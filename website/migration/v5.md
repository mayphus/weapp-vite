# 从 v4 升级到 v5

## 重大变更

### 1. 从 `vite` 切换到 `rolldown-vite`

为了带给用户更好的体验，我决定从 `vite` 切换到 `rolldown-vite` 来解决经常被用户诟病的热更新慢的问题

然后我以我一个复杂的测试案例进行性能测试，主包有 `726` 个模块，独立分包有 `643` 个模块，测试结果如下：

整体平均构建时间提升：约 `1.86` 倍

热更新平均构建时间提升：约 `2.50` 倍

`vite` 的整体平均构建时间为 `4302.26` ms, 构建热更新平均构建时间为 `2216.58` ms

切换到 `rolldown-vite` 后，整体平均构建时间为 `2317.75` ms, 构建热更新平均构建时间为 `887.56` ms

### 2. 从 `tsup` 切换到 `tsdown`

都是基于 `rolldown` 生态的

### 3. 从 `bunldle-require` 切换到 `rolldown-require`

`rolldown-require` 是我在这个项目写的一个包，基于 `rolldown` 的

使用 `API` 和配置方面，参考了 `bunldle-require` 但是代码完全不同，代码绝大部分都是从 `rolldown-vite` 抽离出来的

## 迁移成本

目前测试用例暂时都是全部通过的，配置项也完全一致。

基本不需要做什么配置上的变更，就能平滑升级上来。

## 是否过于激进?

本来这种事情就是不破不立，我希望给用户带来极致的体验，而不是保存一下等半天，这会让我感觉到自己很失败

我试了我所有的模板，还有 `200` 个测试用例都跑通了，所以 `weapp-vite` 认为 `v5` 升级还是利极大的大于弊的。
