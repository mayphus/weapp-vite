// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`build import-umd > dist > app.js 1`] = `
"App({globalData:{},onLaunch(){}});
"
`;

exports[`build import-umd > dist > app.json 1`] = `
"{
  "pages": [
    "pages/index/index",
    "pages/index/vue"
  ],
  "window": {},
  "style": "v2",
  "componentFramework": "glass-easel",
  "sitemapLocation": "sitemap.json"
}"
`;

exports[`build import-umd > dist > app.wxss 1`] = `
".app{color:red}
/*$vite$:1*/"
`;

exports[`build import-umd > dist > components/Navbar/Navbar.js 1`] = `
"Component({});
"
`;

exports[`build import-umd > dist > components/Navbar/Navbar.json 1`] = `
"{
  "component": true,
  "styleIsolation": "apply-shared",
  "usingComponents": {}
}"
`;

exports[`build import-umd > dist > components/Navbar/Navbar.wxml 1`] = `
"<view>Navbar</view>
"
`;

exports[`build import-umd > dist > components/Navbar/Navbar.wxss 1`] = `
".navbar{color:red}
/*$vite$:1*/"
`;

exports[`build import-umd > dist > components/chart/index.js 1`] = `
"function BP(Ae){return Ae&&Ae.__esModule&&Object.prototype.hasOwnProperty.call(Ae,"default")?Ae.default:Ae}var gl={exports:{}},RP=gl.exports,F1;function IP(){return F1||(F1=1,function(Ae,us){(function(K,ne){ne(us)})(RP,function(K){/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function ne(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e}function Ie(s,t,e,i){return new(e||(e=Promise))(function(n,r){function a(h){try{l(i.next(h))}catch(c){r(c)}}function o(h){try{l(i.throw(h))}catch(c){r(c)}}function l(h){var c;h.done?n(h.value):(c=h.value,c instanceof e?c:new e(function(u){u(c)})).then(a,o)}l((i=i.apply(s,[])).next())})}const H1=s=>s;var Zi,st;function V1(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}K.RenderModeEnum=void 0,(Zi=K.RenderModeEnum||(K.RenderModeEnum={}))["desktop-browser"]="desktop-browser",Zi["mobile-browser"]="mobile-browser",Zi.node="node",Zi.worker="worker",Zi.miniApp="miniApp",Zi.wx="wx",Zi.tt="tt",Zi.harmony="harmony",Zi["desktop-miniApp"]="desktop-miniApp",Zi.lynx="lynx",function(s){s.cartesianAxis="cartesianAxis",s.cartesianBandAxis="cartesianAxis-band",s.cartesianLinearAxis="cartesianAxis-linear",s.cartesianTimeAxis="cartesianAxis-time",s.cartesianLogAxis="cartesianAxis-log",s.cartesianSymlogAxis="cartesianAxis-symlog",s.polarAxis="polarAxis",s.polarBandAxis="polarAxis-band",s.polarLinearAxis="polarAxis-linear",s.crosshair="crosshair",s.cartesianCrosshair="cartesianCrosshair",s.polarCrosshair="polarCrosshair",s.dataZoom="dataZoom",s.geoCoordinate="geoCoordinate",s.indicator="indicator",s.discreteLegend="discreteLegend",s.continuousLegend="continuousLegend",s.colorLegend="colorLegend",s.sizeLegend="sizeLegend",s.mapLabel="mapLabel",s.markLine="markLine",s.markArea="markArea",s.markPoint="markPoint",s.polarMarkLine="polarMarkLine",s.polarMarkArea="polarMarkArea",s.polarMarkPoint="polarMarkPoint",s.geoMarkPoint="geoMarkPoint",s.tooltip="tooltip",s.title="title",s.player="player",s.scrollBar="scrollBar",s.label="label",s.totalLabel="totalLabel",s.brush="brush",s.poptip="poptip",s.customMark="customMark"}(st||(st={}));var Cf={exports:{}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}function n(l,h,c){this.fn=l,this.context=h,this.once=c||!1}function r(l,h,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var p=new n(c,u||l,d),g=e?e+h:h;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],p]:l._events[g].push(p):(l._events[g]=p,l._eventsCount++),l}function a(l,h){--l._eventsCount==0?l._events=new i:delete l._events[h]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1)),o.prototype.eventNames=function(){var l,h,c=[];if(this._eventsCount===0)return c;for(h in l=this._events)t.call(l,h)&&c.push(e?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},o.prototype.listeners=function(l){var h=e?e+l:l,c=this._events[h];if(!c)return[];if(c.fn)return[c.fn];for(var u=0,d=c.length,p=new Array(d);u<d;u++)p[u]=c[u].fn;return p},o.prototype.listenerCount=function(l){var h=e?e+l:l,c=this._events[h];return c?c.fn?1:c.length:0},o.prototype.emit=function(l,h,c,u,d,p){var g=e?e+l:l;if(!this._events[g])return!1;var f,m,v=this._events[g],y=arguments.length;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,h),!0;case 3:return v.fn.call(v.context,h,c),!0;case 4:return v.fn.call(v.context,h,c,u),!0;case 5:return v.fn.call(v.context,h,c,u,d),!0;case 6:return v.fn.call(v.context,h,c,u,d,p),!0}for(m=1,f=new Array(y-1);m<y;m++)f[m-1]=arguments[m];v.fn.apply(v.context,f)}else{var _,b=v.length;for(m=0;m<b;m++)switch(v[m].once&&this.removeListener(l,v[m].fn,void 0,!0),y){case 1:v[m].fn.call(v[m].context);break;case 2:v[m].fn.call(v[m].context,h);break;case 3:v[m].fn.call(v[m].context,h,c);break;case 4:v[m].fn.call(v[m].context,h,c,u);break;default:if(!f)for(_=1,f=new Array(y-1);_<y;_++)f[_-1]=arguments[_];v[m].fn.apply(v[m].context,f)}}return!0},o.prototype.on=function(l,h,c){return r(this,l,h,c,!1)},o.prototype.once=function(l,h,c){return r(this,l,h,c,!0)},o.prototype.removeListener=function(l,h,c,u){var d=e?e+l:l;if(!this._events[d])return this;if(!h)return a(this,d),this;var p=this._events[d];if(p.fn)p.fn!==h||u&&!p.once||c&&p.context!==c||a(this,d);else{for(var g=0,f=[],m=p.length;g<m;g++)(p[g].fn!==h||u&&!p[g].once||c&&p[g].context!==c)&&f.push(p[g]);f.length?this._events[d]=f.length===1?f[0]:f:a(this,d)}return this},o.prototype.removeAllListeners=function(l){var h;return l?(h=e?e+l:l,this._events[h]&&a(this,h)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,s.exports=o})(Cf);var Ps=V1(Cf.exports),Jn=(s,t)=>Object.prototype.toString.call(s)===\`[object \${t}]\`,pe=function(s){return arguments.length>1&&arguments[1]!==void 0&&arguments[1]?typeof s=="boolean":s===!0||s===!1||Jn(s,"Boolean")},U=s=>typeof s=="function",I=s=>s==null,R=s=>s!=null,_t=s=>{const t=typeof s;return s!==null&&t==="object"||t==="function"},W1=s=>typeof s=="object"&&s!==null,Ji=function(s){if(!W1(s)||!Jn(s,"Object"))return!1;if(Object.getPrototypeOf(s)===null)return!0;let t=s;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(s)===t},$t=s=>s===void 0,Q=function(s){const t=typeof s;return arguments.length>1&&arguments[1]!==void 0&&arguments[1]?t==="string":t==="string"||Jn(s,"String")},W=s=>Array.isArray?Array.isArray(s):Jn(s,"Array"),Du=function(s){return s!==null&&typeof s!="function"&&Number.isFinite(s.length)},U1=s=>Jn(s,"Date"),it=function(s){const t=typeof s;return arguments.length>1&&arguments[1]!==void 0&&arguments[1]?t==="number":t==="number"||Jn(s,"Number")},q=s=>it(s)&&Number.isFinite(s),G1=s=>new RegExp(/^(http(s)?:\\/\\/)\\w+[^\\s]+(\\.[^\\s]+){1,}$/).test(s),Y1=s=>new RegExp(/^data:image\\/(?:gif|png|jpeg|bmp|webp|svg\\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(s),$1=s=>({}).toString.call(s).replace(/^\\[object /,"").replace(/]$/,"");const X1=Object.prototype;var K1=function(s){const t=s&&s.constructor;return s===(typeof t=="function"&&t.prototype||X1)};const q1=Object.prototype.hasOwnProperty;function ht(s){if(I(s))return!0;if(Du(s))return!s.length;const t=$1(s);if(t==="Map"||t==="Set")return!s.size;if(K1(s))return!Object.keys(s).length;for(const e in s)if(q1.call(s,e))return!1;return!0}var vt=(s,t,e)=>{const i=Q(t)?t.split("."):t;for(let n=0;n<i.length;n++)s=s?s[i[n]]:void 0;return s===void 0?e:s};const Z1=Object.prototype.hasOwnProperty;var _a=(s,t)=>s!=null&&Z1.call(s,t);function Fi(s,t,e){let i;if(!R(s)||typeof s!="object"||t&&t(s))return s;const n=W(s),r=s.length;i=n?new Array(r):typeof s=="object"?{}:pe(s)||it(s)||Q(s)?s:U1(s)?new Date(+s):void 0;const a=n?void 0:Object.keys(Object(s));let o=-1;if(i)for(;++o<(a||s).length;){const l=a?a[o]:o,h=s[l];e&&e.includes(l.toString())?i[l]=h:i[l]=Fi(h,t,e)}return i}function Fu(s,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(t){if(s===t)return;if(R(t)&&typeof t=="object"){const n=Object(t),r=[];for(const l in n)r.push(l);let{length:a}=r,o=-1;for(;a--;){const l=r[++o];!R(n[l])||typeof n[l]!="object"||i&&W(s[l])?Mf(s,l,n[l]):J1(s,t,l,e,i)}}}}function J1(s,t,e){let i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],n=arguments.length>4&&arguments[4]!==void 0&&arguments[4];const r=s[e],a=t[e];let o=t[e],l=!0;if(W(a)){if(i)o=[];else if(W(r))o=r;else if(Du(r)){o=new Array(r.length);let h=-1;const c=r.length;for(;++h<c;)o[h]=r[h]}}else Ji(a)?(o=r??{},typeof r!="function"&&typeof r=="object"||(o={})):l=!1;l&&Fu(o,a,i,n),Mf(s,e,o)}function Mf(s,t,e){(e!==void 0&&!function(i,n){return i===n||Number.isNaN(i)&&Number.isNaN(n)}(s[t],e)||e===void 0&&!(t in s))&&(s[t]=e)}function rt(s){let t=-1;const e=arguments.length<=1?0:arguments.length-1;for(;++t<e;)Fu(s,t+1<1||arguments.length<=t+1?void 0:arguments[t+1],!0);return s}function ju(s,t){if(!s||!Ji(s))return s;const e={};return Object.keys(s).forEach(i=>{const n=s[i];let r=!1;t.forEach(a=>{(Q(a)&&a===i||a instanceof RegExp&&i.match(a))&&(r=!0)}),r||(e[i]=n)}),e}function Ef(s){return Object.prototype.toString.call(s)}function Bf(s){return Object.keys(s)}function Xt(s,t,e){if(s===t)return!0;if(typeof s!=typeof t||s==null||t==null)return!1;if(Number.isNaN(s)&&Number.isNaN(t))return!0;if(Ef(s)!==Ef(t)||U(s)||typeof s!="object")return!1;if(W(s)){if(s.length!==t.length)return!1;for(let r=s.length-1;r>=0;r--)if(!Xt(s[r],t[r]))return!1;return!0}if(!Ji(s))return!1;const i=Bf(s),n=Bf(t);if(i.length!==n.length)return!1;i.sort(),n.sort();for(let r=i.length-1;r>=0;r--)if(i[r]!=n[r])return!1;for(let r=i.length-1;r>=0;r--){const a=i[r];if(!Xt(s[a],t[a]))return!1}return!0}function Q1(s,t,e){const i=function(n){if(!n)return[];if(Object.keys)return Object.keys(n);const r=[];for(const a in n)n.hasOwnProperty(a)&&r.push(a);return r}(t);for(let n=0;n<i.length;n++){const r=i[n];(e?t[r]!=null:s[r]==null)&&(s[r]=t[r])}return s}function Ue(s,t){let e=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(s="prototype"in s?s.prototype:s,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames){const i=Object.getOwnPropertyNames(t);for(let n=0;n<i.length;n++){const r=i[n];r!=="constructor"&&(e?t[r]!=null:s[r]==null)&&(s[r]=t[r])}}else Q1(s,t,e)}function Y(s){return R(s)?W(s)?s:[s]:[]}function Wt(s){if(Du(s))return s[s.length-1]}const Ge=(s,t)=>{var e;if(s.length===0)return;let i=s[0];for(let n=1;n<s.length;n++){const r=s[n];((e=t==null?void 0:t(r,i))!==null&&e!==void 0?e:r-i)>0&&(i=r)}return i},ji=(s,t)=>{var e;if(s.length===0)return;let i=s[0];for(let n=1;n<s.length;n++){const r=s[n];((e=t==null?void 0:t(r,i))!==null&&e!==void 0?e:r-i)<0&&(i=r)}return i};function fl(s,t){if(!W(s)||!W(t)||s.length!==t.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!==t[e])return!1;return!0}function Nu(s){if(!W(s))return[s];const t=[];for(const e of s)t.push(...Nu(e));return t}function tA(s,t){return s<t?-1:s>t?1:s>=t?0:NaN}function ba(s){return Number(s)}const eA=typeof console<"u";function ml(s,t,e){const i=[t].concat([].slice.call(e));eA&&console[s].apply(console,i)}var ci;(function(s){s[s.None=0]="None",s[s.Error=1]="Error",s[s.Warn=2]="Warn",s[s.Info=3]="Info",s[s.Debug=4]="Debug"})(ci||(ci={}));class Tt{static getInstance(t,e){return Tt._instance&&it(t)?Tt._instance.level(t):Tt._instance||(Tt._instance=new Tt(t,e)),Tt._instance}static setInstance(t){return Tt._instance=t}static setInstanceLevel(t){Tt._instance?Tt._instance.level(t):Tt._instance=new Tt(t)}static clearInstance(){Tt._instance=null}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ci.None,e=arguments.length>1?arguments[1]:void 0;this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find(e=>e===t)||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex(i=>i===t);e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this._onErrorHandler.forEach(n=>n(...e))}canLogInfo(){return this._level>=ci.Info}canLogDebug(){return this._level>=ci.Debug}canLogError(){return this._level>=ci.Error}canLogWarn(){return this._level>=ci.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return this._level>=ci.Error&&(this._onErrorHandler.length?this.callErrorHandler(...i):ml((t=this._method)!==null&&t!==void 0?t:"error","ERROR",i)),this}warn(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=ci.Warn&&ml(this._method||"warn","WARN",e),this}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=ci.Info&&ml(this._method||"log","INFO",e),this}debug(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=ci.Debug&&ml(this._method||"log","DEBUG",e),this}}function Rf(s,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;for(I(i)&&(i=s.length);e<i;){const n=e+i>>>1;tA(s[n],t)>0?i=n:e=n+1}return e}Tt._instance=null;const iA=1e-10,sA=1e-10;function Oe(s,t){const e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:iA,i=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:sA)*Math.max(s,t);return Math.abs(s-t)<=Math.max(e,i)}function ds(s,t,e,i){return s>t&&!Oe(s,t,e,i)}function Qi(s,t,e,i){return s<t&&!Oe(s,t,e,i)}const xa=s=>{let t=null,e=null;return function(){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t&&n.every((a,o)=>a===t[o])||(t=n,e=s(...n)),e}};var ui=function(s,t,e){return s<t?t:s>e?e:s},Qn=(s,t,e)=>{let[i,n]=s;n<i&&(i=s[1],n=s[0]);const r=n-i;return r>=e-t?[t,e]:(i=Math.min(Math.max(i,t),e-r),[i,i+r])};function zu(s,t){let e;return s>t&&(e=s,s=t,t=e),i=>Math.max(s,Math.min(t,i))}let vl=!1;try{vl=typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"}catch{vl=!1}function yl(s,t,e){let i,n,r,a,o,l,h=0,c=!1,u=!1,d=!0;const p=!t&&t!==0&&vl;if(typeof s!="function")throw new TypeError("Expected a function");function g(b){const x=i,S=n;return i=n=void 0,h=b,a=s.apply(S,x),a}function f(b,x){return p?(cancelAnimationFrame(o),requestAnimationFrame(b)):setTimeout(b,x)}function m(b){const x=b-l;return l===void 0||x>=t||x<0||u&&b-h>=r}function v(){const b=Date.now();if(m(b))return y(b);o=f(v,function(x){const S=x-h,A=t-(x-l);return u?Math.min(A,r-S):A}(b))}function y(b){return o=void 0,d&&i?g(b):(i=n=void 0,a)}function _(){const b=Date.now(),x=m(b);for(var S=arguments.length,A=new Array(S),w=0;w<S;w++)A[w]=arguments[w];if(i=A,n=this,l=b,x){if(o===void 0)return function(k){return h=k,o=f(v,t),c?g(k):a}(l);if(u)return o=f(v,t),g(l)}return o===void 0&&(o=f(v,t)),a}return t=+t||0,_t(e)&&(c=!!e.leading,u="maxWait"in e,u&&(r=Math.max(q(e.maxWait)?e.maxWait:0,t)),d="trailing"in e?!!e.trailing:d),_.cancel=function(){o!==void 0&&function(b){if(p)return cancelAnimationFrame(b);clearTimeout(b)}(o),h=0,i=l=n=o=void 0},_.flush=function(){return o===void 0?a:y(Date.now())},_.pending=function(){return o!==void 0},_}function tr(s,t,e){let i=!0,n=!0;if(typeof s!="function")throw new TypeError("Expected a function");return _t(e)&&(i="leading"in e?!!e.leading:i,n="trailing"in e?!!e.trailing:n),yl(s,t,{leading:i,trailing:n,maxWait:t})}function Sa(s,t){return e=>s*(1-e)+t*e}function nA(s,t){return function(e){return Math.round(s*(1-e)+t*e)}}vl=!1;const Hu=/[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,Vu=new RegExp(Hu.source,"g"),Ut=1e-12,Gt=Math.PI,bi=Gt/2,je=2*Gt,dt=2*Math.PI,Rt=Math.abs,Ot=Math.atan2,ge=Math.cos,ts=Math.max,ke=Math.min,qt=Math.sin,Ni=Math.sqrt,er=Math.pow;function If(s){return s>=1?bi:s<=-1?-bi:Math.asin(s)}function Of(s,t,e,i,n){let r=e,a=i;return typeof s=="number"&&typeof e=="number"&&(r=(1-n)*s+n*e),typeof t=="number"&&typeof i=="number"&&(a=(1-n)*t+n*i),{x:r,y:a}}function ir(s){const t=s.toString().split(/[eE]/),e=(t[0].split(".")[1]||"").length-(+t[1]||0);return e>0?e:0}function rA(s,t){return function(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10;return Math.round(e*i)/i}(s-t,10**Math.max(ir(s),ir(t)))}class Lt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;this.x=0,this.y=0,this.x=t,this.y=e,this.x1=i,this.y1=n}clone(){return new Lt(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.x=t,this.y=e,this}add(t){return it(t)?(this.x+=t,void(this.y+=t)):(this.x+=t.x,this.y+=t.y,this)}sub(t){return it(t)?(this.x-=t,void(this.y-=t)):(this.x-=t.x,this.y-=t.y,this)}multi(t){throw new Error("暂不支持")}div(t){throw new Error("暂不支持")}}class Ne{static distancePP(t,e){return Ni(er(t.x-e.x,2)+er(t.y-e.y,2))}static distanceNN(t,e,i,n){return Ni(er(t-i,2)+er(e-n,2))}static distancePN(t,e,i){return Ni(er(e-t.x,2)+er(i-t.y,2))}static pointAtPP(t,e,i){return new Lt((e.x-t.x)*i+t.x,(e.y-t.y)*i+t.y)}}function ei(s){return s*(Math.PI/180)}const aA=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(s<0)for(;s<-je;)s+=je;else if(s>0)for(;s>je;)s-=je;return s};function xi(s,t,e){return t?{x:s.x+t*Math.cos(e),y:s.y+t*Math.sin(e)}:{x:s.x,y:s.y}}function _l(s){for(;s<0;)s+=2*Math.PI;for(;s>=2*Math.PI;)s-=2*Math.PI;return s}function oA(s,t,e,i){const{x:n,y:r}=t,a=function(c,u){const d=Math.abs(u-c);if(d>=2*Math.PI||2*Math.PI-d<1e-6)return[0,Math.PI/2,Math.PI,1.5*Math.PI];const p=_l(Math.min(c,u)),g=p+d,f=[p,g];let m=Math.floor(p/Math.PI)*Math.PI/2;for(;m<g;)m>p&&f.push(m),m+=Math.PI/2;return f}(e,i),{width:o,height:l}=s,h=[];return a.forEach(c=>{const u=Math.sin(c),d=Math.cos(c);u===1?h.push(l-r):u===-1?h.push(r):d===1?h.push(o-n):d===-1?h.push(n):(u>0?h.push(Math.abs((l-r)/u)):h.push(Math.abs(r/u)),d>0?h.push(Math.abs((o-n)/d)):h.push(Math.abs(n/d)))}),Math.min.apply(null,h)}function Pf(s){return(s=_l(s))>0&&s<=Math.PI/2?2:s>Math.PI/2&&s<=Math.PI?3:s>Math.PI&&s<=3*Math.PI/2?4:1}var Lf;(function(s){s[s.NONE=0]="NONE",s[s.BBOX1=1]="BBOX1",s[s.BBOX2=2]="BBOX2"})(Lf||(Lf={}));const Df=(s,t,e)=>{let i=s.x1,n=s.x2,r=s.y1,a=s.y2,o=t.x1,l=t.x2,h=t.y1,c=t.y2;return e&&(i>n&&([i,n]=[n,i]),r>a&&([r,a]=[a,r]),o>l&&([o,l]=[l,o]),h>c&&([h,c]=[c,h])),{x11:i,x12:n,y11:r,y12:a,x21:o,x22:l,y21:h,y22:c}};function Aa(s,t,e){if(s&&t){if(!e)return!(s.x1>t.x2||s.x2<t.x1||s.y1>t.y2||s.y2<t.y1);const{x11:i,x12:n,y11:r,y12:a,x21:o,x22:l,y21:h,y22:c}=Df(s,t,!0);return!(i>l||n<o||r>c||a<h)}return!0}function Ff(s,t,e){if(!t)return!0;let i=t.x1,n=t.x2,r=t.y1,a=t.y2;return i>n&&([i,n]=[n,i]),r>a&&([r,a]=[a,r]),s.x>=i&&s.x<=n&&s.y>=r&&s.y<=a}function Wu(s,t){return Math.abs(t[0]*s[0]+t[1]*s[1])}function sr(s,t){let{x:e,y:i}=s,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{x:0,y:0};return{x:(e-n.x)*Math.cos(t)-(i-n.y)*Math.sin(t)+n.x,y:(e-n.x)*Math.sin(t)+(i-n.y)*Math.cos(t)+n.y}}function Uu(s){return{x:(s.x1+s.x2)/2,y:(s.y1+s.y2)/2}}function jf(s,t){const e=t?ei(s.angle):s.angle,i=Uu(s);return[sr({x:s.x1,y:s.y1},e,i),sr({x:s.x2,y:s.y1},e,i),sr({x:s.x2,y:s.y2},e,i),sr({x:s.x1,y:s.y2},e,i)]}function Nf(s,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const i=jf(s,e),n=jf(t,e),r=(m,v)=>[v.x-m.x,v.y-m.y],a=r(Uu(s),Uu(t)),o=r(i[0],i[1]),l=r(i[1],i[2]),h=r(n[0],n[1]),c=r(n[1],n[2]),u=e?ei(s.angle):s.angle;let d=e?ei(90-s.angle):s.angle+bi;const p=e?ei(t.angle):t.angle;let g=e?ei(90-t.angle):t.angle+bi;d>dt&&(d-=dt),g>dt&&(g-=dt);const f=(m,v,y,_)=>{const b=[Math.cos(v),Math.sin(v)];return m+(Wu(b,y)+Wu(b,_))/2>Wu(b,a)};return f((s.x2-s.x1)/2,u,h,c)&&f((s.y2-s.y1)/2,d,h,c)&&f((t.x2-t.x1)/2,p,o,l)&&f((t.y2-t.y1)/2,g,o,l)}function pn(s,t,e,i,n,r){if(r>t&&r>i||r<t&&r<i||i===t)return 0;const a=(r-t)/(i-t);let o=i<t?1:-1;a!==1&&a!==0||(o=i<t?.5:-.5);const l=a*(e-s)+s;return l===n?1/0:l>n?o:0}const zf=s=>{let t=s.charCodeAt(0),e=s.length===2?s.charCodeAt(1):0,i=t;return 55296<=t&&t<=56319&&56320<=e&&e<=57343&&(t&=1023,e&=1023,i=t<<10|e,i+=65536),i===12288||65281<=i&&i<=65376||65504<=i&&i<=65510?"F":i===8361||65377<=i&&i<=65470||65474<=i&&i<=65479||65482<=i&&i<=65487||65490<=i&&i<=65495||65498<=i&&i<=65500||65512<=i&&i<=65518?"H":4352<=i&&i<=4447||4515<=i&&i<=4519||4602<=i&&i<=4607||9001<=i&&i<=9002||11904<=i&&i<=11929||11931<=i&&i<=12019||12032<=i&&i<=12245||12272<=i&&i<=12283||12289<=i&&i<=12350||12353<=i&&i<=12438||12441<=i&&i<=12543||12549<=i&&i<=12589||12593<=i&&i<=12686||12688<=i&&i<=12730||12736<=i&&i<=12771||12784<=i&&i<=12830||12832<=i&&i<=12871||12880<=i&&i<=13054||13056<=i&&i<=19903||19968<=i&&i<=42124||42128<=i&&i<=42182||43360<=i&&i<=43388||44032<=i&&i<=55203||55216<=i&&i<=55238||55243<=i&&i<=55291||63744<=i&&i<=64255||65040<=i&&i<=65049||65072<=i&&i<=65106||65108<=i&&i<=65126||65128<=i&&i<=65131||110592<=i&&i<=110593||127488<=i&&i<=127490||127504<=i&&i<=127546||127552<=i&&i<=127560||127568<=i&&i<=127569||131072<=i&&i<=194367||177984<=i&&i<=196605||196608<=i&&i<=262141?"W":32<=i&&i<=126||162<=i&&i<=163||165<=i&&i<=166||i===172||i===175||10214<=i&&i<=10221||10629<=i&&i<=10630?"Na":i===161||i===164||167<=i&&i<=168||i===170||173<=i&&i<=174||176<=i&&i<=180||182<=i&&i<=186||188<=i&&i<=191||i===198||i===208||215<=i&&i<=216||222<=i&&i<=225||i===230||232<=i&&i<=234||236<=i&&i<=237||i===240||242<=i&&i<=243||247<=i&&i<=250||i===252||i===254||i===257||i===273||i===275||i===283||294<=i&&i<=295||i===299||305<=i&&i<=307||i===312||319<=i&&i<=322||i===324||328<=i&&i<=331||i===333||338<=i&&i<=339||358<=i&&i<=359||i===363||i===462||i===464||i===466||i===468||i===470||i===472||i===474||i===476||i===593||i===609||i===708||i===711||713<=i&&i<=715||i===717||i===720||728<=i&&i<=731||i===733||i===735||768<=i&&i<=879||913<=i&&i<=929||931<=i&&i<=937||945<=i&&i<=961||963<=i&&i<=969||i===1025||1040<=i&&i<=1103||i===1105||i===8208||8211<=i&&i<=8214||8216<=i&&i<=8217||8220<=i&&i<=8221||8224<=i&&i<=8226||8228<=i&&i<=8231||i===8240||8242<=i&&i<=8243||i===8245||i===8251||i===8254||i===8308||i===8319||8321<=i&&i<=8324||i===8364||i===8451||i===8453||i===8457||i===8467||i===8470||8481<=i&&i<=8482||i===8486||i===8491||8531<=i&&i<=8532||8539<=i&&i<=8542||8544<=i&&i<=8555||8560<=i&&i<=8569||i===8585||8592<=i&&i<=8601||8632<=i&&i<=8633||i===8658||i===8660||i===8679||i===8704||8706<=i&&i<=8707||8711<=i&&i<=8712||i===8715||i===8719||i===8721||i===8725||i===8730||8733<=i&&i<=8736||i===8739||i===8741||8743<=i&&i<=8748||i===8750||8756<=i&&i<=8759||8764<=i&&i<=8765||i===8776||i===8780||i===8786||8800<=i&&i<=8801||8804<=i&&i<=8807||8810<=i&&i<=8811||8814<=i&&i<=8815||8834<=i&&i<=8835||8838<=i&&i<=8839||i===8853||i===8857||i===8869||i===8895||i===8978||9312<=i&&i<=9449||9451<=i&&i<=9547||9552<=i&&i<=9587||9600<=i&&i<=9615||9618<=i&&i<=9621||9632<=i&&i<=9633||9635<=i&&i<=9641||9650<=i&&i<=9651||9654<=i&&i<=9655||9660<=i&&i<=9661||9664<=i&&i<=9665||9670<=i&&i<=9672||i===9675||9678<=i&&i<=9681||9698<=i&&i<=9701||i===9711||9733<=i&&i<=9734||i===9737||9742<=i&&i<=9743||9748<=i&&i<=9749||i===9756||i===9758||i===9792||i===9794||9824<=i&&i<=9825||9827<=i&&i<=9829||9831<=i&&i<=9834||9836<=i&&i<=9837||i===9839||9886<=i&&i<=9887||9918<=i&&i<=9919||9924<=i&&i<=9933||9935<=i&&i<=9953||i===9955||9960<=i&&i<=9983||i===10045||i===10071||10102<=i&&i<=10111||11093<=i&&i<=11097||12872<=i&&i<=12879||57344<=i&&i<=63743||65024<=i&&i<=65039||i===65533||127232<=i&&i<=127242||127248<=i&&i<=127277||127280<=i&&i<=127337||127344<=i&&i<=127386||917760<=i&&i<=917999||983040<=i&&i<=1048573||1048576<=i&&i<=1114109?"A":"N"};function bl(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;e||(e=1);const{fontStyle:i=t.fontStyle,fontVariant:n=t.fontVariant,fontWeight:r=t.fontWeight,fontSize:a=t.fontSize,fontFamily:o=t.fontFamily}=s;return(i?i+" ":"")+(n?n+" ":"")+(r?r+" ":"")+a*e+"px "+(o||"sans-serif")}class Ye{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet=\`-/: .,@%'"~\`,this._option=t,this._userSpec=e??{},this.textSpec=this._initSpec(),R(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=R(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(I(this._canvas)&&(R(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),I(this._canvas)&&typeof window<"u"&&window.document!==void 0&&globalThis&&R(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),I(this._context)&&R(this._canvas)){const t=this._canvas.getContext("2d");R(t)&&(t.save(),t.font=bl(this.textSpec),this._contextSaved=!0,this._context=t)}return!I(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:n={}}=this._option,{fontStyle:r=n.fontStyle,fontVariant:a=n.fontVariant,fontWeight:o=(t=n.fontWeight)!==null&&t!==void 0?t:"normal",fontSize:l=(e=n.fontSize)!==null&&e!==void 0?e:12,fontFamily:h=(i=n.fontFamily)!==null&&i!==void 0?i:"sans-serif",align:c,textAlign:u=c??"center",baseline:d,textBaseline:p=d??"middle",ellipsis:g,limit:f}=this._userSpec;let{lineHeight:m=l}=this._userSpec;if(Q(m)&&m[m.length-1]==="%"){const v=Number.parseFloat(m.substring(0,m.length-1))/100;m=l*v}return{fontStyle:r,fontVariant:a,fontFamily:h,fontSize:l,fontWeight:o,textAlign:u,textBaseline:p,ellipsis:g,limit:f,lineHeight:m}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(I(t))return{width:0,height:0};if(I(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:n,textAlign:r,textBaseline:a,ellipsis:o,limit:l,lineHeight:h}=this.textSpec;let c;try{const u=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:n,textAlign:r,textBaseline:a,ellipsis:!!o,maxLineWidth:l||1/0,lineHeight:h});c={width:u.width(),height:u.height()}}catch{this._notSupportVRender=!0,c=this.measureWithNaiveCanvas(t)}return c}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:n,lineHeight:r}=this.textSpec;return{width:i.width,height:(e=r)!==null&&e!==void 0?e:n,fontBoundingBoxAscent:i.fontBoundingBoxAscent,fontBoundingBoxDescent:i.fontBoundingBoxDescent}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){const e={width:0,height:0};for(let i=0;i<t.length;i++){const n=t[i];let r=this._measureSpecialChar(n);I(r)&&Ye.NUMBERS_CHAR_SET.includes(n)&&(r=this._measureNumberChar()),I(r)&&["F","W"].includes(zf(n))&&(r=this._measureFullSizeChar()),I(r)&&(r=this._measureLetterChar()),e.width+=r.width,e.height=Math.max(e.height,r.height),!I(r.fontBoundingBoxAscent)&&(e.fontBoundingBoxAscent=r.fontBoundingBoxAscent),!I(r.fontBoundingBoxDescent)&&(e.fontBoundingBoxDescent=r.fontBoundingBoxDescent)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:n,lineHeight:r}=this.textSpec;for(let a=0;a<t.length;a++){const o=t[a],l=["F","W"].includes(zf(o))?1:.53;i.width+=l*n}return i.height=(e=r)!==null&&e!==void 0?e:n,i}_measureReduce(t,e){var i;const{fontSize:n,lineHeight:r}=this.textSpec,a={width:0,height:0};if(I(t))return a;if(W(t)){const o=t.filter(R).map(l=>l.toString());return o.length===0?a:o.length===1?e(o[0]):{width:o.reduce((l,h)=>Math.max(l,e(h).width),0),height:o.length*(((i=r)!==null&&i!==void 0?i:n)+1)+1}}return e(t.toString())}_measureNumberChar(){if(I(this._numberCharSize)){const t=this._standardMethod(Ye.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/Ye.NUMBERS_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return I(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(Ye.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(I(this._letterCharSize)){const t=this._standardMethod(Ye.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/Ye.ALPHABET_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(t){return R(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){R(this._canvas)&&(this._canvas=null),R(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}}Ye.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",Ye.NUMBERS_CHAR_SET="0123456789",Ye.FULL_SIZE_CHAR="字";function Gu(s,t,e){const{x1:i,y1:n,x2:r,y2:a}=t;return e.onlyTranslate()?(s!==t&&s.setValue(t.x1,t.y1,t.x2,t.y2),s.translate(e.e,e.f),t):(s.clear(),s.add(e.a*i+e.c*n+e.e,e.b*i+e.d*n+e.f),s.add(e.a*r+e.c*n+e.e,e.b*r+e.d*n+e.f),s.add(e.a*r+e.c*a+e.e,e.b*r+e.d*a+e.f),s.add(e.a*i+e.c*a+e.e,e.b*i+e.d*a+e.f),t)}class es{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new es(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;return this.x1=t,this.y1=e,this.x2=i,this.y2=n,this}set(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),n<e?(this.y2=e,this.y1=n):(this.y1=e,this.y2=n),this}add(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return W(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=this.rotatedPoints(t,e,i);return this.clear().add(n[0],n[1]).add(n[2],n[3]).add(n[4],n[5]).add(n[6],n[7])}scale(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const r=this.scalePoints(t,e,i,n);return this.clear().add(r[0],r[1]).add(r[2],r[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.x1*=t,this.x2*=t,this}scaleY(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return Gu(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:n,y1:r,x2:a,y2:o}=this,l=Math.cos(t),h=Math.sin(t),c=e-e*l+i*h,u=i-e*h-i*l;return[l*n-h*r+c,h*n+l*r+u,l*n-h*o+c,h*n+l*o+u,l*a-h*r+c,h*a+l*r+u,l*a-h*o+c,h*a+l*o+u]}scalePoints(t,e,i,n){const{x1:r,y1:a,x2:o,y2:l}=this;return[t*r+(1-t)*i,e*a+(1-e)*n,t*o+(1-t)*i,e*l+(1-e)*n]}}class fe extends es{}class Yu extends es{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;var i;super(t),t&&(this.angle=(i=t.angle)!==null&&i!==void 0?i:e)}intersects(t){return Nf(this,t)}setValue(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;return super.setValue(t,e,i,n),this.angle=r,this}clone(){return new Yu(this)}}class Zt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;this.a=t,this.b=e,this.c=i,this.d=n,this.e=r,this.f=a}equalToMatrix(t){return!(this.e!==t.e||this.f!==t.f||this.a!==t.a||this.d!==t.d||this.b!==t.b||this.c!==t.c)}equalTo(t,e,i,n,r,a){return!(this.e!==r||this.f!==a||this.a!==t||this.d!==n||this.b!==e||this.c!==i)}setValue(t,e,i,n,r,a){return this.a=t,this.b=e,this.c=i,this.d=n,this.e=r,this.f=a,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){const t=this.a,e=this.b,i=this.c,n=this.d,r=this.e,a=this.f,o=new Zt,l=t*n-e*i;return o.a=n/l,o.b=-e/l,o.c=-i/l,o.d=t/l,o.e=(i*a-n*r)/l,o.f=-(t*a-e*r)/l,o}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.a*e+this.c*i,r=this.b*e+this.d*i,a=this.a*-i+this.c*e,o=this.b*-i+this.d*e;return this.a=n,this.b=r,this.c=a,this.d=o,this}rotateByCenter(t,e,i){const n=Math.cos(t),r=Math.sin(t),a=(1-n)*e+r*i,o=(1-n)*i-r*e,l=n*this.a-r*this.b,h=r*this.a+n*this.b,c=n*this.c-r*this.d,u=r*this.c+n*this.d,d=n*this.e-r*this.f+a,p=r*this.e+n*this.f+o;return this.a=l,this.b=h,this.c=c,this.d=u,this.e=d,this.f=p,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}setScale(t,e){return this.b=this.b/this.a*t,this.c=this.c/this.d*e,this.a=t,this.d=e,this}transform(t,e,i,n,r,a){return this.multiply(t,e,i,n,r,a),this}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}transpose(){const{a:t,b:e,c:i,d:n,e:r,f:a}=this;return this.a=e,this.b=t,this.c=n,this.d=i,this.e=a,this.f=r,this}multiply(t,e,i,n,r,a){const o=this.a,l=this.b,h=this.c,c=this.d,u=o*t+h*e,d=l*t+c*e,p=o*i+h*n,g=l*i+c*n,f=o*r+h*a+this.e,m=l*r+c*a+this.f;return this.a=u,this.b=d,this.c=p,this.d=g,this.e=f,this.f=m,this}interpolate(t,e){const i=new Zt;return i.a=this.a+(t.a-this.a)*e,i.b=this.b+(t.b-this.b)*e,i.c=this.c+(t.c-this.c)*e,i.d=this.d+(t.d-this.d)*e,i.e=this.e+(t.e-this.e)*e,i.f=this.f+(t.f-this.f)*e,i}transformPoint(t,e){const{a:i,b:n,c:r,d:a,e:o,f:l}=this,h=i*a-n*r,c=a/h,u=-n/h,d=-r/h,p=i/h,g=(r*l-a*o)/h,f=-(i*l-n*o)/h,{x:m,y:v}=t;e.x=m*c+v*d+g,e.y=m*u+v*p+f}onlyTranslate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return this.a===t&&this.b===0&&this.c===0&&this.d===t}clone(){return new Zt(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){const t=this.a,e=this.b,i=this.c,n=this.d,r=t*n-e*i,a={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(t!==0||e!==0){const o=Math.sqrt(t*t+e*e);a.rotateDeg=e>0?Math.acos(t/o):-Math.acos(t/o),a.scaleX=o,a.scaleY=r/o,a.skewX=(t*i+e*n)/r,a.skewY=0}else if(i!==0||n!==0){const o=Math.sqrt(i*i+n*n);a.rotateDeg=Math.PI/2-(n>0?Math.acos(-i/o):-Math.acos(i/o)),a.scaleX=r/o,a.scaleY=o,a.skewX=0,a.skewY=(t*i+e*n)/r}return a.rotateDeg=180*a.rotateDeg/Math.PI,a}}class lA{constructor(){this.CLEAN_THRESHOLD=1e3,this.L_TIME=1e3,this.R_COUNT=1,this.R_TIMESTAMP_MAX_SIZE=20}clearCache(t,e){const{CLEAN_THRESHOLD:i=this.CLEAN_THRESHOLD,L_TIME:n=this.L_TIME,R_COUNT:r=this.R_COUNT}=e;if(t.size<i)return 0;let a=0;const o=h=>{a++,t.delete(h)},l=Date.now();return t.forEach((h,c)=>{if(h.timestamp.length<r)return o(c);let u=0;for(;l-h.timestamp[h.timestamp.length-1-u]<n&&(u++,!(u>=r)););if(u<r)return o(c);for(;l-h.timestamp[0]>n;)h.timestamp.shift()}),a}addLimitedTimestamp(t,e,i){const{R_TIMESTAMP_MAX_SIZE:n=this.R_TIMESTAMP_MAX_SIZE}=i;t.timestamp.length>n&&t.timestamp.shift(),t.timestamp.push(e)}clearTimeStamp(t,e){const{L_TIME:i=this.L_TIME}=e,n=Date.now();t.forEach(r=>{for(;n-r.timestamp[0]>i;)r.timestamp.shift()})}clearItemTimestamp(t,e){const{L_TIME:i=this.L_TIME}=e,n=Date.now();for(;n-t.timestamp[0]>i;)t.timestamp.shift()}}function xl(s,t,e){t/=100,e/=100;const i=(1-Math.abs(2*e-1))*t,n=i*(1-Math.abs(s/60%2-1)),r=e-i/2;let a=0,o=0,l=0;return 0<=s&&s<60?(a=i,o=n,l=0):60<=s&&s<120?(a=n,o=i,l=0):120<=s&&s<180?(a=0,o=i,l=n):180<=s&&s<240?(a=0,o=n,l=i):240<=s&&s<300?(a=n,o=0,l=i):300<=s&&s<360&&(a=i,o=0,l=n),a=Math.round(255*(a+r)),o=Math.round(255*(o+r)),l=Math.round(255*(l+r)),{r:a,g:o,b:l}}function Sl(s,t,e){s/=255,t/=255,e/=255;const i=Math.min(s,t,e),n=Math.max(s,t,e),r=n-i;let a=0,o=0,l=0;return a=r===0?0:n===s?(t-e)/r%6:n===t?(e-s)/r+2:(s-t)/r+4,a=Math.round(60*a),a<0&&(a+=360),l=(n+i)/2,o=r===0?0:r/(1-Math.abs(2*l-1)),o=+(100*o).toFixed(1),l=+(100*l).toFixed(1),{h:a,s:o,l}}const hA=/^#([0-9a-f]{3,8})$/,Hf={transparent:4294967040},Al={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function kl(s){return((s=Math.max(0,Math.min(255,Math.round(s)||0)))<16?"0":"")+s.toString(16)}function Vf(s){return it(s)?new ii(s>>16,s>>8&255,255&s,1):W(s)?new ii(s[0],s[1],s[2]):new ii(255,255,255)}function $u(s){return s<.04045?.0773993808*s:Math.pow(.9478672986*s+.0521327014,2.4)}function Xu(s){return s<.0031308?12.92*s:1.055*Math.pow(s,.41666)-.055}const Wf=(s,t)=>{const e=hA.exec(s);if(t||e){const i=parseInt(e[1],16),n=e[1].length;return n===3?new ii((i>>8&15)+((i>>8&15)<<4),(i>>4&15)+((i>>4&15)<<4),(15&i)+((15&i)<<4),1):n===6?Vf(i):n===8?new ii(i>>24&255,i>>16&255,i>>8&255,(255&i)/255):null}};class re{static Brighter(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return e===1?t:new re(t).brighter(e).toRGBA()}static SetOpacity(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return e===1?t:new re(t).setOpacity(e).toRGBA()}static getColorBrightness(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"hsl";const i=t instanceof re?t:new re(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3();case"wcag":return i.getLuminanceWCAG()}}static parseColorString(t){if(R(Hf[t]))return function(n){return it(n)?new ii(n>>>24,n>>>16&255,n>>>8&255,255&n):W(n)?new ii(n[0],n[1],n[2],n[3]):new ii(255,255,255,1)}(Hf[t]);if(R(Al[t]))return Vf(Al[t]);const e=\`\${t}\`.trim().toLowerCase(),i=Wf(e);if(i!==void 0)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const n=e.replace(/(?:\\(|\\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new ii(parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10),parseFloat(n[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const n=e.replace(/(?:\\(|\\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),r=xl(parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10));return new ii(r.r,r.g,r.b,parseFloat(n[3]))}}constructor(t){const e=re.parseColorString(t);e?this.color=e:(console.warn(\`Warn: 传入\${t}无法解析为Color\`),this.color=new ii(255,255,255))}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:n}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(n*t))),this}add(t){const{r:e,g:i,b:n}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,n+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:n}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(n*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const n=this.color.opacity,r=Sl(this.color.r,this.color.g,this.color.b),a=xl(I(t)?r.h:ui(t,0,360),I(e)?r.s:e>=0&&e<=1?100*e:e,I(i)?r.l:i<=1&&i>=0?100*i:i);return this.color=new ii(a.r,a.g,a.b,n),this}setRGB(t,e,i){return!I(t)&&(this.color.r=t),!I(e)&&(this.color.g=e),!I(i)&&(this.color.b=i),this}setHex(t){const e=\`\${t}\`.trim().toLowerCase(),i=Wf(e,!0);return i??this}setColorName(t){const e=Al[t.toLowerCase()];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}getLuminanceWCAG(){const t=this.color.r/255,e=this.color.g/255,i=this.color.b/255;let n,r,a;return n=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),r=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),a=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*n+.7152*r+.0722*a}clone(){return new re(this.color.toString())}copyGammaToLinear(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=$u(t.color.r),this.color.g=$u(t.color.g),this.color.b=$u(t.color.b),this}copyLinearToSRGB(t){return this.color.r=Xu(t.color.r),this.color.g=Xu(t.color.g),this.color.b=Xu(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class ii{constructor(t,e,i,n){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),R(n)?this.opacity=isNaN(+n)?1:Math.max(0,Math.min(1,+n)):this.opacity=1}formatHex(){return\`#\${kl(this.r)+kl(this.g)+kl(this.b)+(this.opacity===1?"":kl(255*this.opacity))}\`}formatRgb(){const t=this.opacity;return\`\${t===1?"rgb(":"rgba("}\${this.r},\${this.g},\${this.b}\${t===1?")":\`,\${t})\`}\`}formatHsl(){const t=this.opacity,{h:e,s:i,l:n}=Sl(this.r,this.g,this.b);return\`\${t===1?"hsl(":"hsla("}\${e},\${i}%,\${n}%\${t===1?")":\`,\${t})\`}\`}toString(){return this.formatHex()}}function Uf(s){let t="",e="",i="";const n=s[0]==="#"?1:0;for(let r=n;r<s.length;r++)s[r]!=="#"&&(r<n+2?t+=s[r]:r<n+4?e+=s[r]:r<n+6&&(i+=s[r]));return[parseInt(t,16),parseInt(e,16),parseInt(i,16)]}var cA=Object.freeze({__proto__:null,Color:re,DEFAULT_COLORS:Al,RGB:ii,hexToRgb:Uf,hslToRgb:xl,interpolateRgb:function(s,t){const e=s.r,i=t.r,n=s.g,r=t.g,a=s.b,o=t.b,l=s.opacity,h=t.opacity;return c=>{const u=Math.round(e*(1-c)+i*c),d=Math.round(n*(1-c)+r*c),p=Math.round(a*(1-c)+o*c);return new ii(u,d,p,l*(1-c)+h*c)}},rgbToHex:function(s,t,e){return Number((1<<24)+(s<<16)+(t<<8)+e).toString(16).slice(1)},rgbToHsl:Sl});function Si(s){if(q(s))return[s,s,s,s];if(W(s)){const t=s.length;if(t===1){const e=s[0];return[e,e,e,e]}if(t===2){const[e,i]=s;return[e,i,e,i]}if(t===3){const[e,i,n]=s;return[e,i,n,i]}if(t===4)return s}if(_t(s)){const{top:t=0,right:e=0,bottom:i=0,left:n=0}=s;return[t,e,i,n]}return[0,0,0,0]}function Ku(s){let t,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(!s)return{width:e,height:i};try{t=window==null?void 0:window.getComputedStyle}catch{t=()=>({})}const n=t(s);if(/^(\\d*\\.?\\d+)(px)$/.exec(n.width)){const r=parseFloat(n.width)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)||s.clientWidth-1,a=parseFloat(n.height)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)||s.clientHeight-1;return{width:r<=0?e:r,height:a<=0?i:a}}return{width:e,height:i}}class ps{static getInstance(){return ps.instance||(ps.instance=new ps),ps.instance}constructor(){this.locale_shortWeekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.locale_periods=["AM","PM"],this.locale_weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],this.locale_shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.numberRe=/^\\s*\\d+/,this.pads={"-":"",_:" ",0:"0"},this.requoteRe=/[\\\\^$*+?|[\\]().{}]/g,this.locale_months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.formatShortWeekday=t=>this.locale_shortWeekdays[t.getDay()],this.formatWeekday=t=>this.locale_weekdays[t.getDay()],this.formatShortMonth=t=>this.locale_shortMonths[t.getMonth()],this.formatMonth=t=>this.locale_months[t.getMonth()],this.formatDayOfMonth=(t,e)=>this.pad(t.getDate(),e,2),this.formatHour24=(t,e)=>this.pad(t.getHours(),e,2),this.formatHour12=(t,e)=>this.pad(t.getHours()%12||12,e,2),this.formatMilliseconds=(t,e)=>this.pad(t.getMilliseconds(),e,3),this.formatMonthNumber=(t,e)=>this.pad(t.getMonth()+1,e,2),this.formatMinutes=(t,e)=>this.pad(t.getMinutes(),e,2),this.formatPeriod=t=>this.locale_periods[+(t.getHours()>=12)],this.formatSeconds=(t,e)=>this.pad(t.getSeconds(),e,2),this.formatFullYear=(t,e)=>this.pad(t.getFullYear()%1e4,e,4),this.formatUTCShortWeekday=t=>this.locale_shortWeekdays[t.getUTCDay()],this.formatUTCWeekday=t=>this.locale_weekdays[t.getUTCDay()],this.formatUTCShortMonth=t=>this.locale_shortMonths[t.getUTCMonth()],this.formatUTCMonth=t=>this.locale_months[t.getUTCMonth()],this.formatUTCDayOfMonth=(t,e)=>this.pad(t.getUTCDate(),e,2),this.formatUTCHour24=(t,e)=>this.pad(t.getUTCHours(),e,2),this.formatUTCHour12=(t,e)=>this.pad(t.getUTCHours()%12||12,e,2),this.formatUTCMilliseconds=(t,e)=>this.pad(t.getUTCMilliseconds(),e,3),this.formatUTCMonthNumber=(t,e)=>this.pad(t.getUTCMonth()+1,e,2),this.formatUTCMinutes=(t,e)=>this.pad(t.getUTCMinutes(),e,2),this.formatUTCPeriod=t=>this.locale_periods[+(t.getUTCHours()>=12)],this.formatUTCSeconds=(t,e)=>this.pad(t.getUTCSeconds(),e,2),this.formatUTCFullYear=(t,e)=>this.pad(t.getUTCFullYear()%1e4,e,4),this.formats={a:this.formatShortWeekday,A:this.formatWeekday,b:this.formatShortMonth,B:this.formatMonth,d:this.formatDayOfMonth,e:this.formatDayOfMonth,H:this.formatHour24,I:this.formatHour12,L:this.formatMilliseconds,m:this.formatMonthNumber,M:this.formatMinutes,p:this.formatPeriod,S:this.formatSeconds,Y:this.formatFullYear},this.utcFormats={a:this.formatUTCShortWeekday,A:this.formatUTCWeekday,b:this.formatUTCShortMonth,B:this.formatUTCMonth,d:this.formatUTCDayOfMonth,e:this.formatUTCDayOfMonth,H:this.formatUTCHour24,I:this.formatUTCHour12,L:this.formatUTCMilliseconds,m:this.formatUTCMonthNumber,M:this.formatUTCMinutes,p:this.formatUTCPeriod,S:this.formatUTCSeconds,Y:this.formatUTCFullYear},this.parseShortWeekday=(t,e,i)=>{const n=this.shortWeekdayRe.exec(e.slice(i));return n?(t.w=this.shortWeekdayLookup.get(n[0].toLowerCase()),i+n[0].length):-1},this.parseWeekday=(t,e,i)=>{const n=this.weekdayRe.exec(e.slice(i));return n?(t.w=this.weekdayLookup.get(n[0].toLowerCase()),i+n[0].length):-1},this.parseShortMonth=(t,e,i)=>{const n=this.shortMonthRe.exec(e.slice(i));return n?(t.m=this.shortMonthLookup.get(n[0].toLowerCase()),i+n[0].length):-1},this.parseMonth=(t,e,i)=>{const n=this.monthRe.exec(e.slice(i));return n?(t.m=this.monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1},this.parseDayOfMonth=(t,e,i)=>{const n=this.numberRe.exec(e.slice(i,i+2));return n?(t.d=+n[0],i+n[0].length):-1},this.parseHour24=(t,e,i)=>{const n=this.numberRe.exec(e.slice(i,i+2));return n?(t.H=+n[0],i+n[0].length):-1},this.parseMilliseconds=(t,e,i)=>{const n=this.numberRe.exec(e.slice(i,i+3));return n?(t.L=+n[0],i+n[0].length):-1},this.parseMonthNumber=(t,e,i)=>{const n=this.numberRe.exec(e.slice(i,i+2));return n?(t.m=n-1,i+n[0].length):-1},this.parseMinutes=(t,e,i)=>{const n=this.numberRe.exec(e.slice(i,i+2));return n?(t.M=+n[0],i+n[0].length):-1},this.parsePeriod=(t,e,i)=>{const n=this.periodRe.exec(e.slice(i));return n?(t.p=this.periodLookup.get(n[0].toLowerCase()),i+n[0].length):-1},this.parseSeconds=(t,e,i)=>{const n=this.numberRe.exec(e.slice(i,i+2));return n?(t.S=+n[0],i+n[0].length):-1},this.parseFullYear=(t,e,i)=>{const n=this.numberRe.exec(e.slice(i,i+4));return n?(t.y=+n[0],i+n[0].length):-1},this.parses={a:this.parseShortWeekday,A:this.parseWeekday,b:this.parseShortMonth,B:this.parseMonth,d:this.parseDayOfMonth,e:this.parseDayOfMonth,H:this.parseHour24,I:this.parseHour24,L:this.parseMilliseconds,m:this.parseMonthNumber,M:this.parseMinutes,p:this.parsePeriod,S:this.parseSeconds,Y:this.parseFullYear},this.timeFormat=(t,e)=>this.newFormat(t,this.formats)(new Date(this.getFullTimeStamp(e))),this.timeUTCFormat=(t,e)=>this.newFormat(t,this.utcFormats)(new Date(this.getFullTimeStamp(e))),this.timeParse=(t,e)=>this.newParse(t,!1)(e+""),this.requoteF=this.requote.bind(this),this.periodRe=this.formatRe(this.locale_periods),this.periodLookup=this.formatLookup(this.locale_periods),this.weekdayRe=this.formatRe(this.locale_weekdays),this.weekdayLookup=this.formatLookup(this.locale_weekdays),this.shortWeekdayRe=this.formatRe(this.locale_shortWeekdays),this.shortWeekdayLookup=this.formatLookup(this.locale_shortWeekdays),this.monthRe=this.formatRe(this.locale_months),this.monthLookup=this.formatLookup(this.locale_months),this.shortMonthRe=this.formatRe(this.locale_shortMonths),this.shortMonthLookup=this.formatLookup(this.locale_shortMonths)}requote(t){return t.replace(this.requoteRe,"\\\\$&")}localDate(t){if(0<=t.y&&t.y<100){const e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}utcDate(t){if(0<=t.y&&t.y<100){const e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}newDate(t,e,i){return{y:t,m:e,d:i,H:0,M:0,S:0,L:0}}formatRe(t){return new RegExp("^(?:"+t.map(this.requoteF).join("|")+")","i")}formatLookup(t){return new Map(t.map((e,i)=>[e.toLowerCase(),i]))}pad(t,e,i){const n=t<0?"-":"",r=(n?-t:t)+"",a=r.length;return n+(a<i?new Array(i-a+1).join(e)+r:r)}parseSpecifier(t,e,i,n){let r=0;const a=e.length,o=i.length;let l,h;for(;r<a;){if(n>=o)return-1;if(l=e.charCodeAt(r++),l===37){if(l=e.charAt(r++),h=this.parses[l in this.pads?e.charAt(r++):l],!h||(n=h(t,i,n))<0)return-1}else if(l!==i.charCodeAt(n++))return-1}return n}newParse(t,e){const i=this;return function(n){const r=i.newDate(1900,void 0,1);return i.parseSpecifier(r,t,n+="",0)!==n.length?null:"Q"in r?new Date(r.Q):"s"in r?new Date(1e3*r.s+("L"in r?r.L:0)):(e&&!("Z"in r)&&(r.Z=0),"p"in r&&(r.H=r.H%12+12*r.p),r.m===void 0&&(r.m="q"in r?r.q:0),"Z"in r?(r.H+=r.Z/100|0,r.M+=r.Z%100,i.utcDate(r)):i.localDate(r))}}newFormat(t,e){const i=this;return function(n){const r=[];let a=-1,o=0;const l=t.length;let h,c,u;for(n instanceof Date||(n=new Date(+n));++a<l;)t.charCodeAt(a)===37&&(r.push(t.slice(o,a)),(c=i.pads[h=t.charAt(++a)])?h=t.charAt(++a):c=h==="e"?" ":"0",u=e[h],h=u(n,c),r.push(h),o=a+1);return r.push(t.slice(o,a)),r.join("")}}getFullTimeStamp(t){const e=parseInt(t+"",10);return String(e).length===10?1e3*e:e}}function wl(s,t){const e=t?s.toExponential(t-1):s.toExponential(),i=e.indexOf("e");if(i<0)return null;const n=e.slice(0,i);return[n.length>1?n[0]+n.slice(2):n,+e.slice(i+1)]}let Gf;function Yf(s,t){const e=wl(s,t);if(!e)return s+"";const i=e[0],n=e[1];return n<0?"0."+new Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+new Array(n-i.length+2).join("0")}class uA{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}toString(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type}}const $f=/^(?:(.)?([<>=^]))?([+\\-( ])?([$#])?(0)?(\\d+)?(,)?(\\.\\d+)?(~)?([a-z%])?$/i;function Xf(s){let t;if(t=$f.exec(s))return new uA({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]});Tt.getInstance().error("invalid format: "+s)}const Kf=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];class gn{constructor(){var t,e,i;this.locale={thousands:",",grouping:[3],currency:["$",""]},this.group=this.locale.grouping===void 0||this.locale.thousands===void 0?n=>n:(e=[...this.locale.grouping].map(Number),i=\`\${this.locale.thousands}\`,function(n,r){let a=n.length;const o=[];let l=0,h=e[0],c=0;for(;a>0&&h>0&&(c+h+1>r&&(h=Math.max(1,r-c)),o.push(n.substring(a-=h,a+h)),!((c+=h+1)>r));)h=e[l=(l+1)%e.length];return o.reverse().join(i)}),this.currencyPrefix=this.locale.currency===void 0?"":this.locale.currency[0]+"",this.currencySuffix=this.locale.currency===void 0?"":this.locale.currency[1]+"",this.decimal=this.locale.decimal===void 0?".":this.locale.decimal+"",this.numerals=this.locale.numerals===void 0?n=>n:(t=[...this.locale.numerals].map(String),function(n){return n.replace(/[0-9]/g,r=>t[+r])}),this.percent=this.locale.percent===void 0?"%":this.locale.percent+"",this.minus=this.locale.minus===void 0?"−":this.locale.minus+"",this.nan=this.locale.nan===void 0?"NaN":this.locale.nan+"",this.formatter=n=>this.newFormat(n),this.format=(n,r)=>this.formatter(n)(r),this.formatPrefix=(n,r)=>this._formatPrefix(n,r)}static getInstance(){return gn.instance||(gn.instance=new gn),gn.instance}newFormat(t){const e=Xf(t);let i=e.fill,n=e.align;const r=e.sign,a=e.symbol;let o=e.zero;const l=e.width;let h=e.comma,c=e.precision,u=e.trim,d=e.type;d==="n"?(h=!0,d="g"):qf[d]||(c===void 0&&(c=12),u=!0,d="g"),(o||i==="0"&&n==="=")&&(o=!0,i="0",n="=");const p=a==="$"?this.currencyPrefix:a==="#"&&/[boxX]/.test(d)?"0"+d.toLowerCase():"",g=a==="$"?this.currencySuffix:/[%p]/.test(d)?this.percent:"",f=qf[d],m=/[defgprstz%]/.test(d);c=c===void 0?6:/[gprs]/.test(d)?Math.max(1,Math.min(21,c)):Math.max(0,Math.min(20,c));const{nan:v,minus:y,decimal:_,group:b,numerals:x}=this;function S(A){let w,k,T,C=p,M=g,B=A;if(d==="c")M=f(B)+M,B="";else{B=+B;let L=B<0||1/B<0;if(B=isNaN(B)?v:f(Math.abs(B),c),u&&(B=function(P){const F=P.length;let j,D=-1;t:for(let N=1;N<F;++N)switch(P[N]){case".":D=j=N;break;case"0":D===0&&(D=N),j=N;break;default:if(!+P[N])break t;D>0&&(D=0)}return D>0?P.slice(0,D)+P.slice(j+1):P}(B)),L&&+B==0&&r!=="+"&&(L=!1),C=(L?r==="("?r:y:r==="-"||r==="("?"":r)+C,M=(d==="s"?Kf[8+Gf/3]:"")+M+(L&&r==="("?")":""),m){for(w=-1,k=B.length;++w<k;)if(T=B.charCodeAt(w),48>T||T>57){M=(T===46?_+B.slice(w+1):B.slice(w))+M,B=B.slice(0,w);break}}}h&&!o&&(B=b(B,1/0));let O=C.length+B.length+M.length,E=O<l?new Array(l-O+1).join(i):"";switch(h&&o&&(B=b(E+B,E.length?l-M.length:1/0),E=""),n){case"<":B=C+B+M+E;break;case"=":B=C+E+B+M;break;case"^":B=E.slice(0,O=E.length>>1)+C+B+M+E.slice(O);break;default:B=E+C+B+M}return x(B)}return S.toString=function(){return t+""},S}_formatPrefix(t,e){const i=Xf(t);i.type="f";const n=this.newFormat(i.toString()),r=3*Math.max(-8,Math.min(8,Math.floor(function(l){const h=wl(Math.abs(l));return h?h[1]:NaN}(e)/3))),a=Math.pow(10,-r),o=Kf[8+r/3];return function(l){return n(a*l)+o}}}const qf={"%":(s,t)=>(100*s).toFixed(t),b:s=>Math.round(s).toString(2),c:s=>s+"",d:function(s){return Math.abs(s=Math.round(s))>=1e21?s.toLocaleString("en").replace(/,/g,""):s.toString(10)},f:(s,t)=>s.toFixed(t),e:(s,t)=>s.toExponential(t),g:(s,t)=>s.toPrecision(t),o:s=>Math.round(s).toString(8),p:(s,t)=>Yf(100*s,t),r:Yf,s:function(s,t){const e=wl(s,t);if(!e)return s+"";const i=e[0],n=e[1],r=n-(Gf=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,a=i.length;return r===a?i:r>a?i+new Array(r-a+1).join("0"):r>0?i.slice(0,r)+"."+i.slice(r):"0."+new Array(1-r).join("0")+wl(s,Math.max(0,t+r-1))[0]},X:s=>Math.round(s).toString(16).toUpperCase(),x:s=>Math.round(s).toString(16),t:(s,t)=>Number.isInteger(s)?s.toFixed(2):Math.floor(s*Math.pow(10,t))/Math.pow(10,t)+"",z:(s,t)=>s%1==0?s+"":s.toFixed(t)},dA=function(s){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return function(n){n||(n={});let r=-1;const a=arguments.length<=1?0:arguments.length-1;for(;++r<a;)pA(n,r+1<1||arguments.length<=r+1?void 0:arguments[r+1]);return n}(Fi(s),...e)};function Zf(s,t,e){const i=t[e];if(i===void 0)s[e]=null;else if(_t(i)){_t(s[e])||(s[e]={});for(const n in i)Zf(s[e],i,n)}else s[e]=i}function pA(s,t){if(_t(t)&&s!==t)for(const e in t)Zf(s,t,e)}var ka;(function(s){s.DSV="dsv",s.TREE="tree",s.GEO="geo",s.BYTE="bytejson",s.HEX="hex",s.GRAPH="graph",s.TABLE="table",s.GEO_GRATICULE="geo-graticule"})(ka||(ka={}));const Jf=(s,t)=>{var e,i;if(!(t!=null&&t.fields)||s.length===0)return s;const n=t.fields,r=s[0],a={},o=[];for(const l in n)if(Object.prototype.hasOwnProperty.call(n,l)){const h=n[l];if(!h.type){let u=r;l in r||(u=(e=s.find(d=>l in d))!==null&&e!==void 0?e:r),h.type=typeof u[l]=="number"?"linear":"ordinal"}let c;if(typeof h.sortIndex=="number"&&(c={key:l,type:h.type,index:h.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:h.sortReverse===!0},o.push(c)),((i=h.domain)===null||i===void 0?void 0:i.length)>0)if(h.type==="ordinal"){h._domainCache={},a[l]=h;const u={};h.domain.forEach((d,p)=>{u[d]=p,h._domainCache[d]=p}),c&&(c.sortIndex=u,c.sortIndexCount=h.domain.length)}else h.domain.length>=2&&(a[l]=h)}return Object.keys(a).length>0&&(s=s.filter(l=>{for(const h in a){const c=a[h];if(c.type==="ordinal"){if(!(l[h]in c._domainCache))return!1}else if(c.domain[0]>l[h]||c.domain[1]<l[h])return!1}return!0})),o.sort((l,h)=>l.index-h.index),s.sort((l,h)=>function(c,u,d){for(let p=0;p<d.length;p++){const g=d[p];let f=0;if(g.type==="ordinal"?(g.sortIndex[u[g.key]]===void 0&&(g.sortIndex[u[g.key]]=g.sortIndexCount++),g.sortIndex[c[g.key]]===void 0&&(g.sortIndex[c[g.key]]=g.sortIndexCount++),f=g.sortIndex[c[g.key]]-g.sortIndex[u[g.key]]):g.type==="linear"&&(f=c[g.key]-u[g.key]),g.sortReverse&&(f=-f),f!==0)return f}return 0}(l,h,o)),s};var Qf={},qu={};function tm(s){return new Function("d","return {"+s.map(function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'}).join(",")+"}")}function em(s){var t=Object.create(null),e=[];return s.forEach(function(i){for(var n in i)n in t||e.push(t[n]=n)}),e}function ri(s,t){var e=s+"",i=e.length;return i<t?new Array(t-i+1).join(0)+e:e}function gA(s){var t,e=s.getUTCHours(),i=s.getUTCMinutes(),n=s.getUTCSeconds(),r=s.getUTCMilliseconds();return isNaN(s)?"Invalid Date":((t=s.getUTCFullYear())<0?"-"+ri(-t,6):t>9999?"+"+ri(t,6):ri(t,4))+"-"+ri(s.getUTCMonth()+1,2)+"-"+ri(s.getUTCDate(),2)+(r?"T"+ri(e,2)+":"+ri(i,2)+":"+ri(n,2)+"."+ri(r,3)+"Z":n?"T"+ri(e,2)+":"+ri(i,2)+":"+ri(n,2)+"Z":i||e?"T"+ri(e,2)+":"+ri(i,2)+"Z":"")}function Zu(s){var t=new RegExp('["'+s+\`
\\r]\`),e=s.charCodeAt(0);function i(o,l){var h,c=[],u=o.length,d=0,p=0,g=u<=0,f=!1;function m(){if(g)return qu;if(f)return f=!1,Qf;var y,_,b=d;if(o.charCodeAt(b)===34){for(;d++<u&&o.charCodeAt(d)!==34||o.charCodeAt(++d)===34;);return(y=d)>=u?g=!0:(_=o.charCodeAt(d++))===10?f=!0:_===13&&(f=!0,o.charCodeAt(d)===10&&++d),o.slice(b+1,y-1).replace(/""/g,'"')}for(;d<u;){if((_=o.charCodeAt(y=d++))===10)f=!0;else if(_===13)f=!0,o.charCodeAt(d)===10&&++d;else if(_!==e)continue;return o.slice(b,y)}return g=!0,o.slice(b,u)}for(o.charCodeAt(u-1)===10&&--u,o.charCodeAt(u-1)===13&&--u;(h=m())!==qu;){for(var v=[];h!==Qf&&h!==qu;)v.push(h),h=m();l&&(v=l(v,p++))==null||c.push(v)}return c}function n(o,l){return o.map(function(h){return l.map(function(c){return a(h[c])}).join(s)})}function r(o){return o.map(a).join(s)}function a(o){return o==null?"":o instanceof Date?gA(o):t.test(o+="")?'"'+o.replace(/"/g,'""')+'"':o}return{parse:function(o,l){var h,c,u=i(o,function(d,p){if(h)return h(d,p-1);c=d,h=l?function(g,f){var m=tm(g);return function(v,y){return f(m(v),y,g)}}(d,l):tm(d)});return u.columns=c||[],u},parseRows:i,format:function(o,l){return l==null&&(l=em(o)),[l.map(a).join(s)].concat(n(o,l)).join(\`
\`)},formatBody:function(o,l){return l==null&&(l=em(o)),n(o,l).join(\`
\`)},formatRows:function(o){return o.map(r).join(\`
\`)},formatRow:r,formatValue:a}}var fA=Zu(",").parse,mA=Zu("	").parse;const vA={delimiter:","},im=function(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(arguments.length>2?arguments[2]:void 0).type=ka.DSV;const e=dA(vA,t),{delimiter:i}=e;if(!Q(i))throw new TypeError("Invalid delimiter: must be a string!");return Zu(i).parse(s)},sm=function(s){return(arguments.length>2?arguments[2]:void 0).type=ka.DSV,fA(s)},nm=function(s){return(arguments.length>2?arguments[2]:void 0).type=ka.DSV,mA(s)},yA=(s,t,e)=>{const i=!pe(t==null?void 0:t.dependencyUpdate)||(t==null?void 0:t.dependencyUpdate);if(!s||!W(s))throw new TypeError("Invalid data: must be DataView array!");return W(e.rawData)&&e.rawData.forEach(n=>{n.target&&(n.target.removeListener("change",e.reRunAllTransform),n.target.removeListener("markRunning",e.markRunning))}),i&&s.forEach(n=>{n.target.addListener("change",e.reRunAllTransform),n.target.addListener("markRunning",e.markRunning)}),s};let Ju=0;function rm(){return Ju>1e8&&(Ju=0),(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"dataset")+"_"+Ju++}class Tl{constructor(t){var e;let i;this.options=t,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new Ps,i=t!=null&&t.name?t.name:rm("dataset"),this.name=i,this._logger=(e=t==null?void 0:t.logger)!==null&&e!==void 0?e:Tt.getInstance()}setLogger(t){this._logger=t}getDataView(t){return this.dataViewMap[t]}setDataView(t,e){var i;this.dataViewMap[t]&&((i=this._logger)===null||i===void 0||i.error(\`Error: dataView \${t} 之前已存在，请重新命名\`)),this.dataViewMap[t]=e}removeDataView(t){this.dataViewMap[t]=null,delete this.dataViewMap[t]}registerParser(t,e){var i;this.parserMap[t]&&((i=this._logger)===null||i===void 0||i.warn(\`Warn: transform \${t} 之前已注册，执行覆盖逻辑\`)),this.parserMap[t]=e}removeParser(t){this.parserMap[t]=null,delete this.parserMap[t]}getParser(t){return this.parserMap[t]||this.parserMap.default}registerTransform(t,e){var i;this.transformMap[t]&&((i=this._logger)===null||i===void 0||i.warn(\`Warn: transform \${t} 之前已注册，执行覆盖逻辑\`)),this.transformMap[t]=e}removeTransform(t){this.transformMap[t]=null,delete this.transformMap[t]}getTransform(t){return this.transformMap[t]}multipleDataViewAddListener(t,e,i){this._callMap||(this._callMap=new Map);let n=this._callMap.get(i);n||(n=()=>{t.some(r=>r.isRunning)||i()}),t.forEach(r=>{r.target.addListener(e,n)}),this._callMap.set(i,n)}allDataViewAddListener(t,e){this.multipleDataViewAddListener(Object.values(this.dataViewMap),t,e)}multipleDataViewRemoveListener(t,e,i){if(this._callMap){const n=this._callMap.get(i);n&&t.forEach(r=>{r.target.removeListener(e,n)}),this._callMap.delete(i)}}multipleDataViewUpdateInParse(t){t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()}),t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.parseNewData(e.data,e.options)})}multipleDataViewUpdateInRawData(t){t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()}),t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.updateRawData(e.data,e.options)})}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}}const Qu="_data-view-diff-rank";class _e{constructor(t,e){var i=this;let n;this.dataSet=t,this.options=e,this.isDataView=!0,this.target=new Ps,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{pushHistory:!0,emitMessage:!0};return i.isRunning=!0,i.resetTransformData(),i.transformsArr.forEach(a=>{i.executeTransform(a,{pushHistory:r.pushHistory,emitMessage:!1}),i.isLastTransform(a)&&i.diffLastData()}),i.isRunning=!1,r.emitMessage!==!1&&i.target.emit("change",[]),i},this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},n=e!=null&&e.name?e.name:rm("dataview"),this.name=n,e!=null&&e.history&&(this.history=e.history,this.historyData=[]),this.dataSet.setDataView(n,this),this.setFields(e==null?void 0:e.fields)}parse(t,e){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];var n;this.isRunning=!0,i&&this.target.emit("beforeParse",[]),e&&(this.parseOption=e);const r=this.cloneParseData(t,e);if(e!=null&&e.type){const a=((n=this.dataSet.getParser(e.type))!==null&&n!==void 0?n:this.dataSet.getParser("bytejson"))(r,e.options,this);this.rawData=r,this.parserData=a,this.history&&this.historyData.push(r,a),this.latestData=a}else this.parserData=r,this.rawData=r,this.history&&this.historyData.push(r),this.latestData=r;return this.isRunning=!1,i&&this.target.emit("afterParse",[]),this}transform(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.isRunning=!0,t&&t.type){let i=!0;if(t.type==="fields"){this._fields=t.options.fields;const n=this.transformsArr.findIndex(r=>r.type===t.type);n>=0&&(i=!1,this.transformsArr[n].options.fields=this._fields)}if(i&&this.transformsArr.push(t),e){const n=this.isLastTransform(t);this.executeTransform(t),n&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(t){return this.transformsArr[this.transformsArr.length-1]===t}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort((t,e)=>{var i,n;return((i=t.level)!==null&&i!==void 0?i:0)-((n=e.level)!==null&&n!==void 0?n:0)})}executeTransform(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{pushHistory:!0,emitMessage:!0};const{pushHistory:i,emitMessage:n}=e,r=this.dataSet.getTransform(t.type)(this.latestData,t.options);this.history&&i!==!1&&this.historyData.push(r),this.latestData=r,n!==!1&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(t){this._diffData=!0,this._diffKeys=t,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var t;if(!this._diffData||!this.latestData.forEach||!(!((t=this._diffKeys)===null||t===void 0)&&t.length))return;const e=this._diffRank+1;if(this._diffRank===0)this.latestData.forEach(i=>{i[Qu]=e,this._diffMap.set(this._diffKeys.reduce((n,r)=>n+i[r],""),i)}),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let i;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach(n=>{n[Qu]=e,i=this._diffKeys.reduce((r,a)=>r+n[a],""),this._diffMap.get(i)?this.latestDataAUD.update.push(n):this.latestDataAUD.add.push(n),this._diffMap.set(i,n)}),this._diffMap.forEach((n,r)=>{n[Qu]<e&&(this.latestDataAUD.del.push(n),this._diffMap.delete(r))})}this._diffRank=e}cloneParseData(t,e){let i=!1;return t instanceof _e||(e==null?void 0:e.clone)!==!0||(i=!0),i?Fi(t):t}parseNewData(t,e){this.parse(t,e||this.parseOption),this.reRunAllTransform()}updateRawData(t,e){const i=this.cloneParseData(t,e);this.rawData=i,this.parserData=i,this.latestData=i,this.reRunAllTransform()}getFields(){var t;return this._fields?this._fields:((t=this.parseOption)===null||t===void 0?void 0:t.type)==="dataview"&&this.rawData.length===1&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._fields=t&&e?rt({},this._fields,t):t;const i=this.transformsArr.find(n=>n.type==="fields");!I(this._fields)&&I(i)?(this.dataSet.registerTransform("fields",Jf),this.transform({type:"fields",options:{fields:this._fields}},!1)):i&&(i.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}}class we{static GenAutoIncrementId(){return we.auto_increment_id++}}we.auto_increment_id=0;class yt{constructor(t){this.id=we.GenAutoIncrementId(),this.registry=t}}const Cl="named",am="inject",om="multi_inject",lm="inversify:tagged",hm="inversify:paramtypes";class td{constructor(t,e){this.key=t,this.value=e}toString(){return this.key===Cl?\`named: \${String(this.value).toString()} \`:\`tagged: { key:\${this.key.toString()}, value: \${String(this.value)} }\`}}var nr=function(s){var t;return function(e){const i=typeof Symbol=="function"&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",n=Object.getPrototypeOf(Function),r=Map,a=new WeakMap;function o(y,_,b){let x=a.get(y);if(u(x)){if(!b)return;x=new r,a.set(y,x)}let S=x.get(_);if(u(S)){if(!b)return;S=new r,x.set(_,S)}return S}function l(y,_,b){if(h(y,_,b))return!0;const x=v(_);return!d(x)&&l(y,x,b)}function h(y,_,b){const x=o(_,b,!1);return!u(x)&&!!x.has(y)}function c(y,_,b){if(h(y,_,b))return function(S,A,w){const k=o(A,w,!1);if(!u(k))return k.get(S)}(y,_,b);const x=v(_);return d(x)?void 0:c(y,x,b)}function u(y){return y===void 0}function d(y){return y===null}function p(y){return typeof y=="object"?y!==null:typeof y=="function"}function g(y,_){switch(function(S){if(S===null)return 1;switch(typeof S){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return S===null?1:6;default:return 6}}(y)){case 0:case 1:case 2:case 3:case 4:case 5:return y}const b="string",x=function(S,A){const w=S[A];if(w!=null){if(!m(w))throw new TypeError;return w}}(y,i);if(x!==void 0){const S=x.call(y,b);if(p(S))throw new TypeError;return S}return function(S,A){{const w=S.toString;if(m(w)){const T=w.call(S);if(!p(T))return T}const k=S.valueOf;if(m(k)){const T=k.call(S);if(!p(T))return T}}throw new TypeError}(y)}function f(y){const _=g(y);return typeof _=="symbol"?_:function(b){return""+b}(_)}function m(y){return typeof y=="function"}function v(y){const _=Object.getPrototypeOf(y);if(typeof y!="function"||y===n||_!==n)return _;const b=y.prototype,x=b&&Object.getPrototypeOf(b);if(x==null||x===Object.prototype)return _;const S=x.constructor;return typeof S!="function"||S===y?_:S}e("defineMetadata",function(y,_,b,x){if(!p(b))throw new TypeError;return S=y,A=_,void o(b,x,!0).set(S,A);var S,A}),e("hasMetadata",function(y,_,b){if(!p(_))throw new TypeError;return u(b)||(b=f(b)),l(y,_,b)}),e("hasOwnMetadata",function(y,_,b){if(!p(_))throw new TypeError;return u(b)||(b=f(b)),h(y,_,b)}),e("getMetadata",function(y,_,b){if(!p(_))throw new TypeError;return u(b)||(b=f(b)),c(y,_,b)})}((t=s,function(e,i){typeof t[e]!="function"&&Object.defineProperty(t,e,{configurable:!0,writable:!0,value:i})})),s}({});function _A(s,t,e,i){(function(n,r,a,o){const l=[o];let h={};nr.hasOwnMetadata(n,r)&&(h=nr.getMetadata(n,r));let c=h[a];c===void 0&&(c=[]),c.push(...l),h[a]=c,nr.defineMetadata(n,h,r)})(lm,s,e.toString(),i)}function cm(s){return(t,e,i)=>{_A(t,0,i,s)}}function um(s){return t=>(e,i,n)=>cm(new td(s,t))(e,i,n)}const At=um(am),dm=um(om);function nt(){return function(s){return nr.defineMetadata(hm,null,s),s}}function ae(s){return cm(new td(Cl,s))}const wa="Singleton",pm="Transient",gm="ConstantValue",bA="DynamicValue",xA="Factory",SA="Function",fm="Instance",AA="Invalid";class ed{constructor(t,e){this.id=we.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=AA,this.constraint=i=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){const t=new ed(this.serviceIdentifier,this.scope);return t.activated=t.scope===wa&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.provider=this.provider,t.constraint=this.constraint,t.cache=this.cache,t}}class kA{getConstructorMetadata(t){return{compilerGeneratedMetadata:nr.getMetadata(hm,t),userGeneratedMetadata:nr.getMetadata(lm,t)||{}}}getPropertiesMetadata(t){throw new Error("暂未实现")}}const wA=(Ml=Cl,s=>{const t=e=>{if(e==null)return!1;if(e.key===Ml&&e.value===s)return!0;if(e.constructorArgsMetadata==null)return!1;const i=e.constructorArgsMetadata;for(let n=0;n<i.length;n++)if(i[n].key===Ml&&i[n].value===s)return!0;return!1};return t.metaData=new td(Ml,s),t});var Ml;class El{constructor(t){this._binding=t}inRequestScope(){throw new Error("暂未实现")}inSingletonScope(){return this._binding.scope=wa,this}inTransientScope(){return this._binding.scope=pm,this}whenTargetNamed(t){return this._binding.constraint=wA(t),this}}class TA{constructor(t){this._binding=t}to(t){return this._binding.type=fm,this._binding.implementationType=t,new El(this._binding)}toSelf(){const t=this._binding.serviceIdentifier;return this.to(t)}toDynamicValue(t){return this._binding.type=bA,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new El(this._binding)}toConstantValue(t){return this._binding.type=gm,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=wa,new El(this._binding)}toFactory(t){return this._binding.type=xA,this._binding.factory=t,this._binding.scope=wa,new El(this._binding)}toService(t){this.toDynamicValue(e=>e.container.get(t))}}const Jt=Symbol("ContributionProvider");class mm{constructor(t,e){this.serviceIdentifier=t,this.container=e}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}}function ze(s,t){s(Jt).toDynamicValue(e=>{let{container:i}=e;return new mm(t,i)}).inSingletonScope().whenTargetNamed(t)}class CA{constructor(t,e){this._args=t,this.name=e,this.taps=[]}tap(t,e){this._tap("sync",t,e)}unTap(t,e){const i=typeof t=="string"?t.trim():t.name;i&&(this.taps=this.taps.filter(n=>!(n.name===i&&(!e||n.fn===e))))}_parseOptions(t,e,i){let n;if(typeof e=="string")n={name:e.trim()};else if(typeof e!="object"||e===null)throw new Error("Invalid tap options");if(typeof n.name!="string"||n.name==="")throw new Error("Missing name for tap");return n=Object.assign({type:t,fn:i},n),n}_tap(t,e,i){this._insert(this._parseOptions(t,e,i))}_insert(t){let e;typeof t.before=="string"?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let i=0;typeof t.stage=="number"&&(i=t.stage);let n=this.taps.length;for(;n>0;){n--;const r=this.taps[n];this.taps[n+1]=r;const a=r.stage||0;if(e){if(e.has(r.name)){e.delete(r.name);continue}if(e.size>0)continue}if(!(a>i)){n++;break}}this.taps[n]=t}}class ai extends CA{call(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.taps.map(n=>n.fn).forEach(n=>n(...e))}}const Ta=Symbol.for("EnvContribution"),Bl=Symbol.for("VGlobal");var MA=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},EA=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},vm=function(s,t){return function(e,i){t(e,i,s)}},BA=function(s,t,e,i){return new(e||(e=Promise))(function(n,r){function a(h){try{l(i.next(h))}catch(c){r(c)}}function o(h){try{l(i.throw(h))}catch(c){r(c)}}function l(h){var c;h.done?n(h.value):(c=h.value,c instanceof e?c:new e(function(u){u(c)})).then(a,o)}l((i=i.apply(s,[])).next())})};let id=class{get env(){return this._env}get isImageAnonymous(){return this._isImageAnonymous}set isImageAnonymous(s){this._isImageAnonymous=s}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(s){this._env||this.setEnv("browser"),this.envContribution.supportEvent=s}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(s){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=s}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(s){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=s}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(s){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=s}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(s){this._env||this.setEnv("browser"),this.envContribution.applyStyles=s}constructor(s){this.contributions=s,this._isImageAnonymous=!0,this.id=we.GenAutoIncrementId(),this.hooks={onSetEnv:new ai(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}bindContribution(s){const t=[];if(this.contributions.getContributions().forEach(e=>{const i=e.configure(this,s);i&&i.then&&t.push(i)}),t.length)return Promise.all(t)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(s,t){if(t&&t.force===!0||this._env!==s)return this.deactiveCurrentEnv(),this.activeEnv(s,t)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(s,t){const e=this._env;this._env=s;const i=this.bindContribution(t);if(i&&i.then)return i.then(()=>{this.envParams=t,this.hooks.onSetEnv.call(e,s,this)});this.envParams=t,this.hooks.onSetEnv.call(e,s,this)}setActiveEnvContribution(s){this.envContribution=s}createCanvas(s){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(s)}createOffscreenCanvas(s){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(s)}releaseCanvas(s){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(s)}addEventListener(s,t,e){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(s,t,e)}removeEventListener(s,t,e){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(s,t,e)}dispatchEvent(s){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(s)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(s){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(s):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(s,t){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(s,t):null}loadImage(s){return this._env||this.setEnv("browser"),this.envContribution.loadImage(s)}loadSvg(s){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(s)}loadJson(s){return this._env||this.setEnv("browser"),this.envContribution.loadJson(s)}loadArrayBuffer(s){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(s)}loadBlob(s){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(s)}loadFont(s,t,e){return BA(this,void 0,void 0,function*(){return this._env||this.setEnv("browser"),this.envContribution.loadFont(s,t,e)})}isChrome(){return this._isChrome!=null||(this._env||this.setEnv("browser"),this._isChrome=this._env==="browser"&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return this._isSafari!=null||(this._env||this.setEnv("browser"),this._isSafari=this._env==="browser"&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(s){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(s)}removeDom(s){return this._env||this.setEnv("browser"),this.envContribution.removeDom(s)}createDom(s){return this._env||this.setEnv("browser"),this.envContribution.createDom(s)}updateDom(s,t){return this._env||this.setEnv("browser"),this.envContribution.updateDom(s,t)}getElementTop(s){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementTop(s,t)}getElementLeft(s){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(s,t)}getElementTopLeft(s){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(s,t)}isMacOS(){return this._env||this.setEnv("browser"),this.envContribution.isMacOS()}copyToClipBoard(s){return this._env||this.setEnv("browser"),this.envContribution.copyToClipBoard(s)}};var fn;id=MA([nt(),vm(0,At(Jt)),vm(0,ae(Ta)),EA("design:paramtypes",[Object])],id),function(s){s[s.estimate=0]="estimate",s[s.actualBounding=1]="actualBounding",s[s.fontBounding=2]="fontBounding"}(fn||(fn={}));const RA=je-1e-8;class sd{constructor(t){this.init(t)}init(t){this.bounds=t}arc(t,e,i,n,r,a){if(Math.abs(r-n)>RA)return this.bounds.add(t-i,e-i),void this.bounds.add(t+i,e+i);let o,l,h,c,u=1/0,d=-1/0,p=1/0,g=-1/0;function f(m){h=i*Math.cos(m),c=i*Math.sin(m),h<u&&(u=h),h>d&&(d=h),c<p&&(p=c),c>g&&(g=c)}if(f(n),f(r),r!==n)if((n%=je)<0&&(n+=je),(r%=je)<0&&(r+=je),r<n&&(a=!a,o=n,n=r,r=o),a)for(r-=je,o=n-n%bi,l=0;l<4&&o>r;++l,o-=bi)f(o);else for(o=n-n%bi+bi,l=0;l<4&&o<r;++l,o+=bi)f(o);this.bounds.add(t+u,e+p),this.bounds.add(t+d,e+g)}arcTo(t,e,i,n,r){this.bounds.add(t,e)}bezierCurveTo(t,e,i,n,r,a){this.bounds.add(t,e),this.bounds.add(i,n),this.bounds.add(r,a)}closePath(){}ellipse(){throw new Error("不支持ellipse")}lineTo(t,e){this.bounds.add(t,e)}moveTo(t,e){this.bounds.add(t,e)}quadraticCurveTo(t,e,i,n){this.bounds.add(t,e),this.bounds.add(i,n)}rect(t,e,i,n){this.bounds.add(t,e),this.bounds.add(t+i,e+n)}clear(){this.bounds.clear()}release(){}}class IA{constructor(){this._curves=[],this.bounds=new fe}get curves(){return this._curves}getCurveLengths(){return this._curves.map(t=>t.getLength())}getPointAt(t){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}}const OA=/([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:[eE][-+]?\\d+)?)/gi,PA={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},Ct={A:0,AT:1,C:2,Z:3,E:4,L:5,M:6,Q:7,R:8};let nd,ym,Rl,_m,rd,Il;var Ft,rr,Pe,$e,Ca,ar,jt,Ma,be;function LA(s){const t=s[0],e=s[1],i=s[2],n=s[3],r=s[4],a=s[5],o=s[6],l=s[7],h=l*r,c=-o*a,u=o*r,d=l*a,p=Math.cos(i),g=Math.sin(i),f=Math.cos(n),m=Math.sin(n),v=.5*(n-i),y=Math.sin(.5*v),_=8/3*y*y/Math.sin(v),b=t+p-_*g,x=e+g+_*p,S=t+f,A=e+m,w=S+_*m,k=A-_*f;return[h*b+c*x,u*b+d*x,h*w+c*k,u*w+d*k,h*S+c*A,u*S+d*A]}function bm(s,t,e,i){const n=function(r,a,o,l,h,c,u,d,p){const g=ei(u),f=Math.sin(g),m=Math.cos(g),v=m*(d-r)*.5+f*(p-a)*.5,y=m*(p-a)*.5-f*(d-r)*.5;let _=v*v/((o=Math.abs(o))*o)+y*y/((l=Math.abs(l))*l);_>1&&(_=Math.sqrt(_),o*=_,l*=_);const b=m/o,x=f/o,S=-f/l,A=m/l,w=b*d+x*p,k=S*d+A*p,T=b*r+x*a,C=S*r+A*a;let M=1/((T-w)*(T-w)+(C-k)*(C-k))-.25;M<0&&(M=0);let B=Math.sqrt(M);c===h&&(B=-B);const O=.5*(w+T)-B*(C-k),E=.5*(k+C)+B*(T-w),L=Math.atan2(k-E,w-O);let P=Math.atan2(C-E,T-O)-L;P<0&&c===1?P+=je:P>0&&c===0&&(P-=je);const F=Math.ceil(Math.abs(P/(bi+.001))),j=[];for(let D=0;D<F;++D){const N=L+D*P/F,J=L+(D+1)*P/F;j[D]=[O,E,N,J,o,l,f,m]}return j}(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,e);for(let r=0;r<n.length;++r){const a=LA(n[r]);s.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])}}(function(s){s[s.NONE=0]="NONE",s[s.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",s[s.UPDATE_SHAPE=2]="UPDATE_SHAPE",s[s.CLEAR_SHAPE=253]="CLEAR_SHAPE",s[s.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",s[s.INIT=179]="INIT",s[s.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",s[s.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",s[s.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",s[s.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",s[s.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",s[s.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",s[s.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",s[s.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"})(Ft||(Ft={})),function(s){s[s.GLOBAL=1]="GLOBAL",s[s.LOCAL=16]="LOCAL",s[s.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",s[s.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"}(rr||(rr={})),function(s){s[s.INIT=0]="INIT",s[s.DEFAULT=1]="DEFAULT",s[s.STATE=2]="STATE",s[s.ANIMATE_BIND=10]="ANIMATE_BIND",s[s.ANIMATE_PLAY=11]="ANIMATE_PLAY",s[s.ANIMATE_START=12]="ANIMATE_START",s[s.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",s[s.ANIMATE_END=14]="ANIMATE_END",s[s.TRANSLATE=20]="TRANSLATE",s[s.TRANSLATE_TO=21]="TRANSLATE_TO",s[s.SCALE=22]="SCALE",s[s.SCALE_TO=23]="SCALE_TO",s[s.ROTATE=24]="ROTATE",s[s.ROTATE_TO=25]="ROTATE_TO"}(Pe||(Pe={})),function(s){s[s.INITIAL=0]="INITIAL",s[s.RUNNING=1]="RUNNING",s[s.PAUSED=2]="PAUSED",s[s.END=3]="END"}($e||($e={})),function(s){s[s.NORMAL=0]="NORMAL",s[s.SET_ATTR_IMMEDIATELY=1]="SET_ATTR_IMMEDIATELY"}(Ca||(Ca={})),function(s){s.wait="wait",s.from="from",s.to="to",s.customAnimate="customAnimate"}(ar||(ar={})),function(s){s[s.ROW=1]="ROW",s[s.COLUMN=2]="COLUMN"}(jt||(jt={})),function(s){s[s.CubicBezierCurve=0]="CubicBezierCurve",s[s.QuadraticBezierCurve=1]="QuadraticBezierCurve",s[s.ArcCurve=2]="ArcCurve",s[s.LineCurve=3]="LineCurve",s[s.EllipseCurve=4]="EllipseCurve",s[s.MoveCurve=5]="MoveCurve"}(Ma||(Ma={})),function(s){s[s.beforeFillStroke=0]="beforeFillStroke",s[s.afterFillStroke=1]="afterFillStroke"}(be||(be={}));const DA=[(s,t,e,i,n,r,a)=>t.arc(s[1]*n+e,s[2]*r+i,s[3]*(n+r)/2,s[4],s[5],s[6],a),(s,t,e,i,n,r,a)=>t.arcTo(s[1]*n+e,s[2]*r+i,s[3]*n+e,s[4]*r+i,s[5]*(n+r)/2,a),(s,t,e,i,n,r,a)=>t.bezierCurveTo(s[1]*n+e,s[2]*r+i,s[3]*n+e,s[4]*r+i,s[5]*n+e,s[6]*r+i,a),(s,t,e,i)=>t.closePath(),(s,t,e,i,n,r)=>t.ellipse(s[1]*n+e,s[2]*r+i,s[3]*n,s[4]*r,s[5],s[6],s[7],s[8]),(s,t,e,i,n,r,a)=>t.lineTo(s[1]*n+e,s[2]*r+i,a),(s,t,e,i,n,r,a)=>t.moveTo(s[1]*n+e,s[2]*r+i,a),(s,t,e,i,n,r,a)=>t.quadraticCurveTo(s[1]*n+e,s[2]*r+i,s[3]*n+e,s[4]*r+i,a),(s,t,e,i,n,r,a)=>t.rect(s[1]*n+e,s[2]*r+i,s[3]*n,s[4]*r,a)];function gs(s,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,r=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,a=arguments.length>6?arguments[6]:void 0;for(let o=0;o<s.length;o++){const l=s[o];DA[l[0]](l,t,e,i,n,r,a)}}class ad{getLength(t){return t!=null?this.calcProjLength(t):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}}function xm(s,t){let e=0;const i=s.length;for(let n=0;n<i;n++){const r=s[n],a=t[n],o=s[(n+1)%i],l=t[(n+1)%i];e+=Ne.distanceNN(r,a,o,l)}return e/2}function Sm(s,t,e,i,n){const r=1-n;return r*r*r*s+3*t*n*r*r+3*e*n*n*r+i*n*n*n}function Am(s,t,e,i,n){const r=Sm(s.x,t.x,e.x,i.x,n),a=Sm(s.y,t.y,e.y,i.y,n);return new Lt(r,a)}function km(s,t,e,i){const n=1-i;return n*n*s+2*n*i*t+i*i*e}function wm(s,t,e,i){const n=km(s.x,t.x,e.x,i),r=km(s.y,t.y,e.y,i);return new Lt(n,r)}class Ol extends ad{constructor(t,e,i){super(),this.type=Ma.QuadraticBezierCurve,this.p0=t,this.p1=e,this.p2=i}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y)}getPointAt(t){if(this.defined!==!1)return wm(this.p0,this.p1,this.p2,t);throw new Error("defined为false的点不能getPointAt")}calcLength(){return this._validPoint()?(t=this.p0,e=this.p1,i=this.p2,xm([t.x,e.x,i.x],[t.y,e.y,i.y])):60;var t,e,i}calcProjLength(t){return t===jt.ROW?Rt(this.p0.x-this.p2.x):t===jt.COLUMN?Rt(this.p0.y-this.p2.y):0}getAngleAt(t){const e=ts(t-.01,0),i=ke(t+.01,1),n=this.getPointAt(e),r=this.getPointAt(i);return Ot(r.y-n.y,r.x-n.x)}draw(t,e,i,n,r,a){if(t.moveTo(this.p0.x*n+e,this.p0.y*r+i),a>=1)t.quadraticCurveTo(this.p1.x*n+e,this.p1.y*r+i,this.p2.x*n+e,this.p2.y*r+i);else if(a>0){const[o]=function(l,h){const{p0:c,p1:u,p2:d}=l,p=wm(c,u,d,h),g=Ne.pointAtPP(c,u,h),f=Ne.pointAtPP(u,d,h);return[new Ol(c,g,p),new Ol(p,f,d)]}(this,a);t.quadraticCurveTo(o.p1.x*n+e,o.p1.y*r+i,o.p2.x*n+e,o.p2.y*r+i)}}getYAt(t){throw new Error("QuadraticBezierCurve暂不支持getYAt")}includeX(t){throw new Error("QuadraticBezierCurve暂不支持includeX")}}function Pl(s,t){const{p0:e,p1:i,p2:n,p3:r}=s,a=Am(e,i,n,r,t),o=Ne.pointAtPP(e,i,t),l=Ne.pointAtPP(i,n,t),h=Ne.pointAtPP(n,r,t),c=Ne.pointAtPP(o,l,t),u=Ne.pointAtPP(l,h,t);return[new Ll(e,o,c,a),new Ll(a,u,h,r)]}class Ll extends ad{constructor(t,e,i,n){super(),this.type=Ma.CubicBezierCurve,this.p0=t,this.p1=e,this.p2=i,this.p3=n}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(t){if(this.defined!==!1)return Am(this.p0,this.p1,this.p2,this.p3,t);throw new Error("defined为false的点不能getPointAt")}calcLength(){return this._validPoint()?(t=this.p0,e=this.p1,i=this.p2,n=this.p3,xm([t.x,e.x,i.x,n.x],[t.y,e.y,i.y,n.y])):60;var t,e,i,n}calcProjLength(t){return t===jt.ROW?Rt(this.p0.x-this.p3.x):t===jt.COLUMN?Rt(this.p0.y-this.p3.y):0}getAngleAt(t){const e=ts(t-.01,0),i=ke(t+.01,1),n=this.getPointAt(e),r=this.getPointAt(i);return Ot(r.y-n.y,r.x-n.x)}draw(t,e,i,n,r,a){if(t.moveTo(this.p0.x*n+e,this.p0.y*r+i),a>=1)t.bezierCurveTo(this.p1.x*n+e,this.p1.y*r+i,this.p2.x*n+e,this.p2.y*r+i,this.p3.x*n+e,this.p3.y*r+i);else if(a>0){const[o]=Pl(this,a);t.bezierCurveTo(o.p1.x*n+e,o.p1.y*r+i,o.p2.x*n+e,o.p2.y*r+i,o.p3.x*n+e,o.p3.y*r+i)}}includeX(t){const e=ke(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=ts(this.p0.x,this.p1.x,this.p2.x,this.p3.x);return t>=e&&t<=i}getYAt(t){const e=ke(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=(t-e)/(ts(this.p0.x,this.p1.x,this.p2.x,this.p3.x)-e);return this.getPointAt(i).y}}function Tm(s,t){const{p0:e,p1:i}=s,n=Ne.pointAtPP(e,i,t);return[new Dl(e,n),new Dl(n,i)]}class Dl extends ad{constructor(t,e){super(),this.type=Ma.LineCurve,this.p0=t,this.p1=e}getPointAt(t){if(this.defined!==!1)return Ne.pointAtPP(this.p0,this.p1,t);throw new Error("defined为false的点不能getPointAt")}getAngleAt(t){return this.angle==null&&(this.angle=Ot(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?Ne.distancePP(this.p0,this.p1):60}calcProjLength(t){return t===jt.ROW?Rt(this.p0.x-this.p1.x):t===jt.COLUMN?Rt(this.p0.y-this.p1.y):0}draw(t,e,i,n,r,a){if(t.moveTo(this.p0.x*n+e,this.p0.y*r+i),a>=1)t.lineTo(this.p1.x*n+e,this.p1.y*r+i);else if(a>0){const o=this.getPointAt(a);t.lineTo(o.x*n+e,o.y*r+i)}}includeX(t){return t>=this.p0.x&&t<=this.p1.x||t>=this.p1.x&&t<=this.p0.x}getYAt(t){if(this.includeX(t)){let e=this.p0,i=this.p1;this.p0.x>this.p1.x&&(e=this.p1,i=this.p0);const n=(t-e.x)/(i.x-e.x);return e.y+n*(i.y-e.y)}return 1/0}}class od{get endX(){return this._lastX}get endY(){return this._lastY}constructor(t,e){this.init(t,e)}init(t,e){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=t,this.direction=e,this.curves=[]}bezierCurveTo(t,e,i,n,r,a,o,l){const h=new Ll(new Lt(this._lastX,this._lastY),new Lt(t,e),new Lt(i,n),new Lt(r,a));h.originP1=this._lastOriginP,h.originP2=l,h.defined=o,this.curves.push(h),this._lastX=r,this._lastY=a,this._lastOriginP=l}closePath(){if(this.curves.length<2)return;const t=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,t.defined,this._startOriginP)}ellipse(){throw new Error("SegContext不支持调用ellipse")}lineTo(t,e,i,n){const r=this.addLinearCurve(t,e,i,this._lastOriginP,n);this.curves.push(r),this._lastX=t,this._lastY=e,this._lastOriginP=n}moveTo(t,e,i){return this._lastX=this._startX=t,this._lastY=this._startY=e,this._lastOriginP=i,this._startOriginP=i,this}quadraticCurveTo(t,e,i,n){throw new Error("SegContext不支持调用quadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(t){return this.getLength(t)}addLinearCurve(t,e,i,n,r){const a=new Dl(new Lt(this._lastX,this._lastY),new Lt(t,e));return a.originP1=n,a.originP2=r,a.defined=i,a}getPointAt(t){throw new Error("暂未实现")}getCurveLengths(){return[]}getLength(t){var e,i;if(t===jt.COLUMN){if(!this.curves.length)return 0;const n=this.curves[0],r=this.curves[this.curves.length-1],a=(e=r.p3)!==null&&e!==void 0?e:r.p1;return Rt(n.p0.y-a.y)}if(t===jt.ROW){if(!this.curves.length)return 0;const n=this.curves[0],r=this.curves[this.curves.length-1],a=(i=r.p3)!==null&&i!==void 0?i:r.p1;return Rt(n.p0.x-a.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce((n,r)=>n+r.getLength(),0)),this.length}}class FA extends od{bezierCurveTo(t,e,i,n,r,a,o,l){return super.bezierCurveTo(e,t,n,i,a,r,o,l)}lineTo(t,e,i,n){return super.lineTo(e,t,i,n)}moveTo(t,e,i){return super.moveTo(e,t,i)}clear(){return super.clear()}}function mn(s,t){let e=!1;for(let i=0,n=t.length;i<=n;i++)i>=n===e&&((e=!e)?s.lineStart():s.lineEnd()),e&&s.point(t[i])}function or(s,t,e){const i=t??(Rt(e[e.length-1].x-e[0].x)>Rt(e[e.length-1].y-e[0].y)?jt.ROW:jt.COLUMN);return s==="monotoneY"?new FA(s,i):new od(s,i)}class Cm{constructor(t,e){this.context=t,e&&(this.startPoint=e)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t)}this._lastDefined=t.defined}tryUpdateLength(){return this.context.tryUpdateLength()}}function Ea(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{direction:e,startPoint:i}=t;if(s.length<2-+!!i)return null;const n=or("linear",e,s);return function(r,a){mn(r,a)}(new Cm(n,i),s),n}function Mm(s,t,e,i,n){s.context.bezierCurveTo((2*s._x0+s._x1)/3,(2*s._y0+s._y1)/3,(s._x0+2*s._x1)/3,(s._y0+2*s._y1)/3,(s._x0+4*s._x1+t)/6,(s._y0+4*s._y1+e)/6,i,s.lastPoint1)}class jA{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){this._point===2&&Mm(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;break;default:Mm(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}function NA(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{direction:e,startPoint:i}=t;if(s.length<2-+!!i)return null;if(s.length<3-+!!i)return Ea(s,t);const n=or("basis",e,s);return function(r,a){mn(r,a)}(new jA(n,i),s),n}function Em(s){return s<0?-1:1}function Bm(s,t,e){const i=s._x1-s._x0,n=t-s._x1,r=(s._y1-s._y0)/(i||Number(n<0&&-0)),a=(e-s._y1)/(n||Number(i<0&&-0)),o=(r*n+a*i)/(i+n);return(Em(r)+Em(a))*Math.min(Math.abs(r),Math.abs(a),.5*Math.abs(o))||0}function Rm(s,t){const e=s._x1-s._x0;return e?(3*(s._y1-s._y0)/e-t)/2:t}function ld(s,t,e,i,n){const r=s._x0,a=s._y0,o=s._x1,l=s._y1,h=(o-r)/3;s.context.bezierCurveTo(r+h,a+h*t,o-h,l-h*e,o,l,i,s.lastPoint1)}class Im{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:ld(this,this._t0,Rm(this,this._t0),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1)}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){let e=NaN;const i=t.x,n=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,n,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(i,n,t);break;case 1:this._point=2;break;case 2:this._point=3,ld(this,Rm(this,e=Bm(this,i,n)),e,this._lastDefined1!==!1&&this._lastDefined2!==!1);break;default:ld(this,this._t0,e=Bm(this,i,n),this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=n,this._t0=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined!==!1,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}class zA extends Im{constructor(t,e){super(t,e)}point(t){return super.point({y:t.x,x:t.y,defined:t.defined})}}function HA(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{direction:e,startPoint:i}=t;if(s.length<2-+!!i)return null;if(s.length<3-+!!i)return Ea(s,t);const n=or("monotoneX",e,s);return function(r,a){mn(r,a)}(new Im(n,i),s),n}function VA(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{direction:e,startPoint:i}=t;if(s.length<2-+!!i)return null;if(s.length<3-+!!i)return Ea(s,t);const n=or("monotoneY",e,s);return function(r,a){mn(r,a)}(new zA(n,i),s),n}let WA=class{constructor(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,e=arguments.length>2?arguments[2]:void 0;this.context=s,this._t=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&this._point===2&&this.context.lineTo(this._x,this._y,this._lastDefined!==!1,this.lastPoint),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(s){const t=s.x,e=s.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(t,e,this._lastDefined!==!1&&s.defined!==!1,s):this.context.moveTo(t,e,s);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,e,this._lastDefined!==!1&&s.defined!==!1,this.lastPoint),this.context.lineTo(t,e,this._lastDefined!==!1&&s.defined!==!1,s);else{const i=this._x*(1-this._t)+t*this._t;this._t===.5?this.context.lineTo(i,this._y,this._lastDefined!==!1,this.lastPoint):this.context.lineTo(i,this._y,this._lastDefined!==!1&&s.defined!==!1,this.lastPoint),this.context.lineTo(i,e,this._lastDefined!==!1&&s.defined!==!1,s)}}this._lastDefined=s.defined,this._x=t,this._y=e,this.lastPoint=s}tryUpdateLength(){return this.context.tryUpdateLength()}};function hd(s,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{direction:i,startPoint:n}=e;if(s.length<2-+!!n)return null;const r=new od("step",i??(Rt(s[s.length-1].x-s[0].x)>Rt(s[s.length-1].y-s[0].y)?jt.ROW:jt.COLUMN));return function(a,o){mn(a,o)}(new WA(r,t,n),s),r}class UA extends Cm{lineEnd(){this.context.closePath()}}function GA(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{direction:e,startPoint:i}=t;if(s.length<2-+!!i)return null;const n=or("linear",e,s);return function(r,a){mn(r,a)}(new UA(n,i),s),n}function Om(s,t,e,i,n){let r=s._x1,a=s._y1,o=s._x2,l=s._y2;if(s._l01_a>Ut){const h=2*s._l01_2a+3*s._l01_a*s._l12_a+s._l12_2a,c=3*s._l01_a*(s._l01_a+s._l12_a);r=(r*h-s._x0*s._l12_2a+s._x2*s._l01_2a)/c,a=(a*h-s._y0*s._l12_2a+s._y2*s._l01_2a)/c}if(s._l23_a>Ut){const h=2*s._l23_2a+3*s._l23_a*s._l12_a+s._l12_2a,c=3*s._l23_a*(s._l23_a+s._l12_a);o=(o*h+s._x1*s._l23_2a-t*s._l12_2a)/c,l=(l*h+s._y1*s._l23_2a-e*s._l12_2a)/c}s.context.bezierCurveTo(r,a,o,l,s._x2,s._y2,i,s.lastPoint1)}function Pm(s,t){return function(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{direction:r,startPoint:a}=n;if(e.length<2-+!!a)return null;if(e.length<3-+!!a)return Ea(e,n);const o=or(s,r,e);return mn(new t(o,i,a),e),o}}const YA=Pm("catmullRom",class{constructor(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,e=arguments.length>2?arguments[2]:void 0;this.context=s,this.startPoint=e,this._alpha=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x2,this._y2,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:this.point({x:this._x2,y:this._y2})}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(s){const{x:t,y:e}=s;if(this._point){const i=this._x2-t,n=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(t,e,this._lastDefined1!==!1&&this._lastDefined2!==!1):this.context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:Om(this,t,e,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=s.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=s}tryUpdateLength(){return this.context.tryUpdateLength()}}),$A=Pm("catmullRomClosed",class{constructor(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,e=arguments.length>2?arguments[2]:void 0;this.context=s,this.startPoint=e,this._alpha=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 1:this.context.moveTo(this._x3,this._y3,this.lastPoint1),this.context.closePath();break;case 2:this.context.lineTo(this._x3,this._y3,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),this.context.closePath();break;case 3:this.point({x:this._x3,y:this._y3}),this.point({x:this._x4,y:this._y4}),this.point({x:this._x5,y:this._y5})}}point(s){const{x:t,y:e}=s;if(this._point){const i=this._x2-t,n=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this.context.moveTo(this._x4=t,this._y4=e,s);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Om(this,t,e,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=s.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=s}tryUpdateLength(){return this.context.tryUpdateLength()}});class XA{constructor(t){this.path=t,this._lastX=this._lastY=this._startX=this._startY=0}moveTo(t,e){return this._lastX=this._startX=t,this._lastY=this._startY=e,this}lineTo(t,e){const i=this.addLinearCurve(t,e);this.path.addCurve(i),this._lastX=t,this._lastY=e}addLinearCurve(t,e){return new Dl(new Lt(this._lastX,this._lastY),new Lt(t,e))}quadraticCurveTo(t,e,i,n){const r=new Ol(new Lt(this._lastX,this._lastY),new Lt(t,e),new Lt(i,n));this.path.addCurve(r),this._lastX=i,this._lastY=n}bezierCurveTo(t,e,i,n,r,a){const o=new Ll(new Lt(this._lastX,this._lastY),new Lt(t,e),new Lt(i,n),new Lt(r,a));this.path.addCurve(o),this._lastX=r,this._lastY=a}arcTo(t,e,i,n,r){throw new Error("CurveContext不支持调用arcTo")}ellipse(t,e,i,n,r,a,o,l){throw new Error("CurveContext不支持调用ellipse")}rect(t,e,i,n){throw new Error("CurveContext不支持调用rect")}arc(t,e,i,n,r,a){throw new Error("CurveContext不支持调用arc")}closePath(){this.path.curves.length<2||this.lineTo(this._startX,this._startY)}}function vn(s,t,e){var i,n;switch(t){case"linear":default:return Ea(s,e);case"basis":return NA(s,e);case"monotoneX":return HA(s,e);case"monotoneY":return VA(s,e);case"step":return hd(s,.5,e);case"stepBefore":return hd(s,0,e);case"stepAfter":return hd(s,1,e);case"catmullRom":return YA(s,(i=e==null?void 0:e.curveTension)!==null&&i!==void 0?i:.5,e);case"catmullRomClosed":return $A(s,(n=e==null?void 0:e.curveTension)!==null&&n!==void 0?n:.5,e);case"linearClosed":return GA(s,e)}}class me extends IA{constructor(t){super(),this.commandList=[],t&&(this._ctx=t),this._boundsContext=new sd(this.bounds)}get curves(){return this.tryBuildCurves()}setCtx(t){this._ctx=t}moveTo(t,e){return this.commandList.push([Ct.M,t,e]),this._ctx&&this._ctx.moveTo(t,e),this}lineTo(t,e){return this.commandList.push([Ct.L,t,e]),this._ctx&&this._ctx.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.commandList.push([Ct.Q,t,e,i,n]),this._ctx&&this._ctx.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,a){return this.commandList.push([Ct.C,t,e,i,n,r,a]),this._ctx&&this._ctx.bezierCurveTo(t,e,i,n,r,a),this}arcTo(t,e,i,n,r){return this.commandList.push([Ct.AT,t,e,i,n,r]),this._ctx&&this._ctx.arcTo(t,e,i,n,r),this}ellipse(t,e,i,n,r,a,o,l){return this.commandList.push([Ct.E,t,e,i,n,r,a,o,l]),this._ctx&&this._ctx.ellipse(t,e,i,n,r,a,o,l),this}rect(t,e,i,n){return this.commandList.push([Ct.R,t,e,i,n]),this._ctx&&this._ctx.rect(t,e,i,n),this}arc(t,e,i,n,r,a){return this.commandList.push([Ct.A,t,e,i,n,r,a]),this._ctx&&this._ctx.arc(t,e,i,n,r,a),this}closePath(){return this.commandList.push([Ct.Z]),this._ctx&&this._ctx.closePath(),this}addCurve(t){this._curves.push(t)}clear(){this.transformCbList=null,this.commandList.length=0,this._curves.length=0}beginPath(){this.clear()}tryBuildCurves(){if(!this._curves||!this._curves.length){const t=new XA(this);gs(this.commandList,t,0,0,1,1)}return this._curves}toString(){if(!this.toStringCbList){const i=[];i[Ct.M]=n=>\`M\${n[1]} \${n[2]}\`,i[Ct.L]=n=>\`L\${n[1]} \${n[2]}\`,i[Ct.Q]=n=>\`Q\${n[1]} \${n[2]} \${n[3]} \${n[4]}\`,i[Ct.C]=n=>\`C\${n[1]} \${n[2]} \${n[3]} \${n[4]} \${n[5]} \${n[6]}\`,i[Ct.A]=n=>{const r=[];((o,l,h,c,u,d,p)=>{const g=Math.abs(h-l),f=g>.5*Math.PI?Math.ceil(2*g/Math.PI):1,m=(h-l)/f;for(let v=0;v<f;v++){const y=l+m*v,_=l+m*(v+1),b=4*Math.tan(Math.abs(m)/4)/3,x=_<y?-1:1,S=Math.cos(y),A=Math.sin(y),w=Math.cos(_),k=Math.sin(_),T=S*d+c,C=A*p+u,M=w*d+c,B=k*p+u,O=d*b*x,E=p*b*x;o.push(T-O*A,C+E*S,M+O*k,B-E*w,M,B)}})(r,n[4],n[5],n[1],n[2],n[3],n[3]);let a="";for(let o=0;o<r.length;o+=6)a+=\`C\${r[o]} \${r[o+1]} \${r[o+2]} \${r[o+3]} \${r[o+4]} \${r[o+5]}\`;return a},i[Ct.R]=n=>\`M\${n[1]} \${n[2]} h\${n[3]} v\${n[4]} H\${n[1]}Z\`,i[Ct.Z]=n=>"Z",this.toStringCbList=i}const t=this.toStringCbList;let e="";return this.commandList.forEach(i=>{e+=t[i[0]](i)}),e}fromString(t,e,i,n,r){this.clear();const a=function(o){if(!o)return[];const l=o.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(l===null)return[];let h,c;const u=[];for(let d=0,p=l.length;d<p;d++)if(nd=l[d],ym=nd.slice(1),Rl=nd[0],h=[Rl],c=ym.match(OA),c!==null){for(let g=0,f=c.length;g<f;g++)_m=c[g],rd=parseFloat(_m),Number.isNaN(rd)||h.push(rd);if(Il=PA[Rl],h.length-1>Il){let g,f=Rl;for(let m=1,v=h.length;m<v;m+=Il){g=[f];for(let y=m,_=m+Il;y<_;y++)g.push(h[y]);u.push(g),f==="m"?f="l":f==="M"&&(f="L")}}else u.push(h)}else u.push(h);return u}(t);return this._runCommandStrList(a,e,i,n,r),this._updateBounds(),this}fromLine(t){const{points:e,curveType:i,clipRangeByDimension:n}=t.attribute;if(!e)return;const r=vn(e,i);n==="x"?this.direction=jt.ROW:n==="y"?this.direction=jt.COLUMN:n==="auto"&&(this.direction=r.direction),this._curves=r.curves}fromCustomPath2D(t,e,i,n,r){return this.clear(),this._runCommandList(t.commandList,e,i,n,r),this._updateBounds(),this}transform(t,e,i,n){const r=this.commandList;if(!this.transformCbList){const a=[];a[Ct.M]=this.moveToTransform,a[Ct.L]=this.lineToTransform,a[Ct.Q]=this.quadraticCurveToTransform,a[Ct.C]=this.bezierCurveToTransform,a[Ct.AT]=this.arcToTransform,a[Ct.E]=this.ellipseTransform,a[Ct.R]=this.rectTransform,a[Ct.A]=this.arcTransform,a[Ct.Z]=this.closePathTransform,this.transformCbList=a}r.forEach(a=>{this.transformCbList[a[0]](a,t,e,i,n)}),this._updateBounds()}moveToTransform(t,e,i,n,r){t[1]=t[1]*n+e,t[2]=t[2]*r+i}lineToTransform(t,e,i,n,r){t[1]=t[1]*n+e,t[2]=t[2]*r+i}quadraticCurveToTransform(t,e,i,n,r){t[1]=t[1]*n+e,t[2]=t[2]*r+i,t[3]=t[3]*n+e,t[4]=t[4]*r+i}bezierCurveToTransform(t,e,i,n,r){t[1]=t[1]*n+e,t[2]=t[2]*r+i,t[3]=t[3]*n+e,t[4]=t[4]*r+i,t[5]=t[5]*n+e,t[6]=t[6]*r+i}arcToTransform(t,e,i,n,r){t[1]=t[1]*n+e,t[2]=t[2]*r+i,t[3]=t[3]*n+e,t[4]=t[4]*r+i,t[5]=t[5]*(n+r)/2}ellipseTransform(t,e,i,n,r){t[1]=t[1]*n+e,t[2]=t[2]*r+i,t[3]=t[3]*n,t[4]=t[4]*r}rectTransform(t,e,i,n,r){t[1]=t[1]*n+e,t[2]=t[2]*r+i,t[3]=t[3]*n,t[4]=t[4]*r}arcTransform(t,e,i,n,r){t[1]=t[1]*n+e,t[2]=t[2]*r+i,t[3]=t[3]*(n+r)/2}closePathTransform(){}_runCommandStrList(t){let e,i,n,r,a,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,u=null,d=0,p=0,g=0,f=0;for(let m=0,v=t.length;m<v;++m){switch(e=t[m],h===1&&c===1||(e=KA(e,h,c)),e[0]){case"l":d+=e[1],p+=e[2],this.lineTo(d+o,p+l);break;case"L":d=e[1],p=e[2],this.lineTo(d+o,p+l);break;case"h":d+=e[1],this.lineTo(d+o,p+l);break;case"H":d=e[1],this.lineTo(d+o,p+l);break;case"v":p+=e[1],this.lineTo(d+o,p+l);break;case"V":p=e[1],this.lineTo(d+o,p+l);break;case"m":d+=e[1],p+=e[2],this.moveTo(d+o,p+l);break;case"M":d=e[1],p=e[2],this.moveTo(d+o,p+l);break;case"c":i=d+e[5],n=p+e[6],g=d+e[3],f=p+e[4],this.bezierCurveTo(d+e[1]+o,p+e[2]+l,g+o,f+l,i+o,n+l),d=i,p=n;break;case"C":d=e[5],p=e[6],g=e[3],f=e[4],this.bezierCurveTo(e[1]+o,e[2]+l,g+o,f+l,d+o,p+l);break;case"s":i=d+e[3],n=p+e[4],u[0].match(/[CcSs]/)===null?(g=d,f=p):(g=2*d-g,f=2*p-f),r=d+e[1],a=p+e[2],this.bezierCurveTo(g+o,f+l,r+o,a+l,i+o,n+l),g=r,f=a,d=i,p=n;break;case"S":i=e[3],n=e[4],u[0].match(/[CcSs]/)===null?(g=d,f=p):(g=2*d-g,f=2*p-f),r=e[1],a=e[2],this.bezierCurveTo(g+o,f+l,r+o,a+l,i+o,n+l),g=r,f=a,d=i,p=n;break;case"q":i=d+e[3],n=p+e[4],g=d+e[1],f=p+e[2],this.quadraticCurveTo(g+o,f+l,i+o,n+l),d=i,p=n;break;case"Q":i=e[3],n=e[4],this.quadraticCurveTo(e[1]+o,e[2]+l,i+o,n+l),d=i,p=n,g=e[1],f=e[2];break;case"t":i=d+e[1],n=p+e[2],u[0].match(/[QqTt]/)===null?(g=d,f=p):u[0]==="t"?(g=2*d-r,f=2*p-a):u[0]==="q"&&(g=2*d-g,f=2*p-f),r=g,a=f,this.quadraticCurveTo(g+o,f+l,i+o,n+l),d=i,p=n,g=d+e[1],f=p+e[2];break;case"T":i=e[1],n=e[2],g=2*d-g,f=2*p-f,this.quadraticCurveTo(g+o,f+l,i+o,n+l),d=i,p=n;break;case"a":bm(this,d+o,p+l,[e[1],e[2],e[3],e[4],e[5],e[6]+d+o,e[7]+p+l]),d+=e[6],p+=e[7];break;case"A":bm(this,d+o,p+l,[e[1],e[2],e[3],e[4],e[5],e[6]+o,e[7]+l]),d=e[6],p=e[7];break;case"z":case"Z":this.closePath()}u=e}}_runCommandList(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1;if(e!==0||i!==0||n!==1||r!==1)for(let a=0,o=t.length;a<o;++a){const l=t[a].slice();switch(l[0]){case Ct.L:this.lineToTransform(l,e,i,n,r);break;case Ct.M:this.moveToTransform(l,e,i,n,r);break;case Ct.C:this.bezierCurveToTransform(l,e,i,n,r);break;case Ct.Q:this.quadraticCurveToTransform(l,e,i,n,r);break;case Ct.A:this.arcToTransform(l,e,i,n,r);break;case Ct.E:this.ellipseTransform(l,e,i,n,r);break;case Ct.R:this.rectTransform(l,e,i,n,r);break;case Ct.AT:this.arcToTransform(l,e,i,n,r);break;case Ct.Z:this.closePath()}}else this.commandList=t.map(a=>a.slice())}_updateBounds(){this.bounds.clear(),gs(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===jt.COLUMN){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return Rt(t.p0.y-e.p1.y)}if(this.direction===jt.ROW){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return Rt(t.p0.x-e.p1.x)}return this._curves.reduce((t,e)=>t+e.getLength(),0)}getYAt(t){if(!this.curves)return 1/0;for(let e=0;e<this.curves.length;e++){const i=this.curves[e];if(i.includeX(t))return i.getYAt(t)}return 1/0}getAttrAt(t){if(!this._curves)return{pos:{x:0,y:0},angle:0};let e,i=0;for(let r=0;r<this._curves.length;r++){e=this._curves[r];const a=e.getLength(this.direction);if(i+a>=t)break;i+=a}const n=(t-i)/e.getLength(this.direction);return{pos:e.getPointAt(n),angle:e.getAngleAt(n)}}drawWithClipRange(t,e,i,n,r){this.tryBuildCurves();const a=this.getLength()*r;let o=0;for(let l=0;l<this._curves.length;l++){const h=this._curves[l],c=h.getLength(this.direction);if(!(o+c<=a)){const u=1-(o+c-a)/c;h.draw(t,i,n,e,e,u);break}h.draw(t,i,n,e,e,1),o+=c}}}const Ai=["l",0,0,0,0,0,0,0];function KA(s,t,e){const i=Ai[0]=s[0];if(i==="a"||i==="A")Ai[1]=t*s[1],Ai[2]=e*s[2],Ai[3]=s[3],Ai[4]=s[4],Ai[5]=s[5],Ai[6]=t*s[6],Ai[7]=e*s[7];else if(i==="h"||i==="H")Ai[1]=t*s[1];else if(i==="v"||i==="V")Ai[1]=e*s[1];else for(let n=1,r=s.length;n<r;++n)Ai[n]=(n%2==1?t:e)*s[n];return Ai}const Te={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new Zt},Lm={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},cd={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},Dm=Object.assign({outerBorder:Object.assign(Object.assign({},cd),{distance:0}),innerBorder:Object.assign(Object.assign({},cd),{distance:0})},cd),ki={text:"",maxLineWidth:1/0,maxWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:\`PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,
    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol\`,fontWeight:"",ellipsis:"…",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0,measureMode:fn.fontBounding,keepCenterInLine:!1},qA=Object.assign(Object.assign(Object.assign(Object.assign({forceBoundsWidth:void 0,forceBoundsHeight:void 0,opacity:1,background:null,autoAnimateTexture:!1,textureRatio:1,textureOptions:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,backgroundKeepAspectRatio:!1,backgroundClip:!0,backgroundScale:1,backgroundOffsetX:0,backgroundOffsetY:0,blur:0,filter:"",cursor:null,html:null,react:null},Lm),Dm),{alignSelf:"auto"}),{pickStrokeBuffer:0}),Fm={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},ie=Object.assign(Object.assign(Object.assign({strokeSeg:null,renderable:!0,pickable:!0,shadowGraphic:void 0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,fillStrokeOrder:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden",shadowPickMode:"graphic",keepStrokeScale:!1,clipConfig:null},{_debug_bounds:!1}),qA),Te),ZA=Object.assign(Object.assign({},ie),{startAngle:0,endAngle:dt,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),JA=Object.assign(Object.assign(Object.assign({},ie),Fm),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1,curveTension:1}),QA=Object.assign(Object.assign({},ie),{radius:1,startAngle:0,endAngle:dt}),tk=Object.assign(Object.assign({},ie),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start",baseOpacity:1,cornerType:"round"}),ek=Object.assign(Object.assign({},ie),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),ik=Object.assign(Object.assign(Object.assign({},ie),Fm),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1,curveTension:1}),sk=Object.assign(Object.assign({},ie),{path:new me,fillStrokeOrder:1,clipRange:1,customPath:()=>{Tt.getInstance().warn("空函数")}}),nk=Object.assign(Object.assign({},ie),{points:[],cornerRadius:0,closePath:!0}),rk=Object.assign(Object.assign({},ie),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0,cornerType:"round"});Object.assign(Object.assign({},ie),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0,cornerType:"round"});const ak=Object.assign(Object.assign({},ie),{symbolType:"circle",size:10,keepDirIn3d:!0,clipRange:1}),jm=Object.assign(Object.assign(Object.assign({},ie),ki),{strokeBoundsBuffer:0,keepDirIn3d:!0}),fs=Object.assign(Object.assign(Object.assign({},ie),ki),{upgradeAttrs:null,editable:!1,editOptions:null,ascentDescentMode:"actual",width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],disableAutoWrapLine:!1,maxHeight:void 0,maxWidth:void 0,singleLine:!1}),Ba=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0,maxWidth:500,maxHeight:500},ie),{fill:!0,cornerRadius:0,cornerType:"round"}),ok=Object.assign(Object.assign({},Ba),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1}),H=new class{},lk=function(){const s={linearGradient:/^(linear\\-gradient)/i,radialGradient:/^(radial\\-gradient)/i,conicGradient:/^(conic\\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\\-side|closest\\-corner|farthest\\-side|farthest\\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))px/,percentageValue:/^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))\\%/,emValue:/^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))em/,angleValue:/^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))deg/,fromAngleValue:/^from\\s*(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))deg/,startCall:/^\\(/,endCall:/^\\)/,comma:/^,/,hexColor:/(^\\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\\(\\d{1,3},\\s*\\d{1,3},\\s*\\d{1,3}\\))/i,rgbaColor:/^(rgba\\(\\d{1,3},\\s*\\d{1,3},\\s*\\d{1,3},\\s*((\\d\\.\\d+)|\\d{1,3})\\))/i};let t="";function e(_){const b=new Error(t+": "+_);throw b.source=t,b}function i(){return n("linear",s.linearGradient,r)||n("radial",s.radialGradient,o)||n("conic",s.conicGradient,a)}function n(_,b,x){return function(S,A){if(v(S)){v(s.startCall)||e("Missing (");const k=function(T){const C=x();return C&&(v(s.comma)||e("Missing comma before color stops")),{type:_,orientation:C,colorStops:d(p)}}();return v(s.endCall)||e("Missing )"),k}}(b)}function r(){return m("directional",s.sideOrCorner,1)||m("angular",s.angleValue,1)}function a(){return m("angular",s.fromAngleValue,1)}function o(){let _,b,x=l();return x&&(_=[],_.push(x),b=t,v(s.comma)&&(x=l(),x?_.push(x):t=b)),_}function l(){let _=function(){const b=m("shape",/^(circle)/i,0);return b&&(b.style=f()||h()),b}()||function(){const b=m("shape",/^(ellipse)/i,0);return b&&(b.style=g()||h()),b}();if(_)_.at=c();else{const b=h();if(b){_=b;const x=c();x&&(_.at=x)}else{const x=u();x&&(_={type:"default-radial",at:x})}}return _}function h(){return m("extent-keyword",s.extentKeywords,1)}function c(){if(m("position",/^at/,0)){const _=u();return _||e("Missing positioning value"),_}}function u(){const _={x:g(),y:g()};if(_.x||_.y)return{type:"position",value:_}}function d(_){let b=_();const x=[];if(b)for(x.push(b);v(s.comma);)b=_(),b?x.push(b):e("One extra comma");return x}function p(){const _=m("hex",s.hexColor,1)||m("rgba",s.rgbaColor,1)||m("rgb",s.rgbColor,1)||m("literal",s.literalColor,0);return _||e("Expected color definition"),_.length=g(),_}function g(){return m("%",s.percentageValue,1)||m("position-keyword",s.positionKeywords,1)||f()}function f(){return m("px",s.pixelValue,1)||m("em",s.emValue,1)}function m(_,b,x){const S=v(b);if(S)return{type:_,value:S[x]}}function v(_){const b=/^[\\n\\r\\t\\s]+/.exec(t);b&&y(b[0].length);const x=_.exec(t);return x&&y(x[0].length),x}function y(_){t=t.substr(_)}return function(_){return t=_.toString(),function(){const b=d(i);return t.length>0&&e("Invalid input not EOF"),b}()}}();class lr{static IsGradient(t){return!(typeof t=="string"&&!t.includes("gradient"))}static IsGradientStr(t){return typeof t=="string"&&t.includes("gradient")}static Parse(t){if(lr.IsGradientStr(t))try{const e=lk(t)[0];if(e){if(e.type==="linear")return lr.ParseLinear(e);if(e.type==="radial")return lr.ParseRadial(e);if(e.type==="conic")return lr.ParseConic(e)}}catch{return t}return t}static ParseConic(t){const{orientation:e,colorStops:i=[]}=t,n=Gt/2,r=parseFloat(e.value)/180*Gt-n;return{gradient:"conical",x:.5,y:.5,startAngle:r,endAngle:r+dt,stops:i.map(a=>({color:a.value,offset:parseFloat(a.length.value)/100}))}}static ParseRadial(t){const{colorStops:e=[]}=t;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:e.map(i=>({color:i.value,offset:parseFloat(i.length.value)/100}))}}static ParseLinear(t){const{orientation:e,colorStops:i=[]}=t,n=Gt/2;let r=e.type==="angular"?parseFloat(e.value)/180*Gt:0;for(;r<0;)r+=dt;for(;r>=dt;)r-=dt;let a=0,o=0,l=0,h=0;return r<n?(a=0,o=1,l=Math.sin(r),h=o-Math.cos(r)):r<Gt?(a=0,o=0,l=Math.cos(r-n),h=Math.sin(r-n)):r<Gt+n?(a=1,o=0,l=a-Math.sin(r-Gt),h=Math.cos(r-Gt)):(a=1,l=a-Math.cos(r-n-Gt),h-=Math.sin(r-n-Gt)),{gradient:"linear",x0:a,y0:o,x1:l,y1:h,stops:i.map(c=>({color:c.value,offset:parseFloat(c.length.value)/100}))}}}function ms(s,t,e){let i=t;const{a:n,b:r,c:a,d:o}=s.currentMatrix,l=Math.sign(n)*Math.sqrt(n*n+r*r),h=Math.sign(o)*Math.sqrt(a*a+o*o);return l+h===0?0:(i=i/Math.abs(l+h)*2*e,i)}function Fl(s,t,e){let i,n,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!t||t===!0)return"black";if(W(t))for(let o=0;o<t.length&&(n=t[o],!n);o++);else n=t;if(n=lr.Parse(n),typeof n=="string")return n;if(e.AABBBounds&&(!e.attribute||e.attribute.scaleX!==0||e.attribute.scaleY!==0)){const o=e.AABBBounds;let l=o.x2-o.x1,h=o.y2-o.y1,c=o.x1-r,u=o.y1-a;if(e.attribute){const{scaleX:d=1,scaleY:p=1}=e.attribute;l/=d,h/=p,c/=d,u/=p}n.gradient==="linear"?i=function(d,p,g,f,m,v){var y,_,b,x;const S=d.createLinearGradient(g+((y=p.x0)!==null&&y!==void 0?y:0)*m,f+((_=p.y0)!==null&&_!==void 0?_:0)*v,g+((b=p.x1)!==null&&b!==void 0?b:1)*m,f+((x=p.y1)!==null&&x!==void 0?x:0)*v);return p.stops.forEach(A=>{S.addColorStop(A.offset,A.color)}),S}(s,n,c,u,l,h):n.gradient==="conical"?i=function(d,p,g,f,m,v){var y,_;const b=d.createConicGradient(g+((y=p.x)!==null&&y!==void 0?y:0)*m,f+((_=p.y)!==null&&_!==void 0?_:0)*v,p.startAngle,p.endAngle);return p.stops.forEach(x=>{b.addColorStop(x.offset,x.color)}),b.GetPattern(m+g,v+f,void 0)}(s,n,c,u,l,h):n.gradient==="radial"&&(i=function(d,p,g,f,m,v){var y,_,b,x,S,A;const w=d.createRadialGradient(g+((y=p.x0)!==null&&y!==void 0?y:.5)*m,f+((_=p.y0)!==null&&_!==void 0?_:.5)*v,Math.max(m,v)*((b=p.r0)!==null&&b!==void 0?b:0),g+((x=p.x1)!==null&&x!==void 0?x:.5)*m,f+((S=p.y1)!==null&&S!==void 0?S:.5)*v,Math.max(m,v)*((A=p.r1)!==null&&A!==void 0?A:.5));return p.stops.forEach(k=>{w.addColorStop(k.offset,k.color)}),w}(s,n,c,u,l,h))}return i||"orange"}const ud={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},hk=!0,ck=!1,jl=/\\w|\\(|\\)|-/,Nm=/[.?!,;:/，。？！、；：]/,uk=/\\S/,zm=(s,t)=>{let e=t.fontSize||16;switch(t.script){case"super":case"sub":e*=.8}s.setTextStyle({textAlign:"left",textBaseline:t.textBaseline||"alphabetic",fontStyle:t.fontStyle||"",fontWeight:t.fontWeight||"",fontSize:e,fontFamily:t.fontFamily})};function Nl(s,t,e,i,n){if(!t||t<=0)return 0;const r=H.graphicUtil.textMeasure;let a=i,o=s.slice(0,a),l=Math.floor(r.measureText(o,e).width),h=s.slice(0,a+1),c=Math.floor(r.measureText(h,e).width);for(;l>t||c<=t;){if(l>t?a--:a++,a>s.length){a=s.length;break}if(a<0){a=0;break}o=s.slice(0,a),l=Math.floor(r.measureText(o,e).width),h=s.slice(0,a+1),c=Math.floor(r.measureText(h,e).width)}return n&&(a=zl(s,a)),a}function zl(s,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=t;for(;jl.test(s[i-1])&&jl.test(s[i])||Nm.test(s[i]);)if(i--,i<=0)return e?dk(s,t):t;return i}function dk(s,t){let e=t;for(;jl.test(s[e+1])&&jl.test(s[e])||Nm.test(s[e]);)if(e++,e>=s.length)return e;return e+1}function yn(s,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"actual";const i=H.graphicUtil.textMeasure.measureText(s,t),n={ascent:0,height:0,descent:0,width:0},r=e==="actual"?i.actualBoundingBoxAscent:i.fontBoundingBoxAscent,a=e==="actual"?i.actualBoundingBoxDescent:i.fontBoundingBoxDescent;return typeof r!="number"||typeof a!="number"?(n.width=Math.floor(i.width),n.height=t.fontSize||0,n.ascent=n.height,n.descent=0):(n.width=Math.floor(i.width),n.height=Math.floor(r+a),n.ascent=Math.floor(r),n.descent=n.height-n.ascent),n}var pk=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};let dd=class{configure(s,t){this.canvas=s.canvas,this.context=s.context,s.bindTextMeasure(this)}_measureTextWithoutAlignBaseline(s,t,e){this.context.setTextStyleWithoutAlignBaseline(t);const i=this.context.measureText(s);return e?this.compatibleMetrics(i,t):i}_measureTextWithAlignBaseline(s,t,e){this.context.setTextStyle(t);const i=this.context.measureText(s);return e?this.compatibleMetrics(i,t):i}compatibleMetrics(s,t){if(s.actualBoundingBoxAscent==null||s.actualBoundingBoxDescent==null||s.fontBoundingBoxAscent==null||s.fontBoundingBoxDescent==null){s={width:s.width};const{ascent:e,descent:i}=this.measureTextBoundADscentEstimate(t);s.actualBoundingBoxAscent=e,s.actualBoundingBoxDescent=i,s.fontBoundingBoxAscent=e,s.fontBoundingBoxDescent=i}if(s.actualBoundingBoxLeft==null||s.actualBoundingBoxRight==null){s={width:s.width,actualBoundingBoxAscent:s.actualBoundingBoxAscent,actualBoundingBoxDescent:s.actualBoundingBoxDescent,fontBoundingBoxAscent:s.fontBoundingBoxAscent,fontBoundingBoxDescent:s.fontBoundingBoxDescent};const{left:e,right:i}=this.measureTextBoundLeftRightEstimate(t);s.actualBoundingBoxLeft=e,s.actualBoundingBoxRight=i}return s}estimate(s,t){let{fontSize:e=jm.fontSize}=t,i=0,n=0;for(let r=0;r<s.length;r++)s.charCodeAt(r)<128?i++:n++;return{width:~~(.8*i*e+n*e),height:e}}measureTextWidth(s,t,e){return this.context?(e=e??this._measureTextWithoutAlignBaseline(s,t)).width:this.estimate(s,t).width}measureTextBoundsWidth(s,t,e){return this.context?(e=e??this._measureTextWithoutAlignBaseline(s,t)).width:this.estimate(s,t).width}measureTextBoundsLeftRight(s,t,e){return this.context?{left:(e=e??this._measureTextWithAlignBaseline(s,t,!0)).actualBoundingBoxLeft,right:e.actualBoundingBoxRight}:this.measureTextBoundLeftRightEstimate(t)}measureTextPixelHeight(s,t,e){var i;return this.context?(e=e??this._measureTextWithoutAlignBaseline(s,t,!0),Math.abs(e.actualBoundingBoxAscent-e.actualBoundingBoxDescent)):(i=t.fontSize)!==null&&i!==void 0?i:ki.fontSize}measureTextPixelADscent(s,t,e){return this.context?{ascent:(e=e??this._measureTextWithAlignBaseline(s,t,!0)).actualBoundingBoxAscent,descent:e.actualBoundingBoxDescent}:this.measureTextBoundADscentEstimate(t)}measureTextBoundHieght(s,t,e){var i;return this.context?(e=e??this._measureTextWithoutAlignBaseline(s,t,!0),Math.abs(e.fontBoundingBoxAscent-e.fontBoundingBoxDescent)):(i=t.fontSize)!==null&&i!==void 0?i:ki.fontSize}measureTextBoundADscent(s,t,e){return this.context?{ascent:(e=e??this._measureTextWithAlignBaseline(s,t,!0)).fontBoundingBoxAscent,descent:e.fontBoundingBoxDescent}:this.measureTextBoundADscentEstimate(t)}measureTextBoundADscentEstimate(s){var t;const e=(t=s.fontSize)!==null&&t!==void 0?t:ki.fontSize;return{ascent:.79*e,descent:.21*e}}measureTextBoundLeftRightEstimate(s){var t;const e=(t=s.fontSize)!==null&&t!==void 0?t:ki.fontSize,{textAlign:i}=s;return i==="center"?{left:e/2,right:e/2}:i==="right"||i==="end"?{left:e,right:0}:{left:0,right:e}}measureTextPixelADscentAndWidth(s,t,e){if(!this.context)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(t)),{width:this.estimate(s,t).width});const i=this._measureTextWithoutAlignBaseline(s,t,!0);if(e===fn.actualBounding)return{ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,width:i.width};if(e===fn.estimate)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(t)),{width:i.width});if(e===fn.fontBounding){let n=i.fontBoundingBoxAscent,r=i.fontBoundingBoxDescent;if(i.actualBoundingBoxDescent&&r<i.actualBoundingBoxDescent){const a=i.actualBoundingBoxDescent-r;r+=a,n-=a}else if(i.actualBoundingBoxAscent&&n<i.actualBoundingBoxAscent){const a=i.actualBoundingBoxAscent-n;n+=a,r-=a}return{ascent:n,descent:r,width:i.width}}return{ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,width:i.width}}measureText(s,t){return this.context?(this.context.setTextStyleWithoutAlignBaseline(t),this.context.measureText(s)):this.estimate(s,t)}clipTextVertical(s,t,e,i){if(s.length===0)return{verticalList:s,width:0};const{fontSize:n=12}=t;s.forEach(l=>{l.width=l.direction===0?n:this.measureTextWidth(l.text,t)});const r=[];let a=0,o=0;for(;o<s.length&&a+s[o].width<e;o++)a+=s[o].width,r.push(s[o]);if(s[o]&&s[o].text.length>1){const l=this._clipText(s[o].text,t,e-a,0,s[o].text.length-1,"end",!1);if(i&&l.str!==s[o].text){let h="",c=0;for(let d=0;d<o;d++){const p=s[d];h+=p.text,c+=p.text.length}h+=s[o].text;let u=zl(h,c+l.str.length);u-=c,u!==l.str.length-1&&(l.str=l.str.substring(0,u),l.width=this.measureTextWidth(l.str,t))}r.push(Object.assign(Object.assign({},s[o]),{text:l.str,width:l.width})),a+=l.width}return{verticalList:r,width:a}}clipText(s,t,e,i,n){if(s.length===0)return{str:"",width:0};let r=this.measureTextWidth(s,t);if(r<=e)return{str:s,width:r};if(r=this.measureTextWidth(s[0],t),r>e)return{str:"",width:0};const a=this._clipText(s,t,e,0,s.length-1,"end",!1);if(i&&a.str!==s){let o=zl(s,a.str.length,n);o!==a.str.length&&(o>a.str.length&&(a.wordBreaked=o,o=a.str.length),a.str=s.substring(0,o),a.width=this.measureTextWidth(a.str,t))}return a}_clipText(s,t,e,i,n,r,a){let o;if(r==="start")o=this._clipTextStart(s,t,e,i,n),a&&(o.result=a+o.str);else if(r==="middle"){const l=this._clipTextMiddle(s,t,e,"","",0,0,1);o={str:"none",width:l.width,result:l.left+a+l.right}}else o=this._clipTextEnd(s,t,e,i,n),a&&(o.result=o.str+a);return o}_clipTextEnd(s,t,e,i,n){if(i===n){Tt.getInstance().warn(\`【_clipTextEnd】不应该走到这里\${s}, \${i}, \${n}\`);const h=s.substring(0,n+1);return{str:h,width:this.measureTextWidth(h,t)}}const r=Math.floor((i+n)/2),a=s.substring(0,r+1),o=this.measureTextWidth(a,t);let l;if(o>e){if(a.length<=1)return{str:"",width:0};const h=s.substring(0,r);return l=this.measureTextWidth(h,t),l<=e?{str:h,width:l}:this._clipTextEnd(s,t,e,i,r)}if(o<e){if(r>=s.length-1)return{str:s,width:this.measureTextWidth(s,t)};const h=s.substring(0,r+2);return l=this.measureTextWidth(h,t),l>=e?{str:a,width:o}:this._clipTextEnd(s,t,e,r,n)}return{str:a,width:o}}_clipTextStart(s,t,e,i,n){const r=Math.ceil((i+n)/2),a=s.substring(r-1,s.length),o=this.measureTextWidth(a,t);let l;if(o>e){if(a.length<=1)return{str:"",width:0};const h=s.substring(r,s.length);return l=this.measureTextWidth(h,t),l<=e?{str:h,width:l}:this._clipTextStart(s,t,e,r,s.length)}if(o<e){if(r<=0)return{str:s,width:this.measureTextWidth(s,t)};const h=s.substring(r-2,s.length);return l=this.measureTextWidth(h,t),l>=e?{str:a,width:o}:this._clipTextStart(s,t,e,i,r)}return{str:a,width:o}}_clipTextMiddle(s,t,e,i,n,r,a,o){const l=s.substring(0,o),h=this.measureTextWidth(l,t);if(h+a>e)return{left:i,right:n,width:r+a};const c=s.substring(s.length-o,s.length),u=this.measureTextWidth(c,t);return h+u>e?{left:l,right:n,width:h+a}:this._clipTextMiddle(s,t,e,l,c,h,u,o+1)}clipTextWithSuffixVertical(s,t,e,i,n,r){if(i==="")return this.clipTextVertical(s,t,e,n);if(s.length===0)return{verticalList:s,width:0};const a=this.clipTextVertical(s,t,e,n);if(a.verticalList.length===s.length&&a.verticalList[a.verticalList.length-1].width===s[s.length-1].width)return a;const o=this.measureTextWidth(i,t);if(o>e)return a;let l;if(e-=o,r==="start"){const h=this.revertVerticalList(s);l=this.clipTextVertical(h,t,e,n);const c=this.revertVerticalList(l.verticalList);c.unshift({text:i,direction:1,width:o}),l.verticalList=c}else if(r==="middle"){const h=this.clipTextVertical(s,t,e/2,n),c=this.revertVerticalList(s),u=this.clipTextVertical(c,t,e/2,n);h.verticalList.push({text:i,direction:1,width:o}),this.revertVerticalList(u.verticalList).forEach(d=>h.verticalList.push(d)),l={verticalList:h.verticalList,width:h.width+u.width}}else l=this.clipTextVertical(s,t,e,n),l.verticalList.push({text:i,direction:1,width:o});return l.width+=o,l}revertVerticalList(s){return s.reverse().map(t=>{const e=t.text.split("").reverse().join("");return Object.assign(Object.assign({},t),{text:e})})}clipTextWithSuffix(s,t,e,i,n,r){let a=arguments.length>6&&arguments[6]!==void 0&&arguments[6];if(i==="")return this.clipText(s,t,e,n);if(s.length===0)return{str:"",width:0};const o=this.measureTextWidth(s,t);if(!a&&o<=e)return{str:s,width:o};const l=this.measureTextWidth(i,t);if(l>e)return{str:"",width:0};if(a&&o+l<=e)return{str:s+i,width:o+l};e-=l;const h=this._clipText(s,t,e,0,s.length-1,r,i);if(n&&h.str!==s){const c=zl(s,h.str.length);c!==h.str.length&&(h.result=s.substring(0,c),h.width=this.measureTextWidth(h.str,t))}else a&&h.str===s&&(h.result=s+i);return h.str=h.result,h.width+=l,h}};dd=pk([nt()],dd);var gk=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};const pd=Symbol.for("TextMeasureContribution");let gd=class extends dd{};gd=gk([nt()],gd);const kt=new class{constructor(s){const t=s||{};t.defaultScope=t.defaultScope||pm,this.options=t,this.id=we.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new kA}load(s){const t=this._getContainerModuleHelpersFactory()(s.id);s.registry(t.bindFunction,t.unbindFunction,t.isboundFunction,t.rebindFunction)}get(s){const t=this._getNotAllArgs(s,!1);return this._get(t)}getAll(s){const t=this._getAllArgs(s);return this._get(t)}getTagged(s,t,e){const i=this._getNotAllArgs(s,!1,t,e);return this._get(i)}getNamed(s,t){return this.getTagged(s,Cl,t)}isBound(s){return this._bindingDictionary.has(s)}bind(s){const t=this.options.defaultScope,e=new ed(s,t),i=this._bindingDictionary.get(s)||[];return i.push(e),this._bindingDictionary.set(s,i),new TA(e)}unbind(s){this._bindingDictionary.delete(s)}rebind(s){return this.unbind(s),this.bind(s)}_getContainerModuleHelpersFactory(){const s=(r,a)=>{r._binding.moduleId=a},t=r=>a=>{const o=this.bind(a);return s(o,r),o},e=()=>r=>this.unbind(r),i=()=>r=>this.isBound(r),n=r=>a=>{const o=this.rebind(a);return s(o,r),o};return r=>({bindFunction:t(r),isboundFunction:i(),rebindFunction:n(r),unbindFunction:e(),unbindAsyncFunction:a=>null})}_getNotAllArgs(s,t,e,i){return{avoidConstraints:!1,isMultiInject:t,serviceIdentifier:s,key:e,value:i}}_getAllArgs(s){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:s}}_get(s){const t=[];return this._bindingDictionary.get(s.serviceIdentifier).filter(e=>e.constraint(s)).forEach(e=>{t.push(this._resolveFromBinding(e))}),s.isMultiInject||t.length!==1?t:t[0]}_getChildRequest(s){const t=s.implementationType,{userGeneratedMetadata:e}=this._metadataReader.getConstructorMetadata(t),i=Object.keys(e),n=[];for(let r=0;r<i.length;r++){const a=e[r],o={};a.forEach(d=>{o[d.key]=d.value});const l={inject:o[am],multiInject:o[om]},h=l.inject||l.multiInject,c={serviceIdentifier:h,constructorArgsMetadata:a},u=(this._bindingDictionary.get(h)||[]).filter(d=>d.constraint(c));if(u.length){const d={injectIdentifier:h,metadata:a,bindings:u};n.push(d)}}return n}_resolveFromBinding(s){const t=this._getResolvedFromBinding(s);return this._saveToScope(s,t),t}_getResolvedFromBinding(s){let t;switch(s.type){case gm:case SA:t=s.cache;break;case fm:t=this._resolveInstance(s,s.implementationType);break;default:t=s.dynamicValue({container:this})}return t}_resolveInstance(s,t){if(s.activated)return s.cache;const e=this._getChildRequest(s);return this._createInstance(t,e)}_createInstance(s,t){return t.length?new s(...this._resolveRequests(t)):new s}_resolveRequests(s){return s.map(t=>t.bindings.length>1?t.bindings.map(e=>this._resolveFromBinding(e)):this._resolveFromBinding(t.bindings[0]))}_saveToScope(s,t){s.scope===wa&&(s.cache=t,s.activated=!0)}},Hm=Symbol.for("CanvasFactory"),fk=Symbol.for("Context2dFactory");function fd(s){return kt.getNamed(Hm,H.global.env)(s)}const Vm=1e-4,Wm=Math.sqrt(3),Hl=1/3;function Ls(s){return s>-Ra&&s<Ra}function Um(s){return s>Ra||s<-Ra}const is=[0,0],wi=[0,0],hr=[0,0];function cr(s,t){return(s[0]-t[0])*(s[0]-t[0])+(s[1]-t[1])*(s[1]-t[1])}function vs(s,t,e,i){const n=1-i;return n*(n*s+2*i*t)+i*i*e}function ys(s,t,e,i,n){const r=1-n;return r*r*(r*s+3*n*t)+n*n*(n*i+3*r*e)}function Vl(s){return(s%=dt)<0&&(s+=dt),s}function mk(s,t,e,i,n,r,a,o,l){if(a===0)return!1;const h=a;return!(l>t+h&&l>i+h&&l>r+h||l<t-h&&l<i-h&&l<r-h||o>s+h&&o>e+h&&o>n+h||o<s-h&&o<e-h&&o<n-h)&&function(c,u,d,p,g,f,m,v,y){let _=0,b=.005,x=1/0;is[0]=m,is[1]=v;for(let S=0;S<1;S+=.05){wi[0]=vs(c,d,g,S),wi[1]=vs(u,p,f,S);const A=cr(is,wi);A<x&&(_=S,x=A)}x=1/0;for(let S=0;S<32&&!(b<Vm);S++){const A=_-b,w=_+b;wi[0]=vs(c,d,g,A),wi[1]=vs(u,p,f,A);const k=cr(wi,is);if(A>=0&&k<x)_=A,x=k;else{hr[0]=vs(c,d,g,w),hr[1]=vs(u,p,f,w);const T=cr(hr,is);w<=1&&T<x?(_=w,x=T):b*=.5}}return Math.sqrt(x)}(s,t,e,i,n,r,o,l)<=h/2}function vk(s,t,e,i,n,r,a,o,l,h,c){if(l===0)return!1;const u=l;return!(c>t+u&&c>i+u&&c>r+u&&c>o+u||c<t-u&&c<i-u&&c<r-u&&c<o-u||h>s+u&&h>e+u&&h>n+u&&h>a+u||h<s-u&&h<e-u&&h<n-u&&h<a-u)&&function(d,p,g,f,m,v,y,_,b,x,S){let A,w,k,T,C=0,M=.005,B=1/0;is[0]=b,is[1]=x;for(let O=0;O<1;O+=.05)wi[0]=ys(d,g,m,y,O),wi[1]=ys(p,f,v,_,O),k=cr(is,wi),k<B&&(C=O,B=k);B=1/0;for(let O=0;O<32&&!(M<Vm);O++)A=C-M,w=C+M,wi[0]=ys(d,g,m,y,A),wi[1]=ys(p,f,v,_,A),k=cr(wi,is),A>=0&&k<B?(C=A,B=k):(hr[0]=ys(d,g,m,y,w),hr[1]=ys(p,f,v,_,w),T=cr(hr,is),w<=1&&T<B?(C=w,B=T):M*=.5);return Math.sqrt(B)}(s,t,e,i,n,r,a,o,h,c)<=u/2}function yk(s,t,e,i,n,r,a,o,l){if(a===0)return!1;const h=a;o-=s,l-=t;const c=Math.sqrt(o*o+l*l);if(c-h>e||c+h<e)return!1;if(Math.abs(i-n)%dt<1e-4)return!0;if(r){const d=i;i=Vl(n),n=Vl(d)}else i=Vl(i),n=Vl(n);i>n&&(n+=dt);let u=Math.atan2(l,o);return u<0&&(u+=dt),u>=i&&u<=n||u+dt>=i&&u+dt<=n}function ur(s,t,e,i,n,r,a){if(n===0)return!1;const o=n,l=n/2;let h=0,c=s;if(a>t+l&&a>i+l||a<t-l&&a<i-l||r>s+l&&r>e+l||r<s-l&&r<e-l)return!1;if(s===e)return Math.abs(r-s)<=o/2;h=(t-i)/(s-e),c=(s*i-e*t)/(s-e);const u=h*r-a+c;return u*u/(h*h+1)<=o/2*o/2}const Ra=1e-4;function _k(s,t,e,i,n){const r=6*e-12*t+6*s,a=9*t+3*i-3*s-9*e,o=3*t-3*s;let l=0;if(Ls(a)){if(Um(r)){const h=-o/r;h>=0&&h<=1&&(n[l++]=h)}}else{const h=r*r-4*a*o;if(Ls(h))n[0]=-r/(2*a);else if(h>0){const c=Math.sqrt(h),u=(-r+c)/(2*a),d=(-r-c)/(2*a);u>=0&&u<=1&&(n[l++]=u),d>=0&&d<=1&&(n[l++]=d)}}return l}const si=[-1,-1,-1],Ti=[-1,-1];function bk(){const s=Ti[0];Ti[0]=Ti[1],Ti[1]=s}function xk(s,t,e,i,n,r,a,o,l,h){if(h>t&&h>i&&h>r&&h>o||h<t&&h<i&&h<r&&h<o)return 0;const c=function(f,m,v,y,_,b){const x=y+3*(m-v)-f,S=3*(v-2*m+f),A=3*(m-f),w=f-_,k=S*S-3*x*A,T=S*A-9*x*w,C=A*A-3*S*w;let M=0;if(Ls(k)&&Ls(T))if(Ls(S))b[0]=0;else{const B=-A/S;B>=0&&B<=1&&(b[M++]=B)}else{const B=T*T-4*k*C;if(Ls(B)){const O=T/k,E=-S/x+O,L=-O/2;E>=0&&E<=1&&(b[M++]=E),L>=0&&L<=1&&(b[M++]=L)}else if(B>0){const O=Math.sqrt(B);let E=k*S+1.5*x*(-T+O),L=k*S+1.5*x*(-T-O);E=E<0?-Math.pow(-E,Hl):Math.pow(E,Hl),L=L<0?-Math.pow(-L,Hl):Math.pow(L,Hl);const P=(-S-(E+L))/(3*x);P>=0&&P<=1&&(b[M++]=P)}else{const O=(2*k*S-3*x*T)/(2*Math.sqrt(k*k*k)),E=Math.acos(O)/3,L=Math.sqrt(k),P=Math.cos(E),F=(-S-2*L*P)/(3*x),j=(-S+L*(P+Wm*Math.sin(E)))/(3*x),D=(-S+L*(P-Wm*Math.sin(E)))/(3*x);F>=0&&F<=1&&(b[M++]=F),j>=0&&j<=1&&(b[M++]=j),D>=0&&D<=1&&(b[M++]=D)}}return M}(t,i,r,o,h,si);if(c===0)return 0;let u=0,d=-1,p=0,g=0;for(let f=0;f<c;f++){const m=si[f],v=m===0||m===1?.5:1;ys(s,e,n,a,m)<l||(d<0&&(d=_k(t,i,r,o,Ti),Ti[1]<Ti[0]&&d>1&&bk(),p=ys(t,i,r,o,Ti[0]),d>1&&(g=ys(t,i,r,o,Ti[1]))),d===2?m<Ti[0]?u+=p<t?v:-v:m<Ti[1]?u+=g<p?v:-v:u+=o<g?v:-v:m<Ti[0]?u+=p<t?v:-v:u+=o<p?v:-v)}return u}function Sk(s,t,e,i,n,r,a,o){if(o>t&&o>i&&o>r||o<t&&o<i&&o<r)return 0;const l=function(u,d,p,g,f){const m=u-2*d+p,v=2*(d-u),y=u-g;let _=0;if(Ls(m)){if(Um(v)){const b=-y/v;b>=0&&b<=1&&(f[_++]=b)}}else{const b=v*v-4*m*y;if(Ls(b)){const x=-v/(2*m);x>=0&&x<=1&&(f[_++]=x)}else if(b>0){const x=Math.sqrt(b),S=(-v+x)/(2*m),A=(-v-x)/(2*m);S>=0&&S<=1&&(f[_++]=S),A>=0&&A<=1&&(f[_++]=A)}}return _}(t,i,r,o,si);if(l===0)return 0;const h=function(u,d,p){const g=u+p-2*d;return g===0?.5:(u-d)/g}(t,i,r);if(h>=0&&h<=1){let u=0;const d=vs(t,i,r,h);for(let p=0;p<l;p++){const g=si[p]===0||si[p]===1?.5:1;vs(s,e,n,si[p])<a||(si[p]<h?u+=d<t?g:-g:u+=r<d?g:-g)}return u}const c=si[0]===0||si[0]===1?.5:1;return vs(s,e,n,si[0])<a?0:r<t?c:-c}function Ak(s,t,e,i,n,r,a,o){if((o-=t)>e||o<-e)return 0;const l=Math.sqrt(e*e-o*o);si[0]=-l,si[1]=l;const h=Math.abs(i-n);if(h<1e-4)return 0;if(h>=dt-1e-4){i=0,n=dt;const u=r?1:-1;return a>=si[0]+s&&a<=si[1]+s?u:0}if(i>n){const u=i;i=n,n=u}i<0&&(i+=dt,n+=dt);let c=0;for(let u=0;u<2;u++){const d=si[u];if(d+s>a){let p=Math.atan2(o,d),g=r?1:-1;p<0&&(p=dt+p),(p>=i&&p<=n||p+dt>=i&&p+dt<=n)&&(p>Gt/2&&p<1.5*Gt&&(g=-g),c+=g)}}return c}function md(s){return Math.round(s/Gt*1e8)/1e8%2*Gt}function kk(s,t){let e=md(s[0]);e<0&&(e+=dt);const i=e-s[0];let n=s[1];n+=i,!t&&n-e>=dt?n=e+dt:t&&e-n>=dt?n=e-dt:!t&&e>n?n=e+(dt-md(e-n)):t&&e<n&&(n=e-(dt-md(n-e))),s[0]=e,s[1]=n}const Ia=[0,0];function Gm(s,t,e,i,n){const r=s,a=s.length;let o,l,h=0,c=0,u=0,d=0,p=0;for(let m=0;m<a;m++){const v=r[m],y=m===0;v[0]===Ct.M&&m>1&&(e||(h+=pn(c,u,d,p,i,n))),y&&(c=v[1],u=v[2],d=c,p=u);const _=v[0],b=v[1],x=v[2],S=v[3],A=v[4],w=v[5],k=v[6];let T=A,C=w;Ia[0]=T,Ia[1]=C,kk(Ia,!!v[6]),T=Ia[0],C=Ia[1];const M=T,B=C-T,O=!!(1-(v[6]?0:1)),E=(i-b)*S/S+b;switch(_){case Ct.M:d=b,p=x,c=d,u=p;break;case Ct.L:if(e){if(ur(c,u,b,x,t,i,n))return!0}else h+=pn(c,u,b,x,i,n)||0;c=b,u=x;break;case Ct.C:if(e){if(vk(c,u,b,x,S,A,w,k,t,i,n))return!0}else h+=xk(c,u,b,x,S,A,w,k,i,n)||0;c=w,u=k;break;case Ct.Q:if(e){if(mk(c,u,b,x,S,A,t,i,n))return!0}else h+=Sk(c,u,b,x,S,A,i,n)||0;c=S,u=A;break;case Ct.A:if(o=Math.cos(M)*S+b,l=Math.sin(M)*S+x,y?(d=o,p=l):h+=pn(c,u,o,l,i,n),e){if(yk(b,x,S,M,M+B,O,t,E,n))return!0}else h+=Ak(b,x,S,M,M+B,O,E,n);c=Math.cos(M+B)*S+b,u=Math.sin(M+B)*S+x;break;case Ct.R:if(d=c=b,p=u=x,o=d+S,l=p+A,e){if(ur(d,p,o,p,t,i,n)||ur(o,p,o,l,t,i,n)||ur(o,l,d,l,t,i,n)||ur(d,l,d,p,t,i,n))return!0}else h+=pn(o,p,o,l,i,n),h+=pn(d,l,d,p,i,n);break;case Ct.Z:if(e){if(ur(c,u,d,p,t,i,n))return!0}else h+=pn(c,u,d,p,i,n);c=d,u=p}}return e||(g=u,f=p,Math.abs(g-f)<Ra)||(h+=pn(c,u,d,p,i,n)||0),h!==0;var g,f}const _n=new class{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(s){if(!this.pools.length){const e=fd(Object.assign({nativeCanvas:H.global.createCanvas(s)},s));return this.allocatedCanvas.push(e),e}const t=this.pools.pop();return t.resize(s.width,s.height),t.dpr=s.dpr,t}allocateByObj(s){if(!this.pools.length){const e={width:s.width/s.dpr,height:s.height/s.dpr,dpr:s.dpr},i=fd(Object.assign({nativeCanvas:H.global.createCanvas(e)},e));return this.allocatedCanvas.push(i),i}const t=this.pools.pop();return t.width=s.width,t.height=s.height,t}free(s){this.pools.push(s)}get length(){return this.pools.length}release(){this.pools=[]}};var wk=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},Tk=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};const Wl=Symbol.for("VWindow"),Ul=Symbol.for("WindowHandlerContribution");let vd=class{get width(){if(this._handler){const s=this._handler.getWH();return this._width=s.width}return this._width}get height(){if(this._handler){const s=this._handler.getWH();return this._height=s.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){this.hooks={onChange:new ai(["x","y","width","height"])},this.active=()=>{const s=this.global;s.env&&!this.actived&&(kt.getNamed(Ul,s.env).configure(this,s),this.actived=!0)},this._uid=we.GenAutoIncrementId(),this.global=H.global,this.postInit()}postInit(){this.global.hooks.onSetEnv.tap("window",this.active),this.active()}get style(){var s;return(s=this._handler.getStyle())!==null&&s!==void 0?s:{}}set style(s){this._handler.setStyle(s)}create(s){var t,e;this._handler.createWindow(s);const i=this._handler.getWH();this._width=i.width,this._height=i.height,s.viewBox?this.setViewBox(s.viewBox):s.canvasControled!==!1?this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}):this.setViewBox({x1:0,y1:0,x2:(t=s.width)!==null&&t!==void 0?t:this._width,y2:(e=s.height)!==null&&e!==void 0?e:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(s){this._handler=s}setDpr(s){return this._handler.setDpr(s)}resize(s,t){return this._handler.resizeWindow(s,t)}configure(){throw new Error("暂不支持")}release(){return this.global.hooks.onSetEnv.unTap("window",this.active),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(s){return this._handler.getImageBuffer?this._handler.getImageBuffer(s):null}addEventListener(s,t,e){return this._handler.addEventListener(s,t,e)}removeEventListener(s,t,e){return this._handler.removeEventListener(s,t,e)}dispatchEvent(s){return this._handler.dispatchEvent(s)}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(s){this._handler.clearViewBox(s)}setViewBox(s){this._handler.setViewBox(s)}setViewBoxTransform(s,t,e,i,n,r){this._handler.setViewBoxTransform(s,t,e,i,n,r)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(s,t){const e=this._handler.getViewBox(),i={x:s,y:t};return this._handler.getViewBoxTransform().transformPoint({x:s,y:t},i),i.x-=e.x1,i.y-=e.y1,i}hasSubView(){const s=this._handler.getViewBox();return!(s.x1===0&&s.y1===0&&Oe(this.width,s.width())&&Oe(this.height,s.height()))}isVisible(s){return this._handler.isVisible(s)}onVisibleChange(s){return this._handler.onVisibleChange(s)}getTopLeft(s){return this._handler.getTopLeft(s)}};vd=wk([nt(),Tk("design:paramtypes",[])],vd);var Ym=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},$m=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},Xm=function(s,t){return function(e,i){t(e,i,s)}};let yd=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(s){this.contributions=s,this.configured=!1,this.global=H.global,this.global.hooks.onSetEnv.tap("graphic-util",(t,e,i)=>{this.configured=!1,this.configure(i,e)})}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(s,t){this.configured||(this.contributions.getContributions().forEach(e=>{e.configure(this,t)}),this.configured=!0)}tryInitCanvas(){if(!this._canvas){const s=_n.shareCanvas();this._canvas=s,this._context=s.getContext("2d")}}bindTextMeasure(s){this._textMeasure=s}measureText(s,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"native";var i;this.configure(this.global,this.global.env);const n=this.global.measureTextMethod;this.global.measureTextMethod=e;const r={width:this._textMeasure.measureTextWidth(s,t),height:(i=t.fontSize)!==null&&i!==void 0?i:ki.fontSize};return this.global.measureTextMethod=n,r}createTextMeasureInstance(s,t,e){return this.configure(this.global,this.global.env),new Ye(Object.assign({defaultFontParams:{fontFamily:ki.fontFamily,fontSize:ki.fontSize},getCanvasForMeasure:e||(()=>this.canvas),getTextBounds:void 0,specialCharSet:\`-/: .,@%'"~\`+Ye.ALPHABET_CHAR_SET+Ye.ALPHABET_CHAR_SET.toUpperCase()},t??{}),s)}drawGraphicToCanvas(s,t,e){if(!t.defaultLayer)return null;const i=kt.get(Wl),n=s.AABBBounds,r=n.width(),a=n.height(),o=-n.x1,l=-n.y1;i.create({viewBox:{x1:o,y1:l,x2:n.x2,y2:n.y2},width:r,height:a,canvas:e,dpr:t.window.dpr,canvasControled:!0,offscreen:!0,title:""});const h=t.params.optimize.disableCheckGraphicWidthOutRange;t.params.optimize.disableCheckGraphicWidthOutRange=!0,t.defaultLayer.getNativeHandler().drawTo(i,[s],{transMatrix:i.getViewBoxTransform(),viewBox:i.getViewBox(),stage:t,layer:t.defaultLayer,renderService:t.renderService,background:"transparent",clear:!0,updateBounds:!1}),t.params.optimize.disableCheckGraphicWidthOutRange=h;const c=i.getNativeHandler();return c.nativeCanvas?c.nativeCanvas:null}};var Ds;yd=Ym([nt(),Xm(0,At(Jt)),Xm(0,ae(pd)),$m("design:paramtypes",[Object])],yd),function(s){s[s.transform=0]="transform",s[s.matrix=1]="matrix"}(Ds||(Ds={}));const ve=new Zt;let _d=class{constructor(){this.matrix=new Zt}init(s){return this.mode=Ds.transform,this.originTransform=s,this.matrix.reset(),this}fromMatrix(s,t){return this.mode=Ds.matrix,this.outSourceMatrix=s,this.outTargetMatrix=t,this}scaleMatrix(s,t,e){const i=this.outSourceMatrix;if(ve.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),e){const{x:n,y:r}=e;this.outTargetMatrix.translate(n,r),this.outTargetMatrix.scale(s,t),this.outTargetMatrix.translate(-n,-r)}else this.outTargetMatrix.scale(s,t);return this.outTargetMatrix.multiply(ve.a,ve.b,ve.c,ve.d,ve.e,ve.f),this}rotateMatrix(s,t){const e=this.outSourceMatrix;if(ve.setValue(e.a,e.b,e.c,e.d,e.e,e.f),this.outTargetMatrix.reset(),t){const{x:i,y:n}=t;this.outTargetMatrix.translate(i,n),this.outTargetMatrix.rotate(s),this.outTargetMatrix.translate(-i,-n)}else this.outTargetMatrix.rotate(s);return this.outTargetMatrix.multiply(ve.a,ve.b,ve.c,ve.d,ve.e,ve.f),this}scale(s,t,e){return this.mode===Ds.matrix?this.scaleMatrix(s,t,e):this}rotate(s,t){return this.mode===Ds.matrix?this.rotateMatrix(s,t):this}translateMatrix(s,t){const e=this.outSourceMatrix;return ve.setValue(e.a,e.b,e.c,e.d,e.e,e.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(s,t),this.outTargetMatrix.multiply(ve.a,ve.b,ve.c,ve.d,ve.e,ve.f),this}translate(s,t){return this.mode===Ds.matrix?this.translateMatrix(s,t):this}simplify(s){return this.mode===Ds.matrix?this.simplifyMatrix(s):this}simplifyMatrix(s){return this}};_d=Ym([nt(),$m("design:paramtypes",[])],_d);const ni={arc:ZA,area:JA,circle:QA,line:ik,path:sk,symbol:ak,text:jm,rect:rk,polygon:nk,richtext:fs,richtextIcon:ok,image:Ba,group:tk,glyph:ek},bd=Object.keys(ni);function Gl(s,t){Object.keys(t).forEach(e=>{s[e]=t[e]})}const Km={arc:Object.assign({},ni.arc),area:Object.assign({},ni.area),circle:Object.assign({},ni.circle),line:Object.assign({},ni.line),path:Object.assign({},ni.path),symbol:Object.assign({},ni.symbol),text:Object.assign({},ni.text),rect:Object.assign({},ni.rect),polygon:Object.assign({},ni.polygon),richtext:Object.assign({},ni.richtext),richtextIcon:Object.assign({},ni.richtextIcon),image:Object.assign({},ni.image),group:Object.assign({},ni.group),glyph:Object.assign({},ni.glyph)};class Oa{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},bd.forEach(t=>{this._defaultTheme[t]=Object.create(Km[t])}),this.combinedTheme=this._defaultTheme}getTheme(t){if(!t)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let e={};const i=this.getParentWithTheme(t);return i&&(e=i.theme),this.applyTheme(t,e),this.combinedTheme}getParentWithTheme(t){for(;t.parent;)if((t=t.parent).theme)return t;return null}applyTheme(t,e){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(this.dirty){const n=this.getParentWithTheme(t);if(n){const r=n.theme;(r.dirty||i)&&r.applyTheme(n,e,!0)}this.userTheme?this.doCombine(n&&n.theme.combinedTheme):(n?this.combinedTheme=n.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,Tt.getInstance().warn("未知错误，走到不应该走的区域里")),this.dirty=!1)}return this.combinedTheme}doCombine(t){const e=this.userTheme,i=this.combinedTheme;bd.forEach(n=>{const r=Object.create(Km[n]);t&&t[n]&&Gl(r,t[n]),i[n]&&Gl(r,i[n]),e[n]&&Gl(r,e[n]),this.combinedTheme[n]=r}),e.common&&bd.forEach(n=>{Gl(this.combinedTheme[n],e.common)}),this.dirty=!1}setTheme(t,e){let i=this.userTheme;i?Object.keys(t).forEach(n=>{i[n]?Object.assign(i[n],t[n]):i[n]=Object.assign({},t[n])}):i=t,this.userTheme=i,this.dirty=!0,this.dirtyChildren(e)}resetTheme(t,e){this.userTheme=t,this.dirty=!0,this.dirtyChildren(e)}dirtyChildren(t){t.forEachChildren(e=>{e.isContainer&&(e.theme&&(e.theme.dirty=!0),this.dirtyChildren(e))})}}const qm=new Oa;function Et(s,t){return s.glyphHost?Et(s.glyphHost):t?(s.isContainer,t):function(e){let i;if(i=e.isContainer?e:e.parent,i){for(;i&&!i.theme;)i=i.parent;return i?(i.theme||i.createTheme(),i.theme.getTheme(i)):qm.getTheme()}return null}(s)||s.attachedThemeGraphic&&Et(s.attachedThemeGraphic)||qm.getTheme()}var Ck=function(s,t,e,i){return new(e||(e=Promise))(function(n,r){function a(h){try{l(i.next(h))}catch(c){r(c)}}function o(h){try{l(i.throw(h))}catch(c){r(c)}}function l(h){var c;h.done?n(h.value):(c=h.value,c instanceof e?c:new e(function(u){u(c)})).then(a,o)}l((i=i.apply(s,[])).next())})};class Mk extends Ps{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=we.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(t){if(arguments.length>1&&arguments[1]!==void 0&&arguments[1]){let e=this._lastChild,i=0;for(;e;){if(t(e,i++))return;e=e._prev}}else{let e=this._firstChild,i=0;for(;e;){if(t(e,i++))return;e=e._next}}}forEachChildrenAsync(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return Ck(this,void 0,void 0,function*(){if(e){let i=this._lastChild,n=0;for(;i;){let r=t(i,n++);if(r.then&&(r=yield r),r)return;i=i._prev}}else{let i=this._firstChild,n=0;for(;i;){let r=t(i,n++);if(r.then&&(r=yield r),r)return;i=i._next}}})}forEach(t){return this.forEachChildren(t)}appendChild(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._uid===t._uid)return null;if(!e&&t.isAncestorsOf(this))throw new Error("【Node::appendChild】不能将父辈元素append为子元素");return t.parent&&t.parent.removeChild(t),t.parent=this,this._lastChild?(this._lastChild._next=t,t._prev=this._lastChild,this._lastChild=t):(this._firstChild=this._lastChild=t,t._prev=t._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this.setCount(t.count),this._structEdit=!0,t}appendChildArrHighPerformance(t){return console.error("暂不支持该函数"),t}insertBefore(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,t._prev=e._prev,e._prev?e._prev._next=t:this._firstChild=t,e._prev=t,t._next=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertAfter(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertAfter】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,e._next?(e._next._prev=t,t._next=e._next):this._lastChild=t,e._next=t,t._prev=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertInto(t,e){if(!this._ignoreWarn&&this._nodeList&&Tt.getInstance().warn("insertIntoKeepIdx和insertInto混用可能会存在错误"),e>=this.childrenCount)return this.appendChild(t);if(this===t)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");if(t.parent&&t.parent.removeChild(t),t.parent=this,e===0)t._next=this._firstChild,this._firstChild&&(this._firstChild._prev=t),t._prev=null,this._firstChild=t;else{let i=this._firstChild;for(let n=0;n<e;n++){if(!i)return null;n>0&&(i=i._next)}if(!i)return null;t._next=i._next,t._prev=i,i._next=t,t._next&&(t._next._prev=t)}return this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t}insertIntoKeepIdx(t,e){if(this._nodeList||(this._nodeList=this.children),this._nodeList[e]){const r=this._nodeList[e];return this._nodeList.splice(e,0,t),this.insertBefore(t,r)}let i;this._nodeList[e]=t;for(let r=e-1;r>=0&&(i=this._nodeList[r],!i);r--);if(i)return i._next?this.insertBefore(t,i._next):this.appendChild(t);this._ignoreWarn=!0;const n=this.insertInto(t,0);return this._ignoreWarn=!1,n}removeChild(t){if(!this._idMap||!this._idMap.has(t._uid))return null;if(this._idMap.delete(t._uid),this._nodeList){const e=this._nodeList.findIndex(i=>i===t);e>=0&&this._nodeList.splice(e,1)}return t._prev?t._prev._next=t._next:this._firstChild=t._next,t._next?t._next._prev=t._prev:this._lastChild=t._prev,t.parent=null,t._prev=null,t._next=null,this._structEdit=!0,this.setCount(-t.count),t}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(t){if(!this._idMap)return;this._nodeList&&(this._nodeList.length=0);let e=this._firstChild;for(;e;){const i=e._next;e.parent=null,e._prev=null,e._next=null,e=e._next,e=i}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(t,e){throw new Error("暂不支持")}find(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=null;return this.forEachChildren((n,r)=>!(n===this||!t(n,r)||(i=n,0))),e&&this.forEachChildren(n=>{if(n.isContainer){const r=n.find(t,!0);if(r)return i=r,!0}return!1}),i}findAll(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=[];return this.forEachChildren((n,r)=>{n!==this&&t(n,r)&&i.push(n)}),e&&this.forEachChildren(n=>{if(n.isContainer){const r=n.findAll(t,!0);r.length&&(i=i.concat(r))}}),i}getElementById(t){return this.find(e=>e.id===t,!0)}findChildById(t){return this.getElementById(t)}findChildByUid(t){return this._idMap&&this._idMap.get(t)||null}getElementsByName(t){return this.findAll(e=>e.name===t,!0)}findChildrenByName(t){return this.getElementsByName(t)}getElementsByType(t){return this.findAll(e=>e.type===t,!0)}getChildByName(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this.find(i=>i.name===t,e)}getChildAt(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<t;i++){if(!e._next)return null;e=e._next}return e}at(t){return this.getChildAt(t)}containNode(t){if(!this._idMap)return!1;if(this._idMap.has(t._uid))return!0;let e=this._firstChild;for(;e;){if(e.containNode(t))return!0;e=e._next}return!1}getRootNode(){let t=this.parent;for(;t!=null&&t.parent;)t=t.parent;return t||this}hasChildNodes(){return this._firstChild!==null}addChild(t){return this.appendChild(t)}add(t){return this.appendChild(t)}getChildren(){const t=[];let e=this._firstChild;for(;e;)t.push(e),e=e._next;return t}isChildOf(t){return!!this.parent&&this.parent._uid===t._uid}isParentOf(t){return t.isChildOf(this)}isDescendantsOf(t){let e=this.parent;if(!e)return!1;do{if(e._uid===t._uid)return!0;e=e.parent}while(e!==null);return!1}isAncestorsOf(t){return t.isDescendantsOf(this)}getAncestor(t){throw new Error("暂不支持")}setAllDescendantsProps(t,e){let i=this._firstChild;for(;i;)i[t]=e,i.setAllDescendantsProps(t,e),i=i._next}setCount(t){this._count+=t;let e=this.parent;if(e)do e._count+=t,e=e.parent;while(e!==null)}clone(){throw new Error("暂不支持")}cloneTo(t){throw new Error("暂不支持")}getParent(){return this.parent}del(t){return this.removeChild(t)}addEventListener(t,e,i){const n=pe(i,!0)&&i||_t(i)&&i.capture,r=_t(i)&&i.once,a=U(e)?void 0:e;return t=n?\`\${t}capture\`:t,e=U(e)?e:e.handleEvent,r?super.once(t,e,a):super.on(t,e,a),this}on(t,e,i){return this.addEventListener(t,e,i)}removeEventListener(t,e,i){const n=pe(i,!0)&&i||_t(i)&&i.capture,r=U(e)?void 0:e;t=n?\`\${t}capture\`:t,e=U(e)?e:e.handleEvent;const a=_t(i)&&i.once;return super.off(t,e,r,a),this}off(t,e,i){return this.removeEventListener(t,e,i)}once(t,e,i){return _t(i)?(i.once=!0,this.addEventListener(t,e,i)):this.addEventListener(t,e,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return super.emit(t.type,t,...i),!t.defaultPrevented}emit(t,e){return this.dispatchEvent(t,e)}release(){this.removeAllListeners()}}class Pa{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Pa.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.composedDetailPath(),this.path}composedDetailPath(){return this.pickParams&&this.pickParams.graphic?(this.detailPath=this.path.slice(),this._composedDetailPath(this.pickParams)):this.detailPath=this.path.slice(),this.detailPath}_composedDetailPath(t){if(t&&t.graphic){const e=this.pickParams.graphic;if(e.stage){const i=e.stage.eventSystem.manager.propagationPath(e);this.detailPath.push(i),this._composedDetailPath(t.params)}}}preventDefault(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault()}catch{this.nativeEvent.preventDefault&&U(this.nativeEvent.preventDefault)&&this.nativeEvent.preventDefault()}this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation()}catch{this.nativeEvent.stopPropagation&&U(this.nativeEvent.stopPropagation)&&this.nativeEvent.stopPropagation()}this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}}class Yl extends Pa{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,n,r,a,o,l,h,c,u,d,p,g,f){throw new Error("Method not implemented.")}}class di extends Yl{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var t,e,i;const n=new di(this.manager);n.eventPhase=n.NONE,n.currentTarget=null,n.path=[],n.detailPath=[],n.target=null,n.nativeEvent=this.nativeEvent,n.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyPointerData(this,n),(e=this.manager)===null||e===void 0||e.copyMouseData(this,n),(i=this.manager)===null||i===void 0||i.copyData(this,n),n.target=this.target,n.path=this.composedPath().slice();const r=this.composedDetailPath();return n.detailPath=r&&r.slice(),n.type=this.type,n}}class Fs extends Yl{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var t,e,i;const n=new Fs(this.manager);n.eventPhase=n.NONE,n.currentTarget=null,n.path=[],n.detailPath=[],n.target=null,n.nativeEvent=this.nativeEvent,n.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyWheelData(this,n),(e=this.manager)===null||e===void 0||e.copyMouseData(this,n),(i=this.manager)===null||i===void 0||i.copyData(this,n),n.target=this.target,n.path=this.composedPath().slice();const r=this.composedDetailPath();return n.detailPath=r&&r.slice(),n.type=this.type,n}}Fs.DOM_DELTA_PIXEL=0,Fs.DOM_DELTA_LINE=1,Fs.DOM_DELTA_PAGE=2;class $l extends Pa{constructor(t,e){super(),this.type=t,this.detail=e}}const bn=typeof performance=="object"&&performance.now?performance:Date;function js(s){return s==="mouse"||s==="pen"}class Ek{constructor(t,e){this.dispatch=new Ps,this.cursorTarget=null,this.pauseNotify=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(i,n)=>{if(!(i instanceof di))return void Tt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const r=this.createPointerEvent(i,i.type,n);if(this.dispatchEvent(r,"pointerdown"),r.pointerType==="touch")this.dispatchEvent(r,"touchstart");else if(js(r.pointerType)){const a=r.button===2;this.dispatchEvent(r,a?"rightdown":"mousedown")}this.trackingData(i.pointerId).pressTargetsByButton[i.button]=r.composedPath(),this.freeEvent(r)},this.onPointerMove=(i,n)=>{var r,a;if(!(i instanceof di))return void Tt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.createPointerEvent(i,i.type,n),l=js(o.pointerType),h=this.trackingData(i.pointerId),c=this.findMountedTarget(h.overTargets);if(h.overTargets&&c&&c!==this.rootTarget&&c!==o.target){const u=i.type==="mousemove"?"mouseout":"pointerout",d=this.createPointerEvent(i,u,c||void 0);if(this.dispatchEvent(d,"pointerout"),l&&this.dispatchEvent(d,"mouseout"),!o.composedPath().includes(c)){const p=this.createPointerEvent(i,"pointerleave",c||void 0);for(p.eventPhase=p.AT_TARGET;p.target&&!o.composedPath().includes(p.target);)p.currentTarget=p.target,this.notifyTarget(p),l&&this.notifyTarget(p,"mouseleave"),p.target=p.target.parent;this.freeEvent(p)}this.freeEvent(d)}if(c!==o.target){const u=i.type==="mousemove"?"mouseover":"pointerover",d=this.clonePointerEvent(o,u);this.dispatchEvent(d,"pointerover"),l&&this.dispatchEvent(d,"mouseover");let p=c==null?void 0:c.parent;for(;p&&p!==this.rootTarget.parent&&p!==o.target;)p=p.parent;if(!p||p===this.rootTarget.parent){const g=this.clonePointerEvent(o,"pointerenter");g.eventPhase=g.AT_TARGET;let f=g.target;const m=new Set;let v=c;for(;v&&v!==this.rootTarget;)m.add(v),v=v.parent;for(;f&&f!==c&&f!==this.rootTarget.parent;)m.has(f)||(g.currentTarget=f,this.notifyTarget(g),l&&this.notifyTarget(g,"mouseenter")),f=f.parent;this.freeEvent(g)}this.freeEvent(d)}this.dispatchEvent(o,"pointermove"),o.pointerType==="touch"&&this.dispatchEvent(o,"touchmove"),l&&(this.dispatchEvent(o,"mousemove"),this.cursorTarget=o.target,this.cursor=((a=(r=o.target)===null||r===void 0?void 0:r.attribute)===null||a===void 0?void 0:a.cursor)||this.rootTarget.getCursor()),h.overTargets=o.composedPath(),this.freeEvent(o)},this.onPointerOver=(i,n)=>{var r,a;if(!(i instanceof di))return void Tt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.trackingData(i.pointerId),l=this.createPointerEvent(i,i.type,n),h=js(l.pointerType);this.dispatchEvent(l,"pointerover"),h&&this.dispatchEvent(l,"mouseover"),l.pointerType==="mouse"&&(this.cursorTarget=l.target,this.cursor=((a=(r=l.target)===null||r===void 0?void 0:r.attribute)===null||a===void 0?void 0:a.cursor)||this.rootTarget.getCursor());const c=this.clonePointerEvent(l,"pointerenter");for(c.eventPhase=c.AT_TARGET;c.target&&c.target!==this.rootTarget.parent;)c.currentTarget=c.target,this.notifyTarget(c),h&&this.notifyTarget(c,"mouseenter"),c.target=c.target.parent;o.overTargets=l.composedPath(),this.freeEvent(l),this.freeEvent(c)},this.onPointerOut=(i,n)=>{if(!(i instanceof di))return void Tt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const r=this.trackingData(i.pointerId);if(r.overTargets){const a=js(i.pointerType),o=this.findMountedTarget(r.overTargets),l=this.createPointerEvent(i,"pointerout",o||void 0);this.dispatchEvent(l),a&&this.dispatchEvent(l,"mouseout");const h=this.createPointerEvent(i,"pointerleave",o||void 0);for(h.eventPhase=h.AT_TARGET;h.target&&h.target!==this.rootTarget.parent;)h.currentTarget=h.target,this.notifyTarget(h),a&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;r.overTargets=[],this.freeEvent(l),this.freeEvent(h)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(i,n)=>{var r;if(!(i instanceof di))return void Tt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const a=bn.now(),o=this.createPointerEvent(i,i.type,n);if(this.dispatchEvent(o,"pointerup"),o.pointerType==="touch")this.dispatchEvent(o,"touchend");else if(js(o.pointerType)){const u=o.button===2;this.dispatchEvent(o,u?"rightup":"mouseup")}const l=this.trackingData(i.pointerId),h=this.findMountedTarget(l.pressTargetsByButton[i.button]);let c=h;if(h&&!o.composedPath().includes(h)){let u=h;for(;u&&!o.composedPath().includes(u);){if(o.currentTarget=u,this.notifyTarget(o,"pointerupoutside"),o.pointerType==="touch")this.notifyTarget(o,"touchendoutside");else if(js(o.pointerType)){const d=o.button===2;this.notifyTarget(o,d?"rightupoutside":"mouseupoutside")}u=u.parent}delete l.pressTargetsByButton[i.button],c=u}if(c){const u=this.clonePointerEvent(o,"click");u.target=c,u.path=[],u.detailPath=[],l.clicksByButton[i.button]||(l.clicksByButton[i.button]={clickCount:0,target:u.target,timeStamp:a});const d=l.clicksByButton[i.button];d.target===u.target&&a-d.timeStamp<((r=this._config.clickInterval)!==null&&r!==void 0?r:200)?++d.clickCount:d.clickCount=1,d.target=u.target,d.timeStamp=a,u.detail=d.clickCount,js(u.pointerType)?(this.dispatchEvent(u,"click"),d.clickCount===2&&this.dispatchEvent(u,"dblclick")):u.pointerType==="touch"&&this._config.supportsTouchEvents&&(this.dispatchEvent(u,"tap"),d.clickCount===2&&this.dispatchEvent(u,"dbltap")),this.dispatchEvent(u,"pointertap"),this.freeEvent(u)}this.freeEvent(o)},this.onPointerUpOutside=(i,n)=>{if(!(i instanceof di))return void Tt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const r=this.trackingData(i.pointerId),a=this.findMountedTarget(r.pressTargetsByButton[i.button]),o=this.createPointerEvent(i,i.type,n);if(a){let l=a;for(;l;)o.currentTarget=l,this.notifyTarget(o,"pointerupoutside"),o.pointerType==="touch"?this.notifyTarget(o,"touchendoutside"):js(o.pointerType)&&this.notifyTarget(o,o.button===2?"rightupoutside":"mouseupoutside"),l=l.parent;delete r.pressTargetsByButton[i.button]}this.freeEvent(o)},this.onWheel=(i,n)=>{if(!(i instanceof Fs))return void Tt.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");const r=this.createWheelEvent(i,n);this.dispatchEvent(r),this.freeEvent(r)},this.rootTarget=t,this.mappingTable={},this._config=Object.assign({clickInterval:200},e),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,n)=>i.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){var e,i,n,r,a,o,l;if(!this.rootTarget)return;const h=this.mappingTable[t.type];let c;const u=\`\${t.canvasX}-\${t.canvasY}\`;if(!((e=this._prePointTargetCache)===null||e===void 0)&&e[u]&&(!((n=(i=this._prePointTargetCache)===null||i===void 0?void 0:i[u])===null||n===void 0)&&n.stage)&&((a=(r=this._prePointTargetCache)===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.stage.renderCount)===((o=this._prePointTargetCache)===null||o===void 0?void 0:o.stageRenderCount)?c=this._prePointTargetCache[u]:(c=this.pickTarget(t.viewX,t.viewY,t),t.pickParams||(this._prePointTargetCache={[u]:c,stageRenderCount:(l=c==null?void 0:c.stage.renderCount)!==null&&l!==void 0?l:-1})),h)for(let d=0,p=h.length;d<p;d++)h[d].fn(t,c);else Tt.getInstance().warn(\`[EventManager]: Event mapping not defined for \${t.type}\`)}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,r=i.length-1;n<r;n++)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}notifyTarget(t,e){if(this.pauseNotify)return;e=e??t.type;const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?\`\${e}capture\`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){var n,r;const a=this.allocateEvent(di);return this.copyPointerData(t,a),this.copyMouseData(t,a),this.copyData(t,a),a.nativeEvent=t.nativeEvent,a.originalEvent=t,a.target=i||this.pickTarget((n=a.viewX)!==null&&n!==void 0?n:a.global.x,(r=a.viewY)!==null&&r!==void 0?r:a.global.y,a),typeof e=="string"&&(a.type=e),a}createWheelEvent(t,e){var i,n;const r=this.allocateEvent(Fs);return this.copyWheelData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=e||this.pickTarget((i=r.viewX)!==null&&i!==void 0?i:r.global.x,(n=r.viewY)!==null&&n!==void 0?n:r.global.y,r),r}clonePointerEvent(t,e){const i=this.allocateEvent(di);i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice();const n=t.composedDetailPath();return i.detailPath=n&&n.slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof di&&e instanceof di&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Yl&&e instanceof Yl&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach(i=>{e[i].x=t[i].x,e[i].y=t[i].y}))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=bn.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.x=t.layer.x,e.layer.y=t.layer.y,e.page.x=t.page.x,e.page.y=t.page.y,e.pickParams=t.pickParams}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){var e;this.eventPool.has(t)||this.eventPool.set(t,[]);const i=((e=this.eventPool.get(t))===null||e===void 0?void 0:e.pop())||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=[],i.detailPath=[],i.target=null,i}freeEvent(t){var e;if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),(e=this.eventPool.get(i))===null||e===void 0||e.push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.once&&t.currentTarget.removeEventListener(e,i.fn,{once:!0}),i.fn.call(i.context,t);else for(let n=0,r=i.length;n<r&&!t.propagationImmediatelyStopped;n++)i[n].once&&t.currentTarget.removeEventListener(e,i[n].fn,{once:!0}),i[n].fn.call(i[n].context,t);this.emitDelegation(t,e)}emitDelegation(t,e){const i=t.currentTarget._events["*"];if(i)if("fn"in i)i.fn.call(i.context,t,e);else for(let n=0,r=i.length;n<r&&!t.propagationImmediatelyStopped;n++)i[n].fn.call(i[n].context,t,e)}pickTarget(t,e,i){let n;const r=this.rootTarget.pick(t,e);return n=r&&r.graphic?r.graphic:r&&r.group?r.group:this.rootTarget.AABBBounds.contains(t,e)?this.rootTarget:null,i&&(i.pickParams=r.params),n}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}}const Bk={dispatchEvent(s){var t;if(!(s instanceof Pa))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return s.defaultPrevented=!1,s.path=[],s.detailPath&&(s.detailPath=[]),s.target=this,(t=s==null?void 0:s.manager)===null||t===void 0||t.dispatchEvent(s),!s.defaultPrevented},emit(s,t){return this.dispatchEvent(new $l(s,t))}},Rk={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class Ik{constructor(t){this.resolution=1,this.onPointerDown=c=>{if(this.supportsTouchEvents&&c.pointerType==="touch")return;const u=this.normalizeToPointerData(c);this.autoPreventDefault&&u[0].isNormalized&&(c.cancelable||!("cancelable"in c))&&c.preventDefault();for(let d=0,p=u.length;d<p;d++){const g=u[d],f=this.bootstrapEvent(this.rootPointerEvent,g);this.manager.mapEvent(f)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerMove=c=>{if(this.supportsTouchEvents&&c.pointerType==="touch"||this.isEventOutsideOfTargetElement(c))return;const u=this.normalizeToPointerData(c);for(let d=0,p=u.length;d<p;d++){const g=this.bootstrapEvent(this.rootPointerEvent,u[d]);this.manager.mapEvent(g)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerUp=c=>{if(this.supportsTouchEvents&&c.pointerType==="touch")return;const u=this.isEventOutsideOfTargetViewPort(c)?"outside":"",d=this.normalizeToPointerData(c);for(let p=0,g=d.length;p<g;p++){const f=this.bootstrapEvent(this.rootPointerEvent,d[p]);f.type+=u,this.manager.mapEvent(f)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerOverOut=c=>{if(this.supportsTouchEvents&&c.pointerType==="touch")return;const u=this.normalizeToPointerData(c);for(let d=0,p=u.length;d<p;d++){const g=this.bootstrapEvent(this.rootPointerEvent,u[d]);this.manager.mapEvent(g)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onWheel=c=>{const u=this.normalizeWheelEvent(c);this.manager.mapEvent(u)};const{targetElement:e,resolution:i,rootNode:n,global:r,autoPreventDefault:a=!1,clickInterval:o,supportsTouchEvents:l=r.supportsTouchEvents,supportsPointerEvents:h=r.supportsPointerEvents}=t;this.manager=new Ek(n,{clickInterval:o,supportsTouchEvents:l}),this.globalObj=r,this.supportsPointerEvents=h,this.supportsTouchEvents=l,this.supportsMouseEvents=r.supportsMouseEvents,this.applyStyles=r.applyStyles,this.autoPreventDefault=a,this.eventsAdded=!1,this.rootPointerEvent=new di,this.rootWheelEvent=new Fs,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=i,this.setTargetElement(e)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(t,e){if(!e&&!this.manager.rootTarget.window._handler.canvas.controled)return;t||(t="default");const{applyStyles:i,domElement:n}=this;if(this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];r?typeof r=="string"&&i?n.style.cursor=r:typeof r=="function"?r(t):typeof r=="object"&&i&&Object.assign(n.style,r):i&&Q(t)&&!_a(this.cursorStyles,t)&&(n.style.cursor=t)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.getDocument().addEventListener("pointermove",this.onPointerMove,!0),t.getDocument().addEventListener("pointerup",this.onPointerUp,!0)):(e.addEventListener("pointermove",this.onPointerMove,!0),e.addEventListener("pointerup",this.onPointerUp,!0)),e.addEventListener("pointerdown",this.onPointerDown,!0),e.addEventListener("pointerleave",this.onPointerOverOut,!0),e.addEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.getDocument().addEventListener("mousemove",this.onPointerMove,!0),t.getDocument().addEventListener("mouseup",this.onPointerUp,!0)):(e.addEventListener("mousemove",this.onPointerMove,!0),e.addEventListener("mouseup",this.onPointerUp,!0)),e.addEventListener("mousedown",this.onPointerDown,!0),e.addEventListener("mouseout",this.onPointerOverOut,!0),e.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.addEventListener("touchstart",this.onPointerDown,!0),e.addEventListener("touchend",this.onPointerUp,!0),e.addEventListener("touchmove",this.onPointerMove,!0)),e.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){var t;if(!this.eventsAdded||!this.domElement)return;const{globalObj:e,domElement:i}=this,n=(t=e.getDocument())!==null&&t!==void 0?t:i;this.supportsPointerEvents?(n.removeEventListener("pointermove",this.onPointerMove,!0),n.removeEventListener("pointerup",this.onPointerUp,!0),i.removeEventListener("pointerdown",this.onPointerDown,!0),i.removeEventListener("pointerleave",this.onPointerOverOut,!0),i.removeEventListener("pointerover",this.onPointerOverOut,!0)):(n.removeEventListener("mousemove",this.onPointerMove,!0),n.removeEventListener("mouseup",this.onPointerUp,!0),i.removeEventListener("mousedown",this.onPointerDown,!0),i.removeEventListener("mouseout",this.onPointerOverOut,!0),i.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(i.removeEventListener("touchstart",this.onPointerDown,!0),i.removeEventListener("touchend",this.onPointerUp,!0),i.removeEventListener("touchmove",this.onPointerMove,!0)),i.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(t){return this.domElement.pointTransform?this.domElement.pointTransform(t.x,t.y):t}mapToCanvasPoint(t){var e,i;const n=(e=this.globalObj)===null||e===void 0?void 0:e.mapToCanvasPoint(t,this.domElement);if(n)return n;let r=0,a=0;if(t.changedTouches){const l=(i=t.changedTouches[0])!==null&&i!==void 0?i:{};r=l.clientX||0,a=l.clientY||0}else r=t.clientX||0,a=t.clientY||0;const o=this.domElement.getBoundingClientRect();return{x:r-o.left,y:a-o.top}}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t.changedTouches&&t.changedTouches.length)for(let i=0,n=t.changedTouches.length;i<n;i++){const r=t.changedTouches[i];$t(r.button)&&(r.button=0),$t(r.buttons)&&(r.buttons=1),$t(r.isPrimary)&&(r.isPrimary=t.touches.length===1&&t.type==="touchstart"),$t(r.width)&&(r.width=r.radiusX||1),$t(r.height)&&(r.height=r.radiusY||1),$t(r.tiltX)&&(r.tiltX=0),$t(r.tiltY)&&(r.tiltY=0),$t(r.pointerType)&&(r.pointerType="touch"),$t(r.pointerId)&&(r.pointerId=r.identifier||0),$t(r.pressure)&&(r.pressure=r.force||.5),$t(r.twist)&&(r.twist=0),$t(r.tangentialPressure)&&(r.tangentialPressure=0),$t(r.layerX)&&(r.layerX=r.offsetX=r.clientX),$t(r.layerY)&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(!this.globalObj.supportsMouseEvents||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof PointerEvent)){const i=t;$t(i.isPrimary)&&(i.isPrimary=!0),$t(i.width)&&(i.width=1),$t(i.height)&&(i.height=1),$t(i.tiltX)&&(i.tiltX=0),$t(i.tiltY)&&(i.tiltY=0),$t(i.pointerType)&&(i.pointerType="mouse"),$t(i.pointerId)&&(i.pointerId=1),$t(i.pressure)&&(i.pressure=.5),$t(i.twist)&&(i.twist=0),$t(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;const{x:i,y:n}=this.mapToCanvasPoint(t);e.canvas.x=i,e.canvas.y=n,e.global.x=i,e.global.y=n,e.offset.x=i,e.offset.y=n;const{x:r,y:a}=this.mapToViewportPoint(e);return e.viewport.x=r,e.viewport.y=a,e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:i,y:n}=this.mapToCanvasPoint(e);t.canvas.x=i,t.canvas.y=n,t.global.x=i,t.global.y=n,t.offset.x=i,t.offset.y=n;const{x:r,y:a}=this.mapToViewportPoint(t);return t.viewport.x=r,t.viewport.y=a,t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Rk[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=bn.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null}isEventOutsideOfTargetViewPort(t){if(this.isEventOutsideOfTargetElement(t))return!0;if(this.domElement.getViewBox){const e=this.mapToViewportPoint(this.mapToCanvasPoint(t)),i=this.domElement.getViewBox(),n=i.width(),r=i.height();return!(e.x<n&&e.y<r&&e.x>0&&e.y>0)}return!1}isEventOutsideOfTargetElement(t){let e=t.target;return t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]),e!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}pauseTriggerEvent(){this.manager.pauseNotify=!0}resumeTriggerEvent(){this.manager.pauseNotify=!1}}var pi;(function(s){s[s.INITIAL=0]="INITIAL",s[s.RUNNING=1]="RUNNING",s[s.PAUSE=2]="PAUSE"})(pi||(pi={}));class La{static Avaliable(){return!!H.global.getRequestAnimationFrame()}avaliable(){return La.Avaliable()}tick(t,e){H.global.getRequestAnimationFrame()(()=>{this.released||e(this)})}release(){this.released=!0}getTime(){return Date.now()}}class Xl{static Avaliable(){return!0}avaliable(){return Xl.Avaliable()}tick(t,e){this.timerId=setTimeout(()=>{e(this)},t)}release(){this.timerId>0&&(clearTimeout(this.timerId),this.timerId=-1)}getTime(){return Date.now()}}class bt{constructor(){}static linear(t){return t}static none(){return this.linear}static get(t){return t<-1?t=-1:t>1&&(t=1),function(e){return t===0?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}static getPowIn(t){return function(e){return Math.pow(e,t)}}static getPowOut(t){return function(e){return 1-Math.pow(1-e,t)}}static getPowInOut(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}static getBackIn(t){return function(e){return e*e*((t+1)*e-t)}}static getBackOut(t){return function(e){return--e*e*((t+1)*e+t)+1}}static getBackInOut(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}static sineIn(t){return 1-Math.cos(t*Math.PI/2)}static sineOut(t){return Math.sin(t*Math.PI/2)}static sineInOut(t){return-(Math.cos(Math.PI*t)-1)/2}static expoIn(t){return t===0?0:Math.pow(2,10*t-10)}static expoOut(t){return t===1?1:1-Math.pow(2,-10*t)}static expoInOut(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}static circIn(t){return-(Math.sqrt(1-t*t)-1)}static circOut(t){return Math.sqrt(1- --t*t)}static circInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static bounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static bounceIn(t){return 1-bt.bounceOut(1-t)}static bounceInOut(t){return t<.5?.5*bt.bounceIn(2*t):.5*bt.bounceOut(2*t-1)+.5}static getElasticIn(t,e){return function(i){if(i===0||i===1)return i;const n=e/dt*Math.asin(1/t);return-t*Math.pow(2,10*(i-=1))*Math.sin((i-n)*dt/e)}}static getElasticOut(t,e){return function(i){if(i===0||i===1)return i;const n=e/dt*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-n)*dt/e)+1}}static getElasticInOut(t,e){return function(i){const n=e/dt*Math.asin(1/t);return(i*=2)<1?t*Math.pow(2,10*(i-=1))*Math.sin((i-n)*dt/e)*-.5:t*Math.pow(2,-10*(i-=1))*Math.sin((i-n)*dt/e)*.5+1}}static registerFunc(t,e){bt[t]=e}}function Ok(s,t){const e=1/t;let i=1;for(;s>e;)s-=e,i*=-1;const n=i*s/e;return n>0?n:1+n}bt.quadIn=bt.getPowIn(2),bt.quadOut=bt.getPowOut(2),bt.quadInOut=bt.getPowInOut(2),bt.cubicIn=bt.getPowIn(3),bt.cubicOut=bt.getPowOut(3),bt.cubicInOut=bt.getPowInOut(3),bt.quartIn=bt.getPowIn(4),bt.quartOut=bt.getPowOut(4),bt.quartInOut=bt.getPowInOut(4),bt.quintIn=bt.getPowIn(5),bt.quintOut=bt.getPowOut(5),bt.quintInOut=bt.getPowInOut(5),bt.backIn=bt.getBackIn(1.7),bt.backOut=bt.getBackOut(1.7),bt.backInOut=bt.getBackInOut(1.7),bt.elasticIn=bt.getElasticIn(1,.3),bt.elasticOut=bt.getElasticOut(1,.3),bt.elasticInOut=bt.getElasticInOut(1,.3*1.5),bt.easeInOutQuad=s=>(s/=.5)<1?.5*Math.pow(s,2):-.5*((s-=2)*s-2),bt.easeOutElastic=s=>{const t=2*Math.PI/3;return s===0?0:s===1?1:Math.pow(2,-10*s)*Math.sin((10*s-.75)*t)+1},bt.easeInOutElastic=s=>{const t=2*Math.PI/4.5;return s===0?0:s===1?1:s<.5?-Math.pow(2,20*s-10)*Math.sin((20*s-11.125)*t)/2:Math.pow(2,-20*s+10)*Math.sin((20*s-11.125)*t)/2+1};for(let s=0;s<10;s++)bt[\`flicker\${s}\`]=t=>Ok(t,s);for(let s=2;s<10;s++)bt[\`aIn\${s}\`]=t=>s*t*t+(1-s)*t;class Zm{constructor(){this.id=we.GenAutoIncrementId(),this.animateHead=null,this.animateTail=null,this.animateCount=0,this.paused=!1}addAnimate(t){this.animateTail?(this.animateTail.nextAnimate=t,t.prevAnimate=this.animateTail,this.animateTail=t,t.nextAnimate=null):(this.animateHead=t,this.animateTail=t),this.animateCount++}pause(){this.paused=!0}resume(){this.paused=!1}tick(t){if(this.paused)return;let e=this.animateHead;for(this.animateCount=0;e;)e.status===$e.END?this.removeAnimate(e):e.status===$e.RUNNING||e.status===$e.INITIAL?(this.animateCount++,e.advance(t)):e.status===$e.PAUSED&&this.animateCount++,e=e.nextAnimate}clear(){let t=this.animateHead;for(;t;)t.release(),t=t.nextAnimate;this.animateHead=null,this.animateTail=null,this.animateCount=0}removeAnimate(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];t._onRemove&&t._onRemove.forEach(i=>i()),t===this.animateHead?(this.animateHead=t.nextAnimate,t===this.animateTail?this.animateTail=null:this.animateHead.prevAnimate=null):t===this.animateTail?(this.animateTail=t.prevAnimate,this.animateTail.nextAnimate=null):(t.prevAnimate.nextAnimate=t.nextAnimate,t.nextAnimate.prevAnimate=t.prevAnimate),e&&t.release()}}const Kl=new Zm;class dr{constructor(t,e,i,n,r){this.from=t,this.to=e,this.duration=i,this.easing=n,this.params=r,this.updateCount=0}bind(t,e){this.target=t,this.subAnimate=e,this.onBind()}onBind(){}onFirstRun(){}onStart(){}onEnd(){}getEndProps(){return this.to}getFromProps(){return this.from}getMergedEndProps(){var t;const e=this.getEndProps();return e?this._endProps===e?this._mergedEndProps:(this._endProps=e,void(this._mergedEndProps=Object.assign({},(t=this.step.prev.getLastProps())!==null&&t!==void 0?t:{},e))):this.step.prev?this.step.prev.getLastProps():e}update(t,e,i){if(this.updateCount===0){this.onFirstRun();const n=this.step.getLastProps();Object.keys(n).forEach(r=>{this.subAnimate.animate.validAttr(r)&&(i[r]=n[r])})}this.updateCount+=1,this.onUpdate(t,e,i),t&&this.onEnd()}}class Pk extends dr{constructor(t){super(null,null,0,"linear"),this.cb=t}onUpdate(t,e,i){}onStart(){this.cb()}}class Ns{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:we.GenAutoIncrementId(),e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kl,i=arguments.length>2?arguments[2]:void 0;this.id=t,this.timeline=e||Kl,this.status=$e.INITIAL,this.tailAnimate=new Jm(this),this.subAnimates=[this.tailAnimate],this.timeScale=1,this.rawPosition=-1,this._startTime=0,this._duringTime=0,this.timeline.addAnimate(this),this.slience=i}setTimeline(t){t!==this.timeline&&(this.timeline.removeAnimate(this,!1),t.addAnimate(this))}getStartTime(){return this._startTime}getDuration(){return this.subAnimates.reduce((t,e)=>t+e.totalDuration,0)}after(t){const e=t.getDuration();return this._startTime=e,this}afterAll(t){let e=-1/0;return t.forEach(i=>{e=ts(i.getDuration(),e)}),this._startTime=e,this}parallel(t){return this._startTime=t.getStartTime(),this}static AddInterpolate(t,e){Ns.interpolateMap.set(t,e)}play(t){if(this.tailAnimate.play(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this.subAnimates.length===1&&this.tailAnimate.totalDuration===t.duration&&this.trySetAttribute(t.getFromProps(),t.mode),this}trySetAttribute(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ns.mode;t&&e&Ca.SET_ATTR_IMMEDIATELY&&this.target.setAttributes&&this.target.setAttributes(t,!1,{type:Pe.ANIMATE_PLAY})}runCb(t){const e=new Pk(()=>{t(this,e.step.prev)});return this.tailAnimate.play(e),this}customInterpolate(t,e,i,n,r,a){const o=Ns.interpolateMap.get(t)||Ns.interpolateMap.get("");return!!o&&o(t,e,i,n,r,a)}pause(){this.status===$e.RUNNING&&(this.status=$e.PAUSED)}resume(){this.status===$e.PAUSED&&(this.status=$e.RUNNING)}to(t,e,i,n){if(this.tailAnimate.to(t,e,i,n),this.target){const r=this.target.stage;r&&r.renderNextFrame()}return this}from(t,e,i,n){if(this.tailAnimate.from(t,e,i,n),this.target){const r=this.target.stage;r&&r.renderNextFrame()}return this}wait(t){if(this.tailAnimate.wait(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}startAt(t){if(this.tailAnimate.startAt(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}loop(t){if(this.tailAnimate.loop=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}reversed(t){if(this.tailAnimate.reversed=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}bounce(t){if(this.tailAnimate.bounce=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}subAnimate(){const t=new Jm(this,this.tailAnimate);return this.tailAnimate=t,this.subAnimates.push(t),t.bind(this.target),this}getStartProps(){return this.subAnimates[0].getStartProps()}getEndProps(){return this.tailAnimate.getEndProps()}depreventAttr(t){this._preventAttrs&&this._preventAttrs.delete(t)}preventAttr(t){this._preventAttrs||(this._preventAttrs=new Set),this._preventAttrs.add(t)}preventAttrs(t){t.forEach(e=>this.preventAttr(e))}validAttr(t){return!this._preventAttrs||!this._preventAttrs.has(t)}bind(t){return this.target=t,this.target.onAnimateBind&&!this.slience&&this.target.onAnimateBind(this),this.subAnimates.forEach(e=>{e.bind(t)}),this}advance(t){if(this._duringTime<this._startTime){if(this._duringTime+t*this.timeScale<this._startTime)return void(this._duringTime+=t*this.timeScale);t=this._duringTime+t*this.timeScale-this._startTime,this._duringTime=this._startTime}this.status===$e.INITIAL&&(this.status=$e.RUNNING,this._onStart&&this._onStart.forEach(e=>e())),this.setPosition(Math.max(this.rawPosition,0)+t*this.timeScale)&&this.status===$e.RUNNING&&(this.status=$e.END,this._onEnd&&this._onEnd.forEach(e=>e()))}setPosition(t){let e,i=0;const n=this.rawPosition,r=this.subAnimates.reduce((o,l)=>o+l.totalDuration,0);t<0&&(t=0);const a=t>=r;if(a&&(t=r),t===n)return a;for(let o=0;o<this.subAnimates.length&&(e=this.subAnimates[o],!(i+e.totalDuration>=t));o++)i+=e.totalDuration,e=void 0;return this.rawPosition=t,e.setPosition(t-i),a}onStart(t){this._onStart||(this._onStart=[]),this._onStart.push(t)}onEnd(t){this._onEnd||(this._onEnd=[]),this._onEnd.push(t)}onRemove(t){this._onRemove||(this._onRemove=[]),this._onRemove.push(t)}onFrame(t){this._onFrame||(this._onFrame=[]),this._onFrame.push(t)}release(){this.status=$e.END}stop(t){t||this.target.onStop(),t==="start"?this.target.onStop(this.getStartProps()):t==="end"?this.target.onStop(this.getEndProps()):this.target.onStop(t),this.release()}}Ns.mode=Ca.NORMAL,Ns.interpolateMap=new Map;class Jm{get totalDuration(){return this.calcAttr(),this._totalDuration+this._startAt}constructor(t,e){this.rawPosition=-1,this.position=0,this.loop=0,this.duration=0,this.animate=t,this.stepHead=new Qm(0,0,e?Object.assign({},e.stepTail.props):{}),this.stepTail=this.stepHead,this.dirty=!0,this._startAt=0}calcAttr(){this.dirty&&(this._totalDuration=this.duration*(this.loop+1))}bind(t){return this.target=t,this}play(t){let e=t.duration;(e==null||e<0)&&(e=0);const i=t.easing,n=typeof i=="string"?bt[i]:i,r=this._addStep(e,null,n);return r.type=ar.customAnimate,this._appendProps(t.getEndProps(),r,!1),this._appendCustomAnimate(t,r),this}to(t,e,i,n){(e==null||e<0)&&(e=0);const r=typeof i=="string"?bt[i]:i,a=this._addStep(e,null,r);return a.type=ar.to,this._appendProps(t,a,!!n&&n.tempProps),a.propKeys||(a.propKeys=Object.keys(a.props)),n&&n.noPreventAttrs||this.target.animates&&this.target.animates.forEach(o=>{o.id!==this.animate.id&&o.preventAttrs(a.propKeys)}),this}from(t,e,i,n){this.to(t,0,i,n);const r={};this.stepTail.propKeys||(this.stepTail.propKeys=Object.keys(this.stepTail.props)),this.stepTail.propKeys.forEach(a=>{r[a]=this.getLastPropByName(a,this.stepTail)}),this.to(r,e,i,n),this.stepTail.type=ar.from}startAt(t){return t<0&&(t=0),this._startAt=t,this}getStartProps(){var t;return(t=this.stepHead)===null||t===void 0?void 0:t.props}getEndProps(){return this.stepTail.props}getLastStep(){return this._lastStep}wait(t){if(t>0){const e=this._addStep(+t,null);e.type=ar.wait,e.prev.customAnimate?e.props=e.prev.customAnimate.getEndProps():e.props=e.prev.props,this.target.onAddStep&&this.target.onAddStep(e)}return this}_addStep(t,e,i){const n=new Qm(this.duration,t,e,i);return this.duration+=t,this.stepTail.append(n),this.stepTail=n,n}_appendProps(t,e,i){e.props=i?t:Object.assign({},t);let n=e.prev;const r=e.props;for(e.propKeys||(e.propKeys=Object.keys(e.props)),e.propKeys.forEach(o=>{e.props[o]===void 0&&(e.props[o]=this.target.getDefaultAttribute(o))});n.prev;)n.props&&(n.propKeys||(n.propKeys=Object.keys(n.props)),n.propKeys.forEach(o=>{r[o]===void 0&&(r[o]=n.props[o])})),e.propKeys=Object.keys(e.props),n=n.prev;const a=this.stepHead.props;e.propKeys||(e.propKeys=Object.keys(r)),e.propKeys.forEach(o=>{if(a[o]===void 0){const l=this.animate.getStartProps();a[o]=l[o]=this.target.getComputedAttribute(o)}}),this.target.onAddStep&&this.target.onAddStep(e)}_appendCustomAnimate(t,e){e.customAnimate=t,t.step=e,t.bind(this.target,this)}setPosition(t){var e;const i=this.duration,n=this.loop,r=this.rawPosition;let a,o,l=!1;const h=(e=this._startAt)!==null&&e!==void 0?e:0;if(t<0&&(t=0),t<h)return this.rawPosition=t,!1;if(t-=h,i<=0&&(l=!0,i<0)||(a=Math.floor(t/i),o=t-a*i,l=t>=n*i+i,l&&(o=i,a=n,t=o*a+i),t===r))return l;const c=!this.reversed!=!(this.bounce&&a%2);return c&&(o=i-o),this._deltaPosition=o-this.position,this.position=o,this.rawPosition=t+h,this.updatePosition(l,c),l}updatePosition(t,e){if(!this.stepHead)return;let i=this.stepHead.next;const n=this.position,r=this.duration;if(this.target&&i){let a=i.next;for(;a&&a.position<=n;)i=a,a=i.next;let o=t?r===0?1:n/r:(n-i.position)/i.duration;i.easing&&(o=i.easing(o)),this.tryCallCustomAnimateLifeCycle(i,this._lastStep||(e?this.stepTail:this.stepHead),e),this.updateTarget(i,o,t),this._lastStep=i,this.animate._onFrame&&this.animate._onFrame.forEach(l=>l(i,o))}}tryCallCustomAnimateLifeCycle(t,e,i){if(t!==e)if(i){let n=e.prev;for(;n&&n!==t;)n.customAnimate&&(n.customAnimate.onStart&&n.customAnimate.onStart(),n.customAnimate.onEnd&&n.customAnimate.onEnd()),n=t.prev;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}else{let n=e.next;for(;n&&n!==t;)n.customAnimate&&(n.customAnimate.onStart&&n.customAnimate.onStart(),n.customAnimate.onEnd&&n.customAnimate.onEnd()),n=n.next;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}}getLastPropByName(t,e){let i=e.prev;for(;i;){if(i.props&&i.props[t]!==void 0)return i.props[t];if(i.customAnimate){const n=i.customAnimate.getEndProps()[t];if(n!==void 0)return n}i=i.prev}return Tt.getInstance().warn("未知错误，step中找不到属性"),e.props[t]}updateTarget(t,e,i){t.props==null&&t.customAnimate==null||this.target.onStep(this,this.animate,t,e,i)}}class Qm{constructor(t,e,i,n){this.duration=e,this.position=t,this.props=i,this.easing=n}append(t){t.prev=this,t.next=this.next,this.next=t}getLastProps(){let t=this.prev;for(;t;){if(t.props)return t.props;if(t.customAnimate)return t.customAnimate.getMergedEndProps();t=t.prev}return null}}const Lk=200,Dk="cubicOut";var tv;(function(s){s[s.Top=1]="Top",s[s.Right=2]="Right",s[s.Bottom=4]="Bottom",s[s.Left=8]="Left",s[s.ALL=15]="ALL"})(tv||(tv={}));const _s=[!1,!1,!1,!1],Da=[0,0,0,0],xd=s=>s?W(s)?s.length===0?0:s.length===1?s[0]:s.length===2?(Da[0]=s[0],Da[2]=s[0],Da[1]=s[1],Da[3]=s[1],Da):s:s:0,pr=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],ql=[1,2,3,0,1,2,3,0];function ev(s,t,e,i){for(;s>=dt;)s-=dt;for(;s<0;)s+=dt;for(;s>t;)t+=dt;pr[0].x=e,pr[1].y=e,pr[2].x=-e,pr[3].y=-e;const n=Math.ceil(s/bi)%4,r=Math.ceil(t/bi)%4;if(i.add(ge(s)*e,qt(s)*e),i.add(ge(t)*e,qt(t)*e),n!==r||t-s>Gt){let a=!1;for(let o=0;o<ql.length;o++)if(a||n!==ql[o]){if(a&&r===ql[o])break;if(a){const l=pr[ql[o]];i.add(l.x,l.y)}}else{a=!0;const l=pr[n];i.add(l.x,l.y)}}}function Sd(s,t,e){const{x:i,y:n}=Of(s.x,s.y,t.x,t.y,e),{x:r,y:a}=Of(s.x1,s.y1,t.x1,t.y1,e),o=new Lt(i,n,r,a);return o.defined=t.defined,o}function Ad(s,t,e){if(!s||!t)return[];Array.isArray(s)||(s=[s]),Array.isArray(t)||(t=[t]);let i=[];if(s.length>t.length){i=t.map(n=>{const r=new Lt(n.x,n.y,n.x1,n.y1);return r.defined=n.defined,r});for(let n=0;n<t.length;n++)i[n]=Sd(s[n],t[n],e)}else{i=t.map(n=>{const r=new Lt(n.x,n.y,n.x1,n.y1);return r.defined=n.defined,r});for(let n=0;n<s.length;n++)i[n]=Sd(s[n],t[n],e)}return i}function Zl(s,t){if(W(s)){let e;for(let i=0;i<s.length&&e===void 0;i++)e=s[i][t];return e}return s[t]}class Jl{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Jl.TimeOut;this.durations=[],this.timeout=t,this.lastDate=0,this.durationsListThreshold=30}call(t){return this.lastDate=Date.now(),setTimeout(()=>{this.appendDuration(Date.now()-this.lastDate),t(0)},this.timeout,!0)}clear(t){clearTimeout(t)}appendDuration(t){this.durations.push(t),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce((e,i)=>e+i,0)/this.durations.length,1e3/60),1e3/30)}}Jl.TimeOut=1e3/60;const Ql=new Jl,th=(s,t)=>{const e=((i,n)=>Q(i)&&i[i.length-1]==="%"?n*(Number.parseFloat(i.substring(0,i.length-1))/100):i)(s,t);return isNaN(e)?e:Math.max(t,e)};class Fk extends dr{constructor(t,e,i,n,r){super(t,e,i,n,r)}getEndProps(){return this.valid===!1?{}:{text:this.to}}onBind(){var t,e,i,n,r,a,o,l;this.fromNumber=it((t=this.from)===null||t===void 0?void 0:t.text)?(e=this.from)===null||e===void 0?void 0:e.text:Number.parseFloat((i=this.from)===null||i===void 0?void 0:i.text),this.toNumber=it((n=this.to)===null||n===void 0?void 0:n.text)?(r=this.to)===null||r===void 0?void 0:r.text:Number.parseFloat((a=this.to)===null||a===void 0?void 0:a.text),Number.isFinite(this.toNumber)||(this.fromNumber=0),Number.isFinite(this.toNumber)||(this.valid=!1),this.valid!==!1&&(this.decimalLength=(l=(o=this.params)===null||o===void 0?void 0:o.fixed)!==null&&l!==void 0?l:Math.max(ir(this.fromNumber),ir(this.toNumber)))}onEnd(){}onUpdate(t,e,i){var n;this.valid!==!1&&(i.text=t?(n=this.to)===null||n===void 0?void 0:n.text:(this.fromNumber+(this.toNumber-this.fromNumber)*e).toFixed(this.decimalLength))}}var iv;(function(s){s[s.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",s[s.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT",s[s.TOP_TO_BOTTOM=2]="TOP_TO_BOTTOM",s[s.BOTTOM_TO_TOP=3]="BOTTOM_TO_TOP",s[s.STROKE=4]="STROKE"})(iv||(iv={}));class jk extends dr{constructor(t,e,i,n,r){var a,o;super(t,e,i,n,r),this.newPointAnimateType=(a=r==null?void 0:r.newPointAnimateType)!==null&&a!==void 0?a:"grow",this.clipRangeByDimension=(o=r==null?void 0:r.clipRangeByDimension)!==null&&o!==void 0?o:"x"}getPoints(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(t.points)return t.points;if(t.segments){const i=[];return this.segmentsCache||(this.segmentsCache=[]),t.segments.map(n=>{var r,a;n.points&&i.push(...n.points),e&&this.segmentsCache.push((a=(r=n.points)===null||r===void 0?void 0:r.length)!==null&&a!==void 0?a:0)}),i}return[]}onBind(){const t=this.getPoints(this.from),e=this.getPoints(this.to,!0);this.fromPoints=t?Array.isArray(t)?t:[t]:[],this.toPoints=e?Array.isArray(e)?e:[e]:[];const i=new Map;this.fromPoints.forEach(h=>{h.context&&i.set(h.context,h)});let n,r,a=1/0,o=-1/0;for(let h=0;h<this.toPoints.length;h+=1)if(i.has(this.toPoints[h].context)){a=h,n=i.get(this.toPoints[h].context);break}for(let h=this.toPoints.length-1;h>=0;h-=1)if(i.has(this.toPoints[h].context)){o=h,r=i.get(this.toPoints[h].context);break}this.newPointAnimateType==="clip"&&this.toPoints.length!==0&&(Number.isFinite(o)?(this.clipRange=this.toPoints[o][this.clipRangeByDimension]/this.toPoints[this.toPoints.length-1][this.clipRangeByDimension],this.clipRange===1&&(this.shrinkClipRange=this.toPoints[o][this.clipRangeByDimension]/this.fromPoints[this.fromPoints.length-1][this.clipRangeByDimension]),q(this.clipRange)?this.clipRange=ui(this.clipRange,0,1):this.clipRange=0):this.clipRange=0);let l=this.toPoints[0];this.interpolatePoints=this.toPoints.map((h,c)=>{const u=i.get(h.context);return u?(l=u,[u,h]):this.newPointAnimateType==="appear"||this.newPointAnimateType==="clip"?[h,h]:c<a&&n?[n,h]:c>o&&r?[r,h]:[l,h]}),this.points=this.interpolatePoints.map(h=>{const c=h[0],u=h[1],d=new Lt(c.x,c.y,c.x1,c.y1);return d.defined=u.defined,d.context=u.context,d})}onFirstRun(){const t=this.target.attribute.clipRange;q(t*this.clipRange)&&(this.clipRange*=t)}onUpdate(t,e,i){if(this.points=this.points.map((n,r)=>{const a=Sd(this.interpolatePoints[r][0],this.interpolatePoints[r][1],e);return a.context=n.context,a}),this.clipRange){if(this.shrinkClipRange)return void(t?(i.points=this.toPoints,i.clipRange=1):(i.points=this.fromPoints,i.clipRange=this.clipRange-(this.clipRange-this.shrinkClipRange)*e));i.clipRange=this.clipRange+(1-this.clipRange)*e}if(this.segmentsCache&&this.to.segments){let n=0;i.segments=this.to.segments.map((r,a)=>{const o=n+this.segmentsCache[a],l=this.points.slice(n,o);return n=o,Object.assign(Object.assign({},r),{points:l})})}else i.points=this.points}}var bs;(function(s){s[s.Color255=0]="Color255",s[s.Color1=1]="Color1"})(bs||(bs={}));class Ce{static Get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bs.Color1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0,1];if(e===bs.Color1){const a=Ce.store1[t];if(a)return i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3],i;const o=re.parseColorString(t);if(o){const l=[o.r/255,o.g/255,o.b/255,o.opacity];Ce.store1[t]=l,Ce.store255[t]=[o.r,o.g,o.b,o.opacity],i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3]}return i}const n=Ce.store255[t];if(n)return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i;const r=re.parseColorString(t);return r&&(Ce.store1[t]=[r.r/255,r.g/255,r.b/255,r.opacity],Ce.store255[t]=[r.r,r.g,r.b,r.opacity],i[0]=r.r,i[1]=r.g,i[2]=r.b,i[3]=r.opacity),i}static Set(t,e,i){if(e===bs.Color1){if(Ce.store1[t])return;Ce.store1[t]=i,Ce.store255[t]=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2]),Math.floor(255*i[3])]}else{if(Ce.store255[t])return;Ce.store255[t]=i,Ce.store1[t]=[i[0]/255,i[1]/255,i[2]/255,i[3]]}}}function eh(s){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return Array.isArray(s)&&it(s[0])?t?\`rgb(\${Math.round(s[0])},\${Math.round(s[1])},\${Math.round(s[2])},\${s[3].toFixed(2)})\`:\`rgb(\${Math.round(s[0])},\${Math.round(s[1])},\${Math.round(s[2])})\`:s}function gr(s,t,e,i,n){return Array.isArray(s)&&!it(s[0])||Array.isArray(t)&&!it(t[0])?new Array(4).fill(0).map((r,a)=>sv(W(s)?s[a]:s,W(t)?t[a]:t,e,i)):sv(s,t,e,i,n)}function sv(s,t,e,i,n){if(!s||!t)return s&&eh(s)||t&&eh(t)||!1;let r,a,o=!1,l=!1;if(Array.isArray(s)?r=s:typeof s=="string"?r=Ce.Get(s,bs.Color255):o=!0,Array.isArray(t)?a=t:typeof t=="string"?a=Ce.Get(t,bs.Color255):l=!0,o!==l){const h=o?s:t,c=o?t:s,u=Object.assign(Object.assign({},h),{stops:h.stops.map(d=>Object.assign(Object.assign({},d),{color:eh(c)}))});return o?gr(h,u,e,i,n):gr(u,h,e,i,n)}if(o){if(s.gradient===t.gradient){const h=s,c=t,u=h.stops,d=c.stops;if(u.length!==d.length)return!1;if(h.gradient==="linear")return function(p,g,f){const m=p.stops,v=g.stops;return{gradient:"linear",x0:p.x0+(g.x0-p.x0)*f,x1:p.x1+(g.x1-p.x1)*f,y0:p.y0+(g.y0-p.y0)*f,y1:p.y1+(g.y1-p.y1)*f,stops:new Array(m.length).fill(0).map((y,_)=>({color:kd(m[_].color,v[_].color,f),offset:m[_].offset+(v[_].offset-m[_].offset)*f}))}}(h,c,e);if(h.gradient==="radial")return function(p,g,f){const m=p.stops,v=g.stops;return{gradient:"radial",x0:p.x0+(g.x0-p.x0)*f,x1:p.x1+(g.x1-p.x1)*f,y0:p.y0+(g.y0-p.y0)*f,y1:p.y1+(g.y1-p.y1)*f,r0:p.r0+(g.r0-p.r0)*f,r1:p.r1+(g.r1-p.r1)*f,stops:new Array(m.length).fill(0).map((y,_)=>({color:kd(m[_].color,v[_].color,f),offset:m[_].offset+(v[_].offset-m[_].offset)*f}))}}(h,c,e);if(h.gradient==="conical")return function(p,g,f){const m=p.stops,v=g.stops;return{gradient:"conical",startAngle:p.startAngle+(g.startAngle-p.startAngle)*f,endAngle:p.endAngle+(g.endAngle-p.endAngle)*f,x:p.x+(g.x-p.x)*f,y:p.y+(g.y-p.y)*f,stops:new Array(m.length).fill(0).map((y,_)=>({color:kd(m[_].color,v[_].color,f),offset:m[_].offset+(v[_].offset-m[_].offset)*f}))}}(h,c,e)}return!1}return n&&n(r,a),eh(function(h,c,u){return[h[0]+(c[0]-h[0])*u,h[1]+(c[1]-h[1])*u,h[2]+(c[2]-h[2])*u,h[3]+(c[3]-h[3])*u]}(r,a,e),i)}Ce.store255={},Ce.store1={};const xs=[0,0,0,0],Fa=[0,0,0,0];function kd(s,t,e){return Ce.Get(s,bs.Color255,xs),Ce.Get(t,bs.Color255,Fa),\`rgba(\${Math.round(xs[0]+(Fa[0]-xs[0])*e)},\${Math.round(xs[1]+(Fa[1]-xs[1])*e)},\${Math.round(xs[2]+(Fa[2]-xs[2])*e)},\${xs[3]+(Fa[3]-xs[3])*e})\`}class Nk extends dr{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:0}})}onEnd(){this.target.setTheme({common:{opacity:1}})}onUpdate(t,e,i){this.target.setTheme({common:{opacity:e}})}}class zk extends dr{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:1}})}onEnd(){this.target.setTheme({common:{opacity:0}})}onUpdate(t,e,i){this.target.setTheme({common:{opacity:1-e}})}}class Nt{static GetImage(t,e){var i;const n=Nt.cache.get(t);n?n.loadState==="fail"?H.global.getRequestAnimationFrame()(()=>{e.imageLoadFail(t)}):n.loadState==="init"||n.loadState==="loading"?(i=n.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,n.data):Nt.loadImage(t,e)}static GetSvg(t,e){var i;let n=Nt.cache.get(t);n?n.loadState==="fail"?H.global.getRequestAnimationFrame()(()=>{e.imageLoadFail(t)}):n.loadState==="init"||n.loadState==="loading"?(i=n.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,n.data):(n={type:"image",loadState:"init"},Nt.cache.set(t,n),n.dataPromise=H.global.loadSvg(t),n.dataPromise?(n.waitingMark=[e],n.dataPromise.then(r=>{var a;n.loadState=r!=null&&r.data?"success":"fail",n.data=r==null?void 0:r.data,(a=n.waitingMark)===null||a===void 0||a.map((o,l)=>{r!=null&&r.data?(n.loadState="success",n.data=r.data,o.imageLoadSuccess(t,r.data)):(n.loadState="fail",o.imageLoadFail(t))}),n.waitingMark&&(n.waitingMark=[])})):(n.loadState="fail",e.imageLoadFail(t)))}static GetFile(t,e){let i=Nt.cache.get(t);return i?i.loadState==="fail"?Promise.reject():i.loadState==="init"||i.loadState==="loading"?i.dataPromise.then(n=>n.data):Promise.resolve(i.data):(i={type:e,loadState:"init"},Nt.cache.set(t,i),e==="arrayBuffer"?i.dataPromise=H.global.loadArrayBuffer(t):e==="blob"?i.dataPromise=H.global.loadBlob(t):e==="json"&&(i.dataPromise=H.global.loadJson(t)),i.dataPromise.then(n=>n.data))}static loading(){setTimeout(()=>{if(!Nt.isLoading&&Nt.toLoadAueue.length){Nt.isLoading=!0;const t=Nt.toLoadAueue.splice(0,10),e=[];t.forEach(i=>{const{url:n,marks:r}=i,a={type:"image",loadState:"init"};if(Nt.cache.set(n,a),a.dataPromise=H.global.loadImage(n),a.dataPromise){a.waitingMark=r;const o=a.dataPromise.then(l=>{var h;a.loadState=l!=null&&l.data?"success":"fail",a.data=l==null?void 0:l.data,(h=a.waitingMark)===null||h===void 0||h.map((c,u)=>{l!=null&&l.data?(a.loadState="success",a.data=l.data,c.imageLoadSuccess(n,l.data)):(a.loadState="fail",c.imageLoadFail(n))}),a.waitingMark&&(a.waitingMark=[])});e.push(o)}else a.loadState="fail",r.forEach(o=>o.imageLoadFail(n))}),Promise.all(e).then(()=>{Nt.isLoading=!1,this.onLoadSuccessCb.forEach(i=>i()),Nt.loading()}).catch(i=>{console.error(i),Nt.isLoading=!1,this.onLoadSuccessCb.forEach(n=>n()),Nt.loading()})}},0)}static loadImage(t,e){const i=nv(t,Nt.toLoadAueue);if(i!==-1)return Nt.toLoadAueue[i].marks.push(e),void Nt.loading();Nt.toLoadAueue.push({url:t,marks:[e]}),Nt.loading()}static improveImageLoading(t){const e=nv(t,Nt.toLoadAueue);if(e!==-1){const i=Nt.toLoadAueue.splice(e,1);Nt.toLoadAueue.unshift(i[0])}}static onLoadSuccess(t){this.onLoadSuccessCb.push(t)}}function nv(s,t){for(let e=0;e<t.length;e++)if(t[e].url===s)return e;return-1}Nt.cache=new Map,Nt.isLoading=!1,Nt.toLoadAueue=[],Nt.onLoadSuccessCb=[];class oe{bounds(t,e){if(it(t)){const i=t/2;e.x1=-i,e.x2=i,e.y1=-i,e.y2=i}else e.x1=-t[0]/2,e.x2=t[0]/2,e.y1=-t[1]/2,e.y2=t[1]/2}parseSize(t){return it(t)?t:Math.min(t[0],t[1])}}function rv(s,t,e,i,n){return n?s.arc(e,i,t,0,je,!1,n):s.arc(e,i,t,0,je),!1}var Hk=new class extends oe{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(s,t,e,i,n){return rv(s,this.parseSize(t)/2,e,i,n)}drawOffset(s,t,e,i,n,r){return rv(s,this.parseSize(t)/2+n,e,i,r)}drawToSvgPath(s,t,e,i){const n=this.parseSize(s)/2;return\`M \${t-n}, \${e} a \${n},\${n} 0 1,0 \${2*n},0 a \${n},\${n} 0 1,0 -\${2*n},0\`}},Vk=new class extends oe{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(s,t,e,i,n){return function(r,a,o,l,h){return r.moveTo(-3*a+o,-a+l,h),r.lineTo(-a+o,-a+l,h),r.lineTo(-a+o,-3*a+l,h),r.lineTo(a+o,-3*a+l,h),r.lineTo(a+o,-a+l,h),r.lineTo(3*a+o,-a+l,h),r.lineTo(3*a+o,a+l,h),r.lineTo(a+o,a+l,h),r.lineTo(a+o,3*a+l,h),r.lineTo(-a+o,3*a+l,h),r.lineTo(-a+o,a+l,h),r.lineTo(-3*a+o,a+l,h),r.closePath(),!0}(s,this.parseSize(t)/6,e,i,n)}drawOffset(s,t,e,i,n,r){return function(a,o,l,h,c,u){return a.moveTo(-3*o+l-c,-o+h-c,u),a.lineTo(-o+l-c,-o+h-c,u),a.lineTo(-o+l-c,-3*o+h-c,u),a.lineTo(o+l+c,-3*o+h-c,u),a.lineTo(o+l+c,-o+h-c,u),a.lineTo(3*o+l+c,-o+h-c,u),a.lineTo(3*o+l+c,o+h+c,u),a.lineTo(o+l+c,o+h+c,u),a.lineTo(o+l+c,3*o+h+c,u),a.lineTo(-o+l-c,3*o+h+c,u),a.lineTo(-o+l-c,o+h+c,u),a.lineTo(-3*o+l-c,o+h+c,u),a.closePath(),!0}(s,this.parseSize(t)/6,e,i,n,r)}};function wd(s,t,e,i,n){return s.moveTo(e,i-t,n),s.lineTo(t+e,i,n),s.lineTo(e,i+t,n),s.lineTo(e-t,i,n),s.closePath(),!0}var Wk=new class extends oe{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(s,t,e,i,n){return wd(s,this.parseSize(t)/2,e,i,n)}drawFitDir(s,t,e,i,n){return wd(s,this.parseSize(t)/2,e,i,n)}drawOffset(s,t,e,i,n,r){return wd(s,this.parseSize(t)/2+n,e,i,r)}};function av(s,t,e,i){const n=2*t;return s.rect(e-t,i-t,n,n),!1}var Uk=new class extends oe{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(s,t,e,i){return av(s,this.parseSize(t)/2,e,i)}drawOffset(s,t,e,i,n){return av(s,this.parseSize(t)/2+n,e,i)}};function ov(s,t,e,i){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;return s.moveTo(e+t+2*n,t+i+n),s.lineTo(e-t-2*n,t+i+n),s.lineTo(e,i-t-2*n),s.closePath(),!0}class lv extends oe{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(t,e,i,n){return ov(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,r){return ov(t,this.parseSize(e)/2,i,n,r)}}var Gk=new lv,Yk=new class extends lv{constructor(){super(...arguments),this.type="triangle"}};const hv=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),$k=Math.sin(je/10)*hv,Xk=-Math.cos(je/10)*hv;function cv(s,t,e,i){const n=$k*t,r=Xk*t;s.moveTo(e,-t+i),s.lineTo(n+e,r+i);for(let a=1;a<5;++a){const o=je*a/5,l=Math.cos(o),h=Math.sin(o);s.lineTo(h*t+e,-l*t+i),s.lineTo(l*n-h*r+e,h*n+l*r+i)}return s.closePath(),!0}var Kk=new class extends oe{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(s,t,e,i){return cv(s,this.parseSize(t)/2,e,i)}drawOffset(s,t,e,i,n){return cv(s,this.parseSize(t)/2+n,e,i)}};const qk=Ni(3);function uv(s,t,e,i){const n=t,r=n/qk,a=r/5,o=t;return s.moveTo(0+e,-n+i),s.lineTo(r/2+e,i),s.lineTo(a/2+e,i),s.lineTo(a/2+e,o+i),s.lineTo(-a/2+e,o+i),s.lineTo(-a/2+e,i),s.lineTo(-r/2+e,i),s.closePath(),!0}var Zk=new class extends oe{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(s,t,e,i){return uv(s,this.parseSize(t)/2,e,i)}drawOffset(s,t,e,i,n){return uv(s,this.parseSize(t)/2+n,e,i)}};function dv(s,t,e,i){const n=2*t;return s.moveTo(e,-t+i),s.lineTo(n/3/2+e,t+i),s.lineTo(-n/3/2+e,t+i),s.closePath(),!0}var Jk=new class extends oe{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(s,t,e,i){return dv(s,this.parseSize(t)/2,e,i)}drawOffset(s,t,e,i,n){return dv(s,this.parseSize(t)/2+n,e,i)}};function pv(s,t,e,i){return s.moveTo(-t+e,i),s.lineTo(e,t+i),!1}var Qk=new class extends oe{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(s,t,e,i){return pv(s,this.parseSize(t)/2,e,i)}drawOffset(s,t,e,i,n){return pv(s,this.parseSize(t)/2+n,e,i)}};const Ci=-.5,Mi=Ni(3)/2,gv=1/Ni(12);function fv(s,t,e,i){const n=t/2,r=t*gv,a=n,o=t*gv+t,l=-a,h=o;return s.moveTo(n+e,r+i),s.lineTo(a+e,o+i),s.lineTo(l+e,h+i),s.lineTo(Ci*n-Mi*r+e,Mi*n+Ci*r+i),s.lineTo(Ci*a-Mi*o+e,Mi*a+Ci*o+i),s.lineTo(Ci*l-Mi*h+e,Mi*l+Ci*h+i),s.lineTo(Ci*n+Mi*r+e,Ci*r-Mi*n+i),s.lineTo(Ci*a+Mi*o+e,Ci*o-Mi*a+i),s.lineTo(Ci*l+Mi*h+e,Ci*h-Mi*l+i),s.closePath(),!1}var tw=new class extends oe{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(s,t,e,i){return fv(s,this.parseSize(t)/2,e,i)}drawOffset(s,t,e,i,n){return fv(s,this.parseSize(t)/2+n,e,i)}};function mv(s,t,e,i,n){return s.moveTo(-t+e-2*n,i),s.lineTo(t+e+n,t+i+2*n),s.lineTo(t+e+n,i-t-2*n),s.closePath(),!0}var ew=new class extends oe{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(s,t,e,i){return mv(s,this.parseSize(t)/2,e,i,0)}drawOffset(s,t,e,i,n){return mv(s,this.parseSize(t)/2,e,i,n)}};function vv(s,t,e,i){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;return s.moveTo(e-t-n,t+i+2*n),s.lineTo(t+e+2*n,i),s.lineTo(e-t-n,i-t-2*n),s.closePath(),!0}var iw=new class extends oe{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(s,t,e,i){return vv(s,this.parseSize(t)/2,e,i)}drawOffset(s,t,e,i,n){return vv(s,this.parseSize(t)/2,e,i,n)}};function yv(s,t,e,i){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;return s.moveTo(e-t-2*n,i-t-n),s.lineTo(e+t+2*n,i-t-n),s.lineTo(e,i+t+2*n),s.closePath(),!0}var sw=new class extends oe{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(s,t,e,i){return yv(s,this.parseSize(t)/2,e,i)}drawOffset(s,t,e,i,n){return yv(s,this.parseSize(t)/2,e,i,n)}};const Td=Ni(3);function _v(s,t,e,i){const n=t*Td;return s.moveTo(e,i+-n/3*2),s.lineTo(t+e,i+n),s.lineTo(e-t,i+n),s.closePath(),!0}var nw=new class extends oe{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(s,t,e,i){return _v(s,this.parseSize(t)/2/Td,e,i)}drawOffset(s,t,e,i,n){return _v(s,this.parseSize(t)/2/Td+n,e,i)}};function bv(s,t,e,i){const n=2*t;return s.moveTo(t+e,i-n),s.lineTo(e-t,i),s.lineTo(t+e,n+i),!0}var rw=new class extends oe{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(s,t,e,i){return bv(s,this.parseSize(t)/4,e,i)}drawOffset(s,t,e,i,n){return bv(s,this.parseSize(t)/4+n,e,i)}};function xv(s,t,e,i){const n=2*t;return s.moveTo(e-t,i-n),s.lineTo(e+t,i),s.lineTo(e-t,n+i),!0}var aw=new class extends oe{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(s,t,e,i){return xv(s,this.parseSize(t)/4,e,i)}drawOffset(s,t,e,i,n){return xv(s,this.parseSize(t)/4+n,e,i)}};function Sv(s,t,e,i){const n=2*t;return s.moveTo(e-n,i+t),s.lineTo(e,i-t),s.lineTo(e+n,i+t),!0}var ow=new class extends oe{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(s,t,e,i){return Sv(s,this.parseSize(t)/4,e,i)}drawOffset(s,t,e,i,n){return Sv(s,this.parseSize(t)/4+n,e,i)}};function Av(s,t,e,i){const n=2*t;return s.moveTo(e-n,i-t),s.lineTo(e,i+t),s.lineTo(e+n,i-t),!0}var lw=new class extends oe{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(s,t,e,i){return Av(s,this.parseSize(t)/4,e,i)}drawOffset(s,t,e,i,n){return Av(s,this.parseSize(t)/4+n,e,i)}};function kv(s,t,e,i,n){return s.moveTo(e,i-t),s.lineTo(e,i+t),!0}var hw=new class extends oe{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(s,t,e,i,n){return kv(s,this.parseSize(t)/2,e,i)}drawOffset(s,t,e,i,n,r){return kv(s,this.parseSize(t)/2+n,e,i)}drawToSvgPath(s,t,e,i){const n=this.parseSize(s)/2;return\`M \${t}, \${e-n} L \${t},\${e+n}\`}};function wv(s,t,e,i,n){return s.moveTo(e-t,i),s.lineTo(e+t,i),!0}var cw=new class extends oe{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(s,t,e,i,n){return wv(s,this.parseSize(t)/2,e,i)}drawOffset(s,t,e,i,n,r){return wv(s,this.parseSize(t)/2+n,e,i)}drawToSvgPath(s,t,e,i){const n=this.parseSize(s)/2;return\`M \${t-n}, \${e} L \${t+n},\${e}\`}};function Tv(s,t,e,i,n){return s.moveTo(e-t,i-t),s.lineTo(e+t,i+t),s.moveTo(e+t,i-t),s.lineTo(e-t,i+t),!0}var uw=new class extends oe{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(s,t,e,i,n){return Tv(s,this.parseSize(t)/2,e,i)}drawOffset(s,t,e,i,n,r){return Tv(s,this.parseSize(t)/2+n,e,i)}drawToSvgPath(s,t,e,i){const n=this.parseSize(s)/2;return\`M \${t-n}, \${e-n} L \${t+n},\${e+n} M \${t+n}, \${e-n} L \${t-n},\${e+n}\`}};function Cv(s,t,e,i){return s.rect(e-t[0]/2,i-t[1]/2,t[0],t[1]),!1}function Mv(s,t,e,i){const n=t,r=t/2;return s.rect(e-n/2,i-r/2,n,r),!1}var dw=new class extends oe{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(s,t,e,i){return it(t)?Mv(s,t,e,i):Cv(s,t,e,i)}drawWithClipRange(s,t,e,i,n,r,a){it(t)&&(t=[t,t/2]);const o=2*(t[0]+t[1])*n,l=[{x:e+t[0]/2,y:i-t[1]/2},{x:e+t[0]/2,y:i+t[1]/2},{x:e-t[0]/2,y:i+t[1]/2},{x:e-t[0]/2,y:i-t[1]/2}];let h=0,c=l[3];s.moveTo(c.x,c.y);for(let u=0;u<l.length;u++){const d=l[u],p=Math.sqrt((d.x-c.x)*(d.x-c.x)+(d.y-c.y)*(d.y-c.y));if(h+p>o){const g=(d.x-c.x)*(o-h)/p,f=(d.y-c.y)*(o-h)/p;s.lineTo(c.x+g,c.y+f);break}s.lineTo(d.x,d.y),c=d,h+=p}return!1}drawOffset(s,t,e,i,n){return it(t)?Mv(s,t+2*n,e,i):Cv(s,[t[0]+2*n,t[1]+2*n],e,i)}};const ja=new fe;class Ev{constructor(t,e){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this.pathStr="",this.type=t,W(e)?this.svgCache=e:this.path=e,this.isSvg=i}drawOffset(t,e,i,n,r,a,o){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach(l=>{t.beginPath(),gs(l.path.commandList,t,i,n,e,e),o&&o(l.path,l.attribute)}),!1):(gs(this.path.commandList,t,i,n,e+r,e+r),!1)}draw(t,e,i,n,r,a){return e=this.parseSize(e),this.drawOffset(t,e,i,n,0,r,a)}parseSize(t){return it(t)?t:Math.min(t[0],t[1])}drawWithClipRange(t,e,i,n,r,a,o){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach(l=>{l.path.drawWithClipRange(t,e,i,n,r),o&&o(l.path,l.attribute)}),!1):(this.path.drawWithClipRange(t,e,i,n,r),!1)}bounds(t,e){if(t=this.parseSize(t),this.isSvg)return this.svgCache?(e.clear(),void this.svgCache.forEach(i=>{let{path:n}=i;ja.x1=n.bounds.x1*t,ja.y1=n.bounds.y1*t,ja.x2=n.bounds.x2*t,ja.y2=n.bounds.y2*t,e.union(ja)})):void 0;this.path.bounds&&(e.x1=this.path.bounds.x1*t,e.y1=this.path.bounds.y1*t,e.x2=this.path.bounds.x2*t,e.y2=this.path.bounds.y2*t)}}const ih={};[Hk,Vk,Wk,Uk,nw,Yk,Kk,Zk,Jk,Qk,tw,ew,iw,Gk,sw,rw,aw,ow,lw,dw,hw,cw,uw].forEach(s=>{ih[s.type]=s});const pw={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"};class Cd{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}function Bv(s,t,e,i){const n=s.indexOf(t,e);if(n===-1)throw new Error(i);return n+t.length-1}function Rv(s,t,e){const i=function(c,u){let d,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:">",g="";for(let f=u;f<c.length;f++){let m=c[f];if(d)m===d&&(d="");else if(m==='"'||m==="'")d=m;else if(m===p[0]){if(!p[1])return{data:g,index:f};if(c[f+1]===p[1])return{data:g,index:f}}else m==="	"&&(m=" ");g+=m}}(s,t+1,arguments.length>3&&arguments[3]!==void 0?arguments[3]:">");if(!i)return;let n=i.data;const r=i.index,a=n.search(/\\s/);let o=n,l=!0;return a!==-1&&(o=n.substr(0,a).replace(/\\s\\s*$/,""),n=n.substr(a+1)),{tagName:o,tagExp:n,closeIndex:r,attrExpPresent:l,rawTagName:o}}const gw=new RegExp(\`([^\\\\s=]+)\\\\s*(=\\\\s*(['"])([\\\\s\\\\S]*?)\\\\3)?\`,"gm");class fw{constructor(t){this.currentNode=null,this.options=t,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(t,e,i){const n=e.tagname;typeof n=="string"&&(e.tagname=n),t.addChild(e)}buildAttributesMap(t,e,i){const n={};if(!t)return;const r=function(o,l){const h=[];let c=l.exec(o);for(;c;){const u=[];u.startIndex=l.lastIndex-c[0].length;const d=c.length;for(let p=0;p<d;p++)u.push(c[p]);h.push(u),c=l.exec(o)}return h}(t,gw),a=r.length;for(let o=0;o<a;o++){const l=r[o][1],h=r[o][4];l&&(n[l]=h===void 0||(isNaN(h)?h:Number(h)))}return n}parseXml(t){t=t.replace(/\\r\\n?/g,\`
\`);const e=new Cd("!xml");let i=e,n="",r="";for(let a=0;a<t.length;a++)if(t[a]==="<")if(t[a+1]==="/"){const o=Bv(t,">",a,"Closing Tag is not closed."),l=r.lastIndexOf(".");r=r.substring(0,l),i=this.tagsNodeStack.pop(),i&&i.child&&n&&i.child[i.child.length-1][":@"]&&(i.child[i.child.length-1][":@"].text=n),n="",a=o}else if(t[a+1]==="?")a=Rv(t,a,!1,"?>").closeIndex+1;else if(t.substr(a+1,3)==="!--")a=Bv(t,"-->",a+4,"Comment is not closed.");else{const o=Rv(t,a,!1);let l=o.tagName,h=o.tagExp;const c=o.attrExpPresent,u=o.closeIndex;if(l!==e.tagname&&(r+=r?"."+l:l),h.length>0&&h.lastIndexOf("/")===h.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),r=r.substr(0,r.length-1),h=l):h=h.substr(0,h.length-1);const d=new Cd(l);l!==h&&c&&(d[":@"]=this.buildAttributesMap(h,r,l)),this.addChild(i,d,r),r=r.substr(0,r.lastIndexOf("."))}else{const d=new Cd(l);this.tagsNodeStack.push(i),l!==h&&c&&(d[":@"]=this.buildAttributesMap(h,r,l)),this.addChild(i,d,r),i=d}n="",a=u}else n+=t[a];return e.child}}function mw(s,t){return Iv(s)}function Iv(s,t){const e={};for(let n=0;n<s.length;n++){const r=s[n],a=vw(r);if(a!==void 0&&r[a]){const o=Iv(r[a]);i=o,Object.keys(i).length,r[":@"]&&yw(o,r[":@"]),e[a]!==void 0&&e.hasOwnProperty(a)?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(o)):e[a]=o}}var i;return e}function vw(s){const t=Object.keys(s);for(let e=0;e<t.length;e++){const i=t[e];if(i!==":@")return i}}function yw(s,t,e){if(t){const i=Object.keys(t),n=i.length;for(let r=0;r<n;r++){const a=i[r];s[a]=t[a]}}}class sh{constructor(t){this.options=Object.assign({},sh.defaultOptions,t)}valid(t){return t.startsWith("<")}parse(t){return this.valid?mw(new fw(this.options).parseXml(t),this.options):!1}}sh.defaultOptions={};var _w=function(s,t,e,i){return new(e||(e=Promise))(function(n,r){function a(h){try{l(i.next(h))}catch(c){r(c)}}function o(h){try{l(i.throw(h))}catch(c){r(c)}}function l(h){var c;h.done?n(h.value):(c=h.value,c instanceof e?c:new e(function(u){u(c)})).then(a,o)}l((i=i.apply(s,[])).next())})};function nh(s,t,e){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;return s.expand(t+(i/2+(e?function(n,r){return n?r:0}(e,t):0))),s}let bw=0;function Xe(){return bw++}var fr;(function(s){s[s.HORIZONTAL=0]="HORIZONTAL",s[s.VERTICAL=1]="VERTICAL"})(fr||(fr={}));const Ov=new Map;["…","（","）","—","【","】","「","」","《","》"].forEach(s=>Ov.set(s,!0));const Pv=new Map;function xw(s){if(Ov.has(s))return!0;if(Pv.has(s))return!1;let t=!1;return s.codePointAt(0)<256&&(t=!0),t}[""].forEach(s=>Pv.set(s,!0));const rh=Xe(),Sw=Xe(),Na=Xe(),Aw=Xe(),kw=Xe(),Md=Xe(),Lv=Xe(),za=Xe(),ah=Xe(),oh=Xe();Xe();const Ed=Xe();Xe();const Bd=Xe(),lh=Xe(),hh=Xe(),Dv=Symbol.for("GraphicService"),Fv=Symbol.for("GraphicCreator"),jv={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},ww=Object.keys(jv),ch=new fe,Tw=new Zt,Nv=new fe,Ei=["lineWidth","scaleX","scaleY","angle","anchor","visible"],zv=["x","y"],Hv=["scaleX","scaleY"],Vv=["angle"],Ha=new Lt,zi={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};class Le extends Mk{static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const n=e[i];Object.defineProperty(Le.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get AABBBounds(){return this.tryUpdateAABBBounds()}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var e;super(),this._AABBBounds=new fe,this._updateTag=Ft.INIT,this.attribute=t,this.valid=this.isValid(),this.updateAABBBoundsStamp=0,t.background?this.loadImage((e=t.background.background)!==null&&e!==void 0?e:t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic)}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];var i,n;const{dx:r=t.dx,dy:a=t.dy}=this.attribute;if(e&&this.parent){const o=this.parent.attribute;Ha.x=r+((i=o.scrollX)!==null&&i!==void 0?i:0),Ha.y=a+((n=o.scrollY)!==null&&n!==void 0?n:0)}else Ha.x=r,Ha.y=a;return Ha}onAnimateBind(t){this._emitCustomEvent("animate-bind",t)}tryUpdateAABBBounds(){const t=this.attribute.boundsMode==="imprecise";if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;H.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const e=this.doUpdateAABBBounds(t);return H.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),this.attribute.boundsMode==="empty"&&e.clear(),e}tryUpdateOBBBounds(){return this._OBBBounds||(this._OBBBounds=new Yu),this.tryUpdateAABBBounds(),this.updateOBBBoundsStamp===this.updateAABBBoundsStamp?this._OBBBounds:(this.updateOBBBoundsStamp=this.updateAABBBoundsStamp,this.valid?this.doUpdateOBBBounds():(this._OBBBounds.clear(),this._OBBBounds))}combindShadowAABBBounds(t){if(this.shadowRoot){const e=this.shadowRoot.AABBBounds.clone();t.union(e)}}doUpdateOBBBounds(){return this._OBBBounds}getClipPath(){const{clipConfig:t}=this.attribute;if(!t)return null;this.clipPathMap||(this.clipPathMap=new Map);const{shape:e}=t;let i=this.clipPathMap.get(e)||null;return i||(this.clipPathMap.size>10&&this.clipPathMap.clear(),i=this.parsePath(e),i&&this.clipPathMap.set(e,i)),i}parsePath(t){if(!t)return null;let e=ih[t];if(e||(e=Le.userSymbolMap[t],e))return e;if(((i=t=pw[t]||t).startsWith("<svg")||i.startsWith("<?xml"))===!0){const h=new sh,{svg:c}=h.parse(t);if(!c)return null;const u=W(c.path)?c.path:[c.path];ch.clear();const d=[];u.forEach(v=>{const y=new me().fromString(v.d),_={};ww.forEach(b=>{v[b]&&(_[jv[b]]=v[b])}),d.push({path:y,attribute:_}),ch.union(y.bounds)});const p=ch.width(),g=ch.height(),f=1/ts(p,g);d.forEach(v=>v.path.transform(0,0,f,f));const m=new Ev(t,d,!0);return Le.userSymbolMap[t]=m,m}var i;const n=new me().fromString(t),r=n.bounds.width(),a=n.bounds.height(),o=1/ts(r,a);n.transform(0,0,o,o);const l=new Ev(t,n);return Le.userSymbolMap[t]=l,l}doUpdateAABBBounds(t){this.updateAABBBoundsStamp++;const e=this.getGraphicTheme();this._AABBBounds.clear();const i=this.attribute,n=this.updateAABBBounds(i,e,this._AABBBounds,t),{boundsPadding:r=e.boundsPadding}=i,a=xd(r);return a&&n.expand(a),this.clearUpdateBoundTag(),n}updatePathProxyAABBBounds(t){const e=typeof this.pathProxy=="function"?this.pathProxy(this.attribute):this.pathProxy;if(!e)return!1;const i=new sd(t);return gs(e.commandList,i,0,0),!0}tryUpdateGlobalAABBBounds(){const t=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(t.x1,t.y1,t.x2,t.y2):this._globalAABBBounds=t.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(){if(this._globalTransMatrix){if(this.parent){const t=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._transMatrix||(this._transMatrix=new Zt),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),t&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?(!!(this._updateTag&Ft.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds())&&H.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this):!!(this._updateTag&Ft.UPDATE_BOUNDS)&&H.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&Ft.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&Ft.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&Ft.UPDATE_LOCAL_MATRIX)}isValid(){var t,e;const i=this.attribute;return Number.isFinite(((t=i.x)!==null&&t!==void 0?t:0)+((e=i.y)!==null&&e!==void 0?e:0))}_validNumber(t){return t==null||Number.isFinite(t)}shouldUpdateShape(){return!!(this._updateTag&Ft.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=Ft.CLEAR_SHAPE}containsPoint(t,e,i,n){if(!n)return!1;if(i===rr.GLOBAL){const r=new Lt(t,e);this.parent&&this.parent.globalTransMatrix.transformPoint(r,r),t=r.x,e=r.y}return n.containsPoint(this,{x:t,y:e})}setAttributes(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=arguments.length>2?arguments[2]:void 0;(t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t).background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._setAttributes(t,e,i)}_setAttributes(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=arguments.length>2?arguments[2]:void 0;const n=Object.keys(t);for(let r=0;r<n.length;r++){const a=n[r];this.attribute[a]=t[a]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(n)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i)}setAttribute(t,e,i,n){var r;const a=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,n);a?this._setAttributes(a,i,n):I((r=this.normalAttrs)===null||r===void 0?void 0:r[t])?(this.attribute[t]=e,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n)):this.normalAttrs[t]=e,t==="background"?this.loadImage(e,!0):t==="shadowGraphic"&&this.setShadowGraphic(e)}needUpdateTags(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ei;for(let i=0;i<e.length;i++){const n=e[i];if(t.indexOf(n)!==-1)return!0}return!1}needUpdateTag(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ei;for(let i=0;i<e.length;i++)if(t===e[i])return!0;return!1}initAttributes(t){const e={type:Pe.INIT};t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,e)||t,this.attribute=t,t.background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._updateTag=Ft.INIT,this.valid=this.isValid(),this.onAttributeUpdate(e)}translate(t,e){var i,n;if(t===0&&e===0)return this;const r={type:Pe.TRANSLATE},a=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,zv,r);a&&(t=a.x,e=a.y,delete a.x,delete a.y,this._setAttributes(a));const o=this.attribute,l=o.postMatrix;return l?H.transformUtil.fromMatrix(l,l).translate(t,e):(o.x=((i=o.x)!==null&&i!==void 0?i:Te.x)+t,o.y=((n=o.y)!==null&&n!==void 0?n:Te.y)+e),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this}translateTo(t,e){const i=this.attribute;if(i.x===t&&i.y===e)return this;const n={type:Pe.TRANSLATE_TO},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,zv,n);return r?(this._setAttributes(r,!1,n),this):(i.x=t,i.y=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this)}scale(t,e,i){var n,r;if(t===1&&e===1)return this;const a={type:Pe.SCALE},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e,scaleCenter:i},this.attribute,Hv,a);o&&(t=o.scaleX,e=o.scaleY,delete o.scaleX,delete o.scaleY,this._setAttributes(o));const l=this.attribute;if(i){let{postMatrix:h}=this.attribute;h||(h=new Zt,l.postMatrix=h),H.transformUtil.fromMatrix(h,h).scale(t,e,i)}else l.scaleX=((n=l.scaleX)!==null&&n!==void 0?n:Te.scaleX)*t,l.scaleY=((r=l.scaleY)!==null&&r!==void 0?r:Te.scaleY)*e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(a),this}scaleTo(t,e){const i=this.attribute;if(i.scaleX===t&&i.scaleY===e)return this;const n={type:Pe.SCALE_TO},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e},this.attribute,Hv,n);return r?(this._setAttributes(r,!1,n),this):(i.scaleX=t,i.scaleY=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this)}rotate(t,e){var i;if(t===0)return this;const n={type:Pe.ROTATE},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:t,rotateCenter:e},this.attribute,Vv,n);r&&(delete r.angle,this._setAttributes(r,!1,n));const a=this.attribute;if(e){let{postMatrix:o}=this.attribute;o||(o=new Zt,a.postMatrix=o),H.transformUtil.fromMatrix(o,o).rotate(t,e)}else a.angle=((i=a.angle)!==null&&i!==void 0?i:Te.angle)+t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this}rotateTo(t){const e=this.attribute;if(e.angle===t)return this;const i={type:Pe.ROTATE_TO},n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,Vv,i);return n?(this._setAttributes(n,!1,i),this):(e.angle=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i),this)}skewTo(t,e){return this}animate(t){var e;this.animates||(this.animates=new Map);const i=new Ns(t==null?void 0:t.id,(e=t==null?void 0:t.timeline)!==null&&e!==void 0?e:this.stage&&this.stage.getTimeline(),t==null?void 0:t.slience);if(i.bind(this),t){const{onStart:n,onFrame:r,onEnd:a,onRemove:o}=t;n!=null&&i.onStart(n),r!=null&&i.onFrame(r),a!=null&&i.onEnd(a),o!=null&&i.onRemove(o),i.interpolateFunc=t.interpolate}return this.animates.set(i.id,i),i.onRemove(()=>{i.stop(),this.animates.delete(i.id)}),i}onAttributeUpdate(t){t&&t.skipUpdateCallback||(H.graphicService.onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",t))}update(t){t?(t.bounds&&this.tryUpdateAABBBounds(),t.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds(),this.tryUpdateLocalTransMatrix())}hasState(t){return!(!this.currentStates||!this.currentStates.length)&&(!!I(t)||this.currentStates.includes(t))}getState(t){var e;return(e=this.states)===null||e===void 0?void 0:e[t]}applyStateAttrs(t,e,i,n){var r,a,o,l;if(i){const h=Object.keys(t),c=this.getNoWorkAnimateAttr(),u={};let d;h.forEach(g=>{c[g]?(d||(d={}),d[g]=t[g]):u[g]=n&&t[g]===void 0?this.getDefaultAttribute(g):t[g]});const p=this.animate({slience:!0});p.stateNames=e,p.to(u,(a=(r=this.stateAnimateConfig)===null||r===void 0?void 0:r.duration)!==null&&a!==void 0?a:Lk,(l=(o=this.stateAnimateConfig)===null||o===void 0?void 0:o.easing)!==null&&l!==void 0?l:Dk),d&&this.setAttributes(d,!1,{type:Pe.STATE})}else this.stopStateAnimates(),this.setAttributes(t,!1,{type:Pe.STATE})}updateNormalAttrs(t){const e={};this.normalAttrs?(Object.keys(t).forEach(i=>{i in this.normalAttrs?(e[i]=this.normalAttrs[i],delete this.normalAttrs[i]):e[i]=this.getNormalAttribute(i)}),Object.keys(this.normalAttrs).forEach(i=>{t[i]=this.normalAttrs[i]})):Object.keys(t).forEach(i=>{e[i]=this.getNormalAttribute(i)}),this.normalAttrs=e}stopStateAnimates(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"end";this.animates&&this.animates.forEach(e=>{e.stateNames&&(e.stop(t),this.animates.delete(e.id))})}getNormalAttribute(t){let e=this.attribute[t];return this.animates&&this.animates.forEach(i=>{if(i.stateNames){const n=i.getEndProps();_a(n,t)&&(e=n[t])}}),e}clearStates(t){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}removeState(t,e){if(this.currentStates){const i=W(t)?r=>!t.includes(r):r=>r!==t,n=this.currentStates.filter(i);n.length!==this.currentStates.length&&this.useStates(n,e)}}toggleState(t,e){if(this.hasState(t))this.removeState(t,e);else if((this.currentStates?this.currentStates.indexOf(t):-1)<0){const i=this.currentStates?this.currentStates.slice():[];i.push(t),this.useStates(i,e)}}addState(t,e,i){var n;if(this.currentStates&&this.currentStates.includes(t)&&(e||this.currentStates.length===1))return;const r=e&&(!((n=this.currentStates)===null||n===void 0)&&n.length)?this.currentStates.concat([t]):[t];this.useStates(r,i)}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if(((i=this.currentStates)===null||i===void 0?void 0:i.length)===t.length&&!t.some((r,a)=>this.currentStates[a]!==r))return;const n={};t.forEach(r=>{var a;const o=this.stateProxy?this.stateProxy(r,t):(a=this.states)===null||a===void 0?void 0:a[r];o&&Object.assign(n,o)}),this.updateNormalAttrs(n),this.currentStates=t,this.applyStateAttrs(n,t,e)}addUpdateBoundTag(){this._updateTag|=Ft.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=Ft.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=Ft.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&Ft.UPDATE_SHAPE_AND_BOUNDS)===Ft.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=Ft.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=Ft.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=Ft.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=Ft.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=Ft.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=Ft.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=Ft.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&Ft.UPDATE_LAYOUT)}getAnchor(t,e){const i=[0,0],n=()=>{if(e.b)return e.b;const{scaleX:r,scaleY:a,angle:o}=this.attribute;return Nv.copy(this._AABBBounds),this.setAttributes({scaleX:1,scaleY:1,angle:0}),e.b=this.AABBBounds.clone(),this._AABBBounds.copy(Nv),this.setAttributes({scaleX:r,scaleY:a,angle:o}),e.b};if(typeof t[0]=="string"){const r=parseFloat(t[0])/100,a=n();i[0]=a.x1+(a.x2-a.x1)*r}else i[0]=t[0];if(typeof t[1]=="string"){const r=parseFloat(t[1])/100,a=n();i[1]=a.y1+(a.y2-a.y1)*r}else i[1]=t[1];return i}doUpdateLocalMatrix(){const{x:t=Te.x,y:e=Te.y,scaleX:i=Te.scaleX,scaleY:n=Te.scaleY,angle:r=Te.angle,scaleCenter:a,anchor:o,postMatrix:l}=this.attribute;let h=[0,0];const c={};if(o&&(h=this.getAnchor(o,c)),!a||i===1&&n===1)(function(d,p,g,f,m,v,y,_){const b=p.a,x=p.b,S=p.c,A=p.d,w=p.e,k=p.f,T=ge(y),C=qt(y);let M,B;_?(M=_[0],B=_[1]):(M=g,B=f);const O=M-g,E=B-f,L=b*T+S*C,P=x*T+A*C,F=S*T-b*C,j=A*T-x*C;d.a=m*L,d.b=m*P,d.c=v*F,d.d=v*j,d.e=w+b*M+S*B-L*O-F*E,d.f=k+x*M+A*B-P*O-j*E})(this._transMatrix,this._transMatrix.reset(),t,e,i,n,r,o&&h);else{const d=this._transMatrix;d.reset(),d.translate(h[0],h[1]),d.rotate(r),d.translate(-h[0],-h[1]),d.translate(t,e),h=this.getAnchor(a,c),H.transformUtil.fromMatrix(d,d).scale(i,n,{x:h[0],y:h[1]})}const u=this.getOffsetXY(Te);if(this._transMatrix.e+=u.x,this._transMatrix.f+=u.y,l){const d=Tw.setValue(l.a,l.b,l.c,l.d,l.e,l.f),p=this._transMatrix;d.multiply(p.a,p.b,p.c,p.d,p.e,p.f),p.setValue(d.a,d.b,d.c,d.d,d.e,d.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);const{scrollX:t=0,scrollY:e=0}=this.parent.attribute;this._globalTransMatrix.translate(t,e)}}setStage(t,e){if(this.stage!==t){if(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this.animates&&this.animates.size){const i=t.getTimeline();this.animates.forEach(n=>{n.timeline===Kl&&n.setTimeline(i)})}this._onSetStage&&this._onSetStage(this,t,e),H.graphicService.onSetStage(this,t)}}setStageToShadowRoot(t,e){this.shadowRoot&&this.shadowRoot.setStage(t,e)}onAddStep(t){}onStop(t){t&&this.setAttributes(t,!1,{type:Pe.ANIMATE_END})}onStep(t,e,i,n,r){const a={};if(i.customAnimate)i.customAnimate.update(r,n,a);else{const o=i.props,l=i.parsedProps,h=i.propKeys;this.stepInterpolate(t,e,a,i,n,r,o,void 0,l,h)}this.setAttributes(a,!1,{type:Pe.ANIMATE_UPDATE,animationState:{ratio:n,end:r,step:i,isFirstFrameOfStep:t.getLastStep()!==i}}),this.stage&&this.stage.renderNextFrame()}stepInterpolate(t,e,i,n,r,a,o,l,h,c){c||(c=Object.keys(o),n.propKeys=c),a?n.propKeys.forEach(u=>{e.validAttr(u)&&(i[u]=o[u])}):c.forEach(u=>{var d;if(!e.validAttr(u))return;const p=o[u],g=(d=l&&l[u])!==null&&d!==void 0?d:t.getLastPropByName(u,n);if(p==null||g==null||p===g)return void(i[u]=p);let f;f=e.interpolateFunc&&e.interpolateFunc(u,r,g,p,i),f||(f=e.customInterpolate(u,r,g,p,this,i),f||this.defaultInterpolate(p,g,u,i,h,r)||this._interpolate(u,r,g,p,i))}),n.parsedProps=h}defaultInterpolate(t,e,i,n,r,a){if(Number.isFinite(t)&&Number.isFinite(e))return n[i]=e+(t-e)*a,!0;if(i==="fill"){r||(r={});const o=r.fillColorArray,l=gr(e,o??t,a,!1,(h,c)=>{r.fillColorArray=c});return l&&(n[i]=l),!0}if(i==="stroke"){r||(r={});const o=r.strokeColorArray,l=gr(e,o??t,a,!1,(h,c)=>{r.strokeColorArray=c});return l&&(n[i]=l),!0}if(i==="shadowColor"){r||(r={});const o=r.shadowColorArray,l=gr(e,o??t,a,!0,(h,c)=>{r.shadowColorArray=c});return l&&(n[i]=l),!0}if(Array.isArray(t)&&t.length===e.length){const o=[];let l=!0;for(let h=0;h<t.length;h++){const c=e[h],u=c+(t[h]-c)*a;if(!Number.isFinite(u)){l=!1;break}o.push(u)}l&&(n[i]=o)}return!1}_interpolate(t,e,i,n,r){}getDefaultAttribute(t){return this.getGraphicTheme()[t]}getComputedAttribute(t){var e;return(e=this.attribute[t])!==null&&e!==void 0?e:this.getDefaultAttribute(t)}onSetStage(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._onSetStage=t,e&&this.stage&&t(this,this.stage)}attachShadow(t){return t&&(t.shadowHost=this),this.shadowRoot=t??H.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot.release(!0),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map(t=>t.toJson())}}createPathProxy(t){return Q(t,!0)?this.pathProxy=new me().fromString(t):this.pathProxy=new me,this.pathProxy}loadImage(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!t||e&&function(r){return!(!r.fill&&!r.stroke)}(t))return;const i=t;this.resources||(this.resources=new Map);const n={data:"init",state:null};this.resources.set(i,n),typeof t=="string"?(n.state="loading",t.startsWith("<svg")?(Nt.GetSvg(t,this),this.backgroundImg=this.backgroundImg||e):(G1(t)||t.includes("/")||Y1(t))&&(Nt.GetImage(t,this),this.backgroundImg=this.backgroundImg||e)):_t(t)?(n.state="success",n.data=t,this.backgroundImg=this.backgroundImg||e):n.state="fail"}setShadowGraphic(t){t?this.attachShadow().add(t):this.detachShadow()}imageLoadSuccess(t,e,i){if(!this.resources)return;const n=this.resources.get(t);n&&(n.state="success",n.data=e,i&&i(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(t,e){if(!this.resources)return;const i=this.resources.get(t);i&&(i.state="fail",e&&e())}_stopAnimates(t){t&&t.forEach(e=>{e.stop()})}stopAnimates(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&t&&this.forEachChildren(e=>{e.stopAnimates(t)})}release(){this.releaseStatus="released",this.stopAnimates(),H.graphicService.onRelease(this)}_emitCustomEvent(t,e){var i,n;if(this._events&&t in this._events){const r=new $l(t,e);r.bubbles=!1,r.manager=(n=(i=this.stage)===null||i===void 0?void 0:i.eventSystem)===null||n===void 0?void 0:n.manager,this.dispatchEvent(r)}}}var Wv;Le.userSymbolMap={},Le.mixin(Bk),function(s){s[s.LESS_GROUP=0]="LESS_GROUP",s[s.MORE_GROUP=1]="MORE_GROUP"}(Wv||(Wv={}));class Ss extends Le{constructor(t){super(t),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=Md,this._childUpdateTag=Ft.UPDATE_BOUNDS}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(t){return this.theme||(this.theme=new Oa),this.theme.setTheme(t,this)}createTheme(){this.theme||(this.theme=new Oa)}visibleAll(t){this.setAttribute("visible",t),this.forEachChildren(e=>{e.isContainer&&e.visibleAll?e.visibleAll(t):e.setAttribute("visible",t)})}hideAll(){this.visibleAll(!1)}showAll(){this.visibleAll(!0)}containsPoint(t,e,i){if(i===rr.GLOBAL){const n=new Lt(t,e);return this.parent&&this.parent.globalTransMatrix.transformPoint(n,n),this.AABBBounds.contains(n.x,n.y)}return this.AABBBounds.contains(t,e)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&Ft.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;H.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),H.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,t),this.attribute.boundsMode==="empty"&&e.clear(),e}doUpdateLocalMatrix(){const{x:t=Te.x,y:e=Te.y,dx:i=Te.dx,dy:n=Te.dy,scaleX:r=Te.scaleX,scaleY:a=Te.scaleY,angle:o=Te.angle,postMatrix:l}=this.attribute;if(t!==0||e!==0||i!==0||n!==0||r!==1||a!==1||o!==0||l)return super.doUpdateLocalMatrix();this._transMatrix.reset()}getGraphicTheme(){return Et(this).group}updateAABBBounds(t,e,i){const n=i;i=i.clone();const{width:r,height:a,path:o,clip:l=e.clip}=t;if(o&&o.length?o.forEach(h=>{i.union(h.AABBBounds)}):r!=null&&a!=null&&i.set(0,0,Math.max(0,r),Math.max(0,a)),!l){this.forEachChildren(u=>{i.union(u.AABBBounds)});const{scrollX:h=0,scrollY:c=0}=t;i.translate(h,c)}return H.graphicService.updateTempAABBBounds(i),H.graphicService.transformAABBBounds(t,i,e,!1,this),n.copy(i),n}doUpdateAABBBounds(){this.updateAABBBoundsStamp++;const t=super.doUpdateAABBBounds();return this.parent&&this.parent.addChildUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),t}clearUpdateBoundTag(){this._updateTag&=Ft.CLEAR_BOUNDS,this._childUpdateTag&=Ft.CLEAR_BOUNDS}addUpdateBoundTag(){this._updateTag|=Ft.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&Ft.UPDATE_BOUNDS||(this._childUpdateTag|=Ft.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(t){const e=super.appendChild(t);return this.stage&&e&&(e.stage=this.stage,e.layer=this.layer),this.addUpdateBoundTag(),H.graphicService.onAddIncremental(t,this,this.stage),e}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),H.graphicService.onClearIncremental(this,this.stage)}_updateChildToStage(t){return this.stage&&t&&t.setStage(this.stage,this.layer),this.addUpdateBoundTag(),t}appendChild(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];const i=super.appendChild(t);return e&&this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertBefore(t,e){return this._updateChildToStage(super.insertBefore(t,e))}insertAfter(t,e){return this._updateChildToStage(super.insertAfter(t,e))}insertInto(t,e){return this._updateChildToStage(super.insertInto(t,e))}removeChild(t){const e=super.removeChild(t);return t.stage=null,H.graphicService.onRemove(t),this.addUpdateBoundTag(),e}removeAllChild(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.forEachChildren(e=>{H.graphicService.onRemove(e),t&&e.isContainer&&e.removeAllChild(t)}),super.removeAllChild(),this.addUpdateBoundTag()}setStage(t,e){this.stage!==t&&(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this._onSetStage&&this._onSetStage(this,t,e),H.graphicService.onSetStage(this,t),this.forEachChildren(i=>{i.setStage(t,this.layer)}))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren(t=>{t.isContainer&&t.addUpdateGlobalPositionTag()})}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren(t=>{t.isContainer&&t.addUpdateGlobalPositionTag()})}tryUpdateGlobalTransMatrix(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){const e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&Ft.UPDATE_GLOBAL_MATRIX)}_getChildByName(t,e){return this.find(i=>i.name===t,e)}createOrUpdateChild(t,e,i){let n=this._getChildByName(t);return n?n.setAttributes(e):(n=H.graphicService.creator[i](e),n.name=t,this.add(n)),n}clone(){return new Ss(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Ss.NOWORK_ANIMATE_ATTR}release(t){t&&this.forEachChildren(e=>{e.release(t)}),super.release()}}function Rd(s){return new Ss(s)}Ss.NOWORK_ANIMATE_ATTR=zi;class Cw extends Ss{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("暂不支持")}get dpr(){return this._dpr}constructor(t,e,i,n){var r;super({}),this.stage=t,this.global=e,this.window=i,this.main=n.main,this.layerHandler=n.layerHandler,this.layerHandler.init(this,i,{main:n.main,canvasId:n.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:(r=n.zIndex)!==null&&r!==void 0?r:0}),this.layer=this,this.subLayers=new Map,this.theme=new Oa,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const e=Array.from(this.subLayers.values()).sort((i,n)=>i.zIndex-n.zIndex);this.layerHandler.merge(e.map(i=>(i.layer.subLayers.size&&i.layer.combineSubLayer(t),i.layer.getNativeHandler()))),t&&e.forEach(i=>{i.group&&(i.group.incremental=0)}),e.forEach(i=>{H.layerService.releaseLayer(this.stage,i.layer)}),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(t,e){super.setStage(t,this)}pick(t,e){throw new Error("暂不支持")}tryRenderSecondaryLayer(t,e){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach(i=>{i.layer.renderCount=this.renderCount,i.layer.render(t,e)})}render(t,e){var i;this.layerHandler.render([this],{renderService:t.renderService,stage:this.stage,layer:this,viewBox:t.viewBox,transMatrix:t.transMatrix,background:(i=t.background)!==null&&i!==void 0?i:this.background,updateBounds:t.updateBounds},e),this.afterDrawCbs.forEach(n=>n(this)),this.tryRenderSecondaryLayer(t,e)}resize(t,e){this.layerHandler.resize(t,e)}resizeView(t,e){this.layerHandler.resizeView(t,e)}setDpr(t){this.layerHandler.setDpr(t)}afterDraw(t){this.afterDrawCbs.push(t)}startAnimate(t){throw new Error("暂不支持")}setToFrame(t){throw new Error("暂不支持")}prepare(t,e){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach(t=>{H.layerService.releaseLayer(this.stage,t.layer)})}drawTo(t,e){var i;this.layerHandler.drawTo(t,[this],Object.assign({background:(i=e.background)!==null&&i!==void 0?i:this.background,renderService:e.renderService,viewBox:e.viewBox,transMatrix:e.transMatrix,stage:this.stage,layer:this},e)),this.afterDrawCbs.forEach(n=>n(this))}}const Uv=Symbol.for("TransformUtil"),Gv=Symbol.for("GraphicUtil"),Id=Symbol.for("LayerService"),Yv=Symbol.for("StaticLayerHandlerContribution"),Mw=Symbol.for("DynamicLayerHandlerContribution"),Ew=Symbol.for("VirtualLayerHandlerContribution");var Va,Bw=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},Rw=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};let Wa=Va=class{static GenerateLayerId(){return\`\${Va.idprefix}_\${Va.prefix_count++}\`}constructor(){this.layerMap=new Map,this.global=H.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(s){return this.layerMap.get(s)}getRecommendedLayerType(s){return s||(this.staticLayerCountInEnv!==0?"static":this.dynamicLayerCountInEnv!==0?"dynamic":"virtual")}getLayerHandler(s){let t;return t=s==="static"?kt.get(Yv):s==="dynamic"?kt.get(Mw):kt.get(Ew),t}createLayer(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{main:!1};var e;this.tryInit();let i=this.getRecommendedLayerType(t.layerMode);i=t.main||t.canvasId?"static":i;const n=this.getLayerHandler(i),r=new Cw(s,this.global,s.window,Object.assign(Object.assign({main:!1},t),{layerMode:i,canvasId:(e=t.canvasId)!==null&&e!==void 0?e:Va.GenerateLayerId(),layerHandler:n})),a=this.layerMap.get(s)||[];return a.push(r),this.layerMap.set(s,a),this.staticLayerCountInEnv--,r}prepareStageLayer(s){let t;s.forEachChildren(e=>{const i=e.getNativeHandler();i.type==="virtual"?(i.mainHandler=t,t.secondaryHandlers.push(i)):(t=i,t.secondaryHandlers=[])})}releaseLayer(s,t){t.release();const e=this.layerMap.get(s)||[];this.layerMap.set(s,e.filter(i=>i!==t))}layerCount(s){return(this.layerMap.get(s)||[]).length}restLayerCount(s){return this.global.env==="browser"?10:0}releaseStage(s){this.layerMap.delete(s)}};Wa.idprefix="visactor_layer",Wa.prefix_count=0,Wa=Va=Bw([nt(),Rw("design:paramtypes",[])],Wa);var Iw=new yt(s=>{s(Bl).to(id).inSingletonScope(),s(Wl).to(vd),s(Gv).to(yd).inSingletonScope(),s(Uv).to(_d).inSingletonScope(),s(Id).to(Wa).inSingletonScope()});function mr(s,t){return!(!s&&!t)}function Ua(s,t){let e;return e=W(s)?s.some(i=>i||i===void 0):!!s,e&&t>0}function xn(s,t,e){return e&&s*t>0}function $v(s,t,e,i,n){return n&&s*t>0&&e!==0&&i!==0}function Od(s,t){return s*t>0}function Xv(s,t,e,i){return s*t>0&&e!==0&&i!==0}function zs(s,t,e,i,n,r,a){const o=s-e,l=t-i,h=(a?r:-r)/Math.sqrt(o*o+l*l),c=h*l,u=-h*o,d=s+c,p=t+u,g=e+c,f=i+u,m=(d+g)/2,v=(p+f)/2,y=g-d,_=f-p,b=y*y+_*_,x=n-r,S=d*f-g*p,A=(_<0?-1:1)*Math.sqrt(Math.max(0,x*x*b-S*S));let w=(S*_-y*A)/b,k=(-S*y-_*A)/b;const T=(S*_+y*A)/b,C=(-S*y+_*A)/b,M=w-m,B=k-v,O=T-m,E=C-v;return M*M+B*B>O*O+E*E&&(w=T,k=C),{cx:w,cy:k,x01:-c,y01:-u,x11:w*(n/x-1),y11:k*(n/x-1)}}function Kv(s,t,e,i,n){const r=Rt(e-t),a=s.getParsedCornerRadius(),o=W(a),{outerDeltaAngle:l,innerDeltaAngle:h,outerStartAngle:c,outerEndAngle:u,innerEndAngle:d,innerStartAngle:p}=s.getParsePadAngle(t,e),g=o?a[0]:a,f=o?a[1]:a,m=o?a[2]:a,v=o?a[3]:a,y=Math.max(f,g),_=Math.max(m,v);let b=y,x=_;const S=n*ge(c),A=n*qt(c),w=i*ge(d),k=i*qt(d);let T,C,M,B;if((_>Ut||y>Ut)&&(T=n*ge(u),C=n*qt(u),M=i*ge(p),B=i*qt(p),r<Gt)){const E=function(L,P,F,j,D,N,J,X){const $=F-L,G=j-P,z=J-D,ot=X-N;let ft=ot*$-z*G;return ft*ft<Ut?[]:(ft=(z*(P-N)-ot*(L-D))/ft,[L+ft*$,P+ft*G])}(S,A,M,B,T,C,w,k);if(E){const L=S-E[0],P=A-E[1],F=T-E[0],j=C-E[1],D=1/qt(((O=(L*F+P*j)/(Ni(L*L+P*P)*Ni(F*F+j*j)))>1?0:O<-1?Gt:Math.acos(O))/2),N=Ni(E[0]*E[0]+E[1]*E[1]);x=ke(_,(i-N)/(D-1)),b=ke(y,(n-N)/(D+1))}}var O;return{outerDeltaAngle:l,xors:S,yors:A,xirs:M,yirs:B,xore:T,yore:C,xire:w,yire:k,limitedOcr:b,limitedIcr:x,outerCornerRadiusStart:g,outerCornerRadiusEnd:f,maxOuterCornerRadius:y,maxInnerCornerRadius:_,outerStartAngle:c,outerEndAngle:u,innerDeltaAngle:h,innerEndAngle:d,innerStartAngle:p,innerCornerRadiusStart:v,innerCornerRadiusEnd:m}}function Pd(s,t,e,i,n,r,a){const{startAngle:o,endAngle:l}=s.getParsedAngle(),h=Rt(l-o),c=l>o;let u=!1;if(n<r){const d=n;n=r,r=d}if(n<=Ut)t.moveTo(e,i);else if(h>=dt-Ut)t.moveTo(e+n*ge(o),i+n*qt(o)),t.arc(e,i,n,o,l,!c),r>Ut&&(t.moveTo(e+r*ge(l),i+r*qt(l)),t.arc(e,i,r,l,o,c));else{const{outerDeltaAngle:d,xors:p,yors:g,xirs:f,yirs:m,limitedOcr:v,outerCornerRadiusStart:y,outerCornerRadiusEnd:_,maxOuterCornerRadius:b,xore:x,yore:S,xire:A,yire:w,outerStartAngle:k,outerEndAngle:T,limitedIcr:C,innerDeltaAngle:M,innerEndAngle:B,innerStartAngle:O,innerCornerRadiusStart:E,innerCornerRadiusEnd:L,maxInnerCornerRadius:P}=Kv(s,o,l,r,n);if(d<.001)a&&(a[3]||a[1])&&t.moveTo(e+p,i+g),u=!0;else if(v>Ut){const F=ke(y,v),j=ke(_,v),D=zs(f,m,p,g,n,F,Number(c)),N=zs(x,S,A,w,n,j,Number(c));v<b&&F===j?!a||a[0]?(t.moveTo(e+D.cx+D.x01,i+D.cy+D.y01),t.arc(e+D.cx,i+D.cy,v,Ot(D.y01,D.x01),Ot(N.y01,N.x01),!c)):t.moveTo(e+D.cx+v*ge(Ot(N.y01,N.x01)),i+D.cy+v*qt(Ot(N.y01,N.x01))):!a||a[0]?(t.moveTo(e+D.cx+D.x01,i+D.cy+D.y01),F>0&&t.arc(e+D.cx,i+D.cy,F,Ot(D.y01,D.x01),Ot(D.y11,D.x11),!c),t.arc(e,i,n,Ot(D.cy+D.y11,D.cx+D.x11),Ot(N.cy+N.y11,N.cx+N.x11),!c),j>0&&t.arc(e+N.cx,i+N.cy,j,Ot(N.y11,N.x11),Ot(N.y01,N.x01),!c)):j>0?t.moveTo(e+N.cx+j*ge(Ot(N.y01,N.x01)),i+N.cy+j*qt(Ot(N.y01,N.x01))):t.moveTo(e+x,i+n*qt(T))}else!a||a[0]?(t.moveTo(e+p,i+g),t.arc(e,i,n,k,T,!c)):t.moveTo(e+n*ge(T),i+n*qt(T));if(!(r>Ut)||M<.001)!a||a[1]?t.lineTo(e+A,i+w):t.moveTo(e+A,i+w),u=!0;else if(C>Ut){const F=ke(E,C),j=ke(L,C),D=zs(A,w,x,S,r,-j,Number(c)),N=zs(p,g,f,m,r,-F,Number(c));if(!a||a[1]?t.lineTo(e+D.cx+D.x01,i+D.cy+D.y01):t.moveTo(e+D.cx+D.x01,i+D.cy+D.y01),C<P&&F===j){const J=Ot(N.y01,N.x01);!a||a[2]?t.arc(e+D.cx,i+D.cy,C,Ot(D.y01,D.x01),J,!c):t.moveTo(e+D.cx+ge(J),i+D.cy+qt(J))}else!a||a[2]?(j>0&&t.arc(e+D.cx,i+D.cy,j,Ot(D.y01,D.x01),Ot(D.y11,D.x11),!c),t.arc(e,i,r,Ot(D.cy+D.y11,D.cx+D.x11),Ot(N.cy+N.y11,N.cx+N.x11),c),F>0&&t.arc(e+N.cx,i+N.cy,F,Ot(N.y11,N.x11),Ot(N.y01,N.x01),!c)):F>0?t.moveTo(e+N.cx+F*ge(Ot(N.y01,N.x01)),i+N.cy+F*qt(Ot(N.y01,N.x01))):t.moveTo(e+f,i+m)}else!a||a[1]?t.lineTo(e+A,i+w):t.moveTo(e+A,i+w),!a||a[2]?t.arc(e,i,r,B,O,c):t.moveTo(e+r*ge(O),i+r*qt(O))}return a?a[3]&&t.lineTo(e+n*ge(o),i+n*qt(o)):t.closePath(),u}class Bi{static GetCanvas(){try{return Bi.canvas||(Bi.canvas=H.global.createCanvas({})),Bi.canvas}catch{return null}}static GetCtx(){if(!Bi.ctx){const t=Bi.GetCanvas();Bi.ctx=t.getContext("2d")}return Bi.ctx}}class Sn extends lA{static getInstance(){return Sn._instance||(Sn._instance=new Sn),Sn._instance}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;const i=Bi.GetCanvas(),n=Bi.GetCtx();if(i.width=e,i.height=1,!n)return;if(n.translate(0,0),!n)throw new Error("获取ctx发生错误");const r=n.createLinearGradient(0,0,e,0);t.forEach(a=>{r.addColorStop(a[0],a[1])}),n.fillStyle=r,n.fillRect(0,0,e,1),this.rgbaSet=n.getImageData(0,0,e,1).data}getColor(t){const e=this.rgbaSet.slice(4*t,4*t+4);return\`rgba(\${e[0]}, \${e[1]}, \${e[2]}, \${e[3]/255})\`}GetOrCreate(t,e,i,n){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:100,o=\`\${t}\${e}\${i}\${n}\`;r.forEach(h=>o+=h.join()),o+=a;let l=this.dataMap.get(o);return l||(l={data:new Sn(r,a),timestamp:[]},this.addLimitedTimestamp(l,Date.now(),{}),this.dataMap.set(o,l)),this.clearCache(this.dataMap,this.cacheParams),l.data}}class Ke{static GetSize(t){for(let e=0;e<Ke.ImageSize.length;e++)if(Ke.ImageSize[e]>=t)return Ke.ImageSize[e];return t}static Get(t,e,i,n,r,a,o){const l=Ke.GenKey(t,e,i,n,r),h=Ke.cache[l];if(!h||h.length===0)return null;for(let c=0;c<h.length;c++)if(h[c].width>=a&&h[c].height>=o)return h[c].pattern;return null}static Set(t,e,i,n,r,a,o,l){const h=Ke.GenKey(t,e,i,n,r);Ke.cache[h]?Ke.cache[h].push({width:o,height:l,pattern:a}):Ke.cache[h]=[{width:o,height:l,pattern:a}]}static GenKey(t,e,i,n,r){return\`\${e},\${i},\${n},\${r},\${t.join()}\`}}Ke.cache={},Ke.ImageSize=[20,40,80,160,320,640,1280,2560];const Ld=Symbol.for("ArcRenderContribution"),Dd=Symbol.for("AreaRenderContribution"),qv=Symbol.for("GroupRenderContribution"),Fd=Symbol.for("PathRenderContribution"),jd=Symbol.for("PolygonRenderContribution"),Ga=Symbol.for("RectRenderContribution"),Nd=Symbol.for("SymbolRenderContribution"),zd=Symbol.for("TextRenderContribution"),Zv=Symbol.for("InteractiveSubRenderContribution");function Ya(s,t){return s==="end"||s==="right"?-t:s==="center"?-t/2:0}function uh(s,t,e){return s==="middle"?-t/2:s==="top"?0:s==="bottom"?(arguments.length>3&&arguments[3]!==void 0?arguments[3]:0)-t:s&&s!=="alphabetic"?0:(e||(e=t),-(t-e)/2-.79*e)}function Jv(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function $a(s,t,e){const i=e[0],n=e[1],r=e[2];let a,o,l,h,c,u,d,p,g,f,m,v;return t===s?(s[12]=t[0]*i+t[4]*n+t[8]*r+t[12],s[13]=t[1]*i+t[5]*n+t[9]*r+t[13],s[14]=t[2]*i+t[6]*n+t[10]*r+t[14],s[15]=t[3]*i+t[7]*n+t[11]*r+t[15]):(a=t[0],o=t[1],l=t[2],h=t[3],c=t[4],u=t[5],d=t[6],p=t[7],g=t[8],f=t[9],m=t[10],v=t[11],s[0]=a,s[1]=o,s[2]=l,s[3]=h,s[4]=c,s[5]=u,s[6]=d,s[7]=p,s[8]=g,s[9]=f,s[10]=m,s[11]=v,s[12]=a*i+c*n+g*r+t[12],s[13]=o*i+u*n+f*r+t[13],s[14]=l*i+d*n+m*r+t[14],s[15]=h*i+p*n+v*r+t[15]),s}function Hd(s,t){s[0]=t.a,s[1]=t.b,s[2]=0,s[3]=0,s[4]=t.c,s[5]=t.d,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=t.e,s[13]=t.f,s[14]=0,s[15]=1}function Xa(s,t,e){const i=t[0],n=t[1],r=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=t[8],d=t[9],p=t[10],g=t[11],f=t[12],m=t[13],v=t[14],y=t[15];let _=e[0],b=e[1],x=e[2],S=e[3];return s[0]=_*i+b*o+x*u+S*f,s[1]=_*n+b*l+x*d+S*m,s[2]=_*r+b*h+x*p+S*v,s[3]=_*a+b*c+x*g+S*y,_=e[4],b=e[5],x=e[6],S=e[7],s[4]=_*i+b*o+x*u+S*f,s[5]=_*n+b*l+x*d+S*m,s[6]=_*r+b*h+x*p+S*v,s[7]=_*a+b*c+x*g+S*y,_=e[8],b=e[9],x=e[10],S=e[11],s[8]=_*i+b*o+x*u+S*f,s[9]=_*n+b*l+x*d+S*m,s[10]=_*r+b*h+x*p+S*v,s[11]=_*a+b*c+x*g+S*y,_=e[12],b=e[13],x=e[14],S=e[15],s[12]=_*i+b*o+x*u+S*f,s[13]=_*n+b*l+x*d+S*m,s[14]=_*r+b*h+x*p+S*v,s[15]=_*a+b*c+x*g+S*y,s}function Hi(s,t,e){const i=t[0],n=t[1],r=t[2];let a=e[3]*i+e[7]*n+e[11]*r+e[15];return a=a||1,s[0]=(e[0]*i+e[4]*n+e[8]*r+e[12])/a,s[1]=(e[1]*i+e[5]*n+e[9]*r+e[13])/a,s[2]=(e[2]*i+e[6]*n+e[10]*r+e[14])/a,s}class Vd{constructor(){this.pools=[]}static identity(t){return Jv(t)}allocate(){if(!this.pools.length)return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const t=this.pools.pop();return Vd.identity(t),t}allocateByObj(t){let e;e=this.pools.length?this.pools.pop():[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];for(let i=0;i<e.length;i++)e[i]=t[i];return e}free(t){t&&this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}}const De=new class{constructor(){this.pools=[]}allocate(s,t,e,i,n,r){if(!this.pools.length)return new Zt(s,t,e,i,n,r);const a=this.pools.pop();return a.a=s,a.b=t,a.c=e,a.d=i,a.e=n,a.f=r,a}allocateByObj(s){if(!this.pools.length)return new Zt(s.a,s.b,s.c,s.d,s.e,s.f);const t=this.pools.pop();return t.a=s.a,t.b=s.b,t.c=s.c,t.d=s.d,t.e=s.e,t.f=s.f,t}free(s){this.pools.push(s)}get length(){return this.pools.length}release(){this.pools=[]}},ye=new Vd;var Ow=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},Pw=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},Lw=function(s,t){return function(e,i){t(e,i,s)}};function Qv(s,t,e){var i;const{x:n=e.x,y:r=e.y,z:a=e.z,dx:o=e.dx,dy:l=e.dy,dz:h=e.dz,scaleX:c=e.scaleX,scaleY:u=e.scaleY,scaleZ:d=e.scaleZ,alpha:p=e.alpha,beta:g=e.beta,angle:f=e.angle,anchor3d:m=t.attribute.anchor,anchor:v}=t.attribute,y=[0,0,0];if(m){if(typeof m[0]=="string"){const _=parseFloat(m[0])/100,b=t.AABBBounds;y[0]=b.x1+(b.x2-b.x1)*_}else y[0]=m[0];if(typeof m[1]=="string"){const _=parseFloat(m[1])/100,b=t.AABBBounds;y[1]=b.x1+(b.x2-b.x1)*_}else y[1]=m[1];y[2]=(i=m[2])!==null&&i!==void 0?i:0}if(Jv(s),$a(s,s,[n+o,r+l,a+h]),$a(s,s,[y[0],y[1],y[2]]),function(_,b,x){const S=Math.sin(x),A=Math.cos(x),w=b[4],k=b[5],T=b[6],C=b[7],M=b[8],B=b[9],O=b[10],E=b[11];b!==_&&(_[0]=b[0],_[1]=b[1],_[2]=b[2],_[3]=b[3],_[12]=b[12],_[13]=b[13],_[14]=b[14],_[15]=b[15]),_[4]=w*A+M*S,_[5]=k*A+B*S,_[6]=T*A+O*S,_[7]=C*A+E*S,_[8]=M*A-w*S,_[9]=B*A-k*S,_[10]=O*A-T*S,_[11]=E*A-C*S}(s,s,g),function(_,b,x){const S=Math.sin(x),A=Math.cos(x),w=b[0],k=b[1],T=b[2],C=b[3],M=b[8],B=b[9],O=b[10],E=b[11];b!==_&&(_[4]=b[4],_[5]=b[5],_[6]=b[6],_[7]=b[7],_[12]=b[12],_[13]=b[13],_[14]=b[14],_[15]=b[15]),_[0]=w*A-M*S,_[1]=k*A-B*S,_[2]=T*A-O*S,_[3]=C*A-E*S,_[8]=w*S+M*A,_[9]=k*S+B*A,_[10]=T*S+O*A,_[11]=C*S+E*A}(s,s,p),$a(s,s,[-y[0],-y[1],y[2]]),function(_,b,x){const S=x[0],A=x[1],w=x[2];_[0]=b[0]*S,_[1]=b[1]*S,_[2]=b[2]*S,_[3]=b[3]*S,_[4]=b[4]*A,_[5]=b[5]*A,_[6]=b[6]*A,_[7]=b[7]*A,_[8]=b[8]*w,_[9]=b[9]*w,_[10]=b[10]*w,_[11]=b[11]*w,_[12]=b[12],_[13]=b[13],_[14]=b[14],_[15]=b[15]}(s,s,[c,u,d]),f){const _=ye.allocate(),b=[0,0];if(v){if(typeof m[0]=="string"){const x=parseFloat(m[0])/100,S=t.AABBBounds;b[0]=S.x1+(S.x2-S.x1)*x}else b[0]=m[0];if(typeof m[1]=="string"){const x=parseFloat(m[1])/100,S=t.AABBBounds;b[1]=S.x1+(S.x2-S.x1)*x}else b[1]=m[1]}$a(_,_,[b[0],b[1],0]),function(x,S,A){const w=Math.sin(A),k=Math.cos(A),T=S[0],C=S[1],M=S[2],B=S[3],O=S[4],E=S[5],L=S[6],P=S[7];S!==x&&(x[8]=S[8],x[9]=S[9],x[10]=S[10],x[11]=S[11],x[12]=S[12],x[13]=S[13],x[14]=S[14],x[15]=S[15]),x[0]=T*k+O*w,x[1]=C*k+E*w,x[2]=M*k+L*w,x[3]=B*k+P*w,x[4]=O*k-T*w,x[5]=E*k-C*w,x[6]=L*k-M*w,x[7]=P*k-B*w}(_,_,f),$a(_,_,[-b[0],-b[1],0]),Xa(s,s,_)}}let Wd=class{constructor(s){this.creator=s,this.hooks={onAttributeUpdate:new ai(["graphic"]),onSetStage:new ai(["graphic","stage"]),onRemove:new ai(["graphic"]),onRelease:new ai(["graphic"]),onAddIncremental:new ai(["graphic","group","stage"]),onClearIncremental:new ai(["graphic","group","stage"]),beforeUpdateAABBBounds:new ai(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new ai(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"]),clearAABBBounds:new ai(["graphic","stage","aabbBounds"])},this.tempAABBBounds1=new fe,this.tempAABBBounds2=new fe}onAttributeUpdate(s){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(s)}onSetStage(s,t){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(s,t)}onRemove(s){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(s)}onRelease(s){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(s)}onAddIncremental(s,t,e){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(s,t,e)}onClearIncremental(s,t){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(s,t)}beforeUpdateAABBBounds(s,t,e,i){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(s,t,e,i)}afterUpdateAABBBounds(s,t,e,i,n){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(s,t,e,i,n)}clearAABBBounds(s,t,e){this.hooks.clearAABBBounds.taps.length&&this.hooks.clearAABBBounds.call(s,t,e)}updatePathProxyAABBBounds(s,t){const e=typeof t.pathProxy=="function"?t.pathProxy(t.attribute):t.pathProxy;if(!e)return!1;const i=new sd(s);return gs(e.commandList,i,0,0),!0}updateHTMLTextAABBBounds(s,t,e,i){const{textAlign:n,textBaseline:r}=s;if(s.forceBoundsHeight!=null){const a=it(s.forceBoundsHeight)?s.forceBoundsHeight:s.forceBoundsHeight(),o=uh(r,a,a);e.set(e.x1,o,e.x2,o+a)}if(s.forceBoundsWidth!=null){const a=it(s.forceBoundsWidth)?s.forceBoundsWidth:s.forceBoundsWidth(),o=Ya(n,a);e.set(o,e.y1,o+a,e.y2)}}combindShadowAABBBounds(s,t){if(t&&t.shadowRoot){const e=t.shadowRoot.AABBBounds;s.union(e)}}transformAABBBounds(s,t,e,i,n){if(!t.empty()){const{scaleX:o=e.scaleX,scaleY:l=e.scaleY,stroke:h=e.stroke,shadowBlur:c=e.shadowBlur,lineWidth:u=e.lineWidth,pickStrokeBuffer:d=e.pickStrokeBuffer,strokeBoundsBuffer:p=e.strokeBoundsBuffer}=s,g=this.tempAABBBounds1,f=this.tempAABBBounds2;if(h&&u&&(nh(g,(u+d)/Math.abs(o+l),i,p),t.union(g),g.setValue(f.x1,f.y1,f.x2,f.y2)),c){const{shadowOffsetX:m=e.shadowOffsetX,shadowOffsetY:v=e.shadowOffsetY}=s;nh(g,c/Math.abs(o+l)*2,!1,p+1),g.translate(m,v),t.union(g)}}if(this.combindShadowAABBBounds(t,n),t.empty())return;let r=!0;const a=n.transMatrix;n&&n.isContainer&&(r=!(a.a===1&&a.b===0&&a.c===0&&a.d===1&&a.e===0&&a.f===0)),r&&Gu(t,t,a)}validCheck(s,t,e,i){if(!i||s.forceBoundsHeight!=null||s.forceBoundsWidth!=null||i.shadowRoot||i.isContainer)return!0;const{visible:n=t.visible}=s;return!(!i.valid||!n)||(e.empty()||(i.parent&&e.transformWithMatrix(i.parent.globalTransMatrix),H.graphicService.clearAABBBounds(i,i.stage,e),e.clear()),!1)}updateTempAABBBounds(s){const t=this.tempAABBBounds1,e=this.tempAABBBounds2;return t.setValue(s.x1,s.y1,s.x2,s.y2),e.setValue(s.x1,s.y1,s.x2,s.y2),{tb1:t,tb2:e}}};Wd=Ow([nt(),Lw(0,At(Fv)),Pw("design:paramtypes",[Object])],Wd);const dh=(s,t,e)=>{const{outerBorder:i,shadowBlur:n=t.shadowBlur}=s;if(i){const r=t.outerBorder,{distance:a=r.distance,lineWidth:o=r.lineWidth}=i;e.expand(a+(n+o)/2)}return e};class t0{constructor(t,e,i){this.fontFamily=t,this.textOptions=e,this.textMeasure=i}LayoutBBox(t,e,i,n){if(t.xOffset=e==="left"||e==="start"?0:e==="center"?t.width/-2:e==="right"||e==="end"?-t.width:0,i==="top")t.yOffset=0;else if(i==="middle")t.yOffset=t.height/-2;else if(i==="alphabetic"){let r=.79;if(n.length===1){const a=n[0];r=a.ascent/(a.ascent+a.descent)}t.yOffset=t.height*-r}else t.yOffset=-t.height;return t}GetLayoutByLines(t,e,i,n){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;const{lineWidth:l,suffixPosition:h="end",measureMode:c=fn.actualBounding,keepCenterInLine:u=!1}=o??{};t=t.map(f=>f.toString());const d=[],p=[0,0];if(typeof l=="number"&&l!==1/0){let f;for(let m=0,v=t.length;m<v;m++){const y=this.textMeasure.measureTextPixelADscentAndWidth(t[m],this.textOptions,c);let _=t[m].toString();if(y.width>l){const b=this.textMeasure.clipTextWithSuffix(t[m],this.textOptions,l,r,a,h);_=b.str,f=b.width}else f=y.width;d.push({str:_,width:f,ascent:y.ascent,descent:y.descent,keepCenterInLine:u})}p[0]=l}else{let f,m,v=0;for(let y=0,_=t.length;y<_;y++){m=t[y];const b=this.textMeasure.measureTextPixelADscentAndWidth(t[y],this.textOptions,c);f=b.width,v=Math.max(v,f),d.push({str:m,width:f,ascent:b.ascent,descent:b.descent,keepCenterInLine:u})}p[0]=v}p[1]=d.length*n,p[0]=d.reduce((f,m)=>Math.max(f,m.width),0);const g={xOffset:0,yOffset:0,width:p[0],height:p[1]};return this.LayoutBBox(g,e,i,d),this.layoutWithBBox(g,d,e,i,n)}layoutWithBBox(t,e,i,n,r){const a=[0,0],o=e.length*r;n==="top"||(n==="middle"?a[1]=(t.height-o)/2:n==="bottom"&&(a[1]=t.height-o));for(let l=0;l<e.length;l++)this.lineOffset(t,e[l],i,n,r,a);return{bbox:t,lines:e,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:r,textAlign:i,textBaseline:n}}lineOffset(t,e,i,n,r,a){if(i==="left"||i==="start"?e.leftOffset=0:i==="center"?e.leftOffset=(t.width-e.width)/2:i!=="right"&&i!=="end"||(e.leftOffset=t.width-e.width),e.topOffset=r/2+(e.ascent-e.descent)/2+a[1],!e.keepCenterInLine){const l=e.ascent+e.descent+0;if(l<r-0&&(n==="bottom"?e.topOffset+=(r-l)/2:n==="top"&&(e.topOffset-=(r-l)/2)),n==="alphabetic"){const h=r/(e.ascent+e.descent);e.topOffset=r/2+(e.ascent-e.descent)/2*h+a[1]}}return a[1]+=r,e}}const e0=["text","maxLineWidth","maxWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...Ei];let ph=class dn extends Le{get font(){const t=this.getGraphicTheme();return this._font||(this._font=bl(this.attribute,t)),this._font}get clipedText(){var t;const e=this.attribute,i=this.getGraphicTheme(),n=this.getMaxWidth(i);return Number.isFinite(n)?(this.tryUpdateAABBBounds(),this.cache.clipedText):((t=e.text)!==null&&t!==void 0?t:i.text).toString()}get clipedWidth(){return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){var t,e;const i=this.getGraphicTheme(),n=this.attribute,r=this.getMaxWidth(i);if(!Number.isFinite(r))return!1;const{text:a}=this.attribute;if(this.tryUpdateAABBBounds(),(e=(t=this.cache)===null||t===void 0?void 0:t.layoutData)===null||e===void 0?void 0:e.lines){let o="";return this.cache.layoutData.lines.forEach(l=>{o+=l.str}),(Array.isArray(a)?a.join(""):a)!==o}return n.direction==="vertical"&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map(o=>o.text).join("")!==n.text.toString():this.clipedText!=null&&this.clipedText!==n.text.toString()}get multilineLayout(){return this.tryUpdateAABBBounds(),this.cache.layoutData}get isMultiLine(){return Array.isArray(this.attribute.text)||this.attribute.whiteSpace==="normal"}constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{text:"",fontSize:16}),this.type="text",this.numberType=hh,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{text:t}=this.attribute;return W(t)?!t.every(e=>e==null||e===""):t!=null&&t!==""}getGraphicTheme(){return Et(this).text}doUpdateOBBBounds(){const t=this.getGraphicTheme();this._OBBBounds.clear();const e=this.attribute,{angle:i=t.angle}=e;if(!i){const h=this.AABBBounds;return this._OBBBounds.setValue(h.x1,h.y1,h.x2,h.y2),this._OBBBounds}this.obbText||(this.obbText=new dn({})),this.obbText.setAttributes(Object.assign(Object.assign({},e),{angle:0}));const n=this.obbText.AABBBounds,{x:r,y:a}=e,o={x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2},l=sr(o,i,{x:r,y:a});return this._OBBBounds.copy(n),this._OBBBounds.translate(l.x-o.x,l.y-o.y),this._OBBBounds.angle=i,this._OBBBounds}updateAABBBounds(t,e,i){const{text:n=e.text}=this.attribute;Array.isArray(n)?this.updateMultilineAABBBounds(n):this.updateSingallineAABBBounds(n);const{tb1:r}=H.graphicService.updateTempAABBBounds(i),{scaleX:a=e.scaleX,scaleY:o=e.scaleY,shadowBlur:l=e.shadowBlur,strokeBoundsBuffer:h=e.strokeBoundsBuffer}=t;return l&&(nh(r,l/Math.abs(a+o),!0,h),i.union(r)),H.graphicService.combindShadowAABBBounds(i,this),t.forceBoundsHeight==null&&t.forceBoundsWidth==null||H.graphicService.updateHTMLTextAABBBounds(t,e,i),Gu(i,i,this.transMatrix),i}updateSingallineAABBBounds(t){this.updateMultilineAABBBounds([t]);const e=this.cache.layoutData;if(e&&e.lines&&e.lines.length){const i=e.lines[0];this.cache.clipedText=i.str,this.cache.clipedWidth=i.width}return this._AABBBounds}updateMultilineAABBBounds(t){const e=this.getGraphicTheme(),{direction:i=e.direction,underlineOffset:n=e.underlineOffset}=this.attribute,r=i==="horizontal"?this.updateHorizontalMultilineAABBBounds(t):this.updateVerticalMultilineAABBBounds(t);return i==="horizontal"&&n&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+n),r}guessLineHeightBuf(t){return t?.1*t:0}updateHorizontalMultilineAABBBounds(t){var e;const i=this.getGraphicTheme(),n=this.attribute,{fontFamily:r=i.fontFamily,textAlign:a=i.textAlign,textBaseline:o=i.textBaseline,fontSize:l=i.fontSize,fontWeight:h=i.fontWeight,ellipsis:c=i.ellipsis,maxLineWidth:u,stroke:d=i.stroke,wrap:p=i.wrap,measureMode:g=i.measureMode,lineWidth:f=i.lineWidth,whiteSpace:m=i.whiteSpace,suffixPosition:v=i.suffixPosition,ignoreBuf:y=i.ignoreBuf,keepCenterInLine:_=i.keepCenterInLine}=n,b=y?0:this.guessLineHeightBuf(l),x=this.getLineHeight(n,i,b);if(m==="normal"||p)return this.updateWrapAABBBounds(t);if(!this.shouldUpdateShape()&&(!((e=this.cache)===null||e===void 0)&&e.layoutData)){const k=this.cache.layoutData.bbox;return this._AABBBounds.set(k.xOffset,k.yOffset,k.xOffset+k.width,k.yOffset+k.height),d&&this._AABBBounds.expand(f/2),this._AABBBounds}const S=H.graphicUtil.textMeasure,A=new t0(r,{fontSize:l,fontWeight:h,fontFamily:r,lineHeight:x},S).GetLayoutByLines(t,a,o,x,c===!0?i.ellipsis:c||void 0,!1,{lineWidth:u,suffixPosition:v,measureMode:g,keepCenterInLine:_}),{bbox:w}=A;return this.cache.layoutData=A,this.clearUpdateShapeTag(),this._AABBBounds.set(w.xOffset,w.yOffset,w.xOffset+w.width,w.yOffset+w.height),d&&this._AABBBounds.expand(f/2),this._AABBBounds}updateWrapAABBBounds(t){var e,i,n;const r=this.getGraphicTheme(),{fontFamily:a=r.fontFamily,textAlign:o=r.textAlign,textBaseline:l=r.textBaseline,fontSize:h=r.fontSize,ellipsis:c=r.ellipsis,maxLineWidth:u,stroke:d=r.stroke,lineWidth:p=r.lineWidth,wordBreak:g=r.wordBreak,fontWeight:f=r.fontWeight,ignoreBuf:m=r.ignoreBuf,measureMode:v=r.measureMode,suffixPosition:y=r.suffixPosition,heightLimit:_=0,lineClamp:b,keepCenterInLine:x=r.keepCenterInLine}=this.attribute,S=m?0:this.guessLineHeightBuf(h),A=this.getLineHeight(this.attribute,r,S);if(!this.shouldUpdateShape()&&(!((e=this.cache)===null||e===void 0)&&e.layoutData)){const P=this.cache.layoutData.bbox;return this._AABBBounds.set(P.xOffset,P.yOffset,P.xOffset+P.width,P.yOffset+P.height),d&&this._AABBBounds.expand(p/2),this._AABBBounds}const w=H.graphicUtil.textMeasure,k={fontSize:h,fontWeight:f,fontFamily:a,lineHeight:A},T=new t0(a,k,w),C=W(t)?t.map(P=>P.toString()):[t.toString()],M=[],B=[0,0];let O=1/0;if(_>0&&(O=Math.max(Math.floor(_/A),1)),b&&(O=Math.min(O,b)),typeof u=="number"&&u!==1/0){if(u>0)for(let F=0;F<C.length;F++){const j=C[F];let D=!0;if(F===O-1){const $=w.clipTextWithSuffix(j,k,u,c,!1,y,F!==C.length-1),G=w.measureTextPixelADscentAndWidth($.str,k,v);M.push({str:$.str,width:$.width,ascent:G.ascent,descent:G.descent,keepCenterInLine:x});break}const N=w.clipText(j,k,u,g!=="break-all",g==="keep-all");if(j!==""&&N.str===""||N.wordBreaked){if(c){const $=w.clipTextWithSuffix(j,k,u,c,!1,y);N.str=(i=$.str)!==null&&i!==void 0?i:"",N.width=(n=$.width)!==null&&n!==void 0?n:0}else N.str="",N.width=0;D=!1}const J=w.measureTextPixelADscentAndWidth(N.str,k,v);M.push({str:N.str,width:N.width,ascent:J.ascent,descent:J.descent,keepCenterInLine:x});let X=N.str.length;if(!N.wordBreaked||j!==""&&N.str===""||(D=!0,X=N.wordBreaked),N.str.length!==j.length){if(D){let $=j.substring(X);g==="keep-all"&&($=$.replace(/^\\s+/g,"")),C.splice(F+1,0,$)}}}let P=0;M.forEach(F=>{P=Math.max(P,F.width)}),B[0]=P}else{let P,F,j=0;for(let D=0,N=C.length;D<N;D++){if(D===O-1){const X=w.clipTextWithSuffix(C[D],k,u,c,!1,y),$=w.measureTextPixelADscentAndWidth(X.str,k,v);M.push({str:X.str,width:X.width,ascent:$.ascent,descent:$.descent,keepCenterInLine:x}),j=Math.max(j,X.width);break}F=C[D],P=w.measureTextWidth(F,k),j=Math.max(j,P);const J=w.measureTextPixelADscentAndWidth(F,k,v);M.push({str:F,width:P,ascent:J.ascent,descent:J.descent,keepCenterInLine:x})}B[0]=j}B[1]=M.length*A;const E={xOffset:0,yOffset:0,width:B[0],height:B[1]};T.LayoutBBox(E,o,l,M);const L=T.layoutWithBBox(E,M,o,l,A);return this.cache.layoutData=L,this.clearUpdateShapeTag(),this._AABBBounds.set(E.xOffset,E.yOffset,E.xOffset+E.width,E.yOffset+E.height),d&&this._AABBBounds.expand(p/2),this._AABBBounds}updateVerticalMultilineAABBBounds(t){var e,i;const n=this.getGraphicTheme(),r=H.graphicUtil.textMeasure;let a;const o=this.attribute,{maxLineWidth:l=n.maxLineWidth,ellipsis:h=n.ellipsis,fontFamily:c=n.fontFamily,fontSize:u=n.fontSize,fontWeight:d=n.fontWeight,stroke:p=n.stroke,lineWidth:g=n.lineWidth,verticalMode:f=n.verticalMode,suffixPosition:m=n.suffixPosition}=o,v=this.getLineHeight(o,n,0);let{textAlign:y=n.textAlign,textBaseline:_=n.textBaseline}=o;if(!f){const w=y;y=(e=dn.baselineMapAlign[_])!==null&&e!==void 0?e:"left",_=(i=dn.alignMapBaseline[w])!==null&&i!==void 0?i:"top"}if(a=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach(C=>{const M=C.reduce((B,O)=>B+O.width,0);a=ts(M,a)});const w=Ya(y,a),k=this.cache.verticalList.length*v,T=uh(_,k,u);return this._AABBBounds.set(T,w,T+k,w+a),p&&this._AABBBounds.expand(g/2),this._AABBBounds}const b=t.map(w=>function(k){const T=[];let C=0,M="";for(let B=0;B<k.length;B++)xw(k[B])?C?M+=k[B]:(C=1,M=k[B]):(C&&(T.push({text:M,direction:fr.VERTICAL}),M="",C=0),T.push({text:k[B],direction:fr.HORIZONTAL}));return M&&T.push({text:M,direction:fr.VERTICAL}),T}(w.toString()));b.forEach((w,k)=>{if(Number.isFinite(l))if(h){const T=h===!0?n.ellipsis:h,C=r.clipTextWithSuffixVertical(w,{fontSize:u,fontWeight:d,fontFamily:c},l,T,!1,m);b[k]=C.verticalList,a=C.width}else{const T=r.clipTextVertical(w,{fontSize:u,fontWeight:d,fontFamily:c},l,!1);b[k]=T.verticalList,a=T.width}else a=0,w.forEach(T=>{const C=T.direction===fr.HORIZONTAL?u:r.measureTextWidth(T.text,{fontSize:u,fontWeight:d,fontFamily:c});a+=C,T.width=C})}),this.cache.verticalList=b,this.clearUpdateShapeTag(),this.cache.verticalList.forEach(w=>{const k=w.reduce((T,C)=>T+C.width,0);a=ts(k,a)});const x=Ya(y,a),S=this.cache.verticalList.length*v,A=uh(_,S,u);return this._AABBBounds.set(A,x,A+S,x+a),p&&this._AABBBounds.expand(g/2),this._AABBBounds}getMaxWidth(t){var e,i;const n=this.attribute;return(i=(e=n.maxLineWidth)!==null&&e!==void 0?e:n.maxWidth)!==null&&i!==void 0?i:t.maxWidth}getLineHeight(t,e,i){var n;return(n=th(t.lineHeight,t.fontSize||e.fontSize))!==null&&n!==void 0?n:(t.fontSize||e.fontSize)+i}needUpdateTags(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e0;return super.needUpdateTags(t,e)}needUpdateTag(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e0;return super.needUpdateTag(t,e)}_interpolate(t,e,i,n,r){t==="text"&&(r.text=n)}clone(){return new dn(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return dn.NOWORK_ANIMATE_ATTR}getBaselineMapAlign(){return dn.baselineMapAlign}getAlignMapBaseline(){return dn.alignMapBaseline}};function Ka(s){return new ph(s)}ph.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},zi),ph.baselineMapAlign={top:"left",bottom:"right",middle:"center"},ph.alignMapBaseline={left:"top",right:"bottom",center:"middle"};const i0=["symbolType","size",...Ei];let Ud=class kf extends Le{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{symbolType:"circle"}),this.type="symbol",this.numberType=lh}getParsedPath(){return this.shouldUpdateShape()&&(this._parsedPath=this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}getParsedPath2D(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=null;try{n=new Path2D}catch{return null}const r=this.getParsedPath();if(!r)return null;r.draw(n,i,t,e)}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{size:t}=this.attribute;return W(t)?t.length===2&&t.every(this._validNumber):this._validNumber(t)}doUpdateParsedPath(){const{symbolType:t="circle"}=this.attribute;return super.parsePath(t)}getGraphicTheme(){return Et(this).symbol}updateAABBBounds(t,e,i,n){this.updatePathProxyAABBBounds(i)||(n?this.updateSymbolAABBBoundsImprecise(t,e,i):this.updateSymbolAABBBoundsAccurate(t,e,i));const{tb1:r,tb2:a}=H.graphicService.updateTempAABBBounds(i);((l,h,c)=>{const{outerBorder:u,shadowBlur:d=h.shadowBlur,strokeBoundsBuffer:p=h.strokeBoundsBuffer}=l;if(u){const g=h.outerBorder,{distance:f=g.distance,lineWidth:m=g.lineWidth}=u;nh(c,f+(d+m)/2,!0,p)}})(t,e,r),i.union(r),r.setValue(a.x1,a.y1,a.x2,a.y2);const{lineJoin:o=e.lineJoin}=t;return H.graphicService.transformAABBBounds(t,i,e,o==="miter",this),i}updateSymbolAABBBoundsImprecise(t,e,i){const{size:n=e.size}=t;if(W(n))i.set(-n[0]/2,-n[1]/2,n[0]/2,n[1]/2);else{const r=n/2;i.set(-r,-r,r,r)}return i}updateSymbolAABBBoundsAccurate(t,e,i){const{size:n=e.size}=t;return this.getParsedPath().bounds(n,i),i}needUpdateTags(t){return super.needUpdateTags(t,i0)}needUpdateTag(t){return super.needUpdateTag(t,i0)}toCustomPath(){const t=this.getParsedPath(),e=this.attribute.size,i=W(e)?e:[e,e];return t.path?new me().fromCustomPath2D(t.path,0,0,i[0],i[1]):new me().fromString(t.pathStr,0,0,i[0],i[1])}clone(){return new kf(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return kf.NOWORK_ANIMATE_ATTR}};function gh(s){return new Ud(s)}Ud.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},zi);const s0=["segments","points","curveType","curveTension",...Ei];let n0=class wf extends Le{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}),this.type="line",this.numberType=za}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?e.length!==0:!(!t||t.length<=1)}_interpolate(t,e,i,n,r){t==="points"&&(r.points=Ad(i,n,e))}getGraphicTheme(){return Et(this).line}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateLineAABBBoundsBySegments(t,e,i):this.updateLineAABBBoundsByPoints(t,e,i)),H.graphicService.updateTempAABBBounds(i);const{lineJoin:n=e.lineJoin}=t;return H.graphicService.transformAABBBounds(t,i,e,n==="miter",this),i}updateLineAABBBoundsByPoints(t,e,i,n){const{points:r=e.points,connectedType:a}=t,o=i;return r.forEach(l=>{l.defined===!1&&a!=="connect"||o.add(l.x,l.y)}),o}updateLineAABBBoundsBySegments(t,e,i,n){const{segments:r=e.segments,connectedType:a}=t,o=i;return r.forEach(l=>{l.points.forEach(h=>{h.defined===!1&&a!=="connect"||o.add(h.x,h.y)})}),o}needUpdateTags(t){return super.needUpdateTags(t,s0)}needUpdateTag(t){return super.needUpdateTag(t,s0)}toCustomPath(){const t=this.attribute,e=new me,i=t.segments,n=r=>{if(r&&r.length){let a=!0;r.forEach(o=>{o.defined!==!1&&(a?e.moveTo(o.x,o.y):e.lineTo(o.x,o.y),a=!1)})}};return i&&i.length?i.forEach(r=>{n(r.points)}):t.points&&n(t.points),e}clone(){return new wf(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return wf.NOWORK_ANIMATE_ATTR}};function Gd(s){return new n0(s)}n0.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},zi);const r0=["width","x1","y1","height","cornerRadius",...Ei];class qa extends Le{constructor(t){super(t),this.type="rect",this.numberType=Ed}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}getGraphicTheme(){return Et(this).rect}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){let{width:a,height:o}=t;const{x1:l,y1:h,x:c,y:u}=t;a=a??l-c,o=o??h-u,(isFinite(a)||isFinite(o)||isFinite(c)||isFinite(u))&&i.set(0,0,a||0,o||0)}const{tb1:n,tb2:r}=H.graphicService.updateTempAABBBounds(i);return dh(t,e,n),i.union(n),n.setValue(r.x1,r.y1,r.x2,r.y2),H.graphicService.transformAABBBounds(t,i,e,!1,this),i}needUpdateTags(t){return super.needUpdateTags(t,r0)}needUpdateTag(t){return super.needUpdateTag(t,r0)}toCustomPath(){const t=this.attribute,{x:e,y:i,width:n,height:r}=(o=>{if(!o)return{x:0,y:0,width:0,height:0};let l=I(o.width)?o.x1-o.x:o.width,h=I(o.height)?o.y1-o.y:o.height,c=0,u=0;return l<0?(c=l,l=-l):Number.isNaN(l)&&(l=0),h<0?(u=h,h=-h):Number.isNaN(h)&&(h=0),{x:c,y:u,width:l,height:h}})(t),a=new me;return a.moveTo(e,i),a.rect(e,i,n,r),a}clone(){return new qa(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return qa.NOWORK_ANIMATE_ATTR}}function fh(s){return new qa(s)}qa.NOWORK_ANIMATE_ATTR=zi;class Dw{constructor(t,e,i,n,r,a,o,l,h,c,u,d,p,g){this.left=t,this.top=e,this.width=i,this.height=n,this.actualHeight=0,this.bottom=e+n,this.right=t+i,this.ellipsis=r,this.wordBreak=a,this.verticalDirection=o,this.lines=[],this.globalAlign=l,this.globalBaseline=h,this.layoutDirection=c,this.directionKey=ud[this.layoutDirection],this.isWidthMax=u,this.isHeightMax=d,this.singleLine=p,g?(g.clear(),this.icons=g):this.icons=new Map}draw(t,e){const{width:i,height:n}=this.getActualSize(),r=this.isWidthMax?Math.min(this.width,i):this.width||i||0;let a=this.isHeightMax?Math.min(this.height,n):this.height||n||0;a=Math.min(a,n);let o=0;switch(this.globalBaseline){case"top":o=0;break;case"middle":o=-a/2;break;case"bottom":o=-a}let l=0;this.globalAlign==="right"||this.globalAlign==="end"?l=-r:this.globalAlign==="center"&&(l=-r/2);let h=this[this.directionKey.height];this.singleLine&&(h=this.lines[0].height+1);let c=!1;if(this.verticalDirection==="middle")if(this.actualHeight>=h&&h!==0)for(let u=0;u<this.lines.length;u++){const{top:d,height:p}=this.lines[u];if(d+p<this[this.directionKey.top]||d+p>this[this.directionKey.top]+h)return c;let g=!1;this.ellipsis&&this.lines[u+1]&&this.lines[u+1].top+this.lines[u+1].height>this[this.directionKey.top]+h&&(g=!0,c=!0),this.lines[u].draw(t,g,this.lines[u][this.directionKey.left]+l,this.lines[u][this.directionKey.top]+o,this.ellipsis,e)}else{const u=Math.floor((h-this.actualHeight)/2);this.layoutDirection==="vertical"?l+=u:o+=u;for(let d=0;d<this.lines.length;d++)this.lines[d].draw(t,!1,this.lines[d][this.directionKey.left]+l,this.lines[d][this.directionKey.top]+o,this.ellipsis,e)}else if(this.verticalDirection==="bottom"&&this.layoutDirection!=="vertical")for(let u=0;u<this.lines.length;u++){const{top:d,height:p}=this.lines[u],g=h-this.lines[u].top-this.lines[u].height;if(h===0)this.lines[u].draw(t,!1,l,g+o,this.ellipsis,e);else{if(g+p>this[this.directionKey.top]+h||g<this[this.directionKey.top])return c;{let f=!1;this.ellipsis&&this.lines[u+1]&&g-this.lines[u+1].height<this[this.directionKey.top]&&(f=!0,c=!0),this.lines[u].draw(t,f,l,g+o,this.ellipsis,e)}}}else{this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&this.singleLine&&this.isWidthMax&&(l+=this.lines[0].height+1);for(let u=0;u<this.lines.length;u++){this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&(l-=this.lines[u].height+this.lines[u].top);const{top:d,height:p}=this.lines[u];if(h===0)this.lines[u].draw(t,!1,this.lines[u][this.directionKey.left]+l,this.lines[u][this.directionKey.top]+o,this.ellipsis,e);else{if(d+p<this[this.directionKey.top]||d+p>this[this.directionKey.top]+h)return c;{let g=!1;this.ellipsis&&this.lines[u+1]&&this.lines[u+1].top+this.lines[u+1].height>this[this.directionKey.top]+h&&(g=!0,c=!0),this.lines[u].draw(t,g,this.lines[u][this.directionKey.left]+l,this.lines[u][this.directionKey.top]+o,this.ellipsis,e)}}}}return c}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let t=0,e=0;for(let i=0;i<this.lines.length;i++){const n=this.lines[i];n.actualWidth>t&&(t=n.actualWidth),e+=n.height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}getActualSizeWidthEllipsis(){let t=0,e=0;const{width:i,height:n}=this.getRawActualSize();this.width,this.height;let r=this[this.directionKey.height];if(this.singleLine&&(r=this.lines[0].height+1),this.verticalDirection==="middle")if(this.actualHeight>=r&&r!==0)for(let a=0;a<this.lines.length;a++){const{top:o,height:l}=this.lines[a];if(!(o+l<this[this.directionKey.top]||o+l>this[this.directionKey.top]+r))if(this.ellipsis&&this.lines[a+1]&&this.lines[a+1].top+this.lines[a+1].height>this[this.directionKey.top]+r){const h=this.ellipsis===!0?"...":this.ellipsis||"",c=this.lines[a].getWidthWithEllips(h);c>t&&(t=c),e+=this.lines[a].height}else this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}else{Math.floor((r-this.actualHeight)/2);for(let a=0;a<this.lines.length;a++)this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}else if(this.verticalDirection==="bottom")for(let a=0;a<this.lines.length;a++){const{top:o,height:l}=this.lines[a],h=r-this.lines[a].top-this.lines[a].height;if(r===0)this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height;else if(!(h+l>this[this.directionKey.top]+r||h<this[this.directionKey.top]))if(this.ellipsis&&this.lines[a+1]&&h-this.lines[a+1].height<this[this.directionKey.top]){const c=this.ellipsis===!0?"...":this.ellipsis||"",u=this.lines[a].getWidthWithEllips(c);u>t&&(t=u),e+=this.lines[a].height}else this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}else for(let a=0;a<this.lines.length;a++){const{top:o,height:l}=this.lines[a];if(r===0)this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height;else if(!(o+l<this[this.directionKey.top]||o+l>this[this.directionKey.top]+r))if(this.ellipsis&&this.lines[a+1]&&this.lines[a+1].top+this.lines[a+1].height>this[this.directionKey.top]+r){const h=this.ellipsis===!0?"...":this.ellipsis||"",c=this.lines[a].getWidthWithEllips(h);c>t&&(t=c),e+=this.lines[a].height}else this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}}function Za(s,t,e,i){const n=Math.round(s),r=Math.round(e),a=Math.round(t),o=Math.round(i);return{left:s>n?n:n-.5,top:e>r?r:r-.5,right:a>t?a:a+.5,bottom:o>i?o:o+.5}}class An{constructor(t,e,i,n){this.fontSize=i.fontSize||16,this.textBaseline=i.textBaseline||"alphabetic",this.ascentDescentMode=n;const r=th(i.lineHeight,this.fontSize);this.lineHeight=typeof r=="number"?r>this.fontSize?r:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;const{ascent:a,height:o,descent:l,width:h}=yn(t,i,this.ascentDescentMode);let c=0,u=0,d=0;this.height>o&&(c=(this.height-o)/2,u=Math.ceil(c),d=Math.floor(c)),this.textBaseline==="top"?(this.ascent=c,this.descent=o-c):this.textBaseline==="bottom"?(this.ascent=o-c,this.descent=c):this.textBaseline==="middle"?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=a+u,this.descent=l+d),this.length=t.length,this.width=h||0,this.text=t||"",this.newLine=e||!1,this.character=i,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,i.direction==="vertical"&&(this.direction=i.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height),this.ellipsisStr="..."}updateWidth(){const{width:t}=yn(this.text,this.character,this.ascentDescentMode);this.width=t,this.direction==="vertical"&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}drawBackground(t,e,i,n,r,a,o){if(this.text===""||this.text===\`
\`||!this.character.background||this.character.backgroundOpacity&&!(this.character.backgroundOpacity>0))return;let l=e+i,h=this.text,c=this.left+n;l+=this.top;let u=this.direction;if(this.verticalEllipsis)h=this.ellipsisStr,u="vertical",l-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")h+=this.ellipsisStr,a!=="right"&&a!=="end"||(c-=this.ellipsisWidth);else if(this.ellipsis==="replace"){const p=Nl(h,(u==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,h.length-1);if(h=h.slice(0,p),h+=this.ellipsisStr,a==="right"||a==="end"){const{width:g}=yn(this.text.slice(p),this.character,this.ascentDescentMode);u==="vertical"||(c-=this.ellipsisWidth-g)}}}const d=Za(c,c+(this.widthOrigin||this.width),e,e+o);return Object.assign(Object.assign({},d),{fillStyle:this.character.background,globalAlpha:this.character.backgroundOpacity})}draw(t,e,i,n,r,a,o){let l=e+i,h=this.text,c=this.left+n;l+=this.top;let u=this.direction;if(this.verticalEllipsis)h=this.ellipsisStr,u="vertical",l-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")h+=this.ellipsisStr,a!=="right"&&a!=="end"||(c-=this.ellipsisWidth);else if(this.ellipsis==="replace"){const p=Nl(h,(u==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,h.length-1);if(h=h.slice(0,p),h+=this.ellipsisStr,a==="right"||a==="end"){const{width:g}=yn(this.text.slice(p),this.character,this.ascentDescentMode);u==="vertical"||(c-=this.ellipsisWidth-g)}}}switch(this.character.script){case"super":l-=this.ascent*(1/3);break;case"sub":l+=this.descent/2}u==="vertical"&&(t.save(),t.rotateAbout(Math.PI/2,c,l),t.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),t.translate(c,l),c=0,l=0);const{lineWidth:d=1}=this.character;if(this.character.stroke&&d&&t.strokeText(h,c,l),this.character.fill&&t.fillText(h,c,l),this.character.fill){if(this.character.lineThrough||this.character.underline){if(this.character.underline){const p=1+l,g=Za(c,c+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(g.left,1+l,g.right-g.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}if(this.character.lineThrough){const p=1+l-this.ascent/2,g=Za(c,c+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(g.left,1+l-this.ascent/2,g.right-g.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}else if(this.character.textDecoration==="underline"){const p=1+l,g=Za(c,c+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(g.left,1+l,g.right-g.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}else if(this.character.textDecoration==="line-through"){const p=1+l-this.ascent/2,g=Za(c,c+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(g.left,1+l-this.ascent/2,g.right-g.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}u==="vertical"&&t.restore()}getWidthWithEllips(t){let e=this.text;const i=t==="vertical"?this.height:this.width;if(this.ellipsis==="hide")return i;if(this.ellipsis==="add")return i+this.ellipsisWidth;if(this.ellipsis==="replace"){const n=Nl(e,i-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,e.length-1);e=e.slice(0,n),e+=this.ellipsisStr;const{width:r}=yn(this.text.slice(n),this.character,this.ascentDescentMode);return i+this.ellipsisWidth-r}return i}}const a0=["width","height","image",...Ei];class Ja extends Le{constructor(t){super(t),this.type="image",this.numberType=Lv,this.loadImage(this.attribute.image)}getImageElement(){const{image:t}=this.attribute;if(!t||!this.resources)return null;const e=this.resources.get(t);return e.state!=="success"?null:e.data}get width(){return this.tryUpdateAABBBounds(),this._actualWidth}get height(){return this.tryUpdateAABBBounds(),this._actualHeight}get repeatX(){var t;return(t=this.attribute.repeatX)!==null&&t!==void 0?t:"no-repeat"}set repeatX(t){this.attribute.repeatX===t&&(this.attribute.repeatX=t)}get repeatY(){var t;return(t=this.attribute.repeatY)!==null&&t!==void 0?t:"no-repeat"}set repeatY(t){this.attribute.repeatY===t&&(this.attribute.repeatY=t)}get image(){return this.attribute.image}set image(t){t!==this.attribute.image&&(this.attribute.image=t,this.loadImage(this.attribute.image))}imageLoadSuccess(t,e,i){super.imageLoadSuccess(t,e,()=>{this.successCallback&&this.successCallback()}),this.addUpdateBoundTag()}imageLoadFail(t,e){super.imageLoadFail(t,()=>{this.failCallback&&this.failCallback()})}setAttributes(t,e,i){return t.image&&this.loadImage(t.image),super.setAttributes(t,e,i)}setAttribute(t,e,i,n){return t==="image"&&this.loadImage(e),super.setAttribute(t,e,i,n)}getGraphicTheme(){return Et(this).image}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const{maxWidth:a=e.maxWidth,maxHeight:o=e.maxHeight}=t;let{width:l,height:h}=t;if(l==null||h==null){const c=this.getImageElement();if(c){const u=c.width,d=c.height;if(l!=null)h=l*(d/u);else if(h!=null)l=h*(u/d);else{const p=u/d;p>a/o?(l=a,h=a/p):(h=o,l=o*p)}}else l=a,h=o}this._actualWidth=l,this._actualHeight=h,i.set(0,0,l,h)}const{tb1:n,tb2:r}=H.graphicService.updateTempAABBBounds(i);return dh(t,e,n),i.union(n),n.setValue(r.x1,r.y1,r.x2,r.y2),H.graphicService.transformAABBBounds(t,i,e,!1,this),i}getDefaultAttribute(t){return Ba[t]}needUpdateTags(t){return super.needUpdateTags(t,a0)}needUpdateTag(t){return super.needUpdateTag(t,a0)}clone(){return new Ja(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Ja.NOWORK_ANIMATE_ATTR}}Ja.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},zi);class ss extends Ja{constructor(t){if(super(t),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],t.backgroundShowMode==="always"&&(this._hovered=!0),t.margin){const e=xd(t.margin);this._marginArray=typeof e=="number"?[e,e,e,e]:e}this.onBeforeAttributeUpdate=(e,i,n)=>{if(W(n)&&n.indexOf("margin")!==-1||n==="margin")if(i.margin){const r=xd(i.margin);this._marginArray=typeof r=="number"?[r,r,r,r]:r}else this._marginArray=[0,0,0,0]}}get width(){var t;return((t=this.attribute.width)!==null&&t!==void 0?t:0)+this._marginArray[1]+this._marginArray[3]}get height(){var t;return((t=this.attribute.height)!==null&&t!==void 0?t:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();const{width:t=Ba.width,height:e=Ba.height}=this.attribute,{backgroundWidth:i=t,backgroundHeight:n=e}=this.attribute,r=(i-t)/2,a=(n-e)/2;return this._AABBBounds.expand([0,2*r,2*a,0]),this._AABBBounds}setHoverState(t){this.attribute.backgroundShowMode==="hover"&&this._hovered!==t&&(this._hovered=t)}}class Fw{constructor(t,e,i,n,r,a,o,l){this.left=t,this.width=e,this.baseline=i,this.ascent=n,this.descent=r,this.top=i-n,this.paragraphs=a.map(c=>c),this.textAlign=(this.paragraphs[0]instanceof ss?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=o,this.directionKey=ud[this.direction],this.actualWidth=0;let h=0;this.paragraphs.forEach((c,u)=>{if(u===0&&c instanceof An){const d=uk.exec(c.text);(d==null?void 0:d.index)!==0&&(c.text=c.text.slice(d==null?void 0:d.index),c.updateWidth())}this.actualWidth+=c[this.directionKey.width],h=Math.max(c[this.directionKey.height],h)}),this.height=h,this.blankWidth=l?0:this.width-this.actualWidth,this.calcOffset(e,l)}calcOffset(t,e){const i=this.directionKey,n=this.height;let r=this.left,a=0;this.actualWidth<t&&!e&&(this.textAlign==="right"||this.textAlign==="end"?r=t-this.actualWidth:this.textAlign==="center"?r=(t-this.actualWidth)/2:this.textAlign==="justify"&&(this.paragraphs.length<2?r=(t-this.actualWidth)/2:a=(t-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map(function(o){o instanceof ss?(o["_"+i.x]=r,r+=o[i.width]+a,o["_"+i.y]=o.attribute.textBaseline==="top"?0:o.attribute.textBaseline==="bottom"?n-o.height:(n-o.height)/2):(o[i.left]=r,r+=o[i.width]+a)})}draw(t,e,i,n,r,a){if(r&&(e||this.paragraphs.some(u=>u.overflow))){let u=!0,d=!1;for(let g=this.paragraphs.length-1;g>=0;g--){const f=this.paragraphs[g];if(f.overflow)u=u&&f.text==="";else if(u){d=!0;break}}let p=0;if(!d)for(let g=this.paragraphs.length-1;g>=0;g--){const f=this.paragraphs[g];if(f.overflow){if(f.text==="")break;continue}if(f instanceof ss)break;if(this.direction==="vertical"&&f.direction!=="vertical"){f.verticalEllipsis=!0;break}const m=r===!0?"...":r||"";f.ellipsisStr=m;const{width:v}=yn(m,f.character,f.ascentDescentMode),y=v||0;if(y<=this.blankWidth+p){e&&(f.ellipsis="add");break}if(y<=this.blankWidth+p+f.width){f.ellipsis="replace",f.ellipsisWidth=y,f.ellipsisOtherParagraphWidth=this.blankWidth+p;break}f.ellipsis="hide",p+=f.width}}let o="",l=-1,h=[];const c=[h];this.paragraphs.forEach((u,d)=>{if(u instanceof ss)return;const p=u.drawBackground(t,n,this.ascent,i,d===0,this.textAlign,this.height);p&&(o===p.fillStyle&&l===p.globalAlpha||(h=[],c.push(h),o=p.fillStyle,l=p.globalAlpha),h.push(p))}),c.forEach(u=>{if(u.length===0)return;const d=u[0],p=u[u.length-1];t.fillStyle=d.fillStyle,t.globalAlpha=d.globalAlpha,t.fillRect(d.left,d.top,p.right-d.left,p.bottom-d.top)}),this.paragraphs.forEach((u,d)=>{if(u instanceof ss)return u.setAttributes({x:i+u._x,y:n+u._y}),void a(u,t,i+u._x,n+u._y,this.ascent);const p={x1:this.left,y1:this.top,x2:this.left+this.actualWidth,y2:this.top+this.height};(function(g,f){const m=f&&f.stroke||ck;if(!m)return void(g.globalAlpha=0);const{strokeOpacity:v=1,opacity:y=1}=f;g.globalAlpha=v*y,g.lineWidth=f&&typeof f.lineWidth=="number"?f.lineWidth:1,g.strokeStyle=m,zm(g,f)})(t,u.character),function(g,f,m){const v=f&&f.fill||hk,{fillOpacity:y=1,opacity:_=1}=f;g.globalAlpha=y*_,g.fillStyle=m?Fl(g,v,{AABBBounds:m}):v,zm(g,f)}(t,u.character,p),u.draw(t,n,this.ascent,i,d===0,this.textAlign,this.height)})}getWidthWithEllips(t){let e=0;for(let n=this.paragraphs.length-1;n>=0;n--){const r=this.paragraphs[n];if(r instanceof ss)break;const{width:a}=yn(t,r.character,r.ascentDescentMode),o=a||0;if(o<=this.blankWidth+e){r.ellipsis="add",r.ellipsisWidth=o;break}if(o<=this.blankWidth+e+r.width){r.ellipsis="replace",r.ellipsisWidth=o,r.ellipsisOtherParagraphWidth=this.blankWidth+e;break}r.ellipsis="hide",e+=r.width}let i=0;return this.paragraphs.forEach((n,r)=>{i+=n instanceof ss?n.width:n.getWidthWithEllips(this.direction)}),i}}class jw{constructor(t){this.frame=t,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=t.layoutDirection,this.directionKey=ud[this.direction]}store(t){if(t instanceof ss){this.frame.icons.set(t.richtextId,t),this.lineBuffer.push(t),this.lineWidth+=t[this.directionKey.width];let e=0,i=0;t.attribute.textBaseline==="top"?(e=0,i=t.height):t.attribute.textBaseline==="bottom"?(e=t.height,i=0):(e=t.height/2,i=t.height/2),this.maxAscent=Math.max(this.maxAscent,e),this.maxDescent=Math.max(this.maxDescent,i)}else this.lineBuffer.push(t),t.text.length!==0?(this.lineWidth+=t[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,t.ascent),this.maxDescent=Math.max(this.maxDescent,t.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,t.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,t.descent))}send(){if(this.lineBuffer.length===0)return;const t=this.maxAscent===0?this.maxAscentForBlank:this.maxAscent,e=this.maxDescent===0?this.maxDescentForBlank:this.maxDescent,i=new Fw(this.frame.left,this[this.directionKey.width],this.y+t,t,e,this.lineBuffer,this.direction,this.direction==="horizontal"?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(i),this.frame.actualHeight+=i.height,this.y+=i.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];t instanceof ss?this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineBuffer.length===0?(this.store(t),this.send()):(this.send(),this.deal(t)):typeof this.width!="number"||this.width<0||(t.newLine&&this.send(),(t.text.length!==0||this.newLine)&&(this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(t)):this.cut(t,e)))}cut(t,e){const i=this[this.directionKey.width]-this.lineWidth||0,n=Math.ceil(i/t[this.directionKey.width]*t.length)||0,r=Nl(t.text,i,t.character,n,this.frame.wordBreak==="break-word");if(r!==0){const[a,o]=function(l,h){const c=l.text.slice(0,h),u=l.text.slice(h);return[new An(c,l.newLine,l.character,l.ascentDescentMode),new An(u,!0,l.character,l.ascentDescentMode)]}(t,r);this.store(a),e?this.send():this.deal(o)}else this.lineBuffer.length!==0&&(this.send(),this.deal(t))}}let Yd=!1;try{Yd=Intl&&typeof Intl.Segmenter=="function"}catch{Yd=!1}const o0=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection","fill","stroke","fontSize","fontFamily","fontStyle","fontWeight","lineWidth","opacity","fillOpacity","strokeOpacity",...Ei];class ns extends Le{constructor(t){super(t),this.type="richtext",this._currentHoverIcon=null,this.numberType=Bd,this.onBeforeAttributeUpdate=(e,i,n)=>{for(const r in e)if(r==="hoverIconId"){if(e[r]===i[r])continue;const a=this._frameCache.icons.get(e[r]);this.updateHoverIconState(a)}}}get width(){var t;return(t=this.attribute.width)!==null&&t!==void 0?t:fs.width}set width(t){this.attribute.width!==t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return(t=this.attribute.height)!==null&&t!==void 0?t:fs.height}set height(t){this.attribute.height!==t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(t){this.attribute.maxWidth!==t&&(this.attribute.maxWidth=t,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(t){this.attribute.maxHeight!==t&&(this.attribute.maxHeight=t,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var t;return(t=this.attribute.ellipsis)!==null&&t!==void 0?t:fs.ellipsis}set ellipsis(t){this.attribute.ellipsis!==t&&(this.attribute.ellipsis=t,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var t;return(t=this.attribute.wordBreak)!==null&&t!==void 0?t:fs.wordBreak}set wordBreak(t){this.attribute.wordBreak!==t&&(this.attribute.wordBreak=t,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var t;return(t=this.attribute.verticalDirection)!==null&&t!==void 0?t:fs.verticalDirection}set verticalDirection(t){this.attribute.verticalDirection!==t&&(this.attribute.verticalDirection=t,this.addUpdateShapeAndBoundsTag())}get textAlign(){var t;return(t=this.attribute.textAlign)!==null&&t!==void 0?t:fs.textAlign}set textAlign(t){this.attribute.textAlign!==t&&(this.attribute.textAlign=t,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var t;return(t=this.attribute.textBaseline)!==null&&t!==void 0?t:fs.textBaseline}set textBaseline(t){this.attribute.textBaseline!==t&&(this.attribute.textBaseline=t,this.addUpdateShapeAndBoundsTag())}get textConfig(){var t;return(t=this.attribute.textConfig)!==null&&t!==void 0?t:fs.textConfig}set textConfig(t){this.attribute.textConfig=t,this.addUpdateShapeAndBoundsTag()}getGraphicTheme(){return Et(this).richtext}static AllSingleCharacter(t){return t.lines?t.lines.every(e=>e.paragraphs.every(i=>!(i.text&&Q(i.text)&&ns.splitText(i.text).length>1))):t.every(e=>e.isComposing||!(e.text&&Q(e.text)&&ns.splitText(e.text).length>1))}static splitText(t){if(Yd){const e=new Intl.Segmenter(void 0,{granularity:"grapheme"}),i=[];for(const{segment:n}of e.segment(t))i.push(n);return i}return Array.from(t)}static TransformTextConfig2SingleCharacter(t){const e=[];return t.forEach(i=>{const n=ns.splitText(i.text.toString());if(Q(i.text)&&n.length>1)for(let r=0;r<n.length;r++){const a=n[r];e.push(Object.assign(Object.assign({},i),{text:a}))}else e.push(i)}),e}updateAABBBounds(t,e,i){var n,r,a,o;const{width:l=e.width,height:h=e.height,maxWidth:c=e.maxWidth,maxHeight:u=e.maxHeight,textAlign:d=e.textAlign,verticalDirection:p=(r=(n=t.textBaseline)!==null&&n!==void 0?n:e.textBaseline)!==null&&r!==void 0?r:e.verticalDirection,editOptions:g}=t;if(l>0&&h>0)i.set(0,0,l,h);else{const v=this.getFrameCache(),{width:y,height:_}=v.getActualSize();let b=l||y||0,x=h||_||0;x=typeof u=="number"&&x>u?u:x||0,b=typeof c=="number"&&b>c?c:b||0,i.set(0,0,b,x)}g&&g.keepHeightWhileEmpty&&!i.height()&&!(!((a=t.textConfig)===null||a===void 0)&&a.length)&&(i.y2=i.y1+((o=t.fontSize)!==null&&o!==void 0?o:12),i.x2=i.x1+2);let f=0;switch(p){case"top":f=0;break;case"middle":f=-i.height()/2;break;case"bottom":f=-i.height()}let m=0;switch(d){case"left":m=0;break;case"center":m=-i.width()/2;break;case"right":m=-i.width()}return i.translate(m,f),H.graphicService.updateTempAABBBounds(i),t.forceBoundsHeight==null&&t.forceBoundsWidth==null||H.graphicService.updateHTMLTextAABBBounds(t,e,i),H.graphicService.transformAABBBounds(t,i,e,!1,this),i.width()===0&&i.height()===0&&i.clear(),i}needUpdateTags(t){return super.needUpdateTags(t,o0)}needUpdateTag(t){return super.needUpdateTag(t,o0)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}get cliped(){const t=this.getFrameCache();if(t.actualHeight>t.height)return!0;const{disableAutoWrapLine:e}=this.attribute;if(e)for(let i=0;i<t.lines.length;i++){const n=t.lines[i];for(let r=0;r<n.paragraphs.length;r++){const a=n.paragraphs[r];if(a.overflow&&a.text!=="")return!0}}return!1}combinedStyleToCharacter(t){const{fill:e,stroke:i,fontSize:n,fontFamily:r,fontStyle:a,fontWeight:o,lineWidth:l,opacity:h,fillOpacity:c,lineHeight:u,strokeOpacity:d,upgradeAttrs:p}=this.attribute,g=Object.assign({fill:e,stroke:i,fontSize:n,fontFamily:r,fontStyle:a,fontWeight:o,lineWidth:l,opacity:h,fillOpacity:c,strokeOpacity:d},t);return p!=null&&p.lineHeight&&(g.lineHeight=u),g}doUpdateFrameCache(t){var e;const{maxWidth:i,maxHeight:n,width:r,height:a,ellipsis:o,wordBreak:l,verticalDirection:h,textAlign:c,textBaseline:u,layoutDirection:d,singleLine:p,disableAutoWrapLine:g,editable:f,ascentDescentMode:m,upgradeAttrs:v}=this.attribute,y=v&&v.multiBreakLine;let{textConfig:_=[]}=this.attribute;f&&_.length>0&&!ns.AllSingleCharacter(_)&&(_=ns.TransformTextConfig2SingleCharacter(_),this.attribute.textConfig=_);const b=[],x=t??_;for(let M=0;M<x.length;M++)if("image"in x[M]){const B=this.combinedStyleToCharacter(x[M]);B.lineWidth=void 0;const O=B.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(B.id);if(O)b.push(O);else{const E=new ss(B);E.successCallback=()=>{var L;this.addUpdateBoundTag(),(L=this.stage)===null||L===void 0||L.renderNextFrame()},E.richtextId=B.id,b.push(E)}}else{const B=this.combinedStyleToCharacter(x[M]);if(it(B.text)&&(B.text=\`\${B.text}\`),B.text&&B.text.includes(\`
\`)){const O=B.text.split(\`
\`);for(let E=0;E<O.length;E++)if(E===0)b.push(new An(O[E],!1,B,m));else if(O[E]||M===x.length-1)b.push(new An(O[E],!0,B,m));else{const L=this.combinedStyleToCharacter(x[M+1]);b.push(new An(O[E],!0,L,m))}}else B.text&&b.push(new An(B.text,!1,B,m))}const S=typeof i=="number"&&Number.isFinite(i)&&i>0,A=typeof n=="number"&&Number.isFinite(n)&&n>0,w=typeof r=="number"&&Number.isFinite(r)&&r>0&&(!S||r<=i),k=typeof a=="number"&&Number.isFinite(a)&&a>0&&(!A||a<=n),T=new Dw(0,0,(w?r:S?i:0)||0,(k?a:A?n:0)||0,o,l,h,c,u,d||"horizontal",!w&&S,!k&&A,p||!1,(e=this._frameCache)===null||e===void 0?void 0:e.icons),C=new jw(T);if(C.newLine=y,g){let M=0,B=!1;for(let O=0;O<b.length;O++){const E=b[O];B?(E.overflow=!0,E.left=1/0,E.top=1/0,!E.newLine&&T.lines[T.lines.length-1].paragraphs.push(E)):C.deal(E,!0),T.lines.length!==M&&(M=T.lines.length,C.lineBuffer.length=0,E.overflow=!0,E.left=1e3,E.top=1e3,T.lines[T.lines.length-1].paragraphs.push(E),B=!0),E.newLine&&(B=!1,C.lineWidth=0),C.send()}}else for(let M=0;M<b.length;M++)C.deal(b[M]);if(C.send(),!(T.layoutDirection==="horizontal"?w:k)){const M=T.getActualSizeWidthEllipsis();let B=T.layoutDirection==="horizontal"?M.width:M.height;(T.layoutDirection==="horizontal"?S:A)&&(B=Math.min(B,T.layoutDirection==="horizontal"?i:n)),T.lines.forEach(function(O){O.calcOffset(B,!1)})}y&&T.lines.forEach(M=>{const B=M.paragraphs;M.paragraphs=M.paragraphs.filter(O=>O.text!==""),M.paragraphs.length===0&&B.length&&(B[0].text=\`
\`,M.paragraphs.push(B[0]))}),this._frameCache=T}clone(){return new ns(Object.assign({},this.attribute))}setStage(t,e){super.setStage(t,e),this.getFrameCache().icons.forEach(i=>{i.setStage(t,e)})}bindIconEvent(){this.addEventListener("pointermove",t=>{const e=this.pickIcon(t.global);e&&e===this._currentHoverIcon||(e?this.setAttribute("hoverIconId",e.richtextId):!e&&this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0))}),this.addEventListener("pointerleave",t=>{this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0)})}updateHoverIconState(t){var e,i,n,r,a;t?((e=this._currentHoverIcon)===null||e===void 0||e.setHoverState(!1),this._currentHoverIcon=t,this._currentHoverIcon.setHoverState(!0),(i=this.stage)===null||i===void 0||i.setCursor(t.attribute.cursor),(n=this.stage)===null||n===void 0||n.renderNextFrame()):(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,(r=this.stage)===null||r===void 0||r.setCursor(),(a=this.stage)===null||a===void 0||a.renderNextFrame())}pickIcon(t){const e=this.getFrameCache(),{e:i,f:n}=this.globalTransMatrix;let r;return e.icons.forEach((a,o)=>{var l,h;const c=a.AABBBounds.clone();c.translate(a._marginArray[3],a._marginArray[0]),c.containsPoint({x:t.x-i,y:t.y-n})&&(r=a,r.globalX=((l=r.attribute.x)!==null&&l!==void 0?l:0)+i+a._marginArray[3],r.globalY=((h=r.attribute.y)!==null&&h!==void 0?h:0)+n+a._marginArray[0])}),r}getNoWorkAnimateAttr(){return ns.NOWORK_ANIMATE_ATTR}}function l0(s){return new ns(s)}ns.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},zi);const h0=["path","customPath",...Ei];class Qa extends Le{constructor(t){super(t),this.type="path",this.numberType=ah}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{path:t}=this.attribute;return t!=null&&t!==""}getParsedPathShape(){const t=this.getGraphicTheme();if(!this.valid)return t.path;const e=this.attribute;return e.path instanceof me?e.path:(I(this.cache)&&this.doUpdatePathShape(),this.cache instanceof me?this.cache:t.path)}getGraphicTheme(){return Et(this).path}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const o=this.getParsedPathShape();i.union(o.getBounds())}const{tb1:n,tb2:r}=H.graphicService.updateTempAABBBounds(i);dh(t,e,n),i.union(n),n.setValue(r.x1,r.y1,r.x2,r.y2);const{lineJoin:a=e.lineJoin}=t;return H.graphicService.transformAABBBounds(t,i,e,a==="miter",this),i}doUpdateAABBBounds(t){return this.doUpdatePathShape(),super.doUpdateAABBBounds(t)}doUpdatePathShape(){const t=this.attribute;Q(t.path,!0)?this.cache=new me().fromString(t.path):t.customPath&&(this.cache=new me,t.customPath(this.cache,this))}needUpdateTags(t){return super.needUpdateTags(t,h0)}needUpdateTag(t){return super.needUpdateTag(t,h0)}toCustomPath(){return new me().fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new Qa(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Qa.NOWORK_ANIMATE_ATTR}}function Nw(s){return new Qa(s)}Qa.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},zi);const c0=["segments","points","curveType","curveTension",...Ei];class to extends Le{constructor(t){super(t),this.type="area",this.numberType=Na}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?e.length!==0:!!t&&t.length!==0}getGraphicTheme(){return Et(this).area}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateAreaAABBBoundsBySegments(t,e,i):this.updateAreaAABBBoundsByPoints(t,e,i)),H.graphicService.updateTempAABBBounds(i);const{lineJoin:n=e.lineJoin}=t;return H.graphicService.transformAABBBounds(t,i,e,n==="miter",this),i}updateAreaAABBBoundsByPoints(t,e,i,n){const{points:r=e.points}=t,a=i;return r.forEach(o=>{var l,h;a.add(o.x,o.y),a.add((l=o.x1)!==null&&l!==void 0?l:o.x,(h=o.y1)!==null&&h!==void 0?h:o.y)}),a}updateAreaAABBBoundsBySegments(t,e,i,n){const{segments:r=e.segments}=t,a=i;return r.forEach(o=>{o.points.forEach(l=>{var h,c;a.add(l.x,l.y),a.add((h=l.x1)!==null&&h!==void 0?h:l.x,(c=l.y1)!==null&&c!==void 0?c:l.y)})}),a}_interpolate(t,e,i,n,r){t==="points"&&(r.points=Ad(i,n,e))}needUpdateTags(t){return super.needUpdateTags(t,c0)}needUpdateTag(t){return super.needUpdateTag(t,c0)}toCustomPath(){const t=new me,e=this.attribute,i=e.segments,n=r=>{if(r&&r.length){let a=!0;const o=[];if(r.forEach(l=>{var h,c;l.defined!==!1&&(a?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y),o.push({x:(h=l.x1)!==null&&h!==void 0?h:l.x,y:(c=l.y1)!==null&&c!==void 0?c:l.y}),a=!1)}),o.length){for(let l=o.length-1;l>=0;l--)t.lineTo(o[l].x,o[l].y);t.closePath()}}};return e.points?n(e.points):i&&i.length&&i.forEach(r=>{n(r.points)}),t}clone(){return new to(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return to.NOWORK_ANIMATE_ATTR}}function $d(s){return new to(s)}to.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},zi);const u0=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...Ei];class eo extends Le{constructor(t){super(t),this.type="arc",this.numberType=rh}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,outerRadius:i,innerRadius:n}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)&&this._validNumber(n)}getParsedCornerRadius(){const t=this.getGraphicTheme(),{cornerRadius:e=t.cornerRadius,innerPadding:i=t.innerPadding,outerPadding:n=t.outerPadding}=this.attribute;let{outerRadius:r=t.outerRadius,innerRadius:a=t.innerRadius}=this.attribute;if(r+=n,a-=i,e===0||e==="0%")return 0;const o=Math.abs(r-a),l=h=>Math.min(it(h,!0)?h:o*parseFloat(h)/100,o/2);if(W(e)){const h=e.map(c=>l(c)||0);return h.length===0?[h[0],h[0],h[0],h[0]]:h.length===2?[h[0],h[1],h[0],h[1]]:(h.length===3&&h.push(0),h)}return l(e)}getParsedAngle(){const t=this.getGraphicTheme();let{startAngle:e=t.startAngle,endAngle:i=t.endAngle}=this.attribute;const{cap:n=t.cap}=this.attribute,r=i-e>=0?1:-1,a=i-e;if(e=aA(e),i=e+a,n&&Rt(a)<dt-Ut){let o=1,l=1;n.length&&(o=Number(n[0]),l=Number(n[1]));let{outerRadius:h=t.outerRadius,innerRadius:c=t.innerRadius}=this.attribute;const{outerPadding:u=t.outerPadding,innerPadding:d=t.innerPadding}=this.attribute;h+=u,c-=d;const p=Math.abs(h-c)/2,g=p/h;if(p>Ut&&h>Ut)return{startAngle:e-r*g*o,endAngle:i+r*g*l,sc:r*g*o,ec:r*g*l}}return{startAngle:e,endAngle:i}}getParsePadAngle(t,e){const i=this.getGraphicTheme(),{innerPadding:n=i.innerPadding,outerPadding:r=i.outerPadding,padAngle:a=i.padAngle}=this.attribute;let{outerRadius:o=i.outerRadius,innerRadius:l=i.innerRadius}=this.attribute;o+=r,l-=n;const{padRadius:h=Ni(o*o+l*l)}=this.attribute,c=Rt(e-t);let u=t,d=e,p=t,g=e;const f=a/2;let m=c,v=c;if(f>Ut&&h>Ut){const y=e>t?1:-1;let _=If(Number(h)/l*qt(f)),b=If(Number(h)/o*qt(f));return(m-=2*_)>Ut?(_*=y,p+=_,g-=_):(m=0,p=g=(t+e)/2),(v-=2*b)>Ut?(b*=y,u+=b,d-=b):(v=0,u=d=(t+e)/2),{outerStartAngle:u,outerEndAngle:d,innerStartAngle:p,innerEndAngle:g,innerDeltaAngle:m,outerDeltaAngle:v}}return{outerStartAngle:u,outerEndAngle:d,innerStartAngle:p,innerEndAngle:g,innerDeltaAngle:m,outerDeltaAngle:v}}getGraphicTheme(){return Et(this).arc}updateAABBBounds(t,e,i,n){this.updatePathProxyAABBBounds(i)||(n?this.updateArcAABBBoundsImprecise(t,e,i):this.updateArcAABBBoundsAccurate(t,e,i));const{tb1:r,tb2:a}=H.graphicService.updateTempAABBBounds(i);dh(t,e,r),i.union(r),r.setValue(a.x1,a.y1,a.x2,a.y2);const{lineJoin:o=e.lineJoin}=t;return H.graphicService.transformAABBBounds(t,i,e,o==="miter",this),i}updateArcAABBBoundsImprecise(t,e,i){let{outerRadius:n=e.outerRadius,innerRadius:r=e.innerRadius}=t;const{outerPadding:a=e.outerPadding,innerPadding:o=e.innerPadding}=t;return n+=a,r-=o,n<r&&(n=r),i.set(-n,-n,n,n),i}updateArcAABBBoundsAccurate(t,e,i){let{outerRadius:n=e.outerRadius,innerRadius:r=e.innerRadius}=t;const{outerPadding:a=e.outerPadding,innerPadding:o=e.innerPadding}=t;if(n+=a,r-=o,n<r){const c=n;n=r,r=c}let{endAngle:l=e.endAngle,startAngle:h=e.startAngle}=t;if(h>l){const c=h;h=l,l=c}return n<=Ut?i.set(0,0,0,0):Math.abs(l-h)>dt-Ut?i.set(-n,-n,n,n):(ev(h,l,n,i),ev(h,l,r,i)),i}needUpdateTags(t){return super.needUpdateTags(t,u0)}needUpdateTag(t){return super.needUpdateTag(t,u0)}toCustomPath(){var t,e,i,n;const r=this.attribute,{startAngle:a,endAngle:o}=this.getParsedAngle();let l=((t=r.innerRadius)!==null&&t!==void 0?t:0)-((e=r.innerPadding)!==null&&e!==void 0?e:0),h=((i=r.outerRadius)!==null&&i!==void 0?i:0)-((n=r.outerPadding)!==null&&n!==void 0?n:0);const c=Rt(o-a),u=o>a;if(h<l){const p=h;h=l,l=p}const d=new me;if(h<=Ut)d.moveTo(0,0);else if(c>=dt-Ut)d.moveTo(0+h*ge(a),0+h*qt(a)),d.arc(0,0,h,a,o,!u),l>Ut&&(d.moveTo(0+l*ge(o),0+l*qt(o)),d.arc(0,0,l,o,a,u));else{const p=h*ge(a),g=h*qt(a),f=l*ge(o),m=l*qt(o);d.moveTo(0+p,0+g),d.arc(0,0,h,a,o,!u),d.lineTo(0+f,0+m),d.arc(0,0,l,o,a,u),d.closePath()}return d}clone(){return new eo(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return eo.NOWORK_ANIMATE_ATTR}}function Xd(s){return new eo(s)}eo.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},zi);const d0=["points","cornerRadius",...Ei];class io extends Le{constructor(t){super(t),this.type="polygon",this.numberType=oh}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{points:t}=this.attribute;return t&&t.length>=2}getGraphicTheme(){return Et(this).polygon}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||this.updatePolygonAABBBoundsImprecise(t,e,i),H.graphicService.updateTempAABBBounds(i);const{lineJoin:n=e.lineJoin}=t;return H.graphicService.transformAABBBounds(t,i,e,n==="miter",this),i}updatePolygonAABBBoundsImprecise(t,e,i){const{points:n=e.points}=t;return n.forEach(r=>{i.add(r.x,r.y)}),i}_interpolate(t,e,i,n,r){t==="points"&&(r.points=Ad(i,n,e))}needUpdateTags(t){return super.needUpdateTags(t,d0)}needUpdateTag(t){return super.needUpdateTag(t,d0)}toCustomPath(){const t=this.attribute.points,e=new me;return t.forEach((i,n)=>{n===0?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)}),e.closePath(),e}clone(){return new io(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return io.NOWORK_ANIMATE_ATTR}}function zw(s){return new io(s)}io.NOWORK_ANIMATE_ATTR=zi;class Hw extends Ss{constructor(t){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=t}clearUpdateBoundTag(){super.clearUpdateBoundTag(),this.shadowHost&&this.shadowHost.clearUpdateBoundTag()}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];if(this.shouldUpdateGlobalMatrix()){const e=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f):this._globalTransMatrix=e.clone(),this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){const t=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}}function Vw(s){return new Hw(s)}const gt=new class{constructor(){this.store=new Map}RegisterGraphicCreator(s,t){this.store.set(s,t),this[s]=t}CreateGraphic(s,t){const e=this.store.get(s);return e?e(t):null}};let mh,vh;function Kd(s){return mh||(mh=gt.CreateGraphic("text",{})),mh.initAttributes(s),mh.AABBBounds}var Ww=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},Uw=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},p0=function(s,t){return function(e,i){t(e,i,s)}};class yh{constructor(){this.time=be.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,r,a,o,l,h,c,u,d,p){var g;const{background:f,backgroundOpacity:m=(g=t.attribute.fillOpacity)!==null&&g!==void 0?g:h.backgroundOpacity,opacity:v=h.opacity,backgroundMode:y=h.backgroundMode,backgroundFit:_=h.backgroundFit,backgroundKeepAspectRatio:b=h.backgroundKeepAspectRatio,backgroundScale:x=h.backgroundScale,backgroundOffsetX:S=h.backgroundOffsetX,backgroundOffsetY:A=h.backgroundOffsetY,backgroundClip:w=h.backgroundClip}=t.attribute;if(f)if(t.backgroundImg&&t.resources){const k=t.resources.get(f);if(k.state!=="success"||!k.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){const C=Et(t.parent).group,{scrollX:M=C.scrollX,scrollY:B=C.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(M,B)}w&&e.clip();const T=t.AABBBounds;e.setCommonStyle(t,t.attribute,i,n,h),e.globalAlpha=m*v,this.doDrawImage(e,k.data,T,{backgroundMode:y,backgroundFit:_,backgroundKeepAspectRatio:b,backgroundScale:x,backgroundOffsetX:S,backgroundOffsetY:A}),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,n,h),e.globalAlpha=m*v,e.fillStyle=f,e.fill(),e.highPerformanceRestore()}doDrawImage(t,e,i,n){const{backgroundMode:r,backgroundFit:a,backgroundKeepAspectRatio:o,backgroundScale:l=1,backgroundOffsetX:h=0,backgroundOffsetY:c=0}=n,u=i.width(),d=i.height();let p=u,g=d;if(r==="no-repeat")if(a)if(o){const f=Math.max(u/e.width,d/e.height);t.drawImage(e,i.x1+h,i.y1+c,e.width*f*l,e.height*f*l)}else t.drawImage(e,i.x1,i.y1,i.width(),i.height());else{const f=e.width*l,m=e.height*l;t.drawImage(e,i.x1+h,i.y1+c,f,m)}else{if(a&&r!=="repeat"&&(e.width||e.height)){const v=e.width,y=e.height;r==="repeat-x"?(p=v*(d/y),g=d):r==="repeat-y"&&(g=y*(u/v),p=u);const _=t.dpr,b=_n.allocate({width:p,height:g,dpr:_}),x=b.getContext("2d");x&&(x.inuse=!0,x.clearMatrix(),x.setTransformForCurrent(!0),x.clearRect(0,0,p,g),x.drawImage(e,0,0,p,g),e=b.nativeCanvas),_n.free(b)}const f=t.dpr,m=t.createPattern(e,r);m.setTransform&&m.setTransform(new DOMMatrix([1/f,0,0,1/f,0,0])),t.fillStyle=m,t.translate(i.x1,i.y1),t.fillRect(0,0,u,d),t.translate(-i.x1,-i.y1)}}}const vr=new yh;let rs=class{constructor(s){this.subRenderContribitions=s,this.time=be.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(s,t,e,i,n,r,a,o,l,h,c,u,d){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach(p=>{p.render(s,t,e,i,n,r,a,o,l,h,c,u,d)})}};rs=Ww([nt(),p0(0,At(Jt)),p0(0,ae(Zv)),Uw("design:paramtypes",[Object])],rs);const Gw=new class{constructor(){this.time=be.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(s,t,e,i,n,r,a,o,l,h,c,u,d){var p,g;const{clipConfig:f}=s.attribute;if(!f)return;const m=s.getClipPath();if(!m)return;const v=!(c||u),y=s.AABBBounds,_=(p=s.attribute.width)!==null&&p!==void 0?p:y.width(),b=(g=s.attribute.height)!==null&&g!==void 0?g:y.height();v&&t.save(),t.beginPath(),m.draw(t,[_,b],e+_/2,i+b/2,0)===!1&&t.closePath(),c&&c(t,s.attribute,l,!0),v&&t.clip()}},Yw=new class{constructor(){this.time=be.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(s,t,e,i,n,r,a,o,l,h,c,u,d){const{clipConfig:p}=s.attribute;p&&s.getClipPath()&&(c||u||t.restore())}};class qd{constructor(){this.time=be.afterFillStroke,this.useStyle=!0,this.order=10,this._tempSymbolGraphic=null}createCommonPattern(t,e,i,n,r){const a=(t-2*e)/2,o=n.dpr,l=_n.allocate({width:t,height:t,dpr:o}),h=l.getContext("2d");if(!h)return null;h.inuse=!0,h.clearMatrix(),h.setTransformForCurrent(!0),h.clearRect(0,0,t,t),r(a,h);const c=n.createPattern(l.nativeCanvas,"repeat");return c.setTransform&&c.setTransform(new DOMMatrix([1/o,0,0,1/o,0,0])),_n.free(l),c}createCirclePattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,(r,a)=>{a.fillStyle=i,a.arc(r,r,r,0,dt),a.fill()})}createDiamondPattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,(r,a)=>{const o=t/2,l=o;a.fillStyle=i,a.moveTo(o,l-r),a.lineTo(r+o,l),a.lineTo(o,l+r),a.lineTo(o-r,l),a.closePath(),a.fill()})}createRectPattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,(r,a)=>{const o=e,l=o;a.fillStyle=i,a.fillRect(o,l,2*r,2*r)})}createVerticalLinePattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,(r,a)=>{const o=e;a.fillStyle=i,a.fillRect(o,0,2*r,t)})}createHorizontalLinePattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,(r,a)=>{const o=e;a.fillStyle=i,a.fillRect(0,o,t,2*r)})}createBiasLRLinePattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,(r,a)=>{a.strokeStyle=i,a.lineWidth=r,a.moveTo(0,0),a.lineTo(t,t);const o=t/2,l=-o;a.moveTo(o,l),a.lineTo(o+t,l+t),a.moveTo(-o,-l),a.lineTo(-o+t,-l+t),a.stroke()})}createBiasRLLinePattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,(r,a)=>{a.strokeStyle=i,a.lineWidth=r,a.moveTo(t,0),a.lineTo(0,t);const o=t/2,l=o;a.moveTo(t+o,l),a.lineTo(o,l+t),a.moveTo(t-o,-l),a.lineTo(-o,-l+t),a.stroke()})}createGridPattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,(r,a)=>{const o=e,l=o;a.fillStyle=i,a.fillRect(o,l,r,r),a.fillRect(o+r,l+r,r,r)})}initTextureMap(t,e){this.textureMap=new Map}drawShape(t,e,i,n,r,a,o,l,h,c,u,d,p){this.textureMap||this.initTextureMap(e,t.stage);const{texture:g=h.texture,textureColor:f=h.textureColor,textureSize:m=h.textureSize,texturePadding:v=h.texturePadding}=t.attribute;g&&this.drawTexture(g,t,e,i,n,h,f,m,v)}drawTexture(t,e,i,n,r,a,o,l,h){var c;const{textureRatio:u=a.textureRatio,textureOptions:d=null}=e.attribute;let p=this.textureMap.get(t);if(!p)switch(t){case"circle":p=this.createCirclePattern(l,h,o,i);break;case"diamond":p=this.createDiamondPattern(l,h,o,i);break;case"rect":p=this.createRectPattern(l,h,o,i);break;case"vertical-line":p=this.createVerticalLinePattern(l,h,o,i);break;case"horizontal-line":p=this.createHorizontalLinePattern(l,h,o,i);break;case"bias-lr":p=this.createBiasLRLinePattern(l,h,o,i);break;case"bias-rl":p=this.createBiasRLLinePattern(l,h,o,i);break;case"grid":p=this.createGridPattern(l,h,o,i)}if(d&&d.dynamicTexture){const{gridConfig:g={},useNewCanvas:f}=d,m=e.AABBBounds;n=m.x1,r=m.y1;const v=i;let y;if(f){y=_n.allocate({width:m.width(),height:m.height(),dpr:i.dpr});const O=y.getContext("2d");O.clearRect(0,0,m.width(),m.height()),n=0,r=0,i=O}if(v.save(),e.parent&&!e.transMatrix.onlyTranslate()){const{scrollX:O=0,scrollY:E=0}=e.parent.attribute;v.setTransformFromMatrix(e.parent.globalTransMatrix),v.translate(O,E,!0)}v.setCommonStyle(e,e.attribute,n,r,a),v.clip();const _=m.width(),b=m.height(),x=h,S=l,A=g.columns?g.columns:Math.ceil(_/S),w=g.rows?g.rows:Math.ceil(b/S),k=g.gutterColumn?g.gutterColumn:2*x,T=g.gutterRow?g.gutterRow:2*x;this._tempSymbolGraphic||(this._tempSymbolGraphic=gh({}));const C=g.columns?_/g.columns:S,M=g.rows?b/g.rows:S;this._tempSymbolGraphic.setAttributes({size:[C-k,M-T],symbolType:t});const B=this._tempSymbolGraphic.getParsedPath();for(let O=0;O<w;O++)for(let E=0;E<A;E++){const L=n+S/2+E*S,P=r+S/2+O*S;(c=d.beforeDynamicTexture)===null||c===void 0||c.call(d,i,O,E,w,A,u,e,m.width(),m.height()),i.beginPath(),B.draw(i,Math.min(C-k,M-T),L,P,0)===!1&&i.closePath(),i.fillStyle=o,d.dynamicTexture(i,O,E,w,A,u,e,m.width(),m.height())}f&&(v.globalAlpha=1,v.drawImage(y.nativeCanvas,0,0,y.nativeCanvas.width,y.nativeCanvas.height,m.x1,m.y1,m.width()*v.dpr,m.height()*v.dpr)),v.restore()}else if(p)i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,n,r,a),i.fillStyle=p,i.fill(),i.highPerformanceRestore();else if(t==="wave"){i.save(),i.setCommonStyle(e,e.attribute,n,r,a),i.clip();const g=e.AABBBounds;(function(f,m,v,y,_,b,x){const{fill:S="orange",percent:A=.6,frequency:w=4,opacity:k,phi:T=0}=_;let{amplitude:C=10}=_;C*=function(P){return P<=.5?4*P-1:-4*P+3}(m);const M=y*(1-A),B=v,O=Math.max(Math.round(B/70),2);f.beginPath(),f.moveTo(0+b,y+x),f.lineTo(0+b,M+x);const E=B/w*m,L=B/Math.PI/(2*w);for(let P=0;P<B;P+=O){const F=C*Math.sin((P+E+T)/L+T);f.lineTo(P+b,M+F+x)}f.lineTo(B+b,y+x),f.closePath(),f.fillStyle=S,isFinite(k)&&(f.globalAlpha=k),f.fill()})(i,u,g.width(),g.height(),Object.assign(Object.assign({},d||{}),{fill:o}),n+g.x1-n,r+g.y1-r),i.restore()}}}const so=new qd,$w=new class{constructor(){this.time=be.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(s,t,e,i,n,r,a,o,l,h,c,u){const{outerBorder:d,innerBorder:p}=s.attribute,g=d&&d.visible!==!1,f=p&&p.visible!==!1;if(!g&&!f)return;const{innerPadding:m=l.innerPadding,outerPadding:v=l.outerPadding,startAngle:y=l.startAngle,endAngle:_=l.endAngle,opacity:b=l.opacity,x=l.x,y:S=l.y,scaleX:A=l.scaleX,scaleY:w=l.scaleY,keepStrokeScale:k=l.keepStrokeScale}=s.attribute;let{innerRadius:T=l.innerRadius,outerRadius:C=l.outerRadius}=s.attribute;C+=v,T-=m;const M=(B,O)=>{const E=!(!B||!B.stroke),{distance:L=l[O].distance}=B,P=k?L:ms(t,L,t.dpr),F=L/C,j=O==="outerBorder"?1:-1;if(s.setAttributes({outerRadius:C+j*P,innerRadius:T-j*P,startAngle:y-j*F,endAngle:_+j*F}),t.beginPath(),Pd(s,t,e,i,C+j*P,T-j*P),t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,l),u)u(t,B,l[O]);else if(E){const D=l[O].opacity;l[O].opacity=b,t.setStrokeStyle(s,B,(x-e)/A,(S-i)/w,l[O]),l[O].opacity=D,t.stroke()}};g&&M(d,"outerBorder"),f&&M(p,"innerBorder"),s.setAttributes({outerRadius:C,innerRadius:T,startAngle:y,endAngle:_})}},Xw=so,Kw=vr,qw=new class extends yh{constructor(){super(...arguments),this.time=be.beforeFillStroke}drawShape(s,t,e,i,n,r,a,o,l,h,c,u){const{background:d,backgroundMode:p=l.backgroundMode,backgroundFit:g=l.backgroundFit,backgroundKeepAspectRatio:f=l.backgroundKeepAspectRatio,backgroundScale:m=l.backgroundScale,backgroundOffsetX:v=l.backgroundOffsetX,backgroundOffsetY:y=l.backgroundOffsetY}=s.attribute;if(d)if(s.backgroundImg&&s.resources){const _=s.resources.get(d);if(_.state!=="success"||!_.data)return;t.highPerformanceSave(),t.setTransformFromMatrix(s.parent.globalTransMatrix,!0);const b=s.AABBBounds;this.doDrawImage(t,_.data,b,{backgroundMode:p,backgroundFit:g,backgroundKeepAspectRatio:f,backgroundScale:m,backgroundOffsetX:v,backgroundOffsetY:y}),t.highPerformanceRestore(),t.setTransformForCurrent()}else t.highPerformanceSave(),t.fillStyle=d,t.fill(),t.highPerformanceRestore()}},_h=Gt/2;function yr(s,t,e,i,n,r){let a,o=!(arguments.length>6&&arguments[6]!==void 0)||arguments[6],l=arguments.length>7?arguments[7]:void 0;if(Array.isArray(o)&&(l=o,o=!0),i<0&&(t+=i,i=-i),n<0&&(e+=n,n=-n),it(r,!0))a=[r=Rt(r),r,r,r];else if(Array.isArray(r)){const A=r;let w,k;switch(A.length){case 0:a=[0,0,0,0];break;case 1:w=Rt(A[0]),a=[w,w,w,w];break;case 2:case 3:w=Rt(A[0]),k=Rt(A[1]),a=[w,k,w,k];break;default:a=A,a[0]=Rt(a[0]),a[1]=Rt(a[1]),a[2]=Rt(a[2]),a[3]=Rt(a[3])}}else a=[0,0,0,0];if(i<0||a[0]+a[1]+a[2]+a[3]<1e-12)return s.rect(t,e,i,n);const[h,c,u,d]=[[t,e],[t+i,e],[t+i,e+n],[t,e+n]],p=Math.min(i/2,n/2),g=[Math.min(p,a[0]),Math.min(p,a[1]),Math.min(p,a[2]),Math.min(p,a[3])],f=[h[0]+g[0],h[1]],m=[h[0],h[1]+g[0]],v=[c[0]-g[1],c[1]],y=[c[0],c[1]+g[1]],_=[u[0]-g[2],u[1]],b=[u[0],u[1]-g[2]],x=[d[0]+g[3],d[1]],S=[d[0],d[1]-g[3]];if(s.moveTo(f[0],f[1]),o){if(l&&l[0]?l[0](f[0],f[1],v[0],v[1]):s.lineTo(v[0],v[1]),!fl(v,y)){l&&l[0]&&s.moveTo(v[0],v[1]);const A=v[0],w=v[1]+g[1];s.arc(A,w,g[1],-_h,0,!1)}if(l&&l[1]?l[1](y[0],y[1],b[0],b[1]):s.lineTo(b[0],b[1]),!fl(_,b)){const A=b[0]-g[2],w=b[1];l&&l[1]&&s.moveTo(b[0],b[1]),s.arc(A,w,g[2],0,_h,!1)}if(l&&l[2]?l[2](_[0],_[1],x[0],x[1]):s.lineTo(x[0],x[1]),!fl(x,S)){const A=x[0],w=x[1]-g[3];l&&l[2]&&s.moveTo(x[0],x[1]),s.arc(A,w,g[3],_h,Gt,!1)}if(l&&l[3]?l[3](S[0],S[1],m[0],m[1]):s.lineTo(m[0],m[1]),!fl(f,m)){const A=f[0],w=f[1]+g[0];l&&l[3]&&s.moveTo(m[0],m[1]),s.arc(A,w,g[0],Gt,Gt+_h,!1)}}else l&&l[0]?l[0](f[0],f[1],v[0],v[1]):s.lineTo(v[0],v[1]),l&&l[1]?l[1](v[0],v[1],_[0],_[1]):s.lineTo(_[0],_[1]),l&&l[2]?l[2](_[0],_[1],x[0],x[1]):s.lineTo(x[0],x[1]),l&&l[2]?l[2](x[0],x[1],f[0],f[1]):s.lineTo(f[0],f[1]);return!l&&s.closePath(),s}var g0=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};let bh=class{constructor(){this.time=be.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(s,t,e,i,n,r,a,o,l,h,c,u,d){const{stroke:p=l.stroke}=s.attribute;Array.isArray(p)&&p.some(g=>g===!1)&&(d.doStroke=!1)}};bh=g0([nt()],bh);let xh=class{constructor(){this.time=be.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(s,t,e,i,n,r,a,o,l,h,c,u){const{x1:d,y1:p,x:g=l.x,y:f=l.y,stroke:m=l.stroke,cornerRadius:v=l.cornerRadius,cornerType:y=l.cornerType}=s.attribute;let{width:_,height:b}=s.attribute;if(_=(_??d-g)||0,b=(b??p-f)||0,Array.isArray(m)&&m.some(x=>x===!1)){if(t.setStrokeStyle(s,s.attribute,e,i,l),!(v===0||W(v)&&v.every(x=>x===0))){let x,S=0;return yr(t,e,i,_,b,v,y!=="bevel",new Array(4).fill(0).map((A,w)=>(k,T,C,M)=>{m[w]&&(S===w-1&&m[w]===x||(t.setStrokeStyle(s,Object.assign(Object.assign({},s.attribute),{stroke:m[w]}),e,i,l),t.beginPath(),t.moveTo(k,T),x=m[w]),S=w,t.lineTo(C,M),t.stroke(),w===3&&t.beginPath())})),void t.stroke()}if(t.beginPath(),t.moveTo(e,i),m[0]?t.lineTo(e+_,i):t.moveTo(e+_,i),m[1]?t.lineTo(e+_,i+b):t.moveTo(e+_,i+b),m[2]?t.lineTo(e,i+b):t.moveTo(e,i+b),m[3]){const x=m[0]?i-t.lineWidth/2:i;t.lineTo(e,x)}else t.moveTo(e,i);t.stroke()}}};xh=g0([nt()],xh);const Zw=new class{constructor(){this.time=be.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(s,t,e,i,n,r,a,o,l,h,c,u){const{outerBorder:d,innerBorder:p}=s.attribute,g=d&&d.visible!==!1,f=p&&p.visible!==!1;if(!g&&!f)return;const{cornerRadius:m=l.cornerRadius,cornerType:v=l.cornerType,opacity:y=l.opacity,x:_=l.x,y:b=l.y,scaleX:x=l.scaleX,scaleY:S=l.scaleY,x1:A,y1:w,keepStrokeScale:k=l.keepStrokeScale}=s.attribute;let{width:T,height:C}=s.attribute;T=(T??A-e)||0,C=(C??w-i)||0;const M=(B,O)=>{const E=!(!B||!B.stroke),L=O==="outerBorder"?-1:1,{distance:P=l[O].distance}=B,F=k?P:ms(t,P,t.dpr),j=e+L*F,D=i+L*F,N=2*F;if(m===0||W(m)&&m.every(J=>J===0)?(t.beginPath(),t.rect(j,D,T-L*N,C-L*N)):(t.beginPath(),yr(t,j,D,T-L*N,C-L*N,m,v!=="bevel")),t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,l),u)u(t,B,l[O]);else if(E){const J=l[O].opacity;l[O].opacity=y,t.setStrokeStyle(s,B,(_-e)/x,(b-i)/S,l[O]),l[O].opacity=J,t.stroke()}};g&&M(d,"outerBorder"),f&&M(p,"innerBorder")}},Jw=so,Qw=vr,tT=new class{constructor(){this.time=be.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(s,t,e,i,n,r,a,o,l,h,c,u){const d=s.getParsedPath();if(!d)return;const{outerBorder:p,innerBorder:g}=s.attribute,f=p&&p.visible!==!1,m=g&&g.visible!==!1;if(!f&&!m)return;const{size:v=l.size,opacity:y=l.opacity,x:_=l.x,y:b=l.y,scaleX:x=l.scaleX,scaleY:S=l.scaleY,keepStrokeScale:A=l.keepStrokeScale}=s.attribute,w=(k,T)=>{const C=!(!k||!k.stroke),{distance:M=l[T].distance}=k,B=A?M:ms(t,M,t.dpr),O=T==="outerBorder"?1:-1;if(t.beginPath(),d.drawOffset(t,v,e,i,O*B)===!1&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,l),u)u(t,k,l[T]);else if(C){const E=l[T].opacity;l[T].opacity=y,t.setStrokeStyle(s,k,(_-e)/x,(b-i)/S,l[T]),l[T].opacity=E,t.stroke()}};f&&w(p,"outerBorder"),m&&w(g,"innerBorder")}},eT=new class{constructor(){this.time=be.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(s,t,e,i,n,r,a,o,l,h,c,u,d){const{clipRange:p=l.clipRange,x:g=l.x,y:f=l.y,z:m=l.z,size:v=l.size,scaleX:y=l.scaleX,scaleY:_=l.scaleY}=s.attribute,b=s.getParsedPath();b&&p<1&&p>0&&(t.beginPath(),b.drawWithClipRange&&b.drawWithClipRange(t,v,e,i,p,m,(x,S)=>{var A,w,k,T;if(s._parsedPath.svgCache){const C=Object.assign({},S);C.fill=(A=S.fill)!==null&&A!==void 0?A:s.attribute.fill,C.opacity=(w=S.opacity)!==null&&w!==void 0?w:s.attribute.opacity,C.fillOpacity=s.attribute.fillOpacity,C.stroke=(k=S.stroke)!==null&&k!==void 0?k:s.attribute.stroke,C.lineWidth=(T=S.lineWidth)!==null&&T!==void 0?T:s.attribute.lineWidth,S=C}S.stroke&&(u?u(t,s.attribute,l):o&&(t.setStrokeStyle(s,S,(g-e)/y,(f-i)/_,l),t.stroke()))}),r&&!b.isSvg&&(u?u(t,s.attribute,l):o&&(t.setStrokeStyle(s,s.attribute,(g-e)/y,(f-i)/_,l),t.stroke())))}},iT=so,sT=vr,le={x:0,y:0,z:0,lastModelMatrix:null};class Vi{init(t){t&&(this._renderContribitions=t.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions||(this.builtinContributions=[]),this.builtinContributions.push(Gw),this.builtinContributions.push(Yw),this.builtinContributions.forEach(e=>this._renderContribitions.push(e)),this._renderContribitions.length&&(this._renderContribitions.sort((e,i)=>i.order-e.order),this._beforeRenderContribitions=this._renderContribitions.filter(e=>e.time===be.beforeFillStroke),this._afterRenderContribitions=this._renderContribitions.filter(e=>e.time===be.afterFillStroke))}beforeRenderStep(t,e,i,n,r,a,o,l,h,c,u,d,p){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach(g=>{g.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(g.supportedAppName)?g.supportedAppName:[g.supportedAppName]).includes(t.stage.params.context.appName)||g.drawShape(t,e,i,n,r,a,o,l,h,c,u,d,p)})}afterRenderStep(t,e,i,n,r,a,o,l,h,c,u,d,p){this._afterRenderContribitions&&this._afterRenderContribitions.forEach(g=>{g.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(g.supportedAppName)?g.supportedAppName:[g.supportedAppName]).includes(t.stage.params.context.appName)||g.drawShape(t,e,i,n,r,a,o,l,h,c,u,d,p)})}drawPathProxy(t,e,i,n,r,a,o,l){if(!t.pathProxy)return!1;const h=Et(t,a==null?void 0:a.theme)[t.type.replace("3d","")],{fill:c=h.fill,stroke:u=h.stroke,opacity:d=h.opacity,fillOpacity:p=h.fillOpacity,lineWidth:g=h.lineWidth,strokeOpacity:f=h.strokeOpacity,visible:m=h.visible,x:v=h.x,y=h.y}=t.attribute,_=xn(d,p,c),b=Od(d,f),x=mr(c),S=Ua(u,g);return!m||!x&&!S||!(_||b||o||l)?!0:(e.beginPath(),gs((typeof t.pathProxy=="function"?t.pathProxy(t.attribute):t.pathProxy).commandList,e,i,n),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,n,x,S,_,b,h,r,o,l),S&&(l?l(e,t.attribute,h):b&&(e.setStrokeStyle(t,t.attribute,i-v,n-y,h),e.stroke())),x&&(o?o(e,t.attribute,h):_&&(e.setCommonStyle(t,t.attribute,i-v,n-y,h),e.fill())),this.afterRenderStep(t,e,i,n,x,S,_,b,h,r,o,l),!0)}valid(t,e,i,n){const{fill:r=e.fill,background:a,stroke:o=e.stroke,opacity:l=e.opacity,fillOpacity:h=e.fillOpacity,lineWidth:c=e.lineWidth,strokeOpacity:u=e.strokeOpacity,visible:d=e.visible}=t.attribute,p=xn(l,h,r),g=Od(l,u),f=mr(r,a),m=Ua(o,c);return!(!t.valid||!d)&&!(!f&&!m)&&!!(p||g||i||n||a)&&{fVisible:p,sVisible:g,doFill:f,doStroke:m}}transform(t,e,i){let n=arguments.length>3&&arguments[3]!==void 0&&arguments[3];const{x:r=e.x,y:a=e.y,z:o=e.z,scaleX:l=e.scaleX,scaleY:h=e.scaleY,angle:c=e.angle,postMatrix:u}=t.attribute,d=i.modelMatrix,p=i.camera;le.x=r,le.y=a,le.z=o,le.lastModelMatrix=d;const g=p&&(n||function(m){const{alpha:v,beta:y}=m.attribute;return v||y}(t)),f=g?t.transMatrix.onlyTranslate()&&!u:l===1&&h===1&&c===0&&!u;if(g){const m=ye.allocate(),v=ye.allocate();Qv(v,t,e),Xa(m,d||m,v),le.x=0,le.y=0,le.z=0,i.modelMatrix=m,i.setTransform(1,0,0,1,0,0,!0),ye.free(v)}if(f&&!d){const m=t.getOffsetXY(e);le.x+=m.x,le.y+=m.y,le.z=o,i.setTransformForCurrent()}else if(g)le.x=0,le.y=0,le.z=0,i.setTransform(1,0,0,1,0,0,!0);else if(p&&i.project){const m=t.getOffsetXY(e);le.x+=m.x,le.y+=m.y,this.transformWithoutTranslate(i,le.x,le.y,le.z,l,h,c)}else i.transformFromMatrix(t.transMatrix,!0),le.x=0,le.y=0,le.z=0;return le}transformUseContext2d(t,e,i,n){const r=n.camera;if(this.camera=r,r){const a=t.AABBBounds,o=a.x2-a.x1,l=a.y2-a.y1,h=n.project(0,0,i),c=n.project(o,0,i),u=n.project(o,l,i),d={x:0,y:0},p={x:o,y:0},g={x:o,y:l};n.camera=null;const f=1/(d.x*(g.y-p.y)-p.x*g.y+g.x*p.y+(p.x-g.x)*d.y),m=-(d.y*(u.x-c.x)-p.y*u.x+g.y*c.x+(p.y-g.y)*h.x)*f,v=(p.y*u.y+d.y*(c.y-u.y)-g.y*c.y+(g.y-p.y)*h.y)*f,y=(d.x*(u.x-c.x)-p.x*u.x+g.x*c.x+(p.x-g.x)*h.x)*f,_=-(p.x*u.y+d.x*(c.y-u.y)-g.x*c.y+(g.x-p.x)*h.y)*f,b=(d.x*(g.y*c.x-p.y*u.x)+d.y*(p.x*u.x-g.x*c.x)+(g.x*p.y-p.x*g.y)*h.x)*f,x=(d.x*(g.y*c.y-p.y*u.y)+d.y*(p.x*u.y-g.x*c.y)+(g.x*p.y-p.x*g.y)*h.y)*f;n.setTransform(m,v,y,_,b,x,!0)}}restoreTransformUseContext2d(t,e,i,n){this.camera&&(n.camera=this.camera)}transformWithoutTranslate(t,e,i,n,r,a,o){const l=t.project(e,i,n);t.translate(l.x,l.y,!1),t.scale(r,a,!1),t.rotate(o,!1),t.translate(-l.x,-l.y,!1),t.setTransformForCurrent()}_draw(t,e,i,n,r){const{context:a}=n;if(!a)return;const{renderable:o}=t.attribute;if(o===!1)return;a.highPerformanceSave();const l=this.transform(t,e,a,i),{x:h,y:c,z:u,lastModelMatrix:d}=l;this.z=u,this.drawPathProxy(t,a,h,c,n,r)||(this.drawShape(t,a,h,c,n,r),this.z=0,a.modelMatrix!==d&&ye.free(a.modelMatrix),a.modelMatrix=d),a.highPerformanceRestore()}}var nT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},rT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},f0=function(s,t){return function(e,i){t(e,i,s)}};let Sh=class extends Vi{constructor(s){super(),this.arcRenderContribitions=s,this.numberType=rh,this.builtinContributions=[$w,Kw,Xw],this.init(s)}drawArcTailCapPath(s,t,e,i,n,r,a,o){const l=o-a,h=s.getParsedAngle(),c=h.startAngle;let u=h.endAngle;u=o;const d=u>c;let p=!1;if(n<r){const L=n;n=r,r=L}const{xors:g,yors:f,xirs:m,yirs:v,limitedOcr:y,outerCornerRadiusStart:_,outerCornerRadiusEnd:b,maxOuterCornerRadius:x,xore:S,yore:A,xire:w,yire:k,limitedIcr:T,innerDeltaAngle:C,innerStartAngle:M,innerCornerRadiusStart:B,innerCornerRadiusEnd:O,maxInnerCornerRadius:E}=Kv(s,c,u,r,n);if(y>Ut){const L=ke(_,y),P=ke(b,y),F=zs(m,v,g,f,n,L,Number(d)),j=zs(S,A,w,k,n,P,Number(d));if(y<x&&L===P)t.moveTo(e+F.cx+F.x01,i+F.cy+F.y01),t.arc(e+F.cx,i+F.cy,y,Ot(F.y01,F.x01),Ot(j.y01,j.x01),!d);else{const D=u-l-.03,N=Ot(j.y11,j.x11);t.arc(e,i,n,D,N,!d),P>0&&t.arc(e+j.cx,i+j.cy,P,Ot(j.y11,j.x11),Ot(j.y01,j.x01),!d)}}else t.moveTo(e+g,i+f);if(!(r>Ut)||C<.001)t.lineTo(e+w,i+k),p=!0;else if(T>Ut){const L=ke(B,T),P=ke(O,T),F=zs(w,k,S,A,r,-P,Number(d)),j=zs(g,f,m,v,r,-L,Number(d));if(t.lineTo(e+F.cx+F.x01,i+F.cy+F.y01),T<E&&L===P){const D=Ot(j.y01,j.x01);t.arc(e+F.cx,i+F.cy,T,Ot(F.y01,F.x01),D,!d)}else{P>0&&t.arc(e+F.cx,i+F.cy,P,Ot(F.y01,F.x01),Ot(F.y11,F.x11),!d);const D=Ot(F.cy+F.y11,F.cx+F.x11),N=u-l-.03;t.arc(e,i,r,D,N,d)}}else t.lineTo(e+r*ge(M),i+r*qt(M));return p}drawShape(s,t,e,i,n,r,a,o){const l=Et(s,r==null?void 0:r.theme).arc,{fill:h=l.fill,stroke:c=l.stroke,x:u=l.x,y:d=l.y,fillStrokeOrder:p=l.fillStrokeOrder}=s.attribute,g=this.valid(s,l,a,o);if(!g)return;const{fVisible:f,sVisible:m,doFill:v,doStroke:y}=g,{outerPadding:_=l.outerPadding,innerPadding:b=l.innerPadding,cap:x=l.cap,forceShowCap:S=l.forceShowCap}=s.attribute;let{outerRadius:A=l.outerRadius,innerRadius:w=l.innerRadius}=s.attribute;A+=_,w-=b;let k=0;const T=(pe(x)&&x||x[0])&&h.gradient==="conical";if(T){const{sc:O,startAngle:E,endAngle:L}=s.getParsedAngle();Rt(L-E)<dt-Ut&&(k=O||0,h.startAngle-=k,h.endAngle-=k)}let C=!1;const{isFullStroke:M,stroke:B}=(O=>{var E;let L=!0;if(pe(O,!0)){for(let P=0;P<4;P++)_s[P]=O,L&&(L=!((E=_s[P])!==null&&E!==void 0&&!E));L=O}else if(Array.isArray(O))for(let P=0;P<4;P++)_s[P]=!!O[P],L&&(L=!!_s[P]);else _s[0]=!1,_s[1]=!1,_s[2]=!1,_s[3]=!1;return{isFullStroke:L,stroke:_s}})(c);if(v||M){t.beginPath(),Pd(s,t,e,i,A,w),C=!0,t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,l),this.beforeRenderStep(s,t,e,i,v,y,f,m,l,n,a,o);const O=()=>{v&&(a?a(t,s.attribute,l):f&&(t.setCommonStyle(s,s.attribute,u-e,d-i,l),t.fill()))},E=()=>{y&&M&&(o?o(t,s.attribute,l):m&&(t.setStrokeStyle(s,s.attribute,u-e,d-i,l),t.stroke()))};p?(E(),O()):(O(),E())}if(!M&&y&&(t.beginPath(),Pd(s,t,e,i,A,w,B),C||this.beforeRenderStep(s,t,e,i,v,y,f,m,l,n,a,o),o?o(t,s.attribute,l):m&&(t.setStrokeStyle(s,s.attribute,e,i,l),t.stroke())),(pe(x)&&x||x[1])&&S){const{startAngle:O,endAngle:E}=s.getParsedAngle();if(Rt(E-O)>=dt-Ut){t.beginPath();const L=Math.abs(A-w)/2/A,{endAngle:P=l.endAngle,fill:F=l.fill}=s.attribute,j=P;this.drawArcTailCapPath(s,t,e,i,A,w,j,j+L),C||this.beforeRenderStep(s,t,e,i,v,y,f,m,l,n,a,o);const D=()=>{if(v){const J=F;if(J.gradient==="conical"){const X=function($,G,z,ot){const{stops:ft,startAngle:ut,endAngle:tt}=ot;for(;z<0;)z+=dt;for(;z>dt;)z-=dt;if(z<ut||z>tt)return ft[0].color;let lt,Mt,Pt=(z-ut)/(tt-ut);for(let Dt=0;Dt<ft.length;Dt++)if(ft[Dt].offset>=Pt){lt=ft[Dt-1],Mt=ft[Dt];break}return Pt=(Pt-lt.offset)/(Mt.offset-lt.offset),gr(lt.color,Mt.color,Pt,!1)}(0,0,P,J);a||xn&&(t.setCommonStyle(s,s.attribute,e,i,l),t.fillStyle=X,t.fill())}}},N=()=>{y&&(o||m&&(t.setStrokeStyle(s,s.attribute,e,i,l),t.stroke()))};D(),N()}}this.afterRenderStep(s,t,e,i,v,y,f,m,l,n,a,o),T&&(h.startAngle+=k,h.endAngle+=k)}draw(s,t,e,i){const n=Et(s,i==null?void 0:i.theme).arc;this._draw(s,n,!1,e,i)}};function Ah(s,t,e,i){if(!t.p1)return;const{offsetX:n=0,offsetY:r=0,offsetZ:a=0}=i||{};if(e===1)t.p2&&t.p3?s.bezierCurveTo(n+t.p1.x,r+t.p1.y,n+t.p2.x,r+t.p2.y,n+t.p3.x,r+t.p3.y,a):s.lineTo(n+t.p1.x,r+t.p1.y,a);else if(t.p2&&t.p3){const[o]=Pl(t,e);s.bezierCurveTo(n+o.p1.x,r+o.p1.y,n+o.p2.x,r+o.p2.y,n+o.p3.x,r+o.p3.y,a)}else{const o=t.getPointAt(e);s.lineTo(n+o.x,r+o.y,a)}}function m0(s,t,e,i,n,r,a){var o;let l=t.p0,h=i;if(e&&e.originP1===e.originP2&&(l=e.p0),t.defined)i||(s.lineTo(l.x+n,l.y+r,a),h=!i);else{const{originP1:c,originP2:u}=t;let d;if(c&&c.defined!==!1&&!e?d=l:c&&u.defined!==!1&&(d=(o=t.p3)!==null&&o!==void 0?o:t.p1),i){h=!i;const p=d?d.x:t.p0.x,g=d?d.y:t.p0.y;s.moveTo(p+n,g+r,a)}else d&&(h=!i,s.lineTo(d.x+n,d.y+r,a))}return h}function v0(s,t,e,i,n){const{offsetX:r=0,offsetY:a=0,offsetZ:o=0,mode:l="none",drawConnect:h=!1}=n||{};if(h&&l==="none"||!t)return;let c=!0;const{curves:u}=t;if(e>=1){if(h){let v,y=!0;u.forEach((_,b)=>{_.originP1!==_.originP2&&(y=m0(s,_,v,y,r,a,o)),v=_})}else u.forEach(v=>{v.defined?(c&&s.moveTo(v.p0.x+r,v.p0.y+a,o),Ah(s,v,1,n),c=!1):c=!0});return}if(e<=0)return;let d;i==="x"?d=jt.ROW:i==="y"?d=jt.COLUMN:i==="auto"&&(d=t.direction);const p=e*t.tryUpdateLength(d);let g=0,f=!0,m=null;for(let v=0,y=u.length;v<y;v++){const _=u[v],b=_.getLength(d),x=(p-g)/b;if(g+=b,x<0)break;if(h){if(_.originP1===_.originP2){m=_;continue}f=m0(s,_,m,f,r,a,o),m=_}else{if(!_.defined){c=!0;continue}c&&s.moveTo(_.p0.x+r,_.p0.y+a,o),Ah(s,_,ke(x,1),n),c=!1}}}Sh=nT([nt(),f0(0,At(Jt)),f0(0,ae(Ld)),rT("design:paramtypes",[Object])],Sh);var aT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};let no=class extends Vi{constructor(){super(...arguments),this.numberType=za}draw(s,t,e,i){const n=Et(s,i==null?void 0:i.theme).line;this._draw(s,n,!1,e,i)}drawSegmentItem(s,t,e,i,n,r,a,o,l,h,c,u,d,p,g){var f;if(!t)return;s.beginPath();const m=(f=this.z)!==null&&f!==void 0?f:0;v0(s.camera?s:s.nativeContext,t,l,h,{offsetX:c,offsetY:u,offsetZ:m}),d.cache&&!W(d.cache)&&d.cache.curves.every(_=>_.defined)&&d.attribute.curveType&&d.attribute.curveType.includes("Closed")&&s.closePath(),s.setShadowBlendStyle&&s.setShadowBlendStyle(d,a,o);const{x:v=0,x:y=0}=a;return e!==!1&&(p?p(s,a,o):n&&(s.setCommonStyle(d,a,v-c,y-u,o),s.fill())),i!==!1&&(g?g(s,a,o):r&&(s.setStrokeStyle(d,a,v-c,y-u,o),s.stroke())),!1}drawLinearLineHighPerformance(s,t,e,i,n,r,a,o,l,h,c,u,d){var p;t.beginPath();const g=(p=this.z)!==null&&p!==void 0?p:0,{points:f}=s.attribute,m=f[0];t.moveTo(m.x+a,m.y+o,g);for(let _=1;_<f.length;_++){const b=f[_];t.lineTo(b.x+a,b.y+o,g)}t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,l);const{x:v=0,x:y=0}=s.attribute;e!==!1&&(u?u(t,s.attribute,l):n&&(t.setCommonStyle(s,s.attribute,v-a,y-o,l),t.fill())),i!==!1&&(d?d(t,s.attribute,l):r&&(t.setStrokeStyle(s,s.attribute,v-a,y-o,l),t.stroke()))}drawShape(s,t,e,i,n,r,a,o){const l=Et(s,r==null?void 0:r.theme).line,{fill:h=l.fill,stroke:c=l.stroke,fillOpacity:u=l.fillOpacity,strokeOpacity:d=l.strokeOpacity,segments:p,points:g,closePath:f,curveTension:m=l.curveTension,connectedType:v=l.connectedType}=s.attribute;if(!this.valid(s,l,a,o))return;let{curveType:y=l.curveType}=s.attribute;f&&y==="linear"&&(y="linearClosed");const{clipRange:_=l.clipRange,clipRangeByDimension:b=l.clipRangeByDimension}=s.attribute;if(_===1&&!p&&!g.some(S=>S.defined===!1)&&y==="linear")return this.drawLinearLineHighPerformance(s,t,!!h,!!c,u,d,e,i,l,n,r,a,o);function x(S,A){return A==="none"?S:S.filter(w=>w.defined!==!1)}if(s.shouldUpdateShape()){const{points:S,segments:A}=s.attribute,w=S;if(A&&A.length){let k,T;if(s.cache=A.map((C,M)=>{if(C.points.length<=1&&M===0)return C.points[0]&&(T={endX:C.points[0].x,endY:C.points[0].y,curves:[{defined:C.points[0].defined!==!1}]}),null;M===1?k={x:T.endX,y:T.endY,defined:T.curves[T.curves.length-1].defined}:M>1&&(k.x=T.endX,k.y=T.endY,k.defined=T.curves[T.curves.length-1].defined);const B=vn(x(C.points,v),y,{startPoint:k,curveTension:m});return T=B,B}).filter(C=>!!C),y==="linearClosed"){let C;for(let M=0;M<s.cache.length;M++){const B=s.cache[M];for(let O=0;O<B.curves.length;O++)if(B.curves[O].defined){C=B.curves[O].p0;break}if(C)break}s.cache[s.cache.length-1]&&s.cache[s.cache.length-1].lineTo(C.x,C.y,!0)}}else{if(!S||!S.length)return s.cache=null,void s.clearUpdateShapeTag();s.cache=vn(x(w,v),y,{curveTension:m})}s.clearUpdateShapeTag()}if(Array.isArray(s.cache)){const S=s.attribute.segments.filter(A=>A.points.length);if(S[0].points.length===1&&S.shift(),_===1){let A=!1;s.cache.forEach((w,k)=>{A||(A=this.drawSegmentItem(t,w,!!h,!!c,u,d,S[k],[l,s.attribute],_,b,e,i,s,a,o))})}else{const A=s.cache.reduce((C,M)=>C+M.getLength(),0),w=_*A;let k=0,T=!1;s.cache.forEach((C,M)=>{if(T)return;const B=C.getLength(),O=(w-k)/B;k+=B,O>0&&(T=this.drawSegmentItem(t,C,!!h,!!c,u,d,S[M],[l,s.attribute],ke(O,1),b,e,i,s,a,o))})}}else this.drawSegmentItem(t,s.cache,!!h,!!c,u,d,s.attribute,l,_,b,e,i,s,a,o)}};function kh(s,t,e,i){const{offsetX:n=0,offsetY:r=0,offsetZ:a=0}=i||{};let o=!0;t.forEach(l=>{l.defined?(o&&s.moveTo(l.p0.x+n,l.p0.y+r,a),Ah(s,l,1,i),o=!1):o=!0}),o=!0;for(let l=e.length-1;l>=0;l--){const h=e[l];h.defined?(o&&s.lineTo(h.p0.x+n,h.p0.y+r,a),Ah(s,h,1,i),o=!1):o=!0}s.closePath()}no=aT([nt()],no);const oT=new class extends qd{constructor(){super(...arguments),this.time=be.afterFillStroke}drawShape(s,t,e,i,n,r,a,o,l,h,c,u,d){var p,g,f,m;this.textureMap||this.initTextureMap(t,s.stage);const{attribute:v=s.attribute}=d||{},{texture:y=(p=s.attribute.texture)!==null&&p!==void 0?p:Zl(l,"texture"),textureColor:_=(g=s.attribute.textureColor)!==null&&g!==void 0?g:Zl(l,"textureColor"),textureSize:b=(f=s.attribute.textureSize)!==null&&f!==void 0?f:Zl(l,"textureSize"),texturePadding:x=(m=s.attribute.texturePadding)!==null&&m!==void 0?m:Zl(l,"texturePadding")}=v;y&&this.drawTexture(y,s,t,e,i,l,_,b,x)}},lT=vr;var hT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},cT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},y0=function(s,t){return function(e,i){t(e,i,s)}};let ro=class extends Vi{constructor(s){super(),this.areaRenderContribitions=s,this.numberType=Na,this.builtinContributions=[oT,lT],this.init(s)}drawLinearAreaHighPerformance(s,t,e,i,n,r,a,o,l,h,c,u,d){var p,g,f;const{points:m}=s.attribute;if(m.length<2)return;t.beginPath();const v=(p=this.z)!==null&&p!==void 0?p:0,y=m[0];t.moveTo(y.x+a,y.y+o,v);for(let x=1;x<m.length;x++){const S=m[x];t.lineTo(S.x+a,S.y+o,v)}for(let x=m.length-1;x>=0;x--){const S=m[x];t.lineTo(((g=S.x1)!==null&&g!==void 0?g:S.x)+a,((f=S.y1)!==null&&f!==void 0?f:S.y)+o,v)}t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,l),this.beforeRenderStep(s,t,a,o,!!n,!1,e,!1,l,h,u,null,{attribute:s.attribute});const{x:_=0,x:b=0}=s.attribute;e!==!1&&(u?u(t,s.attribute,l):n&&(t.setCommonStyle(s,s.attribute,_-a,b-o,l),t.fill())),this.afterRenderStep(s,t,a,o,!!n,!1,e,!1,l,h,u,null,{attribute:s.attribute}),(()=>{var x,S;if(i){const{stroke:A=l&&l.stroke}=s.attribute;if(W(A)&&(A[0]||A[2])&&A[1]===!1){if(t.beginPath(),A[0]){t.moveTo(y.x+a,y.y+o,v);for(let w=1;w<m.length;w++){const k=m[w];t.lineTo(k.x+a,k.y+o,v)}}else if(A[2]){const w=m[m.length-1];t.moveTo(w.x+a,w.y+o,v);for(let k=m.length-2;k>=0;k--){const T=m[k];t.lineTo(((x=T.x1)!==null&&x!==void 0?x:T.x)+a,((S=T.y1)!==null&&S!==void 0?S:T.y)+o,v)}}}d?d(t,s.attribute,l):(t.setStrokeStyle(s,s.attribute,_-a,b-o,l),t.stroke())}})()}drawShape(s,t,e,i,n,r,a,o){var l,h,c,u,d,p;const g=Et(s,r==null?void 0:r.theme).area,{fill:f=g.fill,stroke:m=g.stroke,fillOpacity:v=g.fillOpacity,z:y=g.z,strokeOpacity:_=g.strokeOpacity,curveTension:b=g.curveTension,connectedType:x=g.connectedType}=s.attribute,S=this.valid(s,g,a,o);if(!S)return;const{doFill:A}=S,w=S.doStroke&&S.sVisible,{clipRange:k=g.clipRange,closePath:T,points:C,segments:M}=s.attribute;let{curveType:B=g.curveType}=s.attribute;function O(E,L){return L!=="connect"?E:E.filter(P=>P.defined!==!1)}if(T&&B==="linear"&&(B="linearClosed"),k===1&&!M&&!C.some(E=>E.defined===!1)&&B==="linear")return this.drawLinearAreaHighPerformance(s,t,!!f,w,v,_,e,i,g,n,r,a,o);if(s.shouldUpdateShape()){if(M&&M.length){let E,L;const P=M.map((D,N)=>{if(D.points.length<=1&&N===0)return D.points[0]&&(L={endX:D.points[0].x,endY:D.points[0].y}),null;N===1?E={x:L.endX,y:L.endY}:N>1&&(E.x=L.endX,E.y=L.endY);const J=vn(O(D.points,x),B,{startPoint:E,curveTension:b});return L=J,J}).filter(D=>!!D);let F;const j=[];for(let D=M.length-1;D>=0;D--){const N=M[D].points,J=[];for(let X=N.length-1;X>=0;X--)J.push({x:(l=N[X].x1)!==null&&l!==void 0?l:N[X].x,y:(h=N[X].y1)!==null&&h!==void 0?h:N[X].y});if(D!==0){const X=M[D-1].points,$=X[X.length-1];$&&J.push({x:(c=$.x1)!==null&&c!==void 0?c:$.x,y:(u=$.y1)!==null&&u!==void 0?u:$.y})}J.length>1&&(F=vn(O(J,x),B==="stepBefore"?"stepAfter":B==="stepAfter"?"stepBefore":B,{curveTension:b}),j.unshift(F))}s.cacheArea=j.map((D,N)=>({top:P[N],bottom:D}))}else{if(!C||!C.length)return s.cacheArea=null,void s.clearUpdateShapeTag();{const E=O(C,x),L=[];for(let j=E.length-1;j>=0;j--)L.push({x:(d=E[j].x1)!==null&&d!==void 0?d:E[j].x,y:(p=E[j].y1)!==null&&p!==void 0?p:E[j].y});const P=vn(E,B,{curveTension:b}),F=vn(L,B==="stepBefore"?"stepAfter":B==="stepAfter"?"stepBefore":B,{curveTension:b});s.cacheArea={top:P,bottom:F}}}s.clearUpdateShapeTag()}if(Array.isArray(s.cacheArea)){const E=s.attribute.segments.filter(L=>L.points.length);if(E[0].points.length===1&&E.shift(),k===1){let L=!1;s.cacheArea.forEach((P,F)=>{L||(L=this.drawSegmentItem(t,P,A,v,w,_,E[F],[g,s.attribute],k,e,i,y,s,n,a,o))})}else{const L=s.cacheArea.reduce((D,N)=>D+N.top.getLength(),0),P=k*L;let F=0,j=!1;s.cacheArea.forEach((D,N)=>{if(j)return;const J=D.top.getLength(),X=(P-F)/J;F+=J,X>0&&(j=this.drawSegmentItem(t,D,A,v,w,_,E[N],[g,s.attribute],ke(X,1),e,i,y,s,n,a,o))})}}else this.drawSegmentItem(t,s.cacheArea,A,v,w,_,s.attribute,g,k,e,i,y,s,n,a,o)}draw(s,t,e,i){const n=Et(s,i==null?void 0:i.theme).area;this._draw(s,n,!1,e,i)}drawSegmentItem(s,t,e,i,n,r,a,o,l,h,c,u,d,p,g,f){return this._drawSegmentItem(s,t,e,i,n,r,a,o,l,h,c,u,d,p,g,f)}_drawSegmentItem(s,t,e,i,n,r,a,o,l,h,c,u,d,p,g,f){if(!(t&&t.top&&t.bottom&&t.top.curves&&t.top.curves.length&&t.bottom.curves&&t.bottom.curves.length))return;s.beginPath();const{points:m,segments:v}=d.attribute;let y,_,b=jt.ROW;if(v){const k=v[v.length-1];_=v[0].points[0],y=k.points[k.points.length-1]}else _=m[0],y=m[m.length-1];const x=Rt(y.x-_.x),S=Rt(y.y-_.y);b=y.x1==null?jt.ROW:y.y1==null?jt.COLUMN:Number.isFinite(x+S)?x>S?jt.ROW:jt.COLUMN:jt.ROW,function(k,T,C,M){var B;const{top:O,bottom:E}=T;if(O.curves.length!==E.curves.length)return;if(C>=1){const z=[],ot=[];let ft=!0;for(let ut=0,tt=O.curves.length;ut<tt;ut++){const lt=O.curves[ut];ft!==lt.defined?(ft?(kh(k,z,ot,M),z.length=0,ot.length=0):(z.push(lt),ot.push(E.curves[tt-ut-1])),ft=!ft):ft&&(z.push(lt),ot.push(E.curves[tt-ut-1]))}return void kh(k,z,ot,M)}if(C<=0)return;let{direction:L}=M||{};const{curves:P}=O,F=(B=P[P.length-1].p3)!==null&&B!==void 0?B:P[P.length-1].p1,j=Rt(F.x-P[0].p0.x),D=Rt(F.y-P[0].p0.y);L=L??(j>D?jt.ROW:jt.COLUMN),Number.isFinite(j)||(L=jt.COLUMN),Number.isFinite(D)||(L=jt.ROW);const N=C*(L===jt.ROW?j:D);let J=0,X=!0;const $=[],G=[];for(let z=0,ot=O.curves.length;z<ot;z++){const ft=O.curves[z],ut=ft.getLength(L),tt=(N-J)/ut;if(tt<0)break;J+=ut;let lt=null,Mt=null;X!==ft.defined?(X?(kh(k,$,G,M),$.length=0,G.length=0):(lt=ft,Mt=E.curves[ot-z-1]),X=!X):X&&(lt=ft,Mt=E.curves[ot-z-1]),lt&&Mt&&(tt<1&&(lt=lt.p2&&lt.p3?Pl(lt,tt)[0]:Tm(lt,tt)[0],Mt=Mt.p2&&Mt.p3?Pl(Mt,1-tt)[1]:Tm(Mt,1-tt)[1]),lt.defined=X,Mt.defined=X,$.push(lt),G.push(Mt)),lt=null,Mt=null}kh(k,$,G,M)}(s.camera?s:s.nativeContext,t,l,{offsetX:h,offsetY:c,offsetZ:u,direction:b}),this.beforeRenderStep(d,s,h,c,!!i,!1,e,!1,o,p,g,null,{attribute:a}),s.setShadowBlendStyle&&s.setShadowBlendStyle(d,a,o);const{x:A=0,x:w=0}=a;return e!==!1&&(g?g(s,a,o):i&&(s.setCommonStyle(d,a,A-h,w-c,o),s.fill())),this.afterRenderStep(d,s,h,c,!!i,!1,e,!1,o,p,g,null,{attribute:a}),(()=>{if(n!==!1)if(f)f(s,a,o);else{const{stroke:k=o&&o[1]&&o[1].stroke}=a;W(k)&&(k[0]||k[2])&&k[1]===!1&&(s.beginPath(),v0(s.camera?s:s.nativeContext,k[0]?t.top:t.bottom,l,b===jt.ROW?"x":"y",{offsetX:h,offsetY:c,offsetZ:u})),s.setStrokeStyle(d,a,A-h,w-c,o),s.stroke()}})(),!1}};ro=hT([nt(),y0(0,At(Jt)),y0(0,ae(Dd)),cT("design:paramtypes",[Object])],ro);const uT=so,dT=vr;var pT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},gT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},_0=function(s,t){return function(e,i){t(e,i,s)}};let wh=class extends Vi{constructor(s){super(),this.pathRenderContribitions=s,this.numberType=ah,this.builtinContributions=[dT,uT],this.init(s)}drawShape(s,t,e,i,n,r,a,o){var l,h,c;const u=(l=this.tempTheme)!==null&&l!==void 0?l:Et(s,r==null?void 0:r.theme).path,{x:d=u.x,y:p=u.y,fillStrokeOrder:g=u.fillStrokeOrder}=s.attribute,f=(h=this.z)!==null&&h!==void 0?h:0,m=this.valid(s,u,a,o);if(!m)return;const{fVisible:v,sVisible:y,doFill:_,doStroke:b}=m;t.beginPath(),s.pathShape?gs(s.pathShape.commandList,t,e,i,1,1,f):gs(((c=s.attribute.path)!==null&&c!==void 0?c:u.path).commandList,t,e,i,1,1,f),t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,u),this.beforeRenderStep(s,t,e,i,_,b,v,y,u,n,a,o);const x=()=>{b&&(o?o(t,s.attribute,u):y&&(t.setStrokeStyle(s,s.attribute,d-e,p-i,u),t.stroke()))},S=()=>{_&&(a?a(t,s.attribute,u):v&&(t.setCommonStyle(s,s.attribute,d-e,p-i,u),t.fill()))};g?(x(),S()):(S(),x()),this.afterRenderStep(s,t,e,i,_,b,v,y,u,n,a,o)}draw(s,t,e,i){const n=Et(s,i==null?void 0:i.theme).path;this.tempTheme=n,this._draw(s,n,!1,e,i),this.tempTheme=null}};wh=pT([nt(),_0(0,At(Jt)),_0(0,ae(Fd)),gT("design:paramtypes",[Object])],wh);var fT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},mT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},b0=function(s,t){return function(e,i){t(e,i,s)}};let Th=class extends Vi{constructor(s){super(),this.rectRenderContribitions=s,this.type="rect",this.numberType=Ed,this.builtinContributions=[Zw,Qw,Jw],this.init(s)}drawShape(s,t,e,i,n,r,a,o){var l;const h=(l=this.tempTheme)!==null&&l!==void 0?l:Et(s,r==null?void 0:r.theme).rect,{fill:c=h.fill,background:u,stroke:d=h.stroke,cornerRadius:p=h.cornerRadius,cornerType:g=h.cornerType,opacity:f=h.opacity,fillOpacity:m=h.fillOpacity,lineWidth:v=h.lineWidth,strokeOpacity:y=h.strokeOpacity,visible:_=h.visible,x1:b,y1:x,x:S=h.x,y:A=h.y,fillStrokeOrder:w=h.fillStrokeOrder}=s.attribute;let{width:k,height:T}=s.attribute;k=(k??b-S)||0,T=(T??x-A)||0;const C=$v(f,m,k,T,c),M=Xv(f,y,k,T),B=mr(c,u),O=Ua(d,v);if(!s.valid||!_||!B&&!O||!(C||M||a||o||u))return;p===0||W(p)&&p.every(F=>F===0)?(t.beginPath(),t.rect(e,i,k,T)):(t.beginPath(),yr(t,e,i,k,T,p,g!=="bevel"));const E={doFill:B,doStroke:O};t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,h),this.beforeRenderStep(s,t,e,i,B,O,C,M,h,n,a,o,E);const L=()=>{E.doFill&&(a?a(t,s.attribute,h):C&&(t.setCommonStyle(s,s.attribute,S-e,A-i,h),t.fill()))},P=()=>{E.doStroke&&(o?o(t,s.attribute,h):M&&(t.setStrokeStyle(s,s.attribute,S-e,A-i,h),t.stroke()))};w?(P(),L()):(L(),P()),this.afterRenderStep(s,t,e,i,B,O,C,M,h,n,a,o)}draw(s,t,e,i){const n=Et(s,i==null?void 0:i.theme).rect;this.tempTheme=n,this._draw(s,n,!1,e,i),this.tempTheme=null}};Th=fT([nt(),b0(0,At(Jt)),b0(0,ae(Ga)),mT("design:paramtypes",[Object])],Th);var vT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},yT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},x0=function(s,t){return function(e,i){t(e,i,s)}};let Ch=class extends Vi{constructor(s){super(),this.symbolRenderContribitions=s,this.numberType=lh,this.builtinContributions=[tT,sT,iT,eT],this.init(s)}drawShape(s,t,e,i,n,r,a,o){var l;const h=Et(s,r==null?void 0:r.theme).symbol,{size:c=h.size,x:u=h.x,y:d=h.y,scaleX:p=h.scaleX,scaleY:g=h.scaleY,fillStrokeOrder:f=h.fillStrokeOrder,clipRange:m=h.clipRange}=s.attribute,v=this.valid(s,h,a,o);if(!v)return;const{fVisible:y,sVisible:_,doFill:b,doStroke:x}=v,S=s.getParsedPath();if(!S)return;const{keepDirIn3d:A=h.keepDirIn3d}=s.attribute,w=(l=this.z)!==null&&l!==void 0?l:0;t.beginPath();let k=e,T=i,C=w;const M=t.camera;if(A&&M&&t.project){const E=t.project(e,i,w);t.camera=null,W(c)&&(c[0],c[1]),k=E.x,T=E.y,C=void 0}S.draw(t,c,k,T,C,(E,L)=>{var P,F,j,D;if(s._parsedPath.svgCache){const X=Object.assign({},L);X.fill=(P=L.fill)!==null&&P!==void 0?P:s.attribute.fill,X.opacity=(F=L.opacity)!==null&&F!==void 0?F:s.attribute.opacity,X.fillOpacity=s.attribute.fillOpacity,X.stroke=(j=L.stroke)!==null&&j!==void 0?j:s.attribute.stroke,X.lineWidth=(D=L.lineWidth)!==null&&D!==void 0?D:s.attribute.lineWidth,L=X}const N=()=>{L.fill&&(a?a(t,s.attribute,h):(t.setCommonStyle(s,L,u-e,d-i,h),t.fill()))},J=()=>{L.stroke&&(o?o(t,s.attribute,h):_&&m>=1&&(t.setStrokeStyle(s,L,(u-e)/p,(d-i)/g,h),t.stroke()))};f?(J(),N()):(N(),J())})===!1&&t.closePath(),t.camera=M,t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,h),this.beforeRenderStep(s,t,e,i,b,x,y,_,h,n,a,o);const B=()=>{b&&!S.isSvg&&(a?a(t,s.attribute,h):y&&(t.setCommonStyle(s,s.attribute,u-e,d-i,h),t.fill()))},O=()=>{x&&!S.isSvg&&(o?o(t,s.attribute,h):_&&m>=1&&(t.setStrokeStyle(s,s.attribute,(u-e)/p,(d-i)/g,h),t.stroke()))};f?(O(),B()):(B(),O()),this.afterRenderStep(s,t,e,i,b,x,y,_,h,n,a,o)}draw(s,t,e,i){const n=Et(s,i==null?void 0:i.theme).symbol;this._draw(s,n,!1,e,i)}};Ch=vT([nt(),x0(0,At(Jt)),x0(0,ae(Nd)),yT("design:paramtypes",[Object])],Ch);const Mh=new class{constructor(){this.pools=[];for(let s=0;s<10;s++)this.pools.push(new fe)}allocate(s,t,e,i){if(!this.pools.length)return new fe().setValue(s,t,e,i);const n=this.pools.pop();return n.x1=s,n.y1=t,n.x2=e,n.y2=i,n}allocateByObj(s){if(!this.pools.length)return new fe(s);const t=this.pools.pop();return t.x1=s.x1,t.y1=s.y1,t.x2=s.x2,t.y2=s.y2,t}free(s){this.pools.push(s)}get length(){return this.pools.length}release(){this.pools=[]}},S0=new class extends yh{constructor(){super(...arguments),this.time=be.beforeFillStroke}drawShape(s,t,e,i,n,r,a,o,l,h,c,u){var d,p,g,f,m,v,y,_,b,x;const{backgroundMode:S=l.backgroundMode,backgroundFit:A=l.backgroundFit,backgroundKeepAspectRatio:w=l.backgroundKeepAspectRatio}=s.attribute;let k,{background:T}=s.attribute;if(!T)return;const C=()=>{s.type==="richtext"&&(t.restore(),t.save(),k&&t.setTransformFromMatrix(k,!0,1))};let M;s.type==="richtext"&&(k=t.currentMatrix.clone(),t.restore(),t.save(),t.setTransformForCurrent());const B=_t(T)&&T.background,O=s.transMatrix.onlyTranslate();if(B){const E=s.AABBBounds,L=((d=T.x)!==null&&d!==void 0?d:E.x1)+((p=T.dx)!==null&&p!==void 0?p:0),P=((g=T.y)!==null&&g!==void 0?g:E.y1)+((f=T.dy)!==null&&f!==void 0?f:0),F=(m=T.width)!==null&&m!==void 0?m:E.width(),j=(v=T.height)!==null&&v!==void 0?v:E.height();if(M=Mh.allocate(L,P,L+F,P+j),T=T.background,!O){const D=M.width(),N=M.height();M.set(((y=T.x)!==null&&y!==void 0?y:0)+((_=T.dx)!==null&&_!==void 0?_:0),((b=T.y)!==null&&b!==void 0?b:0)+((x=T.dy)!==null&&x!==void 0?x:0),D,N)}}else M=s.AABBBounds,O||(M=Kd(Object.assign(Object.assign({},s.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(s.backgroundImg&&s.resources){const E=s.resources.get(T);if(E.state!=="success"||!E.data)return void C();t.highPerformanceSave(),O&&t.setTransformFromMatrix(s.parent.globalTransMatrix,!0),t.setCommonStyle(s,s.attribute,e,i,l),this.doDrawImage(t,E.data,M,{backgroundMode:S,backgroundFit:A,backgroundKeepAspectRatio:w}),t.highPerformanceRestore(),t.setTransformForCurrent()}else{const{backgroundCornerRadius:E}=s.attribute;t.highPerformanceSave(),t.setCommonStyle(s,s.attribute,e,i,l),t.fillStyle=T,E?(yr(t,M.x1,M.y1,M.width(),M.height(),E,!0),t.fill()):t.fillRect(M.x1,M.y1,M.width(),M.height()),t.highPerformanceRestore()}B&&Mh.free(M),C()}};var _T=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},bT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},A0=function(s,t){return function(e,i){t(e,i,s)}};let Zd=class extends Vi{constructor(s){super(),this.textRenderContribitions=s,this.numberType=hh,this.builtinContributions=[S0],this.init(s)}drawShape(s,t,e,i,n,r,a,o){var l,h,c;const u=Et(s,r==null?void 0:r.theme).text,{text:d,underline:p=u.underline,lineThrough:g=u.lineThrough,keepDirIn3d:f=u.keepDirIn3d,direction:m=u.direction,fontSize:v=u.fontSize,verticalMode:y=u.verticalMode,x:_=u.x,y:b=u.y}=s.attribute,x=(l=th(s.attribute.lineHeight,v))!==null&&l!==void 0?l:v,S=this.valid(s,u,a,o);if(!S)return;const{fVisible:A,sVisible:w,doFill:k,doStroke:T}=S,C=!f,M=this.z||0;t.beginPath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,u),this.beforeRenderStep(s,t,e,i,k,T,A,w,u,n,a,o),C&&this.transformUseContext2d(s,u,M,t);const B=(O,E,L,P)=>{let F=e+E;const j=i+L;if(P){t.highPerformanceSave(),F+=v;const D=De.allocate(1,0,0,1,0,0);D.rotateByCenter(Math.PI/2,F,j),t.transformFromMatrix(D,!0),De.free(D)}T&&(o?o(t,s.attribute,u):w&&(t.setStrokeStyle(s,s.attribute,_-e,b-i,u),t.strokeText(O,F,j,M))),k&&(a?a(t,s.attribute,u):A&&(t.setCommonStyle(s,s.attribute,_-e,b-i,u),t.fillText(O,F,j,M))),P&&(t.highPerformanceRestore(),t.setTransformForCurrent())};if(t.setTextStyleWithoutAlignBaseline(s.attribute,u,M),m==="horizontal"){const{multilineLayout:O}=s;if(!O)return void t.highPerformanceRestore();const{xOffset:E,yOffset:L}=O.bbox;T&&(o?o(t,s.attribute,u):w&&(t.setStrokeStyle(s,s.attribute,_-e,b-i,u),O.lines.forEach(P=>{t.strokeText(P.str,(P.leftOffset||0)+E+e,(P.topOffset||0)+L+i,M)}))),k&&(a?a(t,s.attribute,u):A&&(t.setCommonStyle(s,s.attribute,_-e,b-i,u),O.lines.forEach(P=>{t.fillText(P.str,(P.leftOffset||0)+E+e,(P.topOffset||0)+L+i,M),this.drawUnderLine(p,g,s,(P.leftOffset||0)+E+e,(P.topOffset||0)+L+i,P.descent,(P.descent-P.ascent)/2,M,u,t,{width:P.width})})))}else{let{textAlign:O=u.textAlign,textBaseline:E=u.textBaseline}=s.attribute;if(!y){const J=O;O=(h=s.getBaselineMapAlign()[E])!==null&&h!==void 0?h:"left",E=(c=s.getAlignMapBaseline()[J])!==null&&c!==void 0?c:"top"}s.tryUpdateAABBBounds();const L=s.cache,{verticalList:P}=L;t.textAlign="left",t.textBaseline="top";const F=x*P.length;let j=0;P.forEach(J=>{const X=J.reduce(($,G)=>$+(G.width||0),0);j=ts(X,j)});let D=0,N=0;E==="bottom"?N=-F:E==="middle"&&(N=-F/2),O==="center"?D-=j/2:O==="right"&&(D-=j),P.forEach((J,X)=>{const $=J.reduce((ot,ft)=>ot+(ft.width||0),0),G=j-$;let z=D;O==="center"?z+=G/2:O==="right"&&(z+=G),J.forEach(ot=>{const{text:ft,width:ut,direction:tt}=ot;B(ft,F-(X+1)*x+N,z,tt),z+=ut})})}C&&this.restoreTransformUseContext2d(s,u,M,t),this.afterRenderStep(s,t,e,i,k,T,A,w,u,n,a,o)}draw(s,t,e,i){const n=Et(s,i==null?void 0:i.theme).text,{keepDirIn3d:r=n.keepDirIn3d}=s.attribute,a=!r;this._draw(s,n,a,e,i)}drawUnderLine(s,t,e,i,n,r,a,o,l,h,c){if(t+s<=0)return;const{textAlign:u=l.textAlign,fill:d=l.fill,opacity:p=l.opacity,underlineOffset:g=l.underlineOffset,underlineDash:f=l.underlineDash,fillOpacity:m=l.fillOpacity}=e.attribute,v=!I(c),y=v?c.width:e.clipedWidth,_=v?0:Ya(u,y),b={lineWidth:0,stroke:d,opacity:p,strokeOpacity:m};if(s){b.lineWidth=s,h.setStrokeStyle(e,b,i,n,l),f&&h.setLineDash(f),h.beginPath();const x=n+r+g;h.moveTo(i+_,x,o),h.lineTo(i+_+y,x,o),h.stroke()}if(t){b.lineWidth=t,h.setStrokeStyle(e,b,i,n,l),h.beginPath();const x=n+a;h.moveTo(i+_,x,o),h.lineTo(i+_+y,x,o),h.stroke()}}};function k0(s,t,e,i){s.moveTo(t[0].x+e,t[0].y+i);for(let n=1;n<t.length;n++)s.lineTo(t[n].x+e,t[n].y+i)}function Eh(s,t){return Math.sqrt(s*s+t*t)}function Jd(s,t,e,i,n){const r=t/e;return{x:s.x-i*r,y:s.y-n*r}}Zd=_T([nt(),A0(0,At(Jt)),A0(0,ae(zd)),bT("design:paramtypes",[Object])],Zd);const xT=so,ST=vr;var AT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},kT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},w0=function(s,t){return function(e,i){t(e,i,s)}};let Qd=class extends Vi{constructor(s){super(),this.polygonRenderContribitions=s,this.numberType=oh,this.builtinContributions=[ST,xT],this.init(s)}drawShape(s,t,e,i,n,r,a,o){const l=Et(s,r==null?void 0:r.theme).polygon,{points:h=l.points,cornerRadius:c=l.cornerRadius,x:u=l.x,y:d=l.y,closePath:p=l.closePath,fillStrokeOrder:g=l.fillStrokeOrder}=s.attribute,f=this.valid(s,l,a,o);if(!f)return;const{fVisible:m,sVisible:v,doFill:y,doStroke:_}=f;t.beginPath(),c<=0||W(c)&&c.every(S=>S===0)?k0(t.camera?t:t.nativeContext,h,e,i):function(S,A,w,k,T){let C=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];var M;if(A.length<3)return void k0(S,A,w,k);let B=0,O=A.length-1;C||(B+=1,O-=1,S.moveTo(A[0].x+w,A[0].y+k));for(let E=B;E<=O;E++){const L=A[E===0?O:(E-1)%A.length],P=A[E%A.length],F=A[(E+1)%A.length],j=P.x-L.x,D=P.y-L.y,N=P.x-F.x,J=P.y-F.y,X=(Math.atan2(D,j)-Math.atan2(J,N))/2,$=Math.abs(Math.tan(X));let G=Array.isArray(T)?(M=T[E%A.length])!==null&&M!==void 0?M:0:T,z=G/$;const ot=Eh(j,D),ft=Eh(N,J),ut=Math.min(ot,ft);z>ut&&(z=ut,G=ut*$);const tt=Jd(P,z,ot,j,D),lt=Jd(P,z,ft,N,J),Mt=2*P.x-tt.x-lt.x,Pt=2*P.y-tt.y-lt.y,Dt=Eh(Mt,Pt),ue=Jd(P,Eh(z,G),Dt,Mt,Pt);let Re=Math.atan2(tt.y-ue.y,tt.x-ue.x);const de=Math.atan2(lt.y-ue.y,lt.x-ue.x);let zt=de-Re;zt<0&&(Re=de,zt=-zt),zt>Math.PI&&(zt-=Math.PI),E===0?S.moveTo(tt.x+w,tt.y+k):S.lineTo(tt.x+w,tt.y+k),zt&&S.arcTo(P.x+w,P.y+k,lt.x+w,lt.y+k,G),S.lineTo(lt.x+w,lt.y+k)}C||S.lineTo(A[O+1].x+w,A[O+1].y+k)}(t.camera?t:t.nativeContext,h,e,i,c,p),p&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,l),this.beforeRenderStep(s,t,e,i,y,_,m,v,l,n,a,o);const b=()=>{y&&(a?a(t,s.attribute,l):m&&(t.setCommonStyle(s,s.attribute,u-e,d-i,l),t.fill()))},x=()=>{_&&(o?o(t,s.attribute,l):v&&(t.setStrokeStyle(s,s.attribute,u-e,d-i,l),t.stroke()))};g?(x(),b()):(b(),x()),this.afterRenderStep(s,t,e,i,y,_,m,v,l,n,a,o)}draw(s,t,e,i){const n=Et(s,i==null?void 0:i.theme).polygon;this._draw(s,n,!1,e,i)}};Qd=AT([nt(),w0(0,At(Jt)),w0(0,ae(jd)),kT("design:paramtypes",[Object])],Qd);var wT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},TT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},T0=function(s,t){return function(e,i){t(e,i,s)}};let tp=class{constructor(s){this.groupRenderContribitions=s,this.numberType=Md}drawShape(s,t,e,i,n,r,a,o){const l=Et(s,r==null?void 0:r.theme).group,{fill:h=l.fill,background:c,stroke:u=l.stroke,opacity:d=l.opacity,width:p=l.width,height:g=l.height,clip:f=l.clip,fillOpacity:m=l.fillOpacity,strokeOpacity:v=l.strokeOpacity,cornerRadius:y=l.cornerRadius,path:_=l.path,lineWidth:b=l.lineWidth,visible:x=l.visible,fillStrokeOrder:S=l.fillStrokeOrder,cornerType:A=l.cornerType,x:w=l.x,y:k=l.y}=s.attribute,T=$v(d,m,p,g,h),C=Xv(d,v,p,g),M=mr(h,c),B=Ua(u,b);if(!s.valid||!x||!f&&(!M&&!B||!(T||C||a||o||c)))return;if(_&&_.length&&n.drawContribution){const P=t.disableFill,F=t.disableStroke,j=t.disableBeginPath;t.disableFill=!0,t.disableStroke=!0,t.disableBeginPath=!0,_.forEach(D=>{n.drawContribution.getRenderContribution(D).draw(D,n.renderService,n,r)}),t.disableFill=P,t.disableStroke=F,t.disableBeginPath=j}else y===0||W(y)&&y.every(P=>P===0)?(t.beginPath(),t.rect(e,i,p,g)):(t.beginPath(),yr(t,e,i,p,g,y,A!=="bevel"));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(qw));const O={doFill:M,doStroke:B};t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,l),this._groupRenderContribitions.forEach(P=>{P.time===be.beforeFillStroke&&P.drawShape(s,t,e,i,M,B,T,C,l,n,a,o,O)}),f&&t.clip();const E=()=>{O.doFill&&(a?a(t,s.attribute,l):T&&(t.setCommonStyle(s,s.attribute,w-e,k-i,l),t.fill()))},L=()=>{O.doStroke&&(o?o(t,s.attribute,l):C&&(t.setStrokeStyle(s,s.attribute,w-e,k-i,l),t.stroke()))};S?(L(),E()):(E(),L()),this._groupRenderContribitions.forEach(P=>{P.time===be.afterFillStroke&&P.drawShape(s,t,e,i,M,B,T,C,l,n,a,o)})}draw(s,t,e,i){const{context:n}=e;if(!n)return;const{clip:r,baseOpacity:a=1,drawMode:o,x:l,y:h,width:c,height:u}=s.attribute,d=n.nativeContext,p=n.canvas.nativeCanvas;if(o>0){const b=n.canvas,x=Me.createCanvas({width:b.width,height:b.height,dpr:1}),S=x.getContext("2d"),A=n.nativeContext.getTransform();S.setTransform(A.a,A.b,A.c,A.d,A.e,A.f),o===1&&(S.save(),S.clearRect(0,0,b.width,b.height),S.beginPath(),S.rect(l,h,c,u),S.clip(),S.drawImage(b.nativeCanvas,0,0,b.width,b.height,0,0,b.displayWidth,b.displayHeight),S.restore()),n.nativeContext=S,b.nativeCanvas=x}r?n.save():n.highPerformanceSave();const g=n.baseGlobalAlpha;n.baseGlobalAlpha*=a;const f=Et(s,i==null?void 0:i.theme).group,m=n.modelMatrix;if(n.camera){const b=ye.allocate(),x=ye.allocate();Qv(x,s,f),Xa(b,m||b,x),n.modelMatrix=b,ye.free(x),n.setTransform(1,0,0,1,0,0,!0)}else n.transformFromMatrix(s.transMatrix,!0);n.beginPath(),i.skipDraw?this.drawShape(s,n,0,0,e,i,()=>!1,()=>!1):this.drawShape(s,n,0,0,e);const{scrollX:v=f.scrollX,scrollY:y=f.scrollY}=s.attribute;let _;if((v||y)&&n.translate(v,y),i&&i.drawingCb&&(_=i.drawingCb()),n.modelMatrix!==m&&ye.free(n.modelMatrix),n.modelMatrix=m,n.baseGlobalAlpha=g,o>0){const b=n.nativeContext,x=n.canvas.nativeCanvas;d.save(),d.setTransform(n.dpr,0,0,n.dpr,0,0,!0),o===1&&b.rect(l,h,c,u),d.drawImage(x,0,0,x.width,x.height,0,0,n.canvas.displayWidth,n.canvas.displayHeight);const S=b.getTransform();d.setTransform(S.a,S.b,S.c,S.d,S.e,S.f),n.nativeContext=d,n.canvas.nativeCanvas=p,d.restore()}_&&_.then?_.then(()=>{r?n.restore():n.highPerformanceRestore()}):r?n.restore():n.highPerformanceRestore()}};tp=wT([nt(),T0(0,At(Jt)),T0(0,ae(qv)),TT("design:paramtypes",[Object])],tp);const C0=Symbol.for("IncrementalDrawContribution"),Bh=Symbol.for("ArcRender"),Rh=Symbol.for("AreaRender"),CT=Symbol.for("CircleRender"),gi=Symbol.for("GraphicRender"),M0=Symbol.for("GroupRender"),Ih=Symbol.for("LineRender"),Oh=Symbol.for("PathRender"),Ph=Symbol.for("PolygonRender"),Lh=Symbol.for("RectRender"),Dh=Symbol.for("SymbolRender"),ep=Symbol.for("TextRender"),ip=Symbol.for("RichTextRender"),MT=Symbol.for("GlyphRender"),sp=Symbol.for("DrawContribution"),E0=(s,t,e,i)=>{let n,r=!1,a=!1;if(t.forEachChildren(o=>(r=o.numberType===Sw,!r)),t.forEachChildren(o=>(a=!!o.findFace,!a)),r){const o=t.getChildren(),l=[...o];l.sort((h,c)=>{var u,d,p,g;let f=((d=(u=h.attribute.startAngle)!==null&&u!==void 0?u:0+h.attribute.endAngle)!==null&&d!==void 0?d:0)/2,m=((g=(p=c.attribute.startAngle)!==null&&p!==void 0?p:0+c.attribute.endAngle)!==null&&g!==void 0?g:0)/2;for(;f<0;)f+=dt;for(;m<0;)m+=dt;return m-f}),l.forEach(h=>{h._next=null,h._prev=null}),t.removeAllChild(),t.update(),l.forEach(h=>{t.appendChild(h)}),i.hack_pieFace="outside",n=e(r,a),n&&n.graphic||(i.hack_pieFace="inside",n=e(r,a)),n&&n.graphic||(i.hack_pieFace="top",n=e(r,a)),t.removeAllChild(),o.forEach(h=>{h._next=null,h._prev=null}),o.forEach(h=>{t.appendChild(h)})}else if(a){const o=t.getChildren(),l=o.map(h=>({ave_z:h.findFace().vertices.map(c=>{var u;return s.view(c[0],c[1],(u=c[2]+h.attribute.z)!==null&&u!==void 0?u:0)[2]}).reduce((c,u)=>c+u,0),g:h}));l.sort((h,c)=>c.ave_z-h.ave_z),t.removeAllChild(),l.forEach(h=>{h.g._next=null,h.g._prev=null}),t.update(),l.forEach(h=>{t.add(h.g)}),n=e(r,a),t.removeAllChild(),o.forEach(h=>{h._next=null,h._prev=null}),t.update(),o.forEach(h=>{t.add(h)})}else n=e(r,a);return n};var ET=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},BT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};const Fh=Symbol.for("DrawItemInterceptor"),B0=new fe,R0=new fe;class RT{constructor(){this.order=1}afterDrawItem(t,e,i,n,r){return t.attribute.shadowRootIdx==null&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0||(t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0)&&this.drawItem(t,e,i,n,r),!1}beforeDrawItem(t,e,i,n,r){return t.attribute.shadowRootIdx==null&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0||(t.attribute.shadowRootIdx<0||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0)&&this.drawItem(t,e,i,n,r),!1}drawItem(t,e,i,n,r){if(!t.shadowRoot)return!1;const{context:a}=i;if(a.highPerformanceSave(),a.transformFromMatrix(t.transMatrix,!0),n.dirtyBounds&&n.backupDirtyBounds){B0.copy(n.dirtyBounds),R0.copy(n.backupDirtyBounds);const o=t.globalTransMatrix.getInverse();n.dirtyBounds.copy(n.backupDirtyBounds).transformWithMatrix(o),n.backupDirtyBounds.copy(n.dirtyBounds)}return n.renderGroup(t.shadowRoot,i,De.allocate(1,0,0,1,0,0)),a.highPerformanceRestore(),n.dirtyBounds&&n.backupDirtyBounds&&(n.dirtyBounds.copy(B0),n.backupDirtyBounds.copy(R0)),!0}}class IT{constructor(){this.order=1}afterDrawItem(t,e,i,n,r){return t.attribute._debug_bounds&&this.drawItem(t,e,i,n,r),!1}drawItem(t,e,i,n,r){if(!t.attribute._debug_bounds)return!1;const{context:a}=i;a.highPerformanceSave(),t.parent&&a.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&a.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const o=t.AABBBounds;return t.attribute._debug_bounds!==!0&&t.attribute._debug_bounds(a,t),a.strokeRect(o.x1,o.y1,o.width(),o.height()),a.highPerformanceRestore(),!0}}let jh=class{constructor(){this.order=1,this.interceptors=[new RT,new PT,new OT,new IT]}afterDrawItem(s,t,e,i,n){for(let r=0;r<this.interceptors.length;r++)if(this.interceptors[r].afterDrawItem&&this.interceptors[r].afterDrawItem(s,t,e,i,n))return!0;return!1}beforeDrawItem(s,t,e,i,n){if((!s.in3dMode||e.in3dInterceptor)&&!s.shadowRoot&&!(s.baseGraphic||s.attribute.globalZIndex||s.interactiveGraphic))return!1;for(let r=0;r<this.interceptors.length;r++)if(this.interceptors[r].beforeDrawItem&&this.interceptors[r].beforeDrawItem(s,t,e,i,n))return!0;return!1}};jh=ET([nt(),BT("design:paramtypes",[])],jh);class OT{constructor(){this.order=1}beforeDrawItem(t,e,i,n,r){return!this.processing&&(t.baseGraphic?this.beforeDrawInteractive(t,e,i,n,r):this.beforeSetInteractive(t,e,i,n,r))}beforeSetInteractive(t,e,i,n,r){let a=t.interactiveGraphic;if(t.attribute.globalZIndex){a||(a=t.clone(),t.interactiveGraphic=a,a.baseGraphic=t),a.setAttributes({globalZIndex:0,zIndex:t.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),i.stage.tryInitInteractiveLayer();const o=i.stage.getLayer("_builtin_interactive");return o&&this.getShadowRoot(o).add(a),!0}if(a){i.stage.tryInitInteractiveLayer();const o=i.stage.getLayer("_builtin_interactive");o&&this.getShadowRoot(o).removeChild(a),t.interactiveGraphic=null,a.baseGraphic=null}return!1}beforeDrawInteractive(t,e,i,n,r){const a=t.baseGraphic;let o=!!a.stage,l=a.parent;for(;o&&l&&l.stage!==l;)o=!!l.stage,l=l.parent;if(!o){const h=i.stage.getLayer("_builtin_interactive");return h&&this.getShadowRoot(h).removeChild(t),!0}if(a){this.processing=!0;const{context:h}=i;return h.highPerformanceSave(),h.setTransformFromMatrix(a.parent.globalTransMatrix,!0),a.isContainer?n.renderGroup(a,i,a.parent.globalTransMatrix):n.renderItem(a,i),h.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(t){var e;let i=t.getElementById("_interactive_group");return i||(i=gt.CreateGraphic("group",{}),i.id="_interactive_group",t.add(i)),(e=i.shadowRoot)!==null&&e!==void 0?e:i.attachShadow()}}class PT{constructor(){this.order=1}beforeDrawItem(t,e,i,n,r){if(!t.in3dMode||i.in3dInterceptor)return!1;i.in3dInterceptor=!0;const{context:a,stage:o}=e.drawParams;a.canvas,a.save(),this.initCanvasCtx(a),a.camera=o.camera;const l=a.currentMatrix;l.a/=a.dpr,l.b/=a.dpr,l.c/=a.dpr,l.d/=a.dpr,l.e/=a.dpr,l.f/=a.dpr;const h=ye.allocate();Hd(h,l);const c=a.modelMatrix;if(c){if(h){const u=ye.allocate();a.modelMatrix=Xa(u,c,h)}}else a.modelMatrix=h;return a.setTransform(1,0,0,1,0,0,!0),t.isContainer?E0(a,t,(u,d)=>n.renderGroup(t,i,t.parent.globalTransMatrix,!u&&d),i):n.renderItem(t,i),a.camera=null,a.restore(),a.modelMatrix!==c&&ye.free(a.modelMatrix),a.modelMatrix=c,i.in3dInterceptor=!1,!0}initCanvasCtx(t){t.setTransformForCurrent()}}var LT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},DT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},FT=function(s,t){return function(e,i){t(e,i,s)}};const I0=Symbol.for("RenderService");let np=class{constructor(s){this.drawContribution=s}prepare(s){s&&this.renderTreeRoots.forEach(t=>{this._prepare(t,s)})}_prepare(s,t){s.forEachChildren(e=>{this._prepare(e,t)}),s.update({bounds:t,trans:!0})}prepareRenderList(){}beforeDraw(s){}draw(s){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(s){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}render(s,t){this.renderTreeRoots=s,this.drawParams=t;const e=t.updateBounds;this.prepare(e),this.prepareRenderList(),this.beforeDraw(t),this.draw(t),this.afterDraw(t),this.drawParams=null}};np=LT([nt(),FT(0,At(sp)),DT("design:paramtypes",[Object])],np);var jT=new yt(s=>{s(I0).to(np)});const As=Symbol.for("PickerService"),O0=Symbol.for("GlobalPickerService"),kn=Symbol.for("PickItemInterceptor"),ao=Symbol.for("PickServiceInterceptor");var Nh=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};let zh=class{constructor(){this.order=1}afterPickItem(s,t,e,i,n){if(s.graphic){let r=s.graphic;for(;r.parent;)r=r.parent;r.shadowHost&&(s.params={shadowTarget:s.graphic},s.graphic=r.shadowHost)}return s}};zh=Nh([nt()],zh);let Hh=class{constructor(){this.order=1}afterPickItem(s,t,e,i,n){return s.attribute.shadowRootIdx>0||!s.attribute.shadowRootIdx?this._pickItem(s,t,e,i,n):null}beforePickItem(s,t,e,i,n){return s.attribute.shadowRootIdx<0?this._pickItem(s,t,e,i,n):null}_pickItem(s,t,e,i,n){var r;if(!s.shadowRoot)return null;const{parentMatrix:a}=n||{};if(!a)return null;const o=t.pickContext;o.highPerformanceSave();const l=(r=Et(s))===null||r===void 0?void 0:r[s.type],{shadowPickMode:h=l==null?void 0:l.shadowPickMode}=s.attribute,c=s.shadowRoot,u=De.allocateByObj(a),d=new Lt(u.a*e.x+u.c*e.y+u.e,u.b*e.x+u.d*e.y+u.f),p=t.pickGroup(c,d,u,i);return o.highPerformanceRestore(),!p.graphic&&p.group&&h==="full"&&(p.graphic=p.group),p}};Hh=Nh([nt()],Hh);let Vh=class{constructor(){this.order=1}beforePickItem(s,t,e,i,n){const r=s.baseGraphic;if(r&&r.parent){const a=new Lt(e.x,e.y),o=t.pickContext;o.highPerformanceSave();const l=r.parent.globalTransMatrix;l.transformPoint(a,a);const h=r.isContainer?t.pickGroup(r,a.clone(),l,i):t.pickItem(r,a.clone(),l,i);return o.highPerformanceRestore(),h}return null}};Vh=Nh([nt()],Vh);let Wh=class{constructor(){this.order=1}beforePickItem(s,t,e,i,n){if(!s.in3dMode||i.in3dInterceptor)return null;const r=t.pickContext,a=s.stage;if(!r||!a)return null;if(i.in3dInterceptor=!0,r.save(),this.initCanvasCtx(r),r.camera=a.camera,s.isContainer){const o=E0(r,s,()=>t.pickGroup(s,e,n.parentMatrix,i),i);return r.camera=null,i.in3dInterceptor=!1,r.restore(),o}return r.restore(),null}initCanvasCtx(s){s.setTransformForCurrent()}};Wh=Nh([nt()],Wh);var NT=new yt((s,t,e)=>{e(As)||(s(O0).toSelf(),s(As).toService(O0)),s(Wh).toSelf().inSingletonScope(),s(kn).toService(Wh),s(Hh).toSelf().inSingletonScope(),s(kn).toService(Hh),s(Vh).toSelf().inSingletonScope(),s(kn).toService(Vh),ze(s,kn),s(zh).toSelf().inSingletonScope(),s(ao).toService(zh),ze(s,ao)}),zT=new yt(s=>{s(Dv).to(Wd).inSingletonScope(),s(Fv).toConstantValue(gt)});const rp=Symbol.for("AutoEnablePlugins"),P0=Symbol.for("PluginService");var HT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},VT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},L0=function(s,t){return function(e,i){t(e,i,s)}};let ap=class{constructor(s){this.autoEnablePlugins=s,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(s,t){this.stage=s,this.actived=!0;const{pluginList:e}=t;e&&kt.isBound(rp)&&this.autoEnablePlugins.getContributions().forEach(i=>{e.includes(i.name)&&this.register(i)})}findPluginsByName(s){const t=[];return this.onStartupFinishedPlugin.forEach(e=>{e.name===s&&t.push(e)}),this.onRegisterPlugin.forEach(e=>{e.name===s&&t.push(e)}),t}register(s){s.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.push(s):s.activeEvent==="onRegister"&&(this.onRegisterPlugin.push(s),s.activate(this))}unRegister(s){s.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(s),1):s.activeEvent==="onRegister"&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(s),1),s.deactivate(this)}release(){this.onStartupFinishedPlugin.forEach(s=>{s.deactivate(this)}),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach(s=>{s.deactivate(this)}),this.onRegisterPlugin=[]}};ap=HT([nt(),L0(0,At(Jt)),L0(0,ae(rp)),VT("design:paramtypes",[Object])],ap);var WT=new yt(s=>{s(P0).to(ap),function(t,e){t(Jt).toDynamicValue(i=>{let{container:n}=i;return new mm(e,n)}).whenTargetNamed(e)}(s,rp)}),UT=new yt(s=>{ze(s,Ta)}),GT=new yt(s=>{s(pd).to(gd).inSingletonScope(),ze(s,pd)}),YT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},$T=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};let Uh=class{constructor(){this.type="static",this.offscreen=!1,this.global=H.global}setDpr(s){this.canvas.dpr=s}init(s,t,e){if(this.layer=s,this.window=t,e.main)this.main=!0,this.context=t.getContext(),this.canvas=this.context.getCanvas();else{let i;this.main=!1,e.canvasId&&(i=this.global.getElementById(e.canvasId)),i||(i=this.global.createCanvas({width:t.width,height:t.height})),i.style&&(i.style["pointer-events"]="none");const n=t.getContext().getCanvas().nativeCanvas,r=fd({nativeCanvas:i,width:t.width,height:t.height,dpr:t.dpr,id:e.canvasId,canvasControled:!0,container:t.getContainer(),x:n.offsetLeft,y:n.offsetTop});r.applyPosition(),this.canvas=r,this.context=r.getContext()}}resize(s,t){this.canvas.resize(s,t)}resizeView(s,t){}render(s,t,e){var i;if(!this.main){const n=this.window.getContext().getCanvas().nativeCanvas;!n||this.canvas.x===n.offsetLeft&&this.canvas.y===n.offsetTop||(this.canvas.x=n.offsetLeft,this.canvas.y=n.offsetTop,this.canvas.applyPosition())}t.renderService.render(s,Object.assign(Object.assign({context:this.context,clear:(i=t.background)!==null&&i!==void 0?i:"#ffffff"},t),e))}merge(s){s.forEach(t=>{const e=t.getContext().canvas.nativeCanvas;this.context.drawImage(e,0,0)})}prepare(s,t){}drawTo(s,t,e){var i;const n=s.getContext();e.renderService.render(t,Object.assign(Object.assign({context:n},e),{clear:e.clear?(i=e.background)!==null&&i!==void 0?i:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};Uh=YT([nt(),$T("design:paramtypes",[])],Uh);var XT=new yt(s=>{s(Uh).toSelf(),s(Yv).toService(Uh)}),KT=function(s,t,e,i){return new(e||(e=Promise))(function(n,r){function a(h){try{l(i.next(h))}catch(c){r(c)}}function o(h){try{l(i.throw(h))}catch(c){r(c)}}function l(h){var c;h.done?n(h.value):(c=h.value,c instanceof e?c:new e(function(u){u(c)})).then(a,o)}l((i=i.apply(s,[])).next())})};function D0(s,t,e){const i={},n=[];return s.forEachChildren(r=>{const{zIndex:a=t}=r.attribute;i[a]?i[a].push(r):(i[a]=[r],n.push(a))},e),n.sort((r,a)=>e?a-r:r-a),{childMap:i,zIdxArray:n}}function F0(s,t,e){let i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],n=arguments.length>4&&arguments[4]!==void 0&&arguments[4],r=!1;if(n)r=!0;else{let a;s.forEachChildren((o,l)=>{const{zIndex:h=t}=o.attribute;if(l===0)a=h;else if(a!==h)return r=!0,!0;return!1},i)}if(r){const{childMap:a,zIdxArray:o}=D0(s,t,i);let l=!1;for(let h=0;h<o.length&&!l;h++){const c=a[o[h]];n&&c.sort((u,d)=>{var p,g;return(i?-1:1)*(((p=d.attribute.z)!==null&&p!==void 0?p:0)-((g=u.attribute.z)!==null&&g!==void 0?g:0))});for(let u=0;u<c.length;u++)if(e(c[u],u)){l=!0;break}}}else s.forEachChildren(e,i)}function j0(s,t,e){let i=arguments.length>3&&arguments[3]!==void 0&&arguments[3];return KT(this,void 0,void 0,function*(){yield s.forEachChildrenAsync(e,i)})}function qT(s,t,e){let i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],n=!1;s.forEachChildren((o,l)=>{const{zIndex:h=e}=o.attribute;if(l!==0){if(h!==void 0)return n=!0,!0}return!1},i);let r=null,a=!1;if(n){const{childMap:o,zIdxArray:l}=D0(s,e,i);let h=!1;for(let c=0;c<l.length&&!h;c++){const u=o[l[c]];for(let d=0;d<u.length;d++){if(a){h=!0,r=u[d];break}u[d]._uid!==t||(a=!0)}}}else s.forEachChildren(o=>a?(r=o,!0):(o._uid===t&&(a=!0),!1),i);return r}var ZT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},JT=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},op=function(s,t){return function(e,i){t(e,i,s)}};let Gh=class{constructor(s,t){this.contributions=s,this.drawItemInterceptorContributions=t,this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new es,this.backupDirtyBounds=new es,this.global=H.global,this.layerService=H.layerService,W(this.contributions)||(this.contributions=[this.contributions]),this.init()}init(){this.contributions.forEach(s=>{if(s.style){const t=this.styleRenderMap.get(s.style)||new Map;t.set(s.numberType,s),this.styleRenderMap.set(s.style,t)}else this.defaultRenderMap.set(s.numberType,s)}),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort((s,t)=>s.order-t.order)}prepareForDraw(s,t){t.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!t.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(s,t){this.prepareForDraw(s,t),t.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(t.renderStyle)||this.defaultRenderMap,this.currentRenderService=s;const{context:e,stage:i,viewBox:n,transMatrix:r}=t;if(!e)return;const a=this.dirtyBounds.setValue(0,0,n.width(),n.height());if(i.dirtyBounds&&!i.dirtyBounds.empty()){const l=function(h,c,u){if(h===null)return c;if(c===null)return h;const{x11:d,x12:p,y11:g,y12:f,x21:m,x22:v,y21:y,y22:_}=Df(h,c,u);return d>=v||p<=m||g>=_||f<=y?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(d,m),y1:Math.max(g,y),x2:Math.min(p,v),y2:Math.min(f,_)}}(a,i.dirtyBounds,!1);a.x1=Math.floor(l.x1),a.y1=Math.floor(l.y1),a.x2=Math.ceil(l.x2),a.y2=Math.ceil(l.y2)}const o=e.dpr%1;(o||o!==.5)&&(a.x1=Math.floor(a.x1*e.dpr)/e.dpr,a.y1=Math.floor(a.y1*e.dpr)/e.dpr,a.x2=Math.ceil(a.x2*e.dpr)/e.dpr,a.y2=Math.ceil(a.y2*e.dpr)/e.dpr),this.backupDirtyBounds.copy(a),e.inuse=!0,e.setClearMatrix(r.a,r.b,r.c,r.d,r.e,r.f),e.clearMatrix(),e.setTransformForCurrent(!0),e.translate(n.x1,n.y1,!0),e.beginPath(),e.rect(a.x1,a.y1,a.width(),a.height()),e.clip(),i.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(s,e,t),e.save(),s.renderTreeRoots.sort((l,h)=>{var c,u;return((c=l.attribute.zIndex)!==null&&c!==void 0?c:ie.zIndex)-((u=h.attribute.zIndex)!==null&&u!==void 0?u:ie.zIndex)}).forEach(l=>{l.isContainer?this.renderGroup(l,t,De.allocate(1,0,0,1,0,0)):this.renderItem(l,t)}),e.restore(),e.setClearMatrix(1,0,0,1,0,0),e.inuse=!1,e.draw()}doRegister(){throw new Error("暂不支持")}_findNextGraphic(s){let t=s.parent,e=s._uid;for(;t;){const i=qT(t,e,ie.zIndex);if(i)return i;e=t._uid,t=t.parent}return null}renderGroup(s,t,e,i){if(t.break||s.attribute.visibleAll===!1)return;if(s.incremental&&(t.startAtId==null||t.startAtId===s._uid))return t.break=!0,void this._increaseRender(s,t);if(this.useDirtyBounds&&!Aa(s.AABBBounds,this.dirtyBounds,!1)&&s.attribute.boundsMode!=="empty")return;let n,r=e;if(this.useDirtyBounds){n=Mh.allocateByObj(this.dirtyBounds);const a=s.transMatrix;r=De.allocateByObj(e).multiply(a.a,a.b,a.c,a.d,a.e,a.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(r.getInverse())}this.renderItem(s,t,{drawingCb:()=>{var a;i?s.forEachChildren(o=>{t.break||(o.isContainer?this.renderGroup(o,t,r):this.renderItem(o,t))}):F0(s,ie.zIndex,o=>{t.break||(o.isContainer?this.renderGroup(o,t,r):this.renderItem(o,t))},!1,!!(!((a=t.context)===null||a===void 0)&&a.camera))}}),this.useDirtyBounds&&(this.dirtyBounds.copy(n),Mh.free(n),De.free(r))}_increaseRender(s,t){const{layer:e,stage:i}=t,{subLayers:n}=e;let r=n.get(s._uid);r||(r={layer:this.layerService.createLayer(i),zIndex:n.size,group:s},n.set(s._uid,r));const a=r.layer.getNativeHandler().getContext(),o=r.drawContribution||kt.get(C0);o.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),o.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),o.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:o,clear:"transparent",layer:r.layer,context:a,startAtId:s._uid,break:!1})),r.drawContribution=o;const l=this._findNextGraphic(s);if(l)if(l.isContainer&&l.incremental)this._increaseRender(l,t);else{let h=n.get(l._uid);h||(h={layer:this.layerService.createLayer(i),zIndex:n.size},n.set(l._uid,h));const c=h.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:o,clear:"transparent",layer:h.layer,context:c,startAtId:l._uid,break:!1}))}}getRenderContribution(s){let t;return t||(t=this.selectRenderByNumberType(s.numberType,s)),t||(t=this.selectRenderByType(s.type)),t}renderItem(s,t,e){if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const l=this.InterceptorContributions[o];if(l.beforeDrawItem&&l.beforeDrawItem(s,this.currentRenderService,t,this,e))return}const i=this.getRenderContribution(s);if(!i)return;let n,r=this.scrollMatrix&&(this.scrollMatrix.e!==0||this.scrollMatrix.f!==0);if(s.parent){const{scrollX:o=0,scrollY:l=0}=s.parent.attribute;(o||l)&&(r=!0,this.scrollMatrix||(this.scrollMatrix=De.allocate(1,0,0,1,0,0)),this.scrollMatrix.translate(-o,-l))}if(r&&(n=this.dirtyBounds.clone().transformWithMatrix(this.scrollMatrix)),this.useDirtyBounds&&!s.isContainer&&s.attribute.boundsMode!=="empty"&&!Aa(s.AABBBounds,n??this.dirtyBounds,!1)){if(r&&s.parent){const{scrollX:o=0,scrollY:l=0}=s.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(o,l)}return}const a=t.startAtId!=null&&s._uid!==t.startAtId;if(s._uid===t.startAtId&&(t.startAtId=null),e&&(e.skipDraw=a),a?s.isContainer&&i.draw(s,this.currentRenderService,t,e):i.draw(s,this.currentRenderService,t,e),r&&s.parent){const{scrollX:o=0,scrollY:l=0}=s.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(o,l)}if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const l=this.InterceptorContributions[o];if(l.afterDrawItem&&l.afterDrawItem(s,this.currentRenderService,t,this))return}}selectRenderByType(s){return Tt.getInstance().warn("未知错误，不应该走到这里"),null}selectRenderByNumberType(s,t){let e;if(t.attribute.renderStyle){const i=this.styleRenderMap.get(t.attribute.renderStyle);e=i&&i.get(s)}return e||this.currentRenderMap.get(s)||this.defaultRenderMap.get(s)}clearScreen(s,t,e){var i,n;const{clear:r,viewBox:a}=e,o=a.width(),l=a.height();if(r){t.clearRect(0,0,o,l);const h=(i=s.drawParams)===null||i===void 0?void 0:i.stage;if(h&&(t.globalAlpha=(n=h.attribute.opacity)!==null&&n!==void 0?n:1),h&&h.backgroundImg&&h.resources){const c=h.resources.get(r);c&&c.state==="success"&&c.data&&t.drawImage(c.data,0,0,o,l)}else t.fillStyle=Fl(t,r,{AABBBounds:{x1:0,y1:0,x2:0+o,y2:0+l}},0,0),t.fillRect(0,0,o,l)}}afterDraw(s,t){}};Gh=ZT([nt(),op(0,dm(gi)),op(1,At(Jt)),op(1,ae(Fh)),JT("design:paramtypes",[Array,Object])],Gh);var QT=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};let Yh=class extends no{constructor(){super(...arguments),this.numberType=za}drawShape(s,t,e,i,n,r,a,o){if(s.incremental&&n.multiGraphicOptions){const{startAtIdx:l,length:h}=n.multiGraphicOptions,{segments:c=[]}=s.attribute;if(l>c.length)return;const u=Et(s).line,{fill:d=u.fill,stroke:p=u.stroke,opacity:g=u.opacity,fillOpacity:f=u.fillOpacity,strokeOpacity:m=u.strokeOpacity,lineWidth:v=u.lineWidth,visible:y=u.visible}=s.attribute,_=xn(g,f,d),b=Od(g,m),x=mr(d),S=Ua(p,v);if(!s.valid||!y||!x&&!S||!(_||b||a||o))return;const{context:A}=n;for(let w=l;w<l+h;w++)this.drawIncreaseSegment(s,A,c[w-1],c[w],s.attribute.segments[w],[u,s.attribute],e,i)}else super.drawShape(s,t,e,i,n,r,a,o)}drawIncreaseSegment(s,t,e,i,n,r,a,o){i&&(t.beginPath(),function(l,h,c,u){const{offsetX:d=0,offsetY:p=0}=u||{},g=h?h.points[h.points.length-1]:c.points[0];l.moveTo(g.x+d,g.y+p),c.points.forEach(f=>{f.defined!==!1?l.lineTo(f.x+d,f.y+p):l.moveTo(f.x+d,f.y+p)})}(t.nativeContext,e,i,{offsetX:a,offsetY:o}),t.setShadowBlendStyle&&t.setShadowBlendStyle(s,n,r),t.setStrokeStyle(s,n,a,o,r),t.stroke())}};Yh=QT([nt()],Yh);var tC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};let $h=class extends ro{constructor(){super(...arguments),this.numberType=Na}drawShape(s,t,e,i,n,r,a){if(s.incremental&&n.multiGraphicOptions){const{startAtIdx:o,length:l}=n.multiGraphicOptions,{segments:h=[]}=s.attribute;if(o>h.length)return;const c=Et(s).area,{fill:u=c.fill,fillOpacity:d=c.fillOpacity,opacity:p=c.opacity,visible:g=c.visible}=s.attribute,f=xn(p,d,u),m=mr(u);if(!s.valid||!g||!m||!f&&!a)return;for(let v=o;v<o+l;v++)this.drawIncreaseSegment(s,t,h[v-1],h[v],s.attribute.segments[v],[c,s.attribute],e,i)}else super.drawShape(s,t,e,i,n,r,a)}drawIncreaseSegment(s,t,e,i,n,r,a,o){i&&(t.beginPath(),function(l,h,c,u){const{offsetX:d=0,offsetY:p=0}=u||{},{points:g}=c,f=[];for(let m=0;m<g.length;m++)g[m].defined;f.push(g),f.forEach((m,v)=>{var y,_,b,x;const S=h&&v===0?h.points[h.points.length-1]:m[0];l.moveTo(S.x+d,S.y+p),m.forEach(A=>{A.defined!==!1?l.lineTo(A.x+d,A.y+p):l.moveTo(A.x+d,A.y+p)});for(let A=m.length-1;A>=0;A--){const w=m[A];l.lineTo((y=w.x1)!==null&&y!==void 0?y:w.x,(_=w.y1)!==null&&_!==void 0?_:w.y)}l.lineTo((b=S.x1)!==null&&b!==void 0?b:S.x,(x=S.y1)!==null&&x!==void 0?x:S.y),l.closePath()})}(t.camera?t:t.nativeContext,e,i,{offsetX:a,offsetY:o}),t.setShadowBlendStyle&&t.setShadowBlendStyle(s,n,r),t.setCommonStyle(s,n,a,o,r),t.fill())}};$h=tC([nt()],$h);var _r,eC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},iC=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},oo=function(s,t){return function(e,i){t(e,i,s)}},as=function(s,t,e,i){return new(e||(e=Promise))(function(n,r){function a(h){try{l(i.next(h))}catch(c){r(c)}}function o(h){try{l(i.throw(h))}catch(c){r(c)}}function l(h){var c;h.done?n(h.value):(c=h.value,c instanceof e?c:new e(function(u){u(c)})).then(a,o)}l((i=i.apply(s,[])).next())})};(function(s){s[s.NORMAL=0]="NORMAL",s[s.STOP=1]="STOP"})(_r||(_r={}));let lp=class extends Gh{constructor(s,t,e,i){super(s,i),this.contributions=s,this.lineRender=t,this.areaRender=e,this.drawItemInterceptorContributions=i,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=_r.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new ai([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(s,t){return as(this,void 0,void 0,function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=s,this.lastDrawContext=t,this.checkingForDrawPromise=this.checkForDraw(t);const e=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,e)return;this.currentRenderService=s;const{context:i,viewBox:n}=t;i&&(i.inuse=!0,i.clearMatrix(),i.setTransformForCurrent(!0),i.save(),t.restartIncremental&&this.clearScreen(this.currentRenderService,i,t),i.translate(n.x1,n.y1,!0),i.save(),s.renderTreeRoots.sort((r,a)=>{var o,l;return((o=r.attribute.zIndex)!==null&&o!==void 0?o:ie.zIndex)-((l=a.attribute.zIndex)!==null&&l!==void 0?l:ie.zIndex)}).forEach(r=>{this.renderGroup(r,t)}),this.hooks.completeDraw.tap("top-draw",()=>{i.restore(),i.restore(),i.draw(),i.inuse=!1,this.rendering=!1}))})}_increaseRender(s,t){return as(this,void 0,void 0,function*(){this.rendering=!0,yield this._renderIncrementalGroup(s,t)})}_renderIncrementalGroup(s,t){return as(this,void 0,void 0,function*(){this.count=s.count,yield new Promise(e=>{this.renderItem(s,t,{drawingCb:()=>as(this,void 0,void 0,function*(){if(s.count!==2)yield j0(s,ie.zIndex,(i,n)=>{if(this.status===_r.STOP)return!0;if(i.isContainer||n<this.currentIdx)return!1;const r=this.currFrameStartAt+s.incremental;return n<r&&(this.currentIdx=n+1,this.renderItem(i,t)),n===r-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())}),e(!1);else{const i=s.getChildAt(0);if(i.incremental&&i.attribute.segments)for(i.incrementalAt||(i.incrementalAt=0);i.incrementalAt<i.attribute.segments.length;)t.multiGraphicOptions={startAtIdx:i.incrementalAt,length:i.incremental},this.renderItem(i,t),i.incrementalAt+=i.incremental,yield this.waitToNextFrame();else this.renderItem(i,t);e(!1)}})})}),this.hooks.completeDraw.call()})}waitToNextFrame(){return as(this,void 0,void 0,function*(){return new Promise(s=>{this.global.getRequestAnimationFrame()(()=>{s(!1)})})})}checkForDraw(s){return as(this,void 0,void 0,function*(){let t=this.rendering;return s.restartIncremental&&(t=!1,yield this.forceStop(),this.resetToInit()),t})}forceStop(){return as(this,void 0,void 0,function*(){this.rendering&&(this.status=_r.STOP,yield new Promise(s=>{this.hooks.completeDraw.tap("stopCb",()=>{this.status=_r.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter(t=>t.name!=="stopCb"),s(!1)})}))})}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(s,t){return as(this,void 0,void 0,function*(){if(!t.break&&s.attribute.visibleAll!==!1)return s.incremental&&t.startAtId===s._uid?(yield this._increaseRender(s,t),void(t.break=!0)):void(yield new Promise(e=>{this.renderItem(s,t,{drawingCb:()=>as(this,void 0,void 0,function*(){yield j0(s,ie.zIndex,i=>as(this,void 0,void 0,function*(){t.break||i.isContainer&&(yield this.renderGroup(i,t))})),e(!1)})})}))})}};lp=eC([nt(),oo(0,dm(gi)),oo(1,At(Yh)),oo(2,At($h)),oo(3,At(Jt)),oo(3,ae(Fh)),iC("design:paramtypes",[Array,Object,Object,Object])],lp);var sC=new yt(s=>{s(yh).toSelf().inSingletonScope(),s(qd).toSelf().inSingletonScope(),s(sp).to(Gh),s(C0).to(lp),s(M0).to(tp).inSingletonScope(),s(gi).toService(M0),ze(s,qv),s(rs).toSelf().inSingletonScope(),ze(s,Zv),ze(s,gi),s(jh).toSelf().inSingletonScope(),s(Fh).toService(jh),ze(s,Fh)});function Xh(){Xh.__loaded||(Xh.__loaded=!0,kt.load(Iw),kt.load(zT),kt.load(jT),kt.load(NT),kt.load(WT),function(s){s.load(UT),s.load(GT),s.load(XT)}(kt),function(s){s.load(sC)}(kt))}Xh.__loaded=!1,Xh();const Me=kt.get(Bl);H.global=Me;const nC=kt.get(Gv);H.graphicUtil=nC;const rC=kt.get(Uv);H.transformUtil=rC;const aC=kt.get(Dv);H.graphicService=aC;const oC=kt.get(Id);H.layerService=oC;class lC{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=we.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&t.stage!=null&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,H.graphicService.hooks.onAttributeUpdate.tap(this.key,this.handleChange),H.graphicService.hooks.onSetStage.tap(this.key,this.handleChange),H.graphicService.hooks.onRemove.tap(this.key,this.handleChange)}deactivate(t){const e=i=>i.filter(n=>n.name!==this.key);H.graphicService.hooks.onAttributeUpdate.taps=e(H.graphicService.hooks.onAttributeUpdate.taps),H.graphicService.hooks.onSetStage.taps=e(H.graphicService.hooks.onSetStage.taps),H.graphicService.hooks.onRemove.taps=e(H.graphicService.hooks.onRemove.taps)}}class hC{constructor(){this.name="AutoRefreshPlugin",this.activeEvent="onRegister",this._uid=we.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&t.stage!=null&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,this.dpr=H.global.devicePixelRatio,this.refresh()}refresh(){this._refreshByMediaQuery()||this._refreshByRaf()}_refreshByRaf(){const t=H.global.getRequestAnimationFrame();this.rafId=t(()=>{H.global.devicePixelRatio!==this.dpr&&(this.dpr=H.global.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0)),this.refresh()})}_refreshByMediaQuery(){try{const t=\`(resolution: \${window.devicePixelRatio}dppx)\`,e=()=>{window.devicePixelRatio!==this.dpr&&(this.dpr=window.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0))},i=matchMedia(t);i&&i.addEventListener("change",e),this.autoRefreshCbs||(this.autoRefreshCbs=[]),this.autoRefreshCbs.push(()=>{i&&i.removeEventListener("change",e)})}catch{return!1}return!0}deactivate(t){var e;const i=H.global.getCancelAnimationFrame();i&&this.rafId&&i(this.rafId),(e=this.autoRefreshCbs)===null||e===void 0||e.forEach(n=>{n()}),this.autoRefreshCbs=void 0}}class cC{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=we.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,H.graphicService.hooks.onAddIncremental.tap(this.key,(e,i,n)=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&e.stage!=null&&(this.nextUserParams.startAtId=i._uid,this.renderNextFrame(i))}),H.graphicService.hooks.onClearIncremental.tap(this.key,(e,i)=>{e.stage===t.stage&&e.stage!=null&&(this.nextUserParams.startAtId=e._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(e))})}deactivate(t){H.graphicService.hooks.onAddIncremental.taps=H.graphicService.hooks.onAddIncremental.taps.filter(e=>e.name!==this.key),H.graphicService.hooks.onClearIncremental.taps=H.graphicService.hooks.onClearIncremental.taps.filter(e=>e.name!==this.key)}renderNextFrame(t){this.nextFrameRenderGroupSet.add(t),this.willNextFrameRender||(this.willNextFrameRender=!0,H.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){const t=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach(e=>{const i=e.layer;if(!i||!e.layer.subLayers)return;const n=e.layer.subLayers.get(e._uid);n&&n.drawContribution&&n.drawContribution.draw(t.renderService,Object.assign({stage:t,layer:i,viewBox:t.window.getViewBox(),transMatrix:t.window.getViewBoxTransform(),clear:"transparent",renderService:t.renderService,updateBounds:!1,startAtId:e._uid,context:n.layer.getNativeHandler().getContext()},this.nextUserParams))}),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}}const N0=new fe;class uC{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=we.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,e=>{e&&e===this.pluginService.stage&&e.dirtyBounds.clear()}),H.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,(e,i,n,r)=>{e.glyphHost&&(e=e.glyphHost),i&&i===this.pluginService.stage&&i.renderCount&&(e.isContainer&&!e.shouldSelfChangeUpdateAABBBounds()||n&&(N0.setValue(r.x1,r.y1,r.x2,r.y2),i.dirty(N0,e.parent&&e.parent.globalTransMatrix)))}),H.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,(e,i,n,r,a)=>{i&&i===this.pluginService.stage&&i.renderCount&&(e.isContainer&&!a||i.dirty(r.globalAABBBounds))}),H.graphicService.hooks.clearAABBBounds.tap(this.key,(e,i,n)=>{i&&i===this.pluginService.stage&&i.renderCount&&i&&i.dirty(n)}),H.graphicService.hooks.onRemove.tap(this.key,e=>{const i=e.stage;i&&i===this.pluginService.stage&&i.renderCount&&i&&i.dirty(e.globalAABBBounds)})}deactivate(t){H.graphicService.hooks.beforeUpdateAABBBounds.taps=H.graphicService.hooks.beforeUpdateAABBBounds.taps.filter(e=>e.name!==this.key),H.graphicService.hooks.afterUpdateAABBBounds.taps=H.graphicService.hooks.afterUpdateAABBBounds.taps.filter(e=>e.name!==this.key),H.graphicService.hooks.clearAABBBounds.taps=H.graphicService.hooks.clearAABBBounds.taps.filter(e=>e.name!==this.key),t.stage.hooks.afterRender.taps=t.stage.hooks.afterRender.taps.filter(e=>e.name!==this.key),H.graphicService.hooks.onRemove.taps=H.graphicService.hooks.onRemove.taps.filter(e=>e.name!==this.key)}}const hp=new class extends Ps{set mode(s){this._mode!==s&&(this._mode=s,this.setupTickHandler())}get mode(){return this._mode}constructor(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];super(),this.handleTick=(t,e)=>{const{once:i=!1}=e??{};this.ifCanStop()?this.stop():(this._handlerTick(),i||t.tick(this.interval,this.handleTick))},this._handlerTick=()=>{const t=this.tickerHandler.getTime();let e=0;this.lastFrameTime>=0&&(e=t-this.lastFrameTime),this.lastFrameTime=t,this.status===pi.RUNNING&&(this.tickCounts++,this.timelines.forEach(i=>{i.tick(e)}),this.emit("tick"))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.timelines=s,this.autoStop=!0}init(){this.interval=NaN,this.status=pi.INITIAL,H.global.hooks.onSetEnv.tap("default-ticker",()=>{this.initHandler()}),H.global.env&&this.initHandler()}addTimeline(s){this.timelines.push(s)}remTimeline(s){this.timelines=this.timelines.filter(t=>t!==s)}getTimelines(){return this.timelines}initHandler(){if(this._mode)return null;const s=[{mode:"raf",cons:La},{mode:"timeout",cons:Xl}];for(let t=0;t<s.length;t++)if(s[t].cons.Avaliable()){this.mode=s[t].mode;break}return null}setupTickHandler(){let s;switch(this._mode){case"raf":s=new La;break;case"timeout":s=new Xl;break;default:Tt.getInstance().warn("非法的计时器模式"),s=new La}return!!s.avaliable()&&(this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=s,!0)}setInterval(s){this.interval=s}getInterval(){return this.interval}setFPS(s){this.setInterval(1e3/s)}getFPS(){return 1e3/this.interval}tick(s){this.tickerHandler.tick(s,t=>{this.handleTick(t,{once:!0})})}tickTo(s){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(s,t=>{this.handleTick(t,{once:!0})})}pause(){return this.status!==pi.INITIAL&&(this.status=pi.PAUSE,!0)}resume(){return this.status!==pi.INITIAL&&(this.status=pi.RUNNING,!0)}ifCanStop(){return!!(this.autoStop&&(!this.timelines.length||this.timelines.reduce((s,t)=>s+t.animateCount,0)===0))}start(){let s=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return this.status===pi.RUNNING||!this.tickerHandler||!s&&(this.status===pi.PAUSE||!this.timelines.length||this.timelines.reduce((t,e)=>t+e.animateCount,0)===0)?!1:(this.status=pi.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0)}stop(){this.status=pi.INITIAL,this.setupTickHandler(),this.lastFrameTime=-1}release(){this.stop(),this.timelines=[],this.tickerHandler.release(),this.emit("afterTick")}trySyncTickStatus(){this.status===pi.RUNNING&&this._handlerTick()}};let br;function cp(){(function(){if(br==null)try{const t=document.createElement("canvas"),e=t.getContext("2d");br=!!(window&&t.getBoundingClientRect&&requestAnimationFrame&&window.devicePixelRatio&&e&&e.isPointInPath&&e.isPointInStroke),br&&(br=!!document.createElement)}catch{br=!1}})();const s=H.global&&H.global.env;return s?s==="browser":br}hp.addTimeline(Kl),hp.setFPS(60);let wn=class Tf{static registerPlugin(t,e){Tf._pluginClasses[t]=e}static getPlugin(t){return Tf._pluginClasses[t]}};wn._pluginClasses={};const z0="white";class dC extends Ss{set viewBox(t){this.window.setViewBox(t)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(t){const e=this.window.getViewBox();e.translate(t-e.x1,0),this.window.setViewBox(e)}get y(){return this.window.getViewBox().y1}set y(t){const e=this.window.getViewBox();e.translate(0,t-e.y1),this.window.setViewBox(e)}get width(){return this.window.width}set width(t){this.resize(t,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(t){this.resizeView(t,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(t){this.resizeView(this.viewWidth,t)}get height(){return this.window.height}set height(t){this.resize(this.width,t)}get dpr(){return this.window.dpr}set dpr(t){this.setDpr(t)}get background(){var t;return(t=this._background)!==null&&t!==void 0?t:z0}set background(t){this._background=t}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var e;super({}),this.tickedBeforeRender=!0,this._onVisibleChange=i=>{if(!(this._skipRender<0))if(i){if(this.dirtyBounds){const n=this.window.getViewBox();this.dirtyBounds.setValue(n.x1,n.y1,n.width(),n.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=i=>{this._beforeRender&&this._beforeRender(i)},this.afterRender=i=>{this.renderCount++,this._afterRender&&this._afterRender(i),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach(n=>n(i)),this._afterNextRenderCbs=null,this.tickedBeforeRender=!1},this.afterTickCb=()=>{var i;this.tickedBeforeRender=!0,((i=this.params.optimize)===null||i===void 0?void 0:i.tickRenderMode)==="performance"||this.state!=="rendering"&&this.render()},this.params=t,this.theme=new Oa,this.hooks={beforeRender:new ai(["stage"]),afterRender:new ai(["stage"])},this.global=H.global,!this.global.env&&cp()&&this.global.setEnv("browser"),this.window=kt.get(Wl),this.renderService=kt.get(I0),this.pluginService=kt.get(P0),this.layerService=kt.get(Id),this.pluginService.active(this,t),this.window.create({width:t.width,height:t.height,viewBox:t.viewBox,container:t.container,dpr:t.dpr||this.global.devicePixelRatio,canvasControled:t.canvasControled!==!1,title:t.title||"",canvas:t.canvas}),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._background=(e=t.background)!==null&&e!==void 0?e:z0,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=t.renderStyle,t.autoRender&&this.enableAutoRender(),t.autoRefresh&&this.enableAutoRefresh(),t.disableDirtyBounds===!1&&this.enableDirtyBounds(),t.enableHtmlAttribute&&this.enableHtmlAttribute(t.enableHtmlAttribute),t.ReactDOM&&this.enableReactAttribute(t.ReactDOM),t.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),this._beforeRender=t.beforeRender,this._afterRender=t.afterRender,this.ticker=t.ticker||hp,this.supportInteractiveLayer=t.interactiveLayer!==!1,this.timeline=new Zm,this.ticker.addTimeline(this.timeline),this.timeline.pause(),t.optimize||(t.optimize={}),this.optmize(t.optimize),t.background&&Q(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background}),this.ticker.on("afterTick",this.afterTickCb)}pauseRender(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1;this._skipRender=t}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new Ik(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(t){t?this._skipRender=-1/0:this.params.optimize.skipRenderWithOutRange!==!1?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(t){this.optmizeRender(t.skipRenderWithOutRange),this.params.optimize=t}optmizeRender(){arguments.length>0&&arguments[0]!==void 0&&arguments[0]&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(t){const{center:e={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:i={},alpha:n=0,beta:r=0,camera:a,fieldRatio:o=1,fieldDepth:l}=t;return Object.assign(Object.assign({},t),{center:e,light:i,alpha:n,beta:r,camera:a,fieldRatio:o,fieldDepth:l})}set3dOptions(t){var e,i,n,r,a,o;this.option3d=t;const l=this.get3dOptions(t),{light:h,center:c,camera:u,alpha:d,beta:p,fieldRatio:g,fieldDepth:f}=l,{dir:m=[1,1,-1],color:v="white",ambient:y}=h,_=((e=c.x)!==null&&e!==void 0?e:this.width/2)+((i=c.dx)!==null&&i!==void 0?i:0),b=((n=c.y)!==null&&n!==void 0?n:this.height/2)+((r=c.dy)!==null&&r!==void 0?r:0),x=[_,b,((a=c.z)!==null&&a!==void 0?a:0)+((o=c.dz)!==null&&o!==void 0?o:0)];let S=0,A=0,w=0;u||(S=Math.sin(d)+_,A=Math.sin(p)+b,w=Math.cos(d)*Math.cos(p)*1);const k=wn.getPlugin("DirectionalLight");k&&(this.light=new k(m,v,y));const T={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:g,fieldDepth:f,viewParams:{pos:[S,A,w],center:x,up:[0,1,0]}};if(this.camera)this.camera.params=T;else{const C=wn.getPlugin("OrthoCamera");C&&(this.camera=new C(T))}t.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(t){this._beforeRender=t}setAfterRender(t){this._afterRender=t}afterNextRender(t){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(t)}enableView3dTransform(){if(this.view3dTranform)return;this.view3dTranform=!0;const t=wn.getPlugin("ViewTransform3dPlugin");t&&this.pluginService.register(new t)}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new lC))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableAutoRefresh(){this.autoRefresh||(this.autoRefresh=!0,this.pluginService.register(new hC))}disableAutoRefresh(){this.autoRefresh&&(this.autoRefresh=!1,this.pluginService.findPluginsByName("AutoRefreshPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new cC))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new es;let t=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];t?t.activate(this.pluginService):(t=new uC,this.pluginService.register(t))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableLayout(){if(this._enableLayout)return;this._enableLayout=!0;const t=wn.getPlugin("FlexLayoutPlugin");t&&this.pluginService.register(new t)}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableHtmlAttribute(t){if(this.htmlAttribute)return;const e=wn.getPlugin("HtmlAttributePlugin");e&&(this.htmlAttribute=t,this.pluginService.register(new e))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableReactAttribute(t){if(this.reactAttribute)return;const e=wn.getPlugin("ReactAttributePlugin");e&&(this.reactAttribute=t,this.pluginService.register(new e))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName("ReactAttributePlugin").forEach(t=>{this.pluginService.unRegister(t)}))}getPluginsByName(t){return this.pluginService.findPluginsByName(t)}tryUpdateAABBBounds(){const t=this.window.getViewBox();return this._AABBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._AABBBounds}combineLayer(t,e){throw new Error("暂不支持")}createLayer(t,e){if(this.releaseStatus==="released")return;const i=this.layerService.createLayer(this,{main:!1,layerMode:e,canvasId:t});return this.appendChild(i),i}sortLayer(t){const e=this.children;e.sort(t),this.removeAllChild(),e.forEach(i=>{this.appendChild(i)})}removeLayer(t){return this.removeChild(this.findChildByUid(t))}tryInitInteractiveLayer(){this.releaseStatus!=="released"&&this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(t){this.window.clearViewBox(t)}render(t,e){if(this.releaseStatus==="released")return;this.ticker.start(),this.timeline.resume();const i=this.state;this.state="rendering",this.tickedBeforeRender||this.ticker.trySyncTickStatus(),this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=e,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=i,this._skipRender&&this._skipRender++}combineLayersToWindow(){if(this.global.env==="harmony"){const t=this.window.getContext().nativeContext;this.forEachChildren((e,i)=>{if(i>0){const n=e.getNativeHandler().getContext().canvas.nativeCanvas.nativeCanvas._c.transferToImageBitmap();t.transferFromImageBitmap(n)}})}}renderNextFrame(t,e){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(t||this).forEach(i=>{this.nextFrameRenderLayerSet.add(i)}),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){if(this.releaseStatus==="released")return;this.timeline.resume(),this.ticker.start();const t=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=t,this._skipRender&&this._skipRender++}renderLayerList(t,e){const i=[];for(let n=0;n<t.length;n++){let r=t[n];r.layerMode==="virtual"&&(r=r.getNativeHandler().mainHandler.layer),i.includes(r)||i.push(r)}i.forEach(n=>{n.renderCount>this.renderCount||(n.renderCount=this.renderCount+1,n===this.interactiveLayer&&this.dirtyBounds&&this.dirtyBounds.clear(),n.render({renderService:this.renderService,background:n===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}),this.interactiveLayer&&!t.includes(this.interactiveLayer)&&(this.dirtyBounds&&this.dirtyBounds.clear(),this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}resizeWindow(t,e){let i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.window.resize(t,e),i&&this.render()}resize(t,e){let i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.releaseStatus!=="released"&&(this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.window.resize(t,e),this.forEachChildren(n=>{n.resize(t,e)}),this.camera&&this.option3d&&this.set3dOptions(this.option3d),i&&this.render())}resizeView(t,e){let i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.releaseStatus!=="released"&&(this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.forEachChildren(n=>{n.resizeView(t,e)}),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),i&&this.render())}setViewBox(t,e,i,n,r){let a=!0;typeof t=="object"?(this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2),e===!1&&(a=!1)):(this.viewBox.setValue(t,e,t+i,e+n),r===!1&&(a=!1)),this.forEachChildren(o=>{o.resizeView(this.viewBox.width(),this.viewBox.height())}),a&&this.render()}setDpr(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.forEachChildren(i=>{i.setDpr(t)}),e&&this.render()}setOrigin(t,e){throw new Error("暂不支持")}export(t){throw new Error("暂不支持")}pick(t,e){if(this.releaseStatus==="released")return;const i=this.getPickerService().pick(this.children,new Lt(t,e),{bounds:this.AABBBounds});return!(!(i!=null&&i.graphic)&&!(i!=null&&i.group))&&i}startAnimate(t){throw new Error("暂不支持")}setToFrame(t){throw new Error("暂不支持")}release(){super.release(),this.hooks.beforeRender.unTap("constructor",this.beforeRender),this.hooks.afterRender.unTap("constructor",this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach(t=>{t.release()}),this.interactiveLayer&&(this.interactiveLayer.forEachChildren(t=>{t.setStage&&t.setStage(null,null),this.interactiveLayer.removeChild(t)}),this.interactiveLayer.release()),this.window.release(),this.ticker.remTimeline(this.timeline),this.ticker.removeListener("afterTick",this.afterTickCb),this.renderService.renderTreeRoots=[]}setStage(t){}dirty(t,e){this.releaseStatus!=="released"&&(e&&t.transformWithMatrix(e),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(t.x1,t.y1,t.x2,t.y2),this.dirtyBounds.union(t))}getLayer(t){return this.children.filter(e=>e.name===t)[0]}renderTo(t){this.releaseStatus!=="released"&&this.forEachChildren((e,i)=>{e.drawTo(t,{renderService:this.renderService,viewBox:t.getViewBox(),transMatrix:t.getViewBoxTransform(),background:e===this.defaultLayer?this.background:void 0,clear:i===0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})})}renderToNewWindow(){let t=arguments.length>1?arguments[1]:void 0;if(this.releaseStatus==="released")return;const e=kt.get(Wl),i=t?-t.x1:0,n=t?-t.y1:0,r=t?t.x2:this.viewWidth,a=t?t.y2:this.viewHeight,o=t?t.width():this.viewWidth,l=t?t.height():this.viewHeight;return e.create({viewBox:{x1:i,y1:n,x2:r,y2:a},width:o,height:l,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""}),this.renderTo(e),e}toCanvas(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],e=arguments.length>1?arguments[1]:void 0;if(this.releaseStatus==="released")return;const i=this.renderToNewWindow(t,e).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}setCursor(t){this._cursor=t,this.eventSystem.setCursor(t,"ignore")}getCursor(){return this._cursor}eventPointTransform(t){const e=this.global.mapToCanvasPoint(t,this.window.getContext().canvas.nativeCanvas);return this.stage.window.pointTransform(e.x,e.y)}pauseTriggerEvent(){this._eventSystem&&this._eventSystem.pauseTriggerEvent()}resumeTriggerEvent(){this._eventSystem&&this._eventSystem.resumeTriggerEvent()}getPickerService(){return this.pickerService||(this.pickerService=kt.get(As)),this.pickerService}}var pC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},gC=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};const fC=new Zt(1,0,0,1,0,0),xr={x:0,y:0};let up=class{get nativeContext(){return this.path}constructor(s,t){this.matrix=new Zt(1,0,0,1,0,0),this.stack=[],this.dpr=t,this.applyedMatrix=new Zt(1,0,0,1,0,0),this.path=new me,this._clearMatrix=new Zt(1,0,0,1,0,0)}getCanvas(){throw new Error("不支持getCanvas")}getContext(){throw new Error("不支持getContext")}setTransformForCurrent(){!(arguments.length>0&&arguments[0]!==void 0&&arguments[0])&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix=this.cloneMatrix(this.matrix))}get currentMatrix(){return this.matrix}cloneMatrix(s){return De.allocateByObj(s)}clear(){this.save(),this.resetTransform(),this.restore()}restore(){this.stack.length>0&&(De.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent())}highPerformanceRestore(){this.stack.length>0&&(De.free(this.matrix),this.matrix=this.stack.pop())}rotate(s){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.matrix.rotate(s),t&&this.setTransformForCurrent()}save(){const s=this.cloneMatrix(this.matrix);this.stack.push(s)}highPerformanceSave(){const s=this.cloneMatrix(this.matrix);this.stack.push(s)}scale(s,t){let e=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.scale(s,t),e&&this.setTransformForCurrent()}setScale(s,t){let e=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.setScale(s,t),e&&this.setTransformForCurrent()}scalePoint(s,t,e,i){let n=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];this.translate(e,i,!1),this.scale(s,t,!1),this.translate(-e,-i,!1),n&&this.setTransformForCurrent()}setTransform(s,t,e,i,n,r){let a=!(arguments.length>6&&arguments[6]!==void 0)||arguments[6],o=arguments.length>7&&arguments[7]!==void 0?arguments[7]:this.dpr;this.matrix.setValue(o*s,o*t,o*e,o*i,o*n,o*r),a&&this.setTransformForCurrent()}setTransformFromMatrix(s){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.dpr;this.matrix.setValue(s.a*e,s.b*e,s.c*e,s.d*e,s.e*e,s.f*e),t&&this.setTransformForCurrent()}resetTransform(){let s=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.dpr;this.setTransform(t,0,0,t,0,0),s&&this.setTransformForCurrent()}transform(s,t,e,i,n,r){let a=!(arguments.length>6&&arguments[6]!==void 0)||arguments[6];this.matrix.multiply(s,t,e,i,n,r),a&&this.setTransformForCurrent()}transformFromMatrix(s,t){this.matrix.multiply(s.a,s.b,s.c,s.d,s.e,s.f),t&&this.setTransformForCurrent()}translate(s,t){let e=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.translate(s,t),e&&this.setTransformForCurrent()}rotateDegrees(s){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];const e=s*Math.PI/180;this.rotate(e,t)}rotateAbout(s,t,e){let i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];this.translate(t,e,!1),this.rotate(s,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}rotateDegreesAbout(s,t,e){let i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];this.translate(t,e,!1),this.rotateDegrees(s,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}beginPath(){this.path.clear()}clip(s,t){}arc(s,t,e,i,n,r){this.path.arc(s,t,e,i,n,r)}arcTo(s,t,e,i,n){this.path.arcTo(s,t,e,i,n)}bezierCurveTo(s,t,e,i,n,r){this.path.bezierCurveTo(s,t,e,i,n,r)}closePath(){this.path.closePath()}ellipse(s,t,e,i,n,r,a,o){}lineTo(s,t){this.path.lineTo(s,t)}moveTo(s,t){this.path.moveTo(s,t)}quadraticCurveTo(s,t,e,i){this.path.quadraticCurveTo(s,t,e,i)}rect(s,t,e,i){this.path.rect(s,t,e,i)}createImageData(s,t){return null}createLinearGradient(s,t,e,i){throw new Error("不支持createLinearGradient")}createPattern(s,t){throw new Error("不支持createPattern")}createRadialGradient(s,t,e,i,n,r){throw new Error("不支持createRadialGradient")}createConicGradient(s,t,e,i){return null}fill(s,t){}fillRect(s,t,e,i){this.path.rect(s,t,e,i)}clearRect(s,t,e,i){}fillText(s,t,e){}getImageData(s,t,e,i){return null}getLineDash(){return[]}isPointInPath(s,t){return this.matrix.transformPoint({x:s,y:t},xr),function(e,i,n){return Gm(e,0,!1,i,n)}(this.path.commandList,xr.x,xr.y)}isPointInStroke(s,t){if(!this.lineWidth)return!1;this.matrix.transformPoint({x:s,y:t},xr);const e=ms(this,this.lineWidth,this.dpr);return function(i,n,r,a){return Gm(i,n,!0,r,a)}(this.path.commandList,e,xr.x,xr.y)}measureText(s){throw new Error("不支持measureText")}putImageData(s,t,e){throw new Error("不支持measureText")}setLineDash(s){}stroke(s){}strokeRect(s,t,e,i){this.path.rect(s,t,e,i)}strokeText(s,t,e){}drawImage(){}setCommonStyle(s,t,e,i,n){}_setCommonStyle(s,t,e,i){}setStrokeStyle(s,t,e,i,n){}_setStrokeStyle(s,t,e,i){}setTextStyleWithoutAlignBaseline(s,t){}setTextStyle(s,t){}draw(){}clearMatrix(){let s=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.dpr;this.setTransformFromMatrix(fC,s,t)}setClearMatrix(s,t,e,i,n,r){this._clearMatrix.setValue(s,t,e,i,n,r)}onlyTranslate(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.dpr;return this.matrix.a===s&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===s}release(){this.stack.forEach(s=>De.free(s)),this.stack.length=0}};up=pC([nt(),gC("design:paramtypes",[Object,Number])],up);const dp={WIDTH:500,HEIGHT:500,DPR:1};class Kh{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get nativeCanvas(){return this._nativeCanvas}set nativeCanvas(t){this._nativeCanvas=t}get width(){return this._pixelWidth}set width(t){this._pixelWidth=t,this._displayWidth=t/(this._dpr||1)}get height(){return this._pixelHeight}set height(t){this._pixelHeight=t,this._displayHeight=t/(this._dpr||1)}getContext(t){return this._context}get visiable(){return this._visiable}set visiable(t){this._visiable=t,t?this.show():this.hide()}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this.resize(this._displayWidth,this._displayHeight)}constructor(t){var e;const{nativeCanvas:i,width:n=dp.WIDTH,height:r=dp.HEIGHT,dpr:a=dp.DPR,x:o,y:l,id:h,canvasControled:c=!0}=t;this._x=o??0,this._y=l??0,this._pixelWidth=n*a,this._pixelHeight=r*a,this._visiable=t.visiable!==!1,this.controled=c,this._displayWidth=n,this._displayHeight=r,this._dpr=a,this._nativeCanvas=i,this._id=(e=i.id)!==null&&e!==void 0?e:h,h&&(i.id=h),this.init(t)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(t){}resize(t,e){}toDataURL(t,e){return""}readPixels(t,e,i,n){return this._context.getImageData(t,e,i,n)}convertToBlob(t){throw new Error("暂未实现")}transferToImageBitmap(){throw new Error("暂未实现")}release(){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}}Kh.env="browser";var mC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},vC=function(s,t,e,i){return new(e||(e=Promise))(function(n,r){function a(h){try{l(i.next(h))}catch(c){r(c)}}function o(h){try{l(i.throw(h))}catch(c){r(c)}}function l(h){var c;h.done?n(h.value):(c=h.value,c instanceof e?c:new e(function(u){u(c)})).then(a,o)}l((i=i.apply(s,[])).next())})};let lo=class{configure(s){s.env===this.type&&s.setActiveEnvContribution(this)}getNativeAABBBounds(s){return new fe}removeDom(s){return!1}createDom(s){return null}updateDom(s,t){return!1}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(s){return document.getElementById(s)}getRootElement(){return document.body}loadJson(s){const t=fetch(s).then(e=>e.json());return t.then(e=>({data:e,state:"success"})).catch(()=>({data:null,state:"fail"})),t}loadArrayBuffer(s){return fetch(s).then(t=>t.arrayBuffer()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadBlob(s){return fetch(s).then(t=>t.blob()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}getElementTop(s,t){return 0}getElementLeft(s,t){return 0}getElementTopLeft(s,t){return{top:0,left:0}}loadFont(s,t,e){return vC(this,void 0,void 0,function*(){return{loadState:"fail"}})}isMacOS(){return!1}copyToClipBoard(s){return Promise.resolve(null)}};lo=mC([nt()],lo);var yC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},_C=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};let ho=class{constructor(){this._uid=we.GenAutoIncrementId(),this.viewBox=new fe,this.modelMatrix=new Zt(1,0,0,1,0,0)}onChange(s){this._onChangeCb=s}configure(s,t){t.env===this.type&&s.setWindowHandler(this)}release(){this.releaseWindow()}isVisible(s){return!0}onVisibleChange(s){}getTopLeft(s){return{top:0,left:0}}setViewBox(s){this.viewBox.setValue(s.x1,s.y1,s.x2,s.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(s,t,e,i,n,r){this.modelMatrix.setValue(s,t,e,i,n,r)}getViewBoxTransform(){return this.modelMatrix}};ho=yC([nt(),_C("design:paramtypes",[])],ho);var bC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},xC=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},qh=function(s,t){return function(e,i){t(e,i,s)}};let Zh=class{constructor(s,t){this.pickItemInterceptorContributions=s,this.pickServiceInterceptorContributions=t,this.type="default",this.global=H.global}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort((s,t)=>s.order-t.order),this.pickerServiceInterceptorContributions=this.pickServiceInterceptorContributions.getContributions().sort((s,t)=>s.order-t.order)}pick(s,t,e){let i={graphic:null,group:null};e.pickerService=this;const n=e.bounds.width(),r=e.bounds.height();if(!new fe().setValue(0,0,n,r).containsPoint(t))return i;this.pickContext&&(this.pickContext.inuse=!0),e.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);const a=new Zt(1,0,0,1,0,0);let o;for(let l=s.length-1;l>=0&&(i=s[l].isContainer?this.pickGroup(s[l],t,a,e):this.pickItem(s[l],t,a,e),!i.graphic);l--)o||(o=i.group);if(i.graphic||(i.group=o),this.pickContext&&(this.pickContext.inuse=!1),this.pickerServiceInterceptorContributions.length)for(let l=0;l<this.pickerServiceInterceptorContributions.length;l++){const h=this.pickerServiceInterceptorContributions[l];h.afterPickItem&&(i=h.afterPickItem(i,this,t,e,{parentMatrix:a}))}return i}containsPoint(s,t,e){var i;return!!(!((i=this.pickItem(s,t,null,e??{pickContext:this.pickContext,pickerService:this}))===null||i===void 0)&&i.graphic)}pickGroup(s,t,e,i){let n={group:null,graphic:null};if(s.attribute.visibleAll===!1)return n;const r=i.pickContext,a=r.modelMatrix;if(r.camera){const p=s.transMatrix,g=ye.allocate();if(Hd(g,p),a){if(g){const f=ye.allocate();r.modelMatrix=Xa(f,a,g),ye.free(g)}}else Hd(g,s.globalTransMatrix),r.modelMatrix=g}if(this.InterceptorContributions.length)for(let p=0;p<this.InterceptorContributions.length;p++){const g=this.InterceptorContributions[p];if(g.beforePickItem){const f=g.beforePickItem(s,this,t,i,{parentMatrix:e});if(f)return r.modelMatrix!==a&&ye.free(r.modelMatrix),r.modelMatrix=a,f}}const o=s.transMatrix,l=De.allocateByObj(e),h=new Lt(t.x,t.y);l.transformPoint(h,h);const c=s.AABBBounds.containsPoint(h);if(!c&&!s.stage.camera)return n;const u=this.pickItem(s,h.clone(),e,i);u&&u.graphic&&(n.graphic=u.graphic,n.params=u.params);const d=s.attribute.pickable!==!1&&c;return l.multiply(o.a,o.b,o.c,o.d,o.e,o.f),s.attribute.childrenPickable===!1||u&&u.graphic||F0(s,ie.zIndex,p=>{if(p.isContainer){const g=new Lt(t.x,t.y),f=Et(s).group,{scrollX:m=f.scrollX,scrollY:v=f.scrollY}=s.attribute;g.x-=m,g.y-=v,n=this.pickGroup(p,g,l,i)}else{const g=new Lt(t.x,t.y);l.transformPoint(g,g);const f=Et(s).group,{scrollX:m=f.scrollX,scrollY:v=f.scrollY}=s.attribute;g.x-=m,g.y-=v;const y=this.pickItem(p,g,e,i);y&&y.graphic&&(n.graphic=y.graphic,n.params=y.params)}return!!n.graphic||!!n.group},!0,!!r.camera),r.modelMatrix!==a&&ye.free(r.modelMatrix),r.modelMatrix=a,n.graphic||n.group||!d||s.stage.camera||(n.group=s),De.free(l),n}selectPicker(s){return this.pickerMap.get(s.numberType)||null}};Zh=bC([nt(),qh(0,At(Jt)),qh(0,ae(kn)),qh(1,At(Jt)),qh(1,ae(ao)),xC("design:paramtypes",[Object,Object])],Zh);let H0=!1;const SC=new yt(s=>{H0||(H0=!0,s(Sh).toSelf().inSingletonScope(),s(Bh).to(Sh).inSingletonScope(),s(gi).toService(Bh),s(Ld).toService(rs),ze(s,Ld))});let V0=!1;const AC=new yt(s=>{V0||(V0=!0,s(Th).toSelf().inSingletonScope(),s(Lh).to(Th).inSingletonScope(),s(gi).toService(Lh),s(xh).toSelf(),s(bh).toSelf(),s(Ga).toService(xh),s(Ga).toService(bh),s(Ga).toService(rs),ze(s,Ga))});let W0=!1;const kC=new yt(s=>{W0||(W0=!0,s(no).toSelf().inSingletonScope(),s(Yh).toSelf().inSingletonScope(),s(Ih).to(no).inSingletonScope(),s(gi).toService(Ih))});let U0=!1;const wC=new yt(s=>{U0||(U0=!0,s(ro).toSelf().inSingletonScope(),s(Rh).to(ro).inSingletonScope(),s(gi).toService(Rh),s(Dd).toService(rs),ze(s,Dd),s($h).toSelf().inSingletonScope())});let G0=!1;const TC=new yt(s=>{G0||(G0=!0,s(Ch).toSelf().inSingletonScope(),s(Dh).to(Ch).inSingletonScope(),s(gi).toService(Dh),s(Nd).toService(rs),ze(s,Nd))});let Y0=!1;const CC=new yt(s=>{Y0||(Y0=!0,s(ep).to(Zd).inSingletonScope(),s(gi).toService(ep),s(zd).toService(rs),ze(s,zd))});let $0=!1;const MC=new yt(s=>{$0||($0=!0,s(wh).toSelf().inSingletonScope(),s(Oh).to(wh).inSingletonScope(),s(gi).toService(Oh),s(Fd).toService(rs),ze(s,Fd))});let X0=!1;const EC=new yt(s=>{X0||(X0=!0,s(Ph).to(Qd).inSingletonScope(),s(gi).toService(Ph),s(jd).toService(rs),ze(s,jd))});var BC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},RC=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};let pp=class extends Vi{constructor(){super(),this.numberType=Bd,this.builtinContributions=[S0],this.init()}drawShape(s,t,e,i,n){const r=Et(s).richtext,{strokeOpacity:a=r.strokeOpacity,opacity:o=r.opacity,fillOpacity:l=r.fillOpacity,visible:h=r.visible}=s.attribute;if(!s.valid||!h)return;const c=xn(o,l,!0),u=xn(o,a,!0);c&&(t.setShadowBlendStyle&&t.setShadowBlendStyle(s,s.attribute,r),t.translate(e,i),this.beforeRenderStep(s,t,e,i,c,u,c,u,r,n),s.getFrameCache().draw(t,this.drawIcon),this.afterRenderStep(s,t,e,i,c,u,c,u,r,n))}drawIcon(s,t,e,i,n){var r;const a=Et(s).richtextIcon,{width:o=a.width,height:l=a.height,opacity:h=a.opacity,image:c,backgroundFill:u=a.backgroundFill,backgroundFillOpacity:d=a.backgroundFillOpacity,backgroundStroke:p=a.backgroundStroke,backgroundStrokeOpacity:g=a.backgroundStrokeOpacity,backgroundRadius:f=a.backgroundRadius,margin:m}=s.attribute,{backgroundWidth:v=o,backgroundHeight:y=l}=s.attribute;if(m&&(e+=s._marginArray[3],i+=s._marginArray[0]),s._hovered){const b=(v-o)/2,x=(y-l)/2;f===0?(t.beginPath(),t.rect(e-b,i-x,v,y)):(t.beginPath(),yr(t,e-b,i-x,v,y,f,!0)),u&&(t.globalAlpha=d,t.fillStyle=u,t.fill()),p&&(t.globalAlpha=g,t.strokeStyle=p,t.stroke())}const _=c&&((r=s==null?void 0:s.resources)===null||r===void 0?void 0:r.get(c));_&&_.state==="success"&&(t.globalAlpha=h,t.drawImage(_.data,e,i,o,l))}draw(s,t,e){const i=Et(s).richtext;this._draw(s,i,!1,e)}};pp=BC([nt(),RC("design:paramtypes",[])],pp);let K0=!1;const IC=new yt(s=>{K0||(K0=!0,s(ip).to(pp).inSingletonScope(),s(gi).toService(ip))});function gp(s){const t=[];for(let e=0;e<s.length;e++){const i=s[e];e!==0&&i[0]===t[t.length-1]||t.push(i[0]),t.push(i[1])}return t}const os=(s,t)=>(U(Jh.warnHandler)&&Jh.warnHandler.call(null,s,t),Tt.getInstance().warn(\`[VChart warn]: \${s}\`)),co=(s,t,e)=>{if(!U(Jh.errorHandler))throw new Error(s);Jh.errorHandler.call(null,s,t)},Jh={warnHandler:!1,errorHandler:!1},q0=cp(),Sr=q0&&globalThis?globalThis.document:void 0;function ks(s){return(s==="desktop-browser"||s==="mobile-browser")&&q0}function Ar(s){return kr(s)||s==="mobile-browser"}function kr(s){return s.includes("miniApp")||s==="lynx"||s==="wx"||s==="harmony"}let fp=0;function Tn(){return fp>=9999999&&(fp=0),fp++}function wr(s){return s!=null&&s!==""&&(!!it(s)||+s==+s)}function uo(s){return!(!s||s.length===0)&&!I(s[0])&&!I(s[0].dataId)&&W(s[0].fields)}const OC=s=>t=>vt(t,s),PC=s=>s,mp=s=>{Tt.getInstance().error(s)},Z0=function(s,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(U(s))return s;const i=(r=>{const a=[],o=r.length;let l,h,c,u=null,d=0,p="";r+="";const g=()=>{a.push(p+r.substring(l,h)),p="",l=h+1};for(l=0,h=0;h<o;h+=1)if(c=r[h],c==="\\\\")p+=r.substring(l,h),p+=r.substring(++h,++h),l=h;else if(c===u)g(),u=null,d=-1;else{if(u)continue;l===d&&c==='"'||l===d&&c==="'"?(l=h+1,u=c):c!=="."||d?c==="["?(h>l&&g(),l=h+1,d=l):c==="]"&&(d||mp("Access path missing open bracket: "+r),d>0&&g(),d=0,l=h+1):h>l?g():l=h+1}return d&&mp("Access path missing closing bracket: "+r),u&&mp("Access path missing closing quote: "+r),h>l&&(h+=1,g()),a})(s),n=i.length===1?i[0]:s;return((r,a,o)=>(r.fields=a||[],r.fname=o,r))((e&&e.get||OC)(i),[n],n)},Qh=function(s,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(W(s)){const i=s.map(n=>Z0(n,t,e));return n=>i.map(r=>r(n))}return Z0(s,t,e)},LC=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"];class Wi extends Ss{constructor(t,e){super(t),this._skipRenderAttributes=LC,e!=null&&e.mode&&(this.mode=e.mode,this.setMode(e.mode)),e!=null&&e.skipDefault&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=t,this.onSetStage(()=>{this.render(),this.bindEvents()})}setAttribute(t,e,i,n){const r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,n);if(r)return this._setAttributes(r,i);Ji(this.attribute[t])&&Ji(e)&&!U(this.attribute[t])&&!U(e)?rt(this.attribute[t],e):this.attribute[t]=e,this._skipRenderAttributes.includes(t)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(t,e,i){return t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t,this._setAttributes(t,e)}_setAttributes(t,e){const i=Object.keys(t);this._mergeAttributes(t,i),i.every(n=>this._skipRenderAttributes.includes(n))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(i)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(t,e){I(e)&&(e=Object.keys(t));for(let i=0;i<e.length;i++){const n=e[i];!Ji(this.attribute[n])||U(this.attribute[n])||U(t[n])?this.attribute[n]=t[n]:rt(this.attribute[n],t[n])}}bindEvents(){}_getNodeId(t){var e;return\`\${(e=this.id)!==null&&e!==void 0?e:this._uid}-\${this.name}-\${t}\`}_dispatchEvent(t,e){var i;const n=new $l(t,e);n.manager=(i=this.stage)===null||i===void 0?void 0:i.eventSystem.manager,this.dispatchEvent(n)}}const Ui=Symbol.for("MathPickerContribution"),J0=Symbol.for("MathArcPicker"),Q0=Symbol.for("MathAreaPicker"),ty=Symbol.for("MathCirclePicker"),tc=Symbol.for("MathImagePicker"),ey=Symbol.for("MathLinePicker"),iy=Symbol.for("MathPathPicker"),sy=Symbol.for("MathRectPicker"),ny=Symbol.for("MathSymbolPicker"),ry=Symbol.for("MathTextPicker"),ay=Symbol.for("MathPolygonPicker"),oy=Symbol.for("MathGlyphPicker"),ly=Symbol.for("CanvasArcPicker"),hy=Symbol.for("CanvasAreaPicker"),cy=Symbol.for("CanvasLinePicker"),uy=Symbol.for("CanvasPathPicker"),dy=Symbol.for("CanvasRectPicker"),py=Symbol.for("CanvasSymbolPicker"),gy=Symbol.for("CanvasTextPicker"),fy=Symbol.for("CanvasPolygonPicker"),my=Symbol.for("CanvasRichTextPicker"),vy=Symbol.for("CanvasGroupPicker"),Ri=Symbol.for("CanvasPickerContribution"),yy=(s,t)=>{const e=t.x-s.x,i=t.y-s.y;return Math.abs(e)>Math.abs(i)?e>0?"right":"left":i>0?"down":"up"},ec=(s,t)=>{const e=Math.abs(t.x-s.x),i=Math.abs(t.y-s.y);return Math.sqrt(e*e+i*i)};class DC extends Ps{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,n,r,a,o,l,h,c,u,d;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=p=>{this.startTime=bn.now();const{cachedEvents:g,startPoints:f}=this;p&&g.push(p.clone()),f.length=g.length;for(let m=0;m<g.length;m++){const{x:v,y}=g[m],_={x:v,y};f[m]=_}if(f.length!==1)this.startDistance=ec(f[0],f[1]),this.center=(m=>{const v=m.length;if(v===1)return{x:Math.round(m[0].x),y:Math.round(m[0].y)};let y=0,_=0,b=0;for(;b<v;)y+=m[b].x,_+=m[b].y,b++;return{x:Math.round(y/v),y:Math.round(_/v)}})([f[0],f[1]]);else{const m=g[0];this.pressTimeout=setTimeout(()=>{m.direction="none",m.deltaX=0,m.deltaY=0,m.points=f,this.triggerStartEvent("press",m),this.triggerEvent("press",m),this.eventType="press",this.direction="none",this.pressTimeout=null},this.config.press.time)}},this.onMove=p=>{this.clearPressTimeout();const{startPoints:g,cachedEvents:f}=this;if(!g.length)return;const m=p.clone(),{x:v,y,pointerId:_}=m;for(let k=0,T=f.length;k<T;k++)if(_===f[k].pointerId){f[k]=m;break}const b={x:v,y},x=f.map(k=>({x:k.x,y:k.y})),S=bn.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=S,this.lastMovePoint=b,g.length===1){const k=g[0],T=v-k.x,C=y-k.y,M=this.direction||yy(k,b);this.direction=M;const B=this.getEventType(b);return m.direction=M,m.deltaX=T,m.deltaY=C,m.points=x,this.triggerStartEvent(B,m),void this.triggerEvent(B,m)}const{startDistance:A}=this,w=ec(x[0],x[1]);m.scale=w/A,m.center=this.center,m.points=x,this.triggerStartEvent("pinch",m),this.triggerEvent("pinch",m)},this.onEnd=p=>{const g=p.clone(),{cachedEvents:f,startPoints:m}=this,v=f.map(y=>({x:y.x,y:y.y}));if(g.points=v,this.triggerEndEvent(g),f.length===1){const y=bn.now(),_=this.lastMoveTime;if(y-_<100){const b=_-(this.prevMoveTime||this.startTime);if(b>0){const x=this.prevMovePoint||m[0],S=this.lastMovePoint||m[0],A=ec(x,S),w=A/b;if(w>this.config.swipe.velocity&&A>this.config.swipe.threshold)return g.velocity=w,g.direction=yy(x,S),this.triggerEvent("swipe",g),this.cachedEvents=[],this.startPoints=[],void this.reset()}}y-this.startTime<this.config.press.time&&(y-this.lastTapTime<this.config.tap.interval&&p.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=y,this.lastTapTarget=p.target,this.tapCount===1?this.triggerEvent("tap",g):this.tapCount===2&&(this.triggerEvent("doubletap",g),this.tapCount=0))}for(let y=0,_=f.length;y<_;y++)if(f[y].pointerId===g.pointerId){f.splice(y,1),m.splice(y,1);break}this.reset(),f.length>0&&this.onStart()},this.element=t,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:(n=(i=e==null?void 0:e.press)===null||i===void 0?void 0:i.time)!==null&&n!==void 0?n:251,threshold:(a=(r=e==null?void 0:e.press)===null||r===void 0?void 0:r.threshold)!==null&&a!==void 0?a:9},swipe:{threshold:(l=(o=e==null?void 0:e.swipe)===null||o===void 0?void 0:o.threshold)!==null&&l!==void 0?l:10,velocity:(c=(h=e==null?void 0:e.swipe)===null||h===void 0?void 0:h.velocity)!==null&&c!==void 0?c:.3},tap:{interval:(d=(u=e==null?void 0:e.tap)===null||u===void 0?void 0:u.interval)!==null&&d!==void 0?d:300}},this.initEvents()}initEvents(){const{element:t}=this;t&&(t.addEventListener("pointerdown",this.onStart),t.addEventListener("pointermove",this.onMove),t.addEventListener("pointerup",this.onEnd),t.addEventListener("pointerleave",this.onEnd),t.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){const{element:t}=this;t&&(t.removeEventListener("pointerdown",this.onStart),t.removeEventListener("pointermove",this.onMove),t.removeEventListener("pointerup",this.onEnd),t.removeEventListener("pointerleave",this.onEnd),t.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(t){const{eventType:e,startTime:i,startPoints:n}=this;if(e==="press")return e;let r;return r=bn.now()-i>this.config.press.time&&ec(n[0],t)<this.config.press.threshold?"press":"pan",this.eventType=r,r}enable(t){this.processEvent[t]=!0}isProcess(t){return this.processEvent[t]}pushEvent(t,e){const{emitThrottles:i}=this,n={type:t,ev:e};for(let r=0,a=i.length;r<a;r++)if(i[r].type===t)return void i.splice(r,1,n);i.push(n)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(t,e){this.pushEvent(t,e);const{throttleTimer:i,emitThrottles:n}=this;i||(this.throttleTimer=H.global.getRequestAnimationFrame()(()=>{H.global.getCancelAnimationFrame()(this.throttleTimer),this.throttleTimer=null;for(let r=0,a=n.length;r<a;r++){const{type:o,ev:l}=n[r];this.emitEvent(o,l)}this.emitThrottles.length=0}))}triggerStartEvent(t,e){this.isProcess(t)||(this.enable(t),this.triggerEvent(\`\${t}start\`,e))}triggerEndEvent(t){const e=this.processEvent;Object.keys(e).forEach(i=>{this.triggerEvent(\`\${i}end\`,t),i==="press"&&this.triggerEvent(\`\${i}up\`,t),delete e[i]})}emitEvent(t,e){if(!this.element)return;const i=this.element._events["*"];if(i)if("fn"in i)i.fn.call(i.context,e,t);else for(let n=0,r=i.length;n<r&&!e.propagationImmediatelyStopped;n++)i[n].fn.call(i[n].context,e,t);this.emit(t,e)}}var FC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},jC=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};const wt=[0,0,0];let Cn=class{set fillStyle(s){this.nativeContext.fillStyle=s}get fillStyle(){return this.nativeContext.fillStyle}set font(s){this.nativeContext.font=s}get font(){return this.nativeContext.font}set globalAlpha(s){this.nativeContext.globalAlpha=s*this.baseGlobalAlpha}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(s){this.nativeContext.lineCap=s}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(s){this.nativeContext.lineDashOffset=s}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(s){this.nativeContext.lineJoin=s}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(s){this.nativeContext.lineWidth=s}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(s){this.nativeContext.miterLimit=s}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(s){this.nativeContext.shadowBlur=s}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(s){this.nativeContext.shadowColor=s}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(s){this.nativeContext.shadowOffsetX=s}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(s){this.nativeContext.shadowOffsetY=s}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(s){this.nativeContext.strokeStyle=s}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(s){this.nativeContext.textAlign=s}get textAlign(){return this.nativeContext.textAlign}set textBaseline(s){this.nativeContext.textBaseline=s}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(s){s!==!!this._inuse&&(this._inuse=s,s?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(s,t){this.fillAttributes=Object.assign(Object.assign({},Lm),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},Dm),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},ki),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;const e=s.nativeCanvas.getContext("2d");if(!e)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=e,this.canvas=s,this.matrix=new Zt(1,0,0,1,0,0),this.stack=[],this.dpr=t,this.applyedMatrix=new Zt(1,0,0,1,0,0),this._clearMatrix=new Zt(1,0,0,1,0,0),this.baseGlobalAlpha=1}reset(){this.stack.length&&Tt.getInstance().warn("可能存在bug，matrix没有清空"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new Zt(1,0,0,1,0,0),this.stack.length=0,this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(){!(arguments.length>0&&arguments[0]!==void 0&&arguments[0])&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(s){return De.allocateByObj(s)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(De.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0))}highPerformanceRestore(){this.stack.length>0&&(De.free(this.matrix),this.matrix=this.stack.pop())}rotate(s){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.matrix.rotate(s),t&&this.setTransformForCurrent()}save(){const s=this.cloneMatrix(this.matrix);this.stack.push(s),this.nativeContext.save()}highPerformanceSave(){const s=this.cloneMatrix(this.matrix);this.stack.push(s)}scale(s,t){let e=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.scale(s,t),e&&this.setTransformForCurrent()}setScale(s,t){let e=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.setScale(s,t),e&&this.setTransformForCurrent()}scalePoint(s,t,e,i){let n=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];this.translate(e,i,!1),this.scale(s,t,!1),this.translate(-e,-i,!1),n&&this.setTransformForCurrent()}setTransform(s,t,e,i,n,r){let a=!(arguments.length>6&&arguments[6]!==void 0)||arguments[6],o=arguments.length>7&&arguments[7]!==void 0?arguments[7]:this.dpr;this.matrix.setValue(o*s,o*t,o*e,o*i,o*n,o*r),a&&this.setTransformForCurrent()}setTransformFromMatrix(s){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.dpr;this.matrix.setValue(s.a*e,s.b*e,s.c*e,s.d*e,s.e*e,s.f*e),t&&this.setTransformForCurrent()}resetTransform(){let s=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.dpr;this.setTransform(t,0,0,t,0,0),s&&this.setTransformForCurrent()}transform(s,t,e,i,n,r){let a=!(arguments.length>6&&arguments[6]!==void 0)||arguments[6];this.matrix.multiply(s,t,e,i,n,r),a&&this.setTransformForCurrent()}transformFromMatrix(s,t){this.matrix.multiply(s.a,s.b,s.c,s.d,s.e,s.f),t&&this.setTransformForCurrent()}translate(s,t){let e=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.translate(s,t),e&&this.setTransformForCurrent()}rotateDegrees(s){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];const e=s*Math.PI/180;this.rotate(e,t)}rotateAbout(s,t,e){let i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];this.translate(t,e,!1),this.rotate(s,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}rotateDegreesAbout(s,t,e){let i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];this.translate(t,e,!1),this.rotateDegrees(s,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(s,t){s?typeof s=="string"?this.nativeContext.clip(s):this.nativeContext.clip(s,t):this.nativeContext.clip()}arc(s,t,e,i,n,r,a){if(a=a||0,this.camera){const o=[];((l,h,c,u,d,p,g,f)=>{if(f)for(;c>h;)c-=dt;else for(;c<h;)c+=dt;const m=Gt/3*(c>h?1:-1);let v=h,y=v;for(;y!==c;){y=m>0?Math.min(y+m,c):Math.max(y+m,c);const _=Math.abs(y-v),b=4*Math.tan(_/4)/3,x=y<v?-1:1,S=Math.cos(v),A=Math.sin(v),w=Math.cos(y),k=Math.sin(y),T=S*p+u,C=A*g+d,M=w*p+u,B=k*g+d,O=p*b*x,E=g*b*x;l.push([T-O*A,C+E*S,M+O*k,B-E*w,M,B]),v=y}})(o,i,n,s,t,e,e,r);for(let l=0;l<o.length;++l){const h=o[l];this.bezierCurveTo(h[0],h[1],h[2],h[3],h[4],h[5],a)}}else this.nativeContext.arc(s,t,Math.max(0,e),i,n,r)}arcTo(s,t,e,i,n){this.nativeContext.arcTo(s,t,e,i,n)}bezierCurveTo(s,t,e,i,n,r,a){if(a=a||0,this.camera){let o=a,l=a;this.modelMatrix&&(Hi(wt,[s,t,a],this.modelMatrix),s=wt[0],t=wt[1],o=wt[2],Hi(wt,[e,i,a],this.modelMatrix),e=wt[0],i=wt[1],l=wt[2],Hi(wt,[n,r,a],this.modelMatrix),n=wt[0],r=wt[1],a=wt[2]);let h=this.camera.vp(n,r,a);n=h.x,r=h.y,h=this.camera.vp(s,t,o),s=h.x,t=h.y,h=this.camera.vp(e,i,l),e=h.x,i=h.y}this.nativeContext.bezierCurveTo(s,t,e,i,n,r)}closePath(){this.nativeContext.closePath()}ellipse(s,t,e,i,n,r,a,o){o==null?this.nativeContext.ellipse(s,t,e,i,n,r,a):this.nativeContext.ellipse(s,t,e,i,n,r,a,o)}lineTo(s,t,e){if(e=e||0,this.camera){this.modelMatrix&&(Hi(wt,[s,t,e],this.modelMatrix),s=wt[0],t=wt[1],e=wt[2]);const i=this.camera.vp(s,t,e);s=i.x,t=i.y}this.nativeContext.lineTo(s,t)}moveTo(s,t,e){if(e=e||0,this.camera){this.modelMatrix&&(Hi(wt,[s,t,e],this.modelMatrix),s=wt[0],t=wt[1],e=wt[2]);const i=this.camera.vp(s,t,e);s=i.x,t=i.y}this.nativeContext.moveTo(s,t)}quadraticCurveTo(s,t,e,i,n){if(n=n||0,this.camera){let r=n;this.modelMatrix&&(Hi(wt,[s,t,n],this.modelMatrix),s=wt[0],t=wt[1],r=wt[2],Hi(wt,[e,i,n],this.modelMatrix),e=wt[0],i=wt[1],n=wt[2]);let a=this.camera.vp(e,i,n);e=a.x,i=a.y,a=this.camera.vp(s,t,r),s=a.x,t=a.y}this.nativeContext.quadraticCurveTo(s,t,e,i)}rect(s,t,e,i,n){n=n||0,this.camera?(this.moveTo(s,t,n),this.lineTo(s+e,t,n),this.lineTo(s+e,t+i,n),this.lineTo(s,t+i,n),this.closePath()):this.nativeContext.rect(s,t,e,i)}createImageData(){const s=arguments;return s.length===2?this.nativeContext.createImageData(s[0],s[1]):s.length===1?this.nativeContext.createImageData(s[0]):null}createLinearGradient(s,t,e,i){return isFinite(s+t+e+i)||(s=0,t=0,e=0,i=0),this.nativeContext.createLinearGradient(s,t,e,i)}createPattern(s,t){return s.width===0||s.height===0?null:this.nativeContext.createPattern(s,t)}createRadialGradient(s,t,e,i,n,r){return this.nativeContext.createRadialGradient(s,t,e,i,n,r)}createConicGradient(s,t,e,i){let n,r=!1;const a=this;return{stops:[],addColorStop(o,l){this.stops.push([o,l]),r=!0},GetPattern(o,l,h){return r&&(h||(h=i-e),n=function(c,u,d,p,g,f,m,v,y){const _=Math.floor(180*g/Math.PI),b=Bi.GetCanvas(),x=Bi.GetCtx();if(!x)return null;const S=Ke.GetSize(v),A=Ke.GetSize(y);let w=Ke.Get(u,d,p,f,m,S,A);if(w)return w;const k=Math.sqrt(Math.max(Math.max(Math.pow(d,2)+Math.pow(p,2),Math.pow(S-d,2)+Math.pow(p,2)),Math.max(Math.pow(S-d,2)+Math.pow(A-p,2),Math.pow(d,2)+Math.pow(A-p,2)))),T=_+1,C=g/Math.max(1,T-1),M=Sn.getInstance().GetOrCreate(d,p,S,A,u,T),B=2*Math.PI*k/360;b.width=S,b.height=A,x.setTransform(1,0,0,1,0,0),x.clearRect(0,0,S,A),x.translate(d,p),x.rotate(f);for(let E=0,L=T-1;E<L&&!(f+E*C>m);E++){const P=M.getColor(E);x.beginPath(),x.rotate(C),x.moveTo(0,0),x.lineTo(k,-2*B),x.lineTo(k,0),x.fillStyle=P,x.closePath(),x.fill()}const O=x.getImageData(0,0,S,A);return b.width=O.width,b.height=O.height,x.putImageData(O,0,0),w=c.createPattern(b,"no-repeat"),w&&Ke.Set(u,d,p,f,m,w,S,A),w}(a,this.stops,s,t,h,e,i,o,l),r=!1),n}}}fill(s,t){this.disableFill||(s?this.nativeContext.fill(s):this.nativeContext.fill())}fillRect(s,t,e,i){this.nativeContext.fillRect(s,t,e,i)}clearRect(s,t,e,i){this.nativeContext.clearRect(s,t,e,i)}project(s,t,e){if(e=e||0,this.camera){this.modelMatrix&&(Hi(wt,[s,t,e],this.modelMatrix),s=wt[0],t=wt[1],e=wt[2]);const i=this.camera.vp(s,t,e);s=i.x,t=i.y}return{x:s,y:t}}view(s,t,e){return e=e||0,this.camera?(this.modelMatrix&&(Hi(wt,[s,t,e],this.modelMatrix),s=wt[0],t=wt[1],e=wt[2]),this.camera.view(s,t,e)):[s,t,e]}fillText(s,t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Hi(wt,[t,e,i],this.modelMatrix),t=wt[0],e=wt[1],i=wt[2]);const n=this.camera.vp(t,e,i);t=n.x,e=n.y}this.nativeContext.fillText(s,t,e)}getImageData(s,t,e,i){return this.nativeContext.getImageData(s,t,e,i)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(s,t){return this.nativeContext.isPointInPath(s,t)}isPointInStroke(s,t){return this.nativeContext.isPointInStroke(s,t)}measureText(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:H.global.measureTextMethod;var e,i;if(!t||t==="native")return this.nativeContext.measureText(s);this.mathTextMeasure||(this.mathTextMeasure=H.graphicUtil.createTextMeasureInstance({},{},()=>this.canvas.nativeCanvas));const n=(e=this.fontFamily)!==null&&e!==void 0?e:ki.fontFamily,r=(i=this.fontSize)!==null&&i!==void 0?i:ki.fontSize;return this.mathTextMeasure.textSpec.fontFamily===n&&this.mathTextMeasure.textSpec.fontSize===r||(this.mathTextMeasure.textSpec.fontFamily=n,this.mathTextMeasure.textSpec.fontSize=r,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(s,t)}putImageData(s,t,e){this.nativeContext.putImageData(s,t,e)}setLineDash(s){const t=arguments,e=this.nativeContext;this.nativeContext.setLineDash?t[0]&&e.setLineDash(t[0]):"mozDash"in e?e.mozDash=t[0]:"webkitLineDash"in e&&(e.webkitLineDash=t[0])}stroke(s){this.disableStroke||(s?this.nativeContext.stroke(s):this.nativeContext.stroke())}strokeRect(s,t,e,i){this.nativeContext.strokeRect(s,t,e,i)}strokeText(s,t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Hi(wt,[t,e,i],this.modelMatrix),t=wt[0],e=wt[1],i=wt[2]);const n=this.camera.vp(t,e,i);t=n.x,e=n.y}this.nativeContext.strokeText(s,t,e)}drawImage(){const s=this.nativeContext,t=arguments;t.length===3?s.drawImage(t[0],t[1],t[2]):t.length===5?s.drawImage(t[0],t[1],t[2],t[3],t[4]):t.length===9&&s.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}setCommonStyle(s,t,e,i,n){if(Array.isArray(n)){if(n.length<=1)return this._setCommonStyle(s,t,e,i,n[0]);const r=Object.create(n[0]);return n.forEach((a,o)=>{o!==0&&Object.assign(r,a)}),this._setCommonStyle(s,t,e,i,r)}return this._setCommonStyle(s,t,e,i,n)}_setCommonStyle(s,t,e,i,n){const r=this.nativeContext;n||(n=this.fillAttributes);const{fillOpacity:a=n.fillOpacity,opacity:o=n.opacity,fill:l=n.fill}=t;r.globalAlpha=a*o*this.baseGlobalAlpha,a>1e-12&&o>1e-12&&(r.fillStyle=Fl(this,l,s,e,i))}setShadowBlendStyle(s,t,e){if(Array.isArray(e)){if(e.length<=1)return this._setShadowBlendStyle(s,e[0]);const i=Object.create(e[0]);return e.forEach((n,r)=>{r!==0&&Object.assign(i,n)}),this._setShadowBlendStyle(s,t,i)}return this._setShadowBlendStyle(s,t,e)}_setShadowBlendStyle(s,t,e){const i=this.nativeContext;e||(e=this.fillAttributes);const{opacity:n=e.opacity,shadowBlur:r=e.shadowBlur,shadowColor:a=e.shadowColor,shadowOffsetX:o=e.shadowOffsetX,shadowOffsetY:l=e.shadowOffsetY,blur:h=e.blur,filter:c=e.filter,globalCompositeOperation:u=e.globalCompositeOperation}=t;n<=1e-12||(r||o||l?(i.shadowBlur=r*this.dpr,i.shadowColor=a,i.shadowOffsetX=o*this.dpr,i.shadowOffsetY=l*this.dpr,this._clearShadowStyle=!0):this._clearShadowStyle&&(i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0),h?(i.filter=\`blur(\${h}px)\`,this._clearFilterStyle=!0):c?(i.filter=c,this._clearFilterStyle=!0):this._clearFilterStyle&&(i.filter="blur(0px)",this._clearFilterStyle=!1),u?(i.globalCompositeOperation=u,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(i.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1))}setStrokeStyle(s,t,e,i,n){if(Array.isArray(n)){if(n.length<=1)return this._setStrokeStyle(s,t,e,i,n[0]);const r=Object.create(n[0]);return n.forEach((a,o)=>{o!==0&&Object.assign(r,a)}),this._setStrokeStyle(s,t,e,i,r)}return this._setStrokeStyle(s,t,e,i,n)}_setStrokeStyle(s,t,e,i,n){const r=this.nativeContext;n||(n=this.strokeAttributes);const{strokeOpacity:a=n.strokeOpacity,opacity:o=n.opacity}=t;if(r.globalAlpha=a*o*this.baseGlobalAlpha,a>1e-12&&o>1e-12){const{lineWidth:l=n.lineWidth,stroke:h=n.stroke,lineJoin:c=n.lineJoin,lineDash:u=n.lineDash,lineDashOffset:d=n.lineDashOffset,lineCap:p=n.lineCap,miterLimit:g=n.miterLimit,keepStrokeScale:f=n.keepStrokeScale}=t;r.lineWidth=f?l:ms(this,l,this.dpr),r.strokeStyle=Fl(this,h,s,e,i),r.lineJoin=c,u&&(r.setLineDash(u),r.lineDashOffset=d),r.lineCap=p,r.miterLimit=g}}setTextStyleWithoutAlignBaseline(s,t,e){const i=this.nativeContext;t||(t=this.textAttributes);const{scaleIn3d:n=t.scaleIn3d}=s;s.font?i.font=s.font:i.font=bl(s,t,n&&this.camera&&this.camera.getProjectionScale(e));const{fontFamily:r=t.fontFamily,fontSize:a=t.fontSize}=s;this.fontFamily=r,this.fontSize=a,i.textAlign="left",i.textBaseline="alphabetic"}setTextStyle(s,t,e){var i,n;const r=this.nativeContext;t||(t=this.textAttributes),s.font?r.font=s.font:r.font=bl(s,t,this.camera&&this.camera.getProjectionScale(e));const{fontFamily:a=t.fontFamily,fontSize:o=t.fontSize}=s;this.fontFamily=a,this.fontSize=o,r.textAlign=(i=s.textAlign)!==null&&i!==void 0?i:t.textAlign,r.textBaseline=(n=s.textBaseline)!==null&&n!==void 0?n:t.textBaseline}draw(){}clearMatrix(){let s=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.dpr;this.setTransformFromMatrix(this._clearMatrix,s,t)}setClearMatrix(s,t,e,i,n,r){this._clearMatrix.setValue(s,t,e,i,n,r)}onlyTranslate(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.dpr;return this.matrix.a===s&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===s}release(){this.stack.forEach(s=>De.free(s)),this.stack.length=0}};Cn.env="browser",Cn=FC([nt(),jC("design:paramtypes",[Object,Number])],Cn);var NC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},zC=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};let Tr=class extends Kh{constructor(s){super(s)}init(s){const{container:t}=s;if(typeof t=="string"){const e=H.global.getElementById(t);e&&(this._container=e)}else this._container=t;this._context=new Cn(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;const{nativeCanvas:s}=this;s.width=this._pixelWidth,s.height=this._pixelHeight,!s.style||this.setCanvasStyle(s,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(s),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){const s=this._nativeCanvas;s.style.position="absolute",s.style.top=\`\${this._y}px\`,s.style.left=\`\${this._x}px\`}resetStyle(s){if(!this.controled)return;const{width:t=this._displayWidth,height:e=this._displayHeight,dpr:i=this._dpr,x:n=this._x,y:r=this._y}=s,{nativeCanvas:a}=this;a.width=t*i,a.height=e*i,!a.style||this.setCanvasStyle(a,n,r,t,e),s.id&&(a.id=s.id),this.visiable||this.hide()}setCanvasStyle(s,t,e,i,n){this.controled&&(s.style.width=\`\${i}px\`,s.style.height=\`\${n}px\`)}toDataURL(s,t){return s==="image/jpeg"?this._nativeCanvas.toDataURL(s,t):s==="image/png"?this._nativeCanvas.toDataURL(s):this._nativeCanvas.toDataURL(s,t)}resize(s,t){this.controled&&(this._pixelWidth=s*this._dpr,this._pixelHeight=t*this._dpr,this._displayWidth=s,this._displayHeight=t,this._nativeCanvas.style&&(this._nativeCanvas.style.width=\`\${s}px\`,this._nativeCanvas.style.height=\`\${t}px\`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};function vp(s,t){return new yt(e=>{e(Hm).toDynamicValue(()=>i=>new s(i)).whenTargetNamed(s.env),e(fk).toDynamicValue(()=>(i,n)=>new t(i,n)).whenTargetNamed(t.env)})}Tr.env="browser",Tr=NC([nt(),zC("design:paramtypes",[Object])],Tr);const HC=vp(Tr,Cn);var VC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},WC=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},Mn=function(s,t){return function(e,i){t(e,i,s)}};let Cr=class extends Zh{constructor(s,t,e,i){super(e,i),this.contributions=s,this.drawContribution=t,this.pickItemInterceptorContributions=e,this.pickServiceInterceptorContributions=i,this.global.hooks.onSetEnv.tap("canvas-picker-service",(n,r,a)=>{this.configure(a,r)}),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach(s=>{this.pickerMap.set(s.numberType,s)}),super._init()}configure(s,t){this.pickCanvas=_n.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(s,t,e,i){if(s.attribute.pickable===!1)return null;if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){const h=this.InterceptorContributions[l];if(h.beforePickItem){const c=h.beforePickItem(s,this,t,i,{parentMatrix:e});if(c)return c}}const n=this.pickerMap.get(s.numberType);if(!n)return null;const r=n.contains(s,t,i),a=r?s:null,o={graphic:a,params:r};if(a)return o;if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){const h=this.InterceptorContributions[l];if(h.afterPickItem){const c=h.afterPickItem(s,this,t,i,{parentMatrix:e});if(c)return c}}return o}};Cr=VC([nt(),Mn(0,At(Jt)),Mn(0,ae(Ri)),Mn(1,At(sp)),Mn(2,At(Jt)),Mn(2,ae(kn)),Mn(3,At(Jt)),Mn(3,ae(ao)),WC("design:paramtypes",[Object,Object,Object,Object])],Cr);var UC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};let yp=class{constructor(){this.type="group",this.numberType=Md}contains(s,t,e){return!1}};yp=UC([nt()],yp);const ic=new yt((s,t,e,i)=>{ic.__vloaded||(ic.__vloaded=!0,s(vy).to(yp).inSingletonScope(),s(Ri).toService(vy),ze(s,Ri))});ic.__vloaded=!1;var GC=ic;const YC=new yt((s,t,e,i)=>{e(Cr)||s(Cr).toSelf().inSingletonScope(),e(As)?i(As).toService(Cr):s(As).toService(Cr)});var po,$C=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},XC=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};let Hs=po=class extends ho{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return\`\${po.idprefix}_\${po.prefix_count++}\`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=H.global,this.viewBox=new fe,this.modelMatrix=new Zt(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(s){s.canvas?this.createWindowByCanvas(s):this.createWindowByConfig(s),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch{console.error("发生错误，该环境不存在IntersectionObserver")}}isElementVisible(s){const t=s.getBoundingClientRect(),e=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return!(t.right<0||t.bottom<0||t.left>e||t.top>i)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);const s=new IntersectionObserver((t,e)=>{t.forEach(i=>{this._canvasIsIntersecting!==i.isIntersecting?(this._canvasIsIntersecting=i.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(i.isIntersecting)):this._canvasIsIntersecting=i.isIntersecting})});s&&s.observe(this.canvas.nativeCanvas)}createWindowByConfig(s){const t=this.global.createCanvas({width:s.width,height:s.height});let e;if(e=typeof s.container=="string"?this.global.getElementById(s.container):s.container?s.container:this.global.getRootElement(),!e)throw new Error("发生错误，containerId可能传入有误");s.offscreen?e=null:e.appendChild(t);const i={width:s.width,height:s.height,dpr:s.dpr,nativeCanvas:t,container:e,id:po.GenerateCanvasId(),canvasControled:!0};this.canvas=new Tr(i)}createWindowByCanvas(s){var t;let e;if(typeof s.canvas=="string"){if(e=this.global.getElementById(s.canvas),!e)throw new Error("canvasId 参数不正确，请确认canvas存在并插入dom")}else e=s.canvas;if(!e)throw new Error("发生错误，传入的canvas不正确");let i=s.width,n=s.height;if(i==null||n==null||!s.canvasControled){const a=e.getBoundingClientRect();i=a.width,n=a.height}let r=s.dpr;r==null&&(r=(t=e.getContext("2d").pixelRatio)!==null&&t!==void 0?t:e.width/i),this.canvas=new Tr({width:i,height:n,dpr:r,nativeCanvas:e,canvasControled:s.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(s,t){this.canvas.resize(s,t)}setDpr(s){this.canvas.dpr=s}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(s,t,e){return this.canvas.nativeCanvas.addEventListener(s,t,e)}removeEventListener(s,t,e){return this.canvas.nativeCanvas.removeEventListener(s,t,e)}dispatchEvent(s){return this.canvas.nativeCanvas.dispatchEvent(s)}getStyle(){var s;return(s=this.canvas.nativeCanvas.style)!==null&&s!==void 0?s:{}}setStyle(s){this.canvas.nativeCanvas.style=s}getBoundingClientRect(){const s=this.canvas.nativeCanvas,t=this.getWH();return s.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:t.width,height:t.height,left:0,top:0,right:0,bottom:0}}clearViewBox(s){const t=this.viewBox,e=this.getContext(),i=this.getDpr();e.nativeContext.save(),e.nativeContext.setTransform(i,0,0,i,0,0),e.clearRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),s&&(e.fillStyle=s,e.fillRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)),e.nativeContext.restore()}isVisible(s){return this._canvasIsIntersecting}onVisibleChange(s){this._onVisibleChangeCb=s}getTopLeft(s){return this.global.getElementTopLeft(this.canvas.nativeCanvas,s)}};Hs.env="browser",Hs.idprefix="visactor_window",Hs.prefix_count=0,Hs=po=$C([nt(),XC("design:paramtypes",[])],Hs);const KC=new yt(s=>{s(Hs).toSelf(),s(Ul).toDynamicValue(t=>t.container.get(Hs)).whenTargetNamed(Hs.env)});var qC=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},ZC=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},JC=function(s,t,e,i){return new(e||(e=Promise))(function(n,r){function a(h){try{l(i.next(h))}catch(c){r(c)}}function o(h){try{l(i.throw(h))}catch(c){r(c)}}function l(h){var c;h.done?n(h.value):(c=h.value,c instanceof e?c:new e(function(u){u(c)})).then(a,o)}l((i=i.apply(s,[])).next())})};class QC{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(t){this.dom=t}}function _y(s){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const e=document.createElement("img");if(H.global.isImageAnonymous&&(e.crossOrigin="anonymous"),t){const i=new Blob([s],{type:"image/svg+xml"});s=window.URL.createObjectURL(i)}return e.src=s,e.complete?Promise.resolve(e):new Promise((i,n)=>{e.onload=()=>{i(e)},e.onerror=()=>{n(new Error("加载失败"))}})}let sc=class extends lo{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch{this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(s,t){var e,i;let n=0,r=0,a=0,o=0;if(s.changedTouches){const l=(e=s.changedTouches[0])!==null&&e!==void 0?e:{};n=l.clientX||0,r=l.clientY||0,a=n,o=r}else n=s.clientX||0,r=s.clientY||0,a=s.offsetX||0,o=s.offsetY||0;if(t){const l=n,h=r,c=t.getBoundingClientRect(),u=(i=t.getNativeHandler)===null||i===void 0?void 0:i.call(t).nativeCanvas;let d,p;return u&&(d=c.width/u.offsetWidth,p=c.height/u.offsetHeight),{x:(l-c.left)/(q(d)?d:1),y:(h-c.top)/(q(p)?p:1)}}return{x:a,y:o}}getNativeAABBBounds(s){let t=s;if(typeof s=="string"&&(t=new DOMParser().parseFromString(s,"text/html").firstChild,t.lastChild&&(t=t.lastChild.firstChild)),t.getBoundingClientRect){const e=t.getBoundingClientRect();return new QC(e)}return new fe}removeDom(s){return s.parentElement.removeChild(s),!0}updateDom(s,t){const{width:e,height:i,style:n}=t;return n&&(Q(n)?s.setAttribute("style",n):Object.keys(n).forEach(r=>{s.style[r]=n[r]})),e!=null&&(s.style.width=\`\${e}px\`),i!=null&&(s.style.height=\`\${i}px\`),!0}createDom(s){const{tagName:t="div",parent:e}=s,i=document.createElement(t);if(this.updateDom(i,s),e){const n=Q(e)?this.getElementById(e):e;n&&n.appendChild&&n.appendChild(i)}return i}loadImage(s){return _y(s,!1).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadSvg(s){return _y(s,!0).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}createCanvas(s){var t,e;const i=document.createElement("canvas");s.id&&(i.id=(t=s.id)!==null&&t!==void 0?t:we.GenAutoIncrementId().toString());const n=(e=s.dpr)!==null&&e!==void 0?e:window.devicePixelRatio;return s.width&&s.height&&(i.style.width=\`\${s.width}px\`,i.style.height=\`\${s.height}px\`,i.width=s.width*n,i.height=s.height*n),i}createOffscreenCanvas(s){var t;const e=(t=s.dpr)!==null&&t!==void 0?t:window.devicePixelRatio;return new OffscreenCanvas(s.width*e,s.height*e)}releaseCanvas(s){let t;t=typeof s=="string"?document.getElementById(s):s,t&&t.parentElement&&t.parentElement.removeChild(t)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(s,t,e){return document.addEventListener(s,t,e)}removeEventListener(s,t,e){return document.removeEventListener(s,t,e)}dispatchEvent(s){return document.dispatchEvent(s)}getElementById(s){return document.getElementById(s)}getRootElement(){return document.body}getDocument(){return document}release(){}getElementTop(s,t){let e=s.offsetTop,i=s.offsetParent;for(;i!==null;)e+=i.offsetTop,i=i.offsetParent;return e}getElementLeft(s,t){let e=s.offsetLeft,i=s.offsetParent;for(;i!==null;)e+=i.offsetLeft,i=i.offsetParent;return e}getElementTopLeft(s,t){let e=s.offsetTop,i=s.offsetLeft,n=s.offsetParent;for(;n!==null;)e+=n.offsetTop,i+=n.offsetLeft,n=n.offsetParent;return{top:e,left:i}}loadFont(s,t,e){return JC(this,void 0,void 0,function*(){return new FontFace(s,Q(t)?\`url(\${t})\`:t,e).load().then(function(i){return document.fonts.add(i),{loadState:"success"}}).catch(function(i){return console.error("Failed to load font:",i),{loadState:"fail"}})})}isMacOS(){if(this._isMacOS===void 0)try{this._isMacOS=navigator.platform.toUpperCase().indexOf("MAC")>=0}catch{this._isMacOS=!1}return this._isMacOS}copyToClipBoard(s){return navigator.clipboard.writeText(s).then(()=>{}).catch(t=>{})}};sc=qC([nt(),ZC("design:paramtypes",[])],sc);const nc=new yt(s=>{nc.isBrowserBound||(nc.isBrowserBound=!0,s(sc).toSelf().inSingletonScope(),s(Ta).toService(sc))});function rc(s){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];rc.__loaded||(rc.__loaded=!0,s.load(nc),s.load(HC),s.load(KC),t&&function(e){e.load(GC),e.load(YC)}(s))}nc.isBrowserBound=!1,rc.__loaded=!1;var tM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},eM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},Mr=function(s,t){return function(e,i){t(e,i,s)}};let Er=class extends Zh{constructor(s,t,e){super(t,e),this.contributions=s,this.pickItemInterceptorContributions=t,this.pickServiceInterceptorContributions=e,this.global.hooks.onSetEnv.tap("math-picker-service",(i,n,r)=>{this.configure(r,n)}),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach(s=>{this.pickerMap.set(s.numberType,s)}),super._init()}configure(s,t){this.pickContext=new up(null,1)}pickItem(s,t,e,i){if(s.attribute.pickable===!1)return null;const n=this.pickerMap.get(s.numberType);if(!n)return null;const r=n.contains(s,t,i),a=r?s:null;return a?{graphic:a,params:r}:null}};Er=tM([nt(),Mr(0,At(Jt)),Mr(0,ae(Ui)),Mr(1,At(Jt)),Mr(1,ae(kn)),Mr(2,At(Jt)),Mr(2,ae(ao)),eM("design:paramtypes",[Object,Object,Object])],Er);const ac=new yt(s=>{ac.__vloaded||(ac.__vloaded=!0,ze(s,Ui))});ac.__vloaded=!1;var iM=ac;class ls{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise"||!this.canvasRenderer)return!0;const{pickContext:n}=i??{};if(!n)return!1;const r=t.getGraphicTheme();n.highPerformanceSave();let{x:a=r.x,y:o=r.y}=t.attribute;if(t.transMatrix.onlyTranslate()){const c=t.getOffsetXY(r);a+=c.x,o+=c.y,n.setTransformForCurrent()}else a=0,o=0,n.transformFromMatrix(t.transMatrix,!0);let l=!1,h=!1;return this.canvasRenderer.drawShape(t,n,a,o,{},null,(c,u,d,p)=>!(!l&&!h)||(l=c.isPointInPath(e.x,e.y),h=p||h,l),(c,u,d,p)=>{if(l||h)return!0;const g=u.lineWidth||d.lineWidth,f=u.pickStrokeBuffer||d.pickStrokeBuffer,m=u.keepStrokeScale||d.keepStrokeScale;return n.lineWidth=m?g+f:ms(n,g+f,n.dpr),l=c.isPointInStroke(e.x,e.y),h=p||h,l}),n.highPerformanceRestore(),l}}var sM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},nM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},rM=function(s,t){return function(e,i){t(e,i,s)}};let _p=class extends ls{constructor(s){super(),this.canvasRenderer=s,this.type="arc",this.numberType=rh}};_p=sM([nt(),rM(0,At(Bh)),nM("design:paramtypes",[Object])],_p);let by=!1;const xy=new yt((s,t,e,i)=>{by||(by=!0,s(J0).to(_p).inSingletonScope(),s(Ui).toService(J0))});var aM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},oM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},lM=function(s,t){return function(e,i){t(e,i,s)}};let bp=class extends ls{constructor(s){super(),this.canvasRenderer=s,this.type="area",this.numberType=Na}};bp=aM([nt(),lM(0,At(Rh)),oM("design:paramtypes",[Object])],bp);let Sy=!1;const Ay=new yt((s,t,e,i)=>{Sy||(Sy=!0,s(Q0).to(bp).inSingletonScope(),s(Ui).toService(Q0))});var hM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},cM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},uM=function(s,t){return function(e,i){t(e,i,s)}};let xp=class extends ls{constructor(s){super(),this.canvasRenderer=s,this.type="circle",this.numberType=Aw}};xp=hM([nt(),uM(0,At(CT)),cM("design:paramtypes",[Object])],xp);let ky=!1;const dM=new yt((s,t,e,i)=>{ky||(ky=!0,s(ty).to(xp).inSingletonScope(),s(Ui).toService(ty))});class pM{constructor(){this.type="glyph",this.numberType=kw}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;const{pickContext:n}=i??{};if(!n)return!1;const r=i==null?void 0:i.pickerService;if(r){let a=!1;return t.getSubGraphic().forEach(o=>{if(a)return;const l=r.pickItem(o,e,null,i);a=!(!l||!l.graphic)}),a}return!1}}var gM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},fM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},mM=function(s,t){return function(e,i){t(e,i,s)}};let oc=class extends pM{constructor(s){super(),this.canvasRenderer=s}};oc=gM([nt(),mM(0,At(MT)),fM("design:paramtypes",[Object])],oc);let wy=!1;const vM=new yt((s,t,e,i)=>{wy||(wy=!0,s(oy).to(oc).inSingletonScope(),s(oc).toService(oy))});var yM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};let Br=class{constructor(){this.type="image",this.numberType=Lv}contains(s,t,e){const{pickContext:i}=e??{};return!!i&&!!s.AABBBounds.containsPoint(t)}};Br=yM([nt()],Br);let Ty=!1;const _M=new yt((s,t,e,i)=>{Ty||(Ty=!0,s(tc).to(Br).inSingletonScope(),s(Br).toService(tc))});var bM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},xM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},SM=function(s,t){return function(e,i){t(e,i,s)}};let Sp=class extends ls{constructor(s){super(),this.canvasRenderer=s,this.type="line",this.numberType=za}};Sp=bM([nt(),SM(0,At(Ih)),xM("design:paramtypes",[Object])],Sp);let Cy=!1;const My=new yt((s,t,e,i)=>{Cy||(Cy=!0,s(ey).to(Sp).inSingletonScope(),s(Ui).toService(ey))});var AM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},kM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},wM=function(s,t){return function(e,i){t(e,i,s)}};let Ap=class extends ls{constructor(s){super(),this.canvasRenderer=s,this.type="polygon",this.numberType=oh}};Ap=AM([nt(),wM(0,At(Ph)),kM("design:paramtypes",[Object])],Ap);let Ey=!1;const By=new yt((s,t,e,i)=>{Ey||(Ey=!0,s(ay).to(Ap).inSingletonScope(),s(Ui).toService(ay))});var TM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},CM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},MM=function(s,t){return function(e,i){t(e,i,s)}};let kp=class extends ls{constructor(s){super(),this.canvasRenderer=s,this.type="path",this.numberType=ah}};kp=TM([nt(),MM(0,At(Oh)),CM("design:paramtypes",[Object])],kp);let Ry=!1;const Iy=new yt((s,t,e,i)=>{Ry||(Ry=!0,s(iy).to(kp).inSingletonScope(),s(Ui).toService(iy))}),wp=new fe;class Oy{constructor(){this.type="rect",this.numberType=Ed}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;const{pickContext:n}=i??{};if(!n)return!1;const r=t.getGraphicTheme(),{cornerRadius:a=r.cornerRadius}=t.attribute;let{x:o=r.x,y:l=r.y}=t.attribute;n.highPerformanceSave();let h=!0;if(t.transMatrix.onlyTranslate()){const u=t.getOffsetXY(r);o+=u.x,l+=u.y,n.setTransformForCurrent()}else o=0,l=0,h=!1,n.transformFromMatrix(t.transMatrix,!0);let c=!0;if(!h||t.shadowRoot||it(a,!0)&&a!==0||W(a)&&a.some(u=>u!==0))c=!1,this.canvasRenderer.drawShape(t,n,o,l,{},null,(u,d,p)=>!!c||(c=u.isPointInPath(e.x,e.y),c),(u,d,p)=>{if(c)return!0;const g=d.lineWidth||p.lineWidth,f=d.pickStrokeBuffer||p.pickStrokeBuffer,m=d.keepStrokeScale||p.keepStrokeScale;return n.lineWidth=m?g+f:ms(n,g+f,n.dpr),c=u.isPointInStroke(e.x,e.y),c});else{const{fill:u=r.fill,stroke:d=r.stroke,lineWidth:p=r.lineWidth}=t.attribute;if(u)c=!0;else if(d){const g=t.AABBBounds;wp.setValue(g.x1,g.y1,g.x2,g.y2),wp.expand(-p/2),c=!wp.containsPoint(e)}}return n.highPerformanceRestore(),c}}var EM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},BM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},RM=function(s,t){return function(e,i){t(e,i,s)}};let Tp=class extends Oy{constructor(s){super(),this.canvasRenderer=s}};Tp=EM([nt(),RM(0,At(Lh)),BM("design:paramtypes",[Object])],Tp);let Py=!1;const Ly=new yt((s,t,e,i)=>{Py||(Py=!0,s(sy).to(Tp).inSingletonScope(),s(Ui).toService(sy))});let Dy=!1;const Fy=new yt((s,t,e,i)=>{Dy||(Dy=!0,s(tc).to(Br).inSingletonScope(),s(Br).toService(tc))});var IM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},OM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},PM=function(s,t){return function(e,i){t(e,i,s)}};let Cp=class extends ls{constructor(s){super(),this.canvasRenderer=s,this.type="symbol",this.numberType=lh}};Cp=IM([nt(),PM(0,At(Dh)),OM("design:paramtypes",[Object])],Cp);let jy=!1;const Ny=new yt((s,t,e,i)=>{jy||(jy=!0,s(ny).to(Cp).inSingletonScope(),s(Ui).toService(ny))});var LM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};let Mp=class{constructor(){this.type="text",this.numberType=hh}contains(s,t,e){return!!s.AABBBounds.containsPoint(t)}};Mp=LM([nt()],Mp);let zy=!1;const Hy=new yt((s,t,e,i)=>{zy||(zy=!0,s(ry).to(Mp).inSingletonScope(),s(Ui).toService(ry))}),DM=new yt((s,t,e,i)=>{e(Er)||s(Er).toSelf().inSingletonScope(),e(As)?i(As).toService(Er):s(As).toService(Er)});var FM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},jM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};let go=class extends Cn{constructor(s,t){super(s,t);const e=s.nativeCanvas.getContext("2d");if(!e)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=e,this.canvas=s,this.matrix=new Zt(1,0,0,1,0,0),this.stack=[],this.dpr=t??1}release(){}};go.env="node",go=FM([nt(),jM("design:paramtypes",[Object,Number])],go);var NM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},zM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};let Rr=class extends Kh{constructor(s){super(s)}init(){this._context=new go(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(){this._nativeCanvas.release&&U(this._nativeCanvas.release)&&this._nativeCanvas.release()}};Rr.env="node",Rr=NM([nt(),zM("design:paramtypes",[Object])],Rr);const HM=vp(Rr,go);var VM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},WM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},UM=function(s,t){return function(e,i){t(e,i,s)}};let Ir=class extends ho{get container(){return null}constructor(s){super(),this.global=s,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(s){s.canvas?this.createWindowByCanvas(s):this.createWindowByConfig(s)}createWindowByConfig(s){const t=this.global.createCanvas({width:s.width,height:s.height}),e={width:s.width,height:s.height,dpr:s.dpr,nativeCanvas:t,id:we.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new Rr(e)}createWindowByCanvas(s){var t;const e=s.canvas,i=(t=s.dpr)!==null&&t!==void 0?t:1;let n=s.width,r=s.height;n!=null&&r!=null&&s.canvasControled||(n=e.width/i,r=e.height/i),this.canvas=new Rr({width:n,height:r,dpr:i,nativeCanvas:e,canvasControled:s.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(s,t){this.canvas.resize(s,t)}setDpr(s){this.canvas.dpr=s}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png";return this.canvas.nativeCanvas.toBuffer(s)}addEventListener(s,t,e){}dispatchEvent(s){return!0}removeEventListener(s,t,e){}getStyle(){}setStyle(s){}getBoundingClientRect(){return null}clearViewBox(s){}};Ir.env="node",Ir=VM([nt(),UM(0,At(Bl)),WM("design:paramtypes",[Object])],Ir);const GM=new yt(s=>{s(Ir).toSelf(),s(Ul).toDynamicValue(t=>t.container.get(Ir)).whenTargetNamed(Ir.env)});var YM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};let lc=class extends lo{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(s,t){s.env===this.type&&(s.setActiveEnvContribution(this),this.pkg=t)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(s){const t=fetch(s).then(e=>e.json());return t.then(e=>({data:e,state:"success"})).catch(()=>({data:null,state:"fail"})),t}loadArrayBuffer(s){return fetch(s).then(t=>t.arrayBuffer()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadImage(s){const{loadImage:t}=this.pkg;return t?t(s).then(e=>({loadState:e?"success":"fail",data:e})).catch(()=>({loadState:"fail",data:null})):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(s){const t=this.pkg.Resvg;if(!t)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));const e=new t(s).render().asPng();return this.loadImage(e)}createCanvas(s){return this.pkg.createCanvas(s.width,s.height)}releaseCanvas(s){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(s){return Ql.call(s)}}getCancelAnimationFrame(){return s=>{Ql.clear(s)}}addEventListener(s,t,e){}removeEventListener(s,t,e){}getElementById(s){return null}getRootElement(){return null}dispatchEvent(s){}release(){}createOffscreenCanvas(s){}};lc=YM([nt()],lc);const hc=new yt(s=>{hc.isNodeBound||(hc.isNodeBound=!0,s(lc).toSelf().inSingletonScope(),s(Ta).toService(lc))});function cc(s){cc.__loaded||(cc.__loaded=!0,s.load(hc),s.load(HM),s.load(GM))}hc.isNodeBound=!1,cc.__loaded=!1;var $M=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a};let fo=class extends Cn{draw(){}createPattern(s,t){return null}};fo.env="wx",fo=$M([nt()],fo);var XM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},KM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)};let Or=class extends Kh{constructor(s){super(s)}init(){this._context=new fo(this,this._dpr)}release(){}};Or.env="wx",Or=XM([nt(),KM("design:paramtypes",[Object])],Or);const qM=vp(Or,fo);var ZM=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},JM=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},QM=function(s,t){return function(e,i){t(e,i,s)}};class tE{constructor(){this.cache={}}addEventListener(t,e){t&&e&&(this.cache[t]=this.cache[t]||{listener:[]},this.cache[t].listener.push(e))}removeEventListener(t,e){if(!t||!e||!this.cache[t])return;const i=this.cache[t].listener.findIndex(n=>n===e);i>=0&&this.cache[t].listener.splice(i,1)}cleanEvent(){this.cache={}}}let Pr=class extends ho{get container(){return null}constructor(s){super(),this.global=s,this.type="wx",this.eventManager=new tE}getTitle(){return this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return{x:0,y:0}}createWindow(s){s.canvas?this.createWindowByCanvas(s):this.createWindowByConfig(s)}createWindowByConfig(s){const t=this.global.createCanvas({width:s.width,height:s.height}),e={width:s.width,height:s.height,dpr:s.dpr,nativeCanvas:t,id:we.GenAutoIncrementId().toString(),canvasControled:!1};this.canvas=new Or(e)}createWindowByCanvas(s){let t;if(typeof s.canvas=="string"){if(t=this.global.getElementById(s.canvas),!t)throw new Error("canvasId 参数不正确，请确认canvas存在并插入dom")}else t=s.canvas;let e=s.width,i=s.height;if(e==null||i==null||!s.canvasControled){const r=t.getBoundingClientRect();e=r.width,i=r.height}let n=s.dpr;n==null&&(n=t.width/e),this.canvas=new Or({width:e,height:i,dpr:n,nativeCanvas:t,canvasControled:s.canvasControled})}releaseWindow(){}resizeWindow(s,t){}setDpr(s){this.canvas.dpr=s}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(s,t){this.eventManager.addEventListener(s,t)}removeEventListener(s,t){this.eventManager.removeEventListener(s,t)}dispatchEvent(s){var t,e,i,n;const{type:r}=s;return!!this.eventManager.cache[r]&&(s.changedTouches&&s.changedTouches[0]&&(s.offsetX=s.changedTouches[0].x,s.changedTouches[0].offsetX=(t=s.changedTouches[0].x)!==null&&t!==void 0?t:s.changedTouches[0].pageX,s.changedTouches[0].clientX=(e=s.changedTouches[0].x)!==null&&e!==void 0?e:s.changedTouches[0].pageX,s.offsetY=s.changedTouches[0].y,s.changedTouches[0].offsetY=(i=s.changedTouches[0].y)!==null&&i!==void 0?i:s.changedTouches[0].pageY,s.changedTouches[0].clientY=(n=s.changedTouches[0].y)!==null&&n!==void 0?n:s.changedTouches[0].pageY),s.preventDefault=()=>{},s.stopPropagation=()=>{},this.eventManager.cache[r].listener&&this.eventManager.cache[r].listener.forEach(a=>{a(s)}),!0)}getStyle(){return{}}setStyle(s){}getBoundingClientRect(){const s=this.getWH();return{x:0,y:0,width:s.width,height:s.height,left:0,top:0,right:0,bottom:0}}clearViewBox(s){const t=this.viewBox,e=this.getContext(),i=this.getDpr();e.nativeContext.save(),e.nativeContext.setTransform(i,0,0,i,0,0),e.clearRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),s&&(e.fillStyle=s,e.fillRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)),e.nativeContext.restore()}};Pr.env="wx",Pr=ZM([nt(),QM(0,At(Bl)),JM("design:paramtypes",[Object])],Pr);const eE=new yt(s=>{s(Pr).toSelf(),s(Ul).toDynamicValue(t=>t.container.get(Pr)).whenTargetNamed(Pr.env)});var iE=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},sE=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},nE=function(s,t,e,i){return new(e||(e=Promise))(function(n,r){function a(h){try{l(i.next(h))}catch(c){r(c)}}function o(h){try{l(i.throw(h))}catch(c){r(c)}}function l(h){var c;h.done?n(h.value):(c=h.value,c instanceof e?c:new e(function(u){u(c)})).then(a,o)}l((i=i.apply(s,[])).next())})};let uc=class extends lo{constructor(){super(),this.type="wx",this.supportEvent=!0,this.canvasMap=new Map,this.freeCanvasList=[],this.canvasIdx=0,this.supportsTouchEvents=!0;try{this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch{this.supportsPointerEvents=!1,this.supportsMouseEvents=!1}this.applyStyles=!0}configure(s,t){if(s.env===this.type)return s.setActiveEnvContribution(this),function(e,i,n,r,a,o,l){return nE(this,void 0,void 0,function*(){const h=wx.getSystemInfoSync().pixelRatio;for(let c=0;c<i.length;c++){const u=i[c];!l&&n.has(u)||(yield new Promise(d=>{let p=wx.createSelectorQuery();o&&(p=p.in(o)),p.select(\`#\${u}\`).fields({node:!0,size:!0}).exec(g=>{if(!g[0])return;const f=g[0].node,m=g[0].width,v=g[0].height;f.width=m*h,f.height=v*h,n.set(u,f),c>=r&&a.push(f),d(null)})}))}})}(t.domref,t.canvasIdLists,this.canvasMap,t.freeCanvasIdx,this.freeCanvasList,t.component,t.forceUpdate).then(()=>{})}loadImage(s){return Promise.resolve({data:s,loadState:"success"})}loadSvg(s){return Promise.reject()}createCanvas(s){const t=this.freeCanvasList[this.canvasIdx]||this.freeCanvasList[this.freeCanvasList.length-1];return this.canvasIdx++,t}createOffscreenCanvas(s){}releaseCanvas(s){}getDevicePixelRatio(){return wx.getSystemInfoSync().pixelRatio}getRequestAnimationFrame(){return function(s){return Ql.call(s)}}getCancelAnimationFrame(){return s=>{Ql.clear(s)}}addEventListener(s,t,e){return null}removeEventListener(s,t,e){return null}dispatchEvent(s){return null}getElementById(s){return this.canvasMap.get(s)}getRootElement(){return null}getDocument(){return null}release(){}mapToCanvasPoint(s){var t;return(t=s==null?void 0:s.type)===null||t===void 0||t.startsWith("mouse"),s}};uc=iE([nt(),sE("design:paramtypes",[])],uc);const dc=new yt(s=>{dc._isWxBound||(dc._isWxBound=!0,s(uc).toSelf().inSingletonScope(),s(Ta).toService(uc))});function pc(s){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];pc.__loaded||(pc.__loaded=!0,s.load(dc),s.load(qM),s.load(eE),t&&function(e){e.load(iM),e.load(DM),e.load(xy),e.load(Ay),e.load(dM),e.load(vM),e.load(_M),e.load(My),e.load(By),e.load(Iy),e.load(Ly),e.load(Fy),e.load(Ny),e.load(Hy)}(s))}dc._isWxBound=!1,pc.__loaded=!1;var rE=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},aE=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},oE=function(s,t){return function(e,i){t(e,i,s)}};let Ep=class extends ls{constructor(s){super(),this.canvasRenderer=s,this.type="arc",this.numberType=rh}};Ep=rE([nt(),oE(0,At(Bh)),aE("design:paramtypes",[Object])],Ep);let Vy=!1;const lE=new yt((s,t,e,i)=>{Vy||(Vy=!0,s(ly).to(Ep).inSingletonScope(),s(Ri).toService(ly))});var hE=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},cE=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},uE=function(s,t){return function(e,i){t(e,i,s)}};let Bp=class extends Oy{constructor(s){super(),this.canvasRenderer=s}};Bp=hE([nt(),uE(0,At(Lh)),cE("design:paramtypes",[Object])],Bp);let Wy=!1;const dE=new yt((s,t,e,i)=>{Wy||(Wy=!0,s(dy).to(Bp).inSingletonScope(),s(Ri).toService(dy))});class Uy extends Vi{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;const{pickContext:n}=i??{};if(!n)return!1;n.highPerformanceSave();const r=t.getGraphicTheme(),a=this.transform(t,r,n),{x:o,y:l,z:h,lastModelMatrix:c}=a;let u=e;if(n.camera){u=e.clone();const p=t.parent.globalTransMatrix;u.x=p.a*e.x+p.c*e.y+p.e,u.y=p.b*e.x+p.d*e.y+p.f}this.canvasRenderer.z=h;let d=!1;return this.canvasRenderer.drawShape(t,n,o,l,{},null,p=>!!d||(d=p.isPointInPath(u.x,u.y),d),(p,g,f)=>{if(d)return!0;const m=g.lineWidth||f.lineWidth,v=g.pickStrokeBuffer||f.pickStrokeBuffer,y=g.keepStrokeScale||f.keepStrokeScale;return n.lineWidth=y?m+v:ms(n,m+v,n.dpr),d=p.isPointInStroke(u.x,u.y),d}),this.canvasRenderer.z=0,n.modelMatrix!==c&&ye.free(n.modelMatrix),n.modelMatrix=c,n.highPerformanceRestore(),d}}var pE=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},gE=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},fE=function(s,t){return function(e,i){t(e,i,s)}};let Rp=class extends Uy{constructor(s){super(),this.canvasRenderer=s,this.type="line",this.numberType=za}};Rp=pE([nt(),fE(0,At(Ih)),gE("design:paramtypes",[Object])],Rp);let Gy=!1;const mE=new yt((s,t,e,i)=>{Gy||(Gy=!0,s(cy).to(Rp).inSingletonScope(),s(Ri).toService(cy))});var vE=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},yE=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},_E=function(s,t){return function(e,i){t(e,i,s)}};let Ip=class extends ls{constructor(s){super(),this.canvasRenderer=s,this.type="area",this.numberType=Na}};Ip=vE([nt(),_E(0,At(Rh)),yE("design:paramtypes",[Object])],Ip);let Yy=!1;const bE=new yt((s,t,e,i)=>{Yy||(Yy=!0,s(hy).to(Ip).inSingletonScope(),s(Ri).toService(hy))});class $y extends Vi{contains(t,e,i){const{pickContext:n}=i??{};if(!n)return!1;const r=t.getGraphicTheme();n.highPerformanceSave();const a=this.transform(t,r,n),{x:o,y:l,z:h,lastModelMatrix:c}=a;let u=e;if(n.camera){u=e.clone();const p=t.parent.globalTransMatrix;u.x=p.a*e.x+p.c*e.y+p.e,u.y=p.b*e.x+p.d*e.y+p.f}this.canvasRenderer.z=h;let d=!1;return this.canvasRenderer.drawShape(t,n,o,l,i,null,(p,g,f)=>!!d||(d=p.isPointInPath(u.x,u.y),d)),this.canvasRenderer.z=0,n.modelMatrix!==c&&ye.free(n.modelMatrix),n.modelMatrix=c,n.highPerformanceRestore(),d}}var xE=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},SE=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},AE=function(s,t){return function(e,i){t(e,i,s)}};let Op=class extends $y{constructor(s){super(),this.canvasRenderer=s,this.type="symbol",this.numberType=lh}contains(s,t,e){const{pickContext:i}=e??{};if(!i)return!1;const n=s.getParsedPath();if(!i.camera){if(!s.AABBBounds.containsPoint(t))return!1;if(n.isSvg||s.attribute.pickMode==="imprecise")return!0}i.highPerformanceSave();const r=s.getGraphicTheme(),a=this.transform(s,r,i),{x:o,y:l,z:h,lastModelMatrix:c}=a;let u=t;if(i.camera){u=t.clone();const p=s.parent.globalTransMatrix;u.x=p.a*t.x+p.c*t.y+p.e,u.y=p.b*t.x+p.d*t.y+p.f}this.canvasRenderer.z=h;let d=!1;return this.canvasRenderer.drawShape(s,i,o,l,{},null,(p,g,f)=>!!d||(d=p.isPointInPath(u.x,u.y),d),(p,g,f)=>{if(d)return!0;const m=g.lineWidth||f.lineWidth,v=g.pickStrokeBuffer||f.pickStrokeBuffer,y=g.keepStrokeScale||f.keepStrokeScale;return i.lineWidth=y?m+v:ms(i,m+v,i.dpr),d=p.isPointInStroke(u.x,u.y),d}),this.canvasRenderer.z=0,i.modelMatrix!==c&&ye.free(i.modelMatrix),i.modelMatrix=c,i.highPerformanceRestore(),d}};Op=xE([nt(),AE(0,At(Dh)),SE("design:paramtypes",[Object])],Op);let Xy=!1;const kE=new yt((s,t,e,i)=>{Xy||(Xy=!0,s(py).to(Op).inSingletonScope(),s(Ri).toService(py))});var wE=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},TE=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},CE=function(s,t){return function(e,i){t(e,i,s)}};let Pp=class extends $y{constructor(s){super(),this.canvasRenderer=s,this.type="text",this.numberType=hh}contains(s,t,e){const{pickContext:i}=e??{};if(!i)return!1;const n=s.AABBBounds;if(!i.camera)return!!n.containsPoint(t);i.highPerformanceSave();const r=s.getGraphicTheme(),{keepDirIn3d:a=r.keepDirIn3d}=s.attribute,o=!a,l=this.transform(s,r,i,o),{x:h,y:c,z:u,lastModelMatrix:d}=l;this.canvasRenderer.z=u;let p=t;if(i.camera){p=t.clone();const f=s.parent.globalTransMatrix;p.x=f.a*t.x+f.c*t.y+f.e,p.y=f.b*t.x+f.d*t.y+f.f}let g=!1;return this.canvasRenderer.drawShape(s,i,h,c,{},null,(f,m,v)=>{if(g)return!0;const{fontSize:y=r.fontSize,textBaseline:_=r.textBaseline,textAlign:b=r.textAlign}=s.attribute,x=s.AABBBounds,S=x.height(),A=x.width(),w=uh(_,S,y),k=Ya(b,A);return f.rect(k+h,w+c,A,S,u),g=f.isPointInPath(p.x,p.y),g},(f,m,v)=>g),this.canvasRenderer.z=0,i.modelMatrix!==d&&ye.free(i.modelMatrix),i.modelMatrix=d,i.highPerformanceRestore(),g}};Pp=wE([nt(),CE(0,At(ep)),TE("design:paramtypes",[Object])],Pp);let Ky=!1;const ME=new yt((s,t,e,i)=>{Ky||(Ky=!0,s(gy).to(Pp).inSingletonScope(),s(Ri).toService(gy))});var EE=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},BE=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},RE=function(s,t){return function(e,i){t(e,i,s)}};let Lp=class extends Uy{constructor(s){super(),this.canvasRenderer=s,this.type="path",this.numberType=ah}};Lp=EE([nt(),RE(0,At(Oh)),BE("design:paramtypes",[Object])],Lp);let qy=!1;const IE=new yt((s,t,e,i)=>{qy||(qy=!0,s(uy).to(Lp).inSingletonScope(),s(Ri).toService(uy))});var OE=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},PE=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},LE=function(s,t){return function(e,i){t(e,i,s)}};let Dp=class extends ls{constructor(s){super(),this.canvasRenderer=s,this.type="polygon",this.numberType=oh}};Dp=OE([nt(),LE(0,At(Ph)),PE("design:paramtypes",[Object])],Dp);let Zy=!1;const DE=new yt((s,t,e,i)=>{Zy||(Zy=!0,s(fy).to(Dp).inSingletonScope(),s(Ri).toService(fy))});var FE=function(s,t,e,i){var n,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,t,e,i);else for(var o=s.length-1;o>=0;o--)(n=s[o])&&(a=(r<3?n(a):r>3?n(t,e,a):n(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a},jE=function(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)},NE=function(s,t){return function(e,i){t(e,i,s)}};let Fp=class{constructor(s){this.canvasRenderer=s,this.type="richtext",this.numberType=Bd}contains(s,t,e){return!!s.AABBBounds.containsPoint(t)}};Fp=FE([nt(),NE(0,At(ip)),jE("design:paramtypes",[Object])],Fp);let Jy=!1;const zE=new yt((s,t,e,i)=>{Jy||(Jy=!0,s(my).to(Fp).inSingletonScope(),s(Ri).toService(my))}),ws=cp();function gc(){gc.__loaded||(gc.__loaded=!0,gt.RegisterGraphicCreator("arc",Xd),kt.load(SC),kt.load(ws?lE:xy))}gc.__loaded=!1;const HE=gc;function fc(){fc.__loaded||(fc.__loaded=!0,gt.RegisterGraphicCreator("area",$d),kt.load(wC),kt.load(ws?bE:Ay))}fc.__loaded=!1;const VE=fc;function mc(){mc.__loaded||(mc.__loaded=!0,gt.RegisterGraphicCreator("group",Rd))}mc.__loaded=!1;const Ii=mc;function vc(){vc.__loaded||(vc.__loaded=!0,gt.RegisterGraphicCreator("line",Gd),kt.load(kC),kt.load(ws?mE:My))}vc.__loaded=!1;const mo=vc;function yc(){yc.__loaded||(yc.__loaded=!0,gt.RegisterGraphicCreator("path",Nw),kt.load(MC),kt.load(ws?IE:Iy))}yc.__loaded=!1;const WE=yc;function _c(){_c.__loaded||(_c.__loaded=!0,gt.RegisterGraphicCreator("polygon",zw),kt.load(EC),kt.load(ws?DE:By))}_c.__loaded=!1;const UE=_c;function bc(){bc.__loaded||(bc.__loaded=!0,gt.RegisterGraphicCreator("rect",fh),kt.load(AC),kt.load(ws?dE:Ly))}bc.__loaded=!1;const Lr=bc;function xc(){xc.__loaded||(xc.__loaded=!0,gt.RegisterGraphicCreator("richtext",l0),kt.load(IC),kt.load(ws?zE:Fy))}xc.__loaded=!1;const vo=xc;function Sc(){Sc.__loaded||(Sc.__loaded=!0,gt.RegisterGraphicCreator("shadowRoot",Vw))}Sc.__loaded=!1;const En=Sc;function Ac(){Ac.__loaded||(Ac.__loaded=!0,gt.RegisterGraphicCreator("symbol",gh),kt.load(TC),kt.load(ws?kE:Ny))}Ac.__loaded=!1;const yo=Ac;function kc(){kc.__loaded||(kc.__loaded=!0,gt.RegisterGraphicCreator("text",Ka),kt.load(CC),kt.load(ws?ME:Hy))}kc.__loaded=!1;const Dr=kc;function Qy(){Ii(),Lr()}const GE=-.5*Math.PI,YE=1.5*Math.PI,_o="PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol";var se;(function(s){s.selected="selected",s.selectedReverse="selected_reverse",s.hover="hover",s.hoverReverse="hover_reverse"})(se||(se={}));const Fr={[se.selectedReverse]:{},[se.selected]:{},[se.hover]:{},[se.hoverReverse]:{}},t_={container:"",width:30,height:30,style:{}},e_={debounce:yl,throttle:tr};Qy();class bo extends Wi{constructor(t,e){super(e!=null&&e.skipDefault?t:rt({},bo.defaultAttributes,t)),this.name="scrollbar",this._onRailPointerDown=i=>{const{viewX:n,viewY:r}=i,{direction:a,width:o,height:l,range:h}=this.attribute,c=this._sliderSize,[u,d]=this._getScrollRange();let p;if(a==="vertical"){const g=r-this._viewPosition.y,f=ui(g-c/2,u,d);p=g/l,this._slider.setAttribute("y",f,!0)}else{const g=n-this._viewPosition.x,f=ui(g-c/2,u,d);p=g/o,this._slider.setAttribute("x",f,!0)}this.setScrollRange([p-(h[1]-h[0])/2,p+(h[1]-h[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=i=>{const{stopSliderDownPropagation:n=!0}=this.attribute;n&&i.stopPropagation();const{direction:r}=this.attribute,{x:a,y:o}=this.stage.eventPointTransform(i);this._prePos=r==="horizontal"?a:o,this._dispatchEvent("scrollDown",{pos:this._prePos,event:i}),Me.env==="browser"?(Me.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),Me.addEventListener("pointerup",this._onSliderPointerUp)):(this.stage.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.addEventListener("pointerup",this._onSliderPointerUp),this.stage.addEventListener("pointerupoutside",this._onSliderPointerUp))},this._computeScrollValue=i=>{const{direction:n}=this.attribute,{x:r,y:a}=this.stage.eventPointTransform(i);let o,l,h=0;const{width:c,height:u}=this.getSliderRenderBounds();return n==="vertical"?(l=a,h=l-this._prePos,o=h/u):(l=r,h=l-this._prePos,o=h/c),[l,o]},this._onSliderPointerMove=i=>{const{stopSliderMovePropagation:n=!0}=this.attribute;n&&i.stopPropagation();const r=this.getScrollRange(),[a,o]=this._computeScrollValue(i);this.setScrollRange([r[0]+o,r[1]+o],!0),this._prePos=a},this._onSliderPointerMoveWithDelay=this.attribute.delayTime===0?this._onSliderPointerMove:e_[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=i=>{i.preventDefault();const{range:n,limitRange:r=[0,1]}=this.attribute,a=this.getScrollRange(),[o,l]=this._computeScrollValue(i),h=[a[0]+l,a[1]+l];this._dispatchEvent("scrollUp",{pre:n,value:Qn(h,r[0],r[1])}),Me.env==="browser"?(Me.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),Me.removeEventListener("pointerup",this._onSliderPointerUp)):(this.stage.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.removeEventListener("pointerup",this._onSliderPointerUp),this.stage.removeEventListener("pointerupoutside",this._onSliderPointerUp))}}setScrollRange(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];const{direction:i="horizontal",limitRange:n=[0,1],range:r,realTime:a=!0}=this.attribute,o=Qn(t,n[0],n[1]);if(e){const l=this._getSliderPos(o);if(this._slider){const h=l[1]-l[0];this._sliderSize=h,i==="horizontal"?this._slider.setAttributes({x:l[0],width:h},!0):this._slider.setAttributes({y:l[0],height:h},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=o,a&&this._dispatchEvent("scrollDrag",{pre:r,value:o})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;const{delayType:t="throttle",delayTime:e=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",e_[t](this._onRailPointerDown,e)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown)}render(){this._reset();const{direction:t="horizontal",width:e,height:i,range:n,limitRange:r=[0,1],railStyle:a,sliderStyle:o,padding:l=2}=this.attribute,h=this.createOrUpdateChild("scrollbar-container",{},"group"),c=h.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:e,height:i},a),"rect");this._rail=c;const u=this.getSliderRenderBounds(),d=this._getSliderPos(Qn(n,r[0],r[1])),p=d[1]-d[0];let g;this._sliderSize=p,g=t==="horizontal"?{x:d[0],y:u.y1,width:p,height:u.height}:{x:u.x1,y:d[0],width:u.width,height:p};const f=h.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},g),{cornerRadius:this._getDefaultSliderCornerRadius()}),o),{boundsPadding:Si(l),pickMode:"imprecise"}),"rect");this._slider=f,this._container=h;const m=this._container.AABBBounds;this._viewPosition={x:m.x1,y:m.y1}}getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;const{width:t,height:e,padding:i=2}=this.attribute,[n,r,a,o]=Si(i),l={x1:o,y1:n,x2:t-r,y2:e-a,width:Math.max(0,t-(o+r)),height:Math.max(0,e-(n+a))};return this._sliderRenderBounds=l,l}_getDefaultSliderCornerRadius(){const{direction:t,round:e}=this.attribute;if(e){const{width:i,height:n}=this.getSliderRenderBounds();return t==="horizontal"?n:i}return 0}_getSliderPos(t){const{direction:e}=this.attribute,{width:i,height:n,x1:r,y1:a}=this.getSliderRenderBounds();return e==="horizontal"?[i*t[0]+r,i*t[1]+r]:[n*t[0]+a,n*t[1]+a]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;const{limitRange:t=[0,1],direction:e}=this.attribute,[i,n]=Qn(t,0,1),{width:r,height:a,x1:o,y1:l}=this.getSliderRenderBounds(),h=this._sliderSize;return e==="horizontal"?Qn([o+i*r,o+n*r],o,r-h):Qn([l+i*a,l+n*a],l,a-h)}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}}function Gi(s,t){s.forEachChildren(e=>{const i=t(e);e.isContainer&&!i&&Gi(e,t)})}bo.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};const Qt=s=>!I(s)&&s.visible!==!1,$E=["#ffffff","#000000"];function i_(s,t,e,i,n,r){if(typeof s!="string"||typeof t!="string")return s;const a=new re(s).toHex(),o=new re(t).toHex();return jp(a,o,e,i,r)?a:function(l,h,c,u,d,p){const g=[];d&&(d instanceof Array?g.push(...d):g.push(d)),g.push(...$E);for(const f of g)if(l!==f&&jp(f,h,c,u,p))return f}(a,o,e,i,n,r)}function jp(s,t,e,i,n){if(n==="lightness"){const r=re.getColorBrightness(new re(t));return re.getColorBrightness(new re(s))<.5?r>=.5:r<.5}return i?Np(s,t)>i:e==="largeText"?Np(s,t)>3:Np(s,t)>4.5}function Np(s,t){const e=s_(s),i=s_(t);return((e>i?e:i)+.05)/((e>i?i:e)+.05)}function s_(s){const t=Uf(s),e=t[0]/255,i=t[1]/255,n=t[2]/255;let r,a,o;return r=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),a=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),o=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),.2126*r+.7152*a+.0722*o}function wc(s,t,e,i){let n;switch(s){case"base":n=t;break;case"invertBase":n=e;break;case"similarBase":n=i}return n}function XE(s){let t=function(e){const[i,n]=e;return Math.sqrt(i*i+n*n)}(s);return t>0&&(t=1/t),[s[0]*t,s[1]*t]}function KE(s,t,e){const i=function(o,l){const[h,c]=o,[u,d]=l,p=Math.sqrt((h*h+c*c)*(u*u+d*d)),g=p&&(h*u+c*d)/p;return Math.acos(Math.min(Math.max(g,-1),1))}(s,t),n=(a=t,(r=s)[0]*a[1]-r[1]*a[0]>=0);var r,a;return e?n?2*Math.PI-i:i:n?i:2*Math.PI-i}const xo=(s,t,e,i)=>new Ye(Object.assign({defaultFontParams:Object.assign({fontFamily:_o,fontSize:14},i),getTextBounds:e?void 0:Kd,specialCharSet:\`-/: .,@%'"~\`+Ye.ALPHABET_CHAR_SET+Ye.ALPHABET_CHAR_SET.toUpperCase()},t??{}),s);function zp(s,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!s)return{width:0,height:0};const i=Kd({text:s,fontFamily:t.fontFamily||e.fontFamily||_o,fontSize:t.fontSize||e.fontSize||12,fontWeight:t.fontWeight||e.fontWeight,textAlign:t.textAlign||"center",textBaseline:t.textBaseline,ellipsis:!!t.ellipsis,maxLineWidth:t.maxLineWidth||1/0,lineHeight:t.fontSize||e.fontSize||12});return{width:i.width(),height:i.height()}}function n_(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"type";var e,i;return _t(s.text)&&"type"in s.text?(e=s.text.type)!==null&&e!==void 0?e:"text":t in s&&(i=s[t])!==null&&i!==void 0?i:"text"}function r_(s){var t,e;return R(s.maxLineWidth)&&(s.maxWidth=s.maxLineWidth,delete s.maxLineWidth),s.width=(t=s.width)!==null&&t!==void 0?t:0,s.height=(e=s.height)!==null&&e!==void 0?e:0,s.textConfig=s.text.text||s.text,s}function Tc(s){const t=n_(s,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"type");return t==="rich"?gt.richtext(r_(s)):(t==="html"?s=function(e){const{text:i,_originText:n}=e,{text:r}=i;return e.html=r,e.text=n,e.renderable=!1,e}(s):t==="react"&&(s=function(e){const{text:i,_originText:n}=e,{text:r}=i;return e.react=r,e.text=n,e.renderable=!1,e}(s)),gt.text(s))}function a_(s,t,e,i,n){s==="right"?e==="center"?t.setAttribute("x",i-n/2):e==="right"||e==="end"?t.setAttribute("x",i):t.setAttribute("x",i-n):e==="center"?t.setAttribute("x",i+n/2):e==="right"||e==="end"?t.setAttribute("x",i+n):t.setAttribute("x",i)}function o_(){Ii(),Lr(),yo(),vo(),Dr()}var l_=function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e};o_();class Bn extends Wi{getBgRect(){return this._bgRect}getTextShape(){return this._textShape}constructor(t,e){super(e!=null&&e.skipDefault?t:rt({},Bn.defaultAttributes,t)),this.name="tag",this._tagStates=[],this._rectStates=[],this._symbolStates=[],this._textStates=[]}render(){var t,e,i;this.cacheStates();const{text:n="",textStyle:r={},shape:a={},panel:o={},space:l=4,minWidth:h,maxWidth:c,padding:u=4,visible:d,state:p,type:g,textAlwaysCenter:f,containerTextAlign:m}=this.attribute,v=Si(u),y=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group");let _,b=-v[3],x=-v[0],S=v[1]+v[3],A=v[0]+v[2],w=0,k=0;const{visible:T}=a,C=l_(a,["visible"]);if(pe(T)){const G=(C==null?void 0:C.size)||10,z=it(G)?G:Math.max(G[0],G[1]);_=y.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:G,strokeBoundsBuffer:0},C),{visible:T,x:z/2,y:z/2}),"symbol"),ht(p==null?void 0:p.shape)||(_.states=p.shape),T&&(k=z+l)}let M,B,O;if(S+=k,w+=k,function(G){return n_(G,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"type")==="rich"}({text:n})||g==="rich"){const G=Object.assign(Object.assign(Object.assign({},r_(Object.assign({type:g,text:n},r))),r),{visible:R(n)&&d!==!1,x:w,y:0});I(G.lineHeight)&&(G.lineHeight=r.fontSize),M=y.createOrUpdateChild("tag-text",G,"richtext"),B=M.AABBBounds.width(),O=M.AABBBounds.height()}else{const G=Object.assign(Object.assign({text:_t(n)&&"type"in n&&n.type==="text"?n.text:n,visible:R(n)&&d!==!1,lineHeight:r==null?void 0:r.fontSize},r),{x:w,y:0});I(G.lineHeight)&&(G.lineHeight=r.fontSize),M=y.createOrUpdateChild("tag-text",G,"text");const z=zp(G.text,r,(e=(t=this.stage)===null||t===void 0?void 0:t.getTheme())===null||e===void 0?void 0:e.text);B=z.width,O=z.height}S+=B;const E=(i=a.size)!==null&&i!==void 0?i:10,L=it(E)?E:Math.max(E[0],E[1]);A+=Math.max(O,a.visible?L:0);const{textAlign:P,textBaseline:F}=r;(R(h)||R(c))&&(R(h)&&S<h&&(S=h),R(c)&&S>c&&(S=c,M.setAttribute("maxLineWidth",c-v[1]-v[2]))),b=0,x=0;let j=0;P==="left"||P==="start"?j=1:P==="right"||P==="end"?j=-1:P==="center"&&(j=0),j?j<0?(b-=S,_&&_.setAttribute("x",(_.attribute.x||0)-B),y.setAttribute("x",-v[1]-k)):j>0&&y.setAttribute("x",v[3]):(b-=S/2,_&&_.setAttribute("x",(_.attribute.x||0)-B/2),y.setAttribute("x",-k/2));const D=m==="right"||m==="end",N=m==="left"||m==="start",J=(G,z)=>{M.type==="richtext"?M.setAttributes({x:G,textAlign:z,textConfig:Y(M.attribute.textConfig).map(ot=>Object.assign(Object.assign({},ot),{textAlign:z}))}):M.setAttributes({x:G,textAlign:z})};if((m?m==="center":f)&&j){const G=S-v[1]-v[3],z=B+k,ot=j===1?(G-z)/2+k+B/2:v[0]+k-(S/2+z/2-k)+B/2;if(J(ot,"center"),_){const ft=ot-B/2-k+L/2;_.setAttributes({x:ft})}}if(N&&j!==1){const G=S-v[1]-v[3],z=j===0?-G/2+k/2:-S+v[3]+v[1]+k;if(J(z+k,"left"),_){const ot=z+L/2;_.setAttributes({x:ot})}}if(D&&j!==-1){const G=S-v[1]-v[3],z=j===0?G/2+k/2:G;if(J(z,"right"),_){const ot=z-B-k+L/2;_.setAttributes({x:ot})}}F==="middle"?(x-=A/2,_&&_.setAttribute("y",0)):F==="bottom"?(x-=A,_&&_.setAttribute("y",-O/2),y.setAttribute("y",-v[2])):F==="top"&&(y.setAttribute("y",v[0]),_&&_.setAttribute("y",O/2)),ht(p==null?void 0:p.text)||(M.states=p.text);const{visible:X}=o,$=l_(o,["visible"]);if(d&&pe(X)){const G=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},$),{visible:X&&!!n,width:S,height:A,x:b,y:x}),"rect");if(ht(p==null?void 0:p.panel)||(G.states=p.panel),$.customShape){const z=$.customShape;G.pathProxy=ot=>z(this,ot,new me)}this._bgRect=G}this._textShape=M,this._symbol=_,this.resetStates()}initAttributes(t,e){t=e!=null&&e.skipDefault?t:rt({},Bn.defaultAttributes,t),super.initAttributes(t),this.render()}addState(t,e,i){super.addState(t,e,i),this._textShape&&this._textShape.addState(t,e,i),this._bgRect&&this._bgRect.addState(t,e,i),this._symbol&&this._symbol.addState(t,e,i)}removeState(t,e){super.removeState(t,e),this._textShape&&this._textShape.removeState(t,e),this._bgRect&&this._bgRect.removeState(t,e),this._symbol&&this._symbol.removeState(t,e)}cacheStates(){var t,e,i,n,r,a,o,l,h,c,u,d,p,g;this._tagStates=(e=(t=this.currentStates)===null||t===void 0?void 0:t.slice())!==null&&e!==void 0?e:[],this._rectStates=(r=(n=(i=this._bgRect)===null||i===void 0?void 0:i.currentStates)===null||n===void 0?void 0:n.slice())!==null&&r!==void 0?r:[],this._symbolStates=(l=(o=(a=this._symbol)===null||a===void 0?void 0:a.currentStates)===null||o===void 0?void 0:o.slice())!==null&&l!==void 0?l:[],this._textStates=(u=(c=(h=this._textShape)===null||h===void 0?void 0:h.currentStates)===null||c===void 0?void 0:c.slice())!==null&&u!==void 0?u:[],this.clearStates(),(d=this._bgRect)===null||d===void 0||d.clearStates(),(p=this._symbol)===null||p===void 0||p.clearStates(),(g=this._textShape)===null||g===void 0||g.clearStates()}resetStates(){var t,e,i;this._tagStates.length&&this.useStates(this._tagStates),this._rectStates.length&&((t=this._bgRect)===null||t===void 0||t.useStates(this._rectStates)),this._symbolStates.length&&((e=this._symbol)===null||e===void 0||e.useStates(this._symbolStates)),this._textStates.length&&((i=this._textShape)===null||i===void 0||i.useStates(this._textStates))}}Bn.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};const h_={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},qE={poptip:rt({},h_)};class c_ extends Wi{constructor(){super(...arguments),this.name="crosshair"}render(){this.renderCrosshair(this)}}Ii(),mo();class Cc extends c_{constructor(t,e){super(e!=null&&e.skipDefault?t:rt({},Cc.defaultAttributes,t))}renderCrosshair(t){const{start:e,end:i,lineStyle:n}=this.attribute;return t.createOrUpdateChild("crosshair-line",Object.assign({points:[e,i]},n),"line")}setLocation(t){const{start:e,end:i}=t;this.setAttributes({start:e,end:i})}}Cc.defaultAttributes={lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}},Ii(),Lr();class Mc extends c_{constructor(t,e){super(e!=null&&e.skipDefault?t:rt({},Mc.defaultAttributes,t))}renderCrosshair(t){const{start:e,end:i,rectStyle:n}=this.attribute;return t.createOrUpdateChild("crosshair-rect",Object.assign({x:e.x,y:e.y,width:i.x-e.x,height:i.y-e.y},n),"rect")}setLocation(t){const{start:e,end:i}=t;this.setAttributes({start:e,end:i})}}Mc.defaultAttributes={rectStyle:{fill:"#b2bacf",opacity:.2}},Ii(),mo(),UE(),yo();class Ec extends Wi{getStartAngle(){return _l(this._startAngle)}getEndAngle(){return _l(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super(e!=null&&e.skipDefault?t:rt({},Ec.defaultAttributes,t)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:n,visible:r=!0,multiSegment:a,mainSegmentIndex:o}=this.attribute;if(!r)return;this._computeLineAngle();const l=this._getMainSegmentPoints(),h=this._renderSymbol(t,l,"start"),c=this._renderSymbol(e,l,"end");if(this.startSymbol=h,this.endSymbol=c,a){const u=[...this.attribute.points];if(q(o))u[o]=this._clipPoints(u[o]);else{const d=this._clipPoints(Nu(u));u[0][0]=d[0],u[u.length-1][u[u.length-1].length-1]=d[d.length-1]}u.forEach((d,p)=>{var g,f;const m=gt.line(Object.assign(Object.assign({points:d},W(i)?(g=i[p])!==null&&g!==void 0?g:i[i.length-1]:i),{fill:!1}));m.name=\`\${this.name}-line\`,m.id=this._getNodeId("line"+p),ht(n==null?void 0:n.line)||(m.states=W(n.line)?(f=n.line[p])!==null&&f!==void 0?f:n.line[n.line.length-1]:n.line),this.add(m),this.lines.push(m)})}else{let u=gt.line;Y(i)[0].cornerRadius&&(u=gt.polygon);const d=u(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},Y(i)[0]),{fill:!1,closePath:!1}));d.name=\`\${this.name}-line\`,d.id=this._getNodeId("line"),ht(n==null?void 0:n.line)||(d.states=[].concat(n.line)[0]),this.add(d),this.lines.push(d)}}_computeStartRotate(t){return t+Math.PI/2}_computeEndRotate(t){return t+Math.PI/2}_renderSymbol(t,e,i){if(!e.length)return;const{autoRotate:n=!0}=t;let r;if(t&&t.visible){const a=this.getStartAngle(),o=this.getEndAngle(),{state:l}=this.attribute,h=e[0],c=e[e.length-1],{refX:u=0,refY:d=0,refAngle:p=0,style:g,symbolType:f,size:m=12}=t;let v,y;i==="start"?(v={x:h.x+(q(a)?u*Math.cos(a)+d*Math.cos(a-Math.PI/2):0),y:h.y+(q(a)?u*Math.sin(a)+d*Math.sin(a-Math.PI/2):0)},y=this._computeStartRotate(this._startAngle)):(v={x:c.x+(q(o)?u*Math.cos(o)+d*Math.cos(o-Math.PI/2):0),y:c.y+(q(o)?u*Math.sin(o)+d*Math.sin(o-Math.PI/2):0)},y=this._computeEndRotate(this._endAngle)),r=gt.symbol(Object.assign(Object.assign(Object.assign({},v),{symbolType:f,size:m,angle:n?y+p:0,strokeBoundsBuffer:0}),g)),r.name=\`\${this.name}-\${i}-symbol\`,r.id=this._getNodeId(\`\${i}-symbol\`),ht(l==null?void 0:l.symbol)||(r.states=l.symbol),i==="start"?ht(l==null?void 0:l.startSymbol)||(r.states=l.startSymbol):ht(l==null?void 0:l.endSymbol)||(r.states=l.endSymbol),this.add(r)}return r}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute;let n;return n=e?q(i)?t[i]:Nu(t):t,this._mainSegmentPoints=n,n}_clipPoints(t){const{startSymbol:e={},endSymbol:i={}}=this.attribute;let n=t;if(e.visible){const r=e.clip?e.size||10:0;n=[{x:t[0].x-r/2*(Math.cos(this._startAngle)||0),y:t[0].y-r/2*(Math.sin(this._startAngle)||0)},...n.slice(1)]}if(i.visible){const r=i.clip?i.size||10:0,a={x:t[t.length-1].x-r/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-r/2*(Math.sin(this._endAngle)||0)};n=[...n.slice(0,n.length-1),a]}return n}_computeLineAngle(){const t=this._getMainSegmentPoints();if(t.length<=1)return;const e=t[0],i=t[1],n=t[t.length-2],r=t[t.length-1],a=[e.x-i.x,e.y-i.y],o=Math.atan2(a[1],a[0]),l=[r.x-n.x,r.y-n.y],h=Math.atan2(l[1],l[0]);this._startAngle=o,this._endAngle=h}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}var xe,jr;Ec.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}},function(s){s.innerView="inner-view",s.axisContainer="axis-container",s.labelContainer="axis-label-container",s.tickContainer="axis-tick-container",s.tick="axis-tick",s.subTick="axis-sub-tick",s.label="axis-label",s.title="axis-title",s.gridContainer="axis-grid-container",s.grid="axis-grid",s.gridRegion="axis-grid-region",s.line="axis-line",s.background="axis-background",s.axisLabelBackground="axis-label-background",s.axisBreak="axis-break",s.axisBreakSymbol="axis-break-symbol"}(xe||(xe={})),function(s){s.selected="selected",s.selectedReverse="selected_reverse",s.hover="hover",s.hoverReverse="hover_reverse"}(jr||(jr={}));const Nr={[jr.selectedReverse]:{},[jr.selected]:{},[jr.hover]:{},[jr.hoverReverse]:{}},Hp={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}},u_={size:8,stroke:"#000",lineWidth:1,zIndex:1},d_=Math.sin(Math.PI/10);function p_(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:d_;const e=!I(s)&&s!==0,i=e?Math.cos(s):1;return e&&Math.abs(i)<=t}function Vp(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:d_;const e=!I(s)&&s!==0,i=e?Math.sin(s):0;return!e||Math.abs(i)<=t}function g_(s){const t={};return Gi(s,e=>{e.type!=="group"&&e.id&&(t[e.id]=e)}),t}function f_(s,t){return{x:s.x+t[0],y:s.y+t[1]}}function zr(s,t){let e="";return s.length===0||(s.forEach((i,n)=>{n===0?e=\`M\${i.x},\${i.y}\`:e+=\`L\${i.x},\${i.y}\`}),t&&(e+="Z")),e}function Yi(s,t,e){var i;let n,r;const a=(o,l,h)=>(n=o.AABBBounds,r=l.AABBBounds,h>Math.max(r.x1-n.x2,n.x1-r.x2,r.y1-n.y2,n.y1-r.y2));return Vp((i=s.attribute)===null||i===void 0?void 0:i.angle,Number.EPSILON)?a(s,t,e):(n=s.OBBBounds,r=t.OBBBounds,!n||!r||n.empty()||r.empty()?a(s,t,e):n.intersects(r))}function Wp(s,t){for(let e,i=1,n=s.length,r=s[0];i<n;r=e,++i)if(e=s[i],Yi(r,e,t))return!0;return!1}class ZE extends Wi{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{this._lastHover=((e,i,n)=>{const r=e.target;return r!==n&&r.name&&!ht(r.states)?(r.addState(se.hover,!0),Gi(i,a=>{a!==r&&a.name&&!ht(a.states)&&a.addState(se.hoverReverse,!0)}),r):n})(t,this.axisContainer,this._lastHover)},this._onUnHover=t=>{this._lastHover=((e,i,n)=>n&&(Gi(i,r=>{r.name&&!ht(r.states)&&(r.removeState(se.hoverReverse),r.removeState(se.hover))}),null))(0,this.axisContainer,this._lastHover)},this._onClick=t=>{this._lastSelect=((e,i,n)=>{const r=e.target;return n===r&&r.hasState(se.selected)?(Gi(i,a=>{a.name&&!ht(a.states)&&(a.removeState(se.selectedReverse),a.removeState(se.selected))}),null):r.name&&!ht(r.states)?(r.addState(se.selected,!0),Gi(i,a=>{a!==r&&a.name&&!ht(a.states)&&a.addState(se.selectedReverse,!0)}),r):n})(t,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){const e=Fi(this.attribute);rt(this.attribute,t);const i=gt.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this._prevInnerView=this._innerView&&g_(this._innerView),this.removeAllChild(!0),this._innerView=gt.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){const{title:e,label:i,tick:n,line:r,items:a}=this.attribute,o=gt.group({x:0,y:0,zIndex:1,pickable:!1});if(o.name=xe.axisContainer,o.id=this._getNodeId("container"),o.setMode(this.mode),this.axisContainer=o,t.add(o),r&&r.visible&&this.renderLine(o),a&&a.length&&(this.data=this._transformItems(a[0]),n&&n.visible&&this.renderTicks(o),i&&i.visible)){const l=gt.group({x:0,y:0,pickable:!1});l.name=xe.labelContainer,l.id=this._getNodeId("label-container"),this.axisLabelsContainer=l,o.add(l),a.forEach((h,c)=>{const u=this.renderLabels(l,h,c),d=u.getChildren();this.beforeLabelsOverlap(d,h,u,c,a.length),this.handleLabelsOverlap(d,h,u,c,a.length),this.afterLabelsOverlap(d,h,u,c,a.length);let p=0,g=0,f="center",m="middle",v=0;d.forEach((y,_)=>{var b;const x=y.attribute,S=(b=x.angle)!==null&&b!==void 0?b:0,A=y.AABBBounds;let w=A.width(),k=A.height();S&&(w=Math.abs(w*Math.cos(S)),k=Math.abs(k*Math.sin(S))),p=Math.max(p,w),g=Math.max(g,k),f=x.textAlign,m=x.textBaseline,_===0&&(v=x.x)}),this.axisLabelLayerSize[c]={width:p,height:g,labelPos:v,textAlign:f,textBaseline:m}})}e&&e.visible&&this.renderTitle(o)}renderTicks(t){const e=this.getTickLineItems(),i=gt.group({x:0,y:0,pickable:!1});i.name=xe.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach((r,a)=>{var o;const l=gt.line(Object.assign({},this._getTickLineAttribute("tick",r,a,e)));if(l.name=xe.tick,l.id=this._getNodeId(r.id),ht((o=this.attribute.tick)===null||o===void 0?void 0:o.state))l.states=Fr;else{const h=this.data[a],c=rt({},Fr,this.attribute.tick.state);Object.keys(c).forEach(u=>{U(c[u])&&(c[u]=c[u](h.rawValue,a,h,this.data))}),l.states=c}i.add(l)}),this.tickLineItems=e;const{subTick:n}=this.attribute;if(n&&n.visible){const r=this.getSubTickLineItems();r.length&&r.forEach((a,o)=>{const l=gt.line(Object.assign({},this._getTickLineAttribute("subTick",a,o,e)));if(l.name=xe.subTick,l.id=this._getNodeId(\`\${o}\`),ht(n.state))l.states=Fr;else{const h=rt({},Fr,n.state);Object.keys(h).forEach(c=>{U(h[c])&&(h[c]=h[c](a.value,o,a,e))}),l.states=h}i.add(l)}),this.subTickLineItems=r}}renderLabels(t,e,i){const{dataFilter:n}=this.attribute.label;n&&U(n)&&(e=n(e,i));const r=this._transformItems(e),a=gt.group({x:0,y:0,pickable:!1});return a.name=\`\${xe.labelContainer}-layer-\${i}\`,a.id=this._getNodeId(\`label-container-layer-\${i}\`),t.add(a),r.forEach((o,l)=>{var h;const c=Tc(this._getLabelAttribute(o,l,r,i));if(c.name=xe.label,c.id=this._getNodeId(\`layer\${i}-label-\${o.id}\`),ht((h=this.attribute.label)===null||h===void 0?void 0:h.state))c.states=Fr;else{const u=rt({},Fr,this.attribute.label.state);Object.keys(u).forEach(d=>{U(u[d])&&(u[d]=u[d](o,l,r,i))}),c.states=u}c.data=Object.assign(Object.assign({},o),{index:l,layer:i}),a.add(c)}),a}renderTitle(t){const e=this.getTitleAttribute(),i=new Bn(Object.assign({},e));i.name=xe.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){return f_(t,this.getVerticalVector(e,i,t))}getTickLineItems(){const{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:n,inside:r=!1,length:a,dataFilter:o}=t;let l=1;return e.length>=2&&(l=e[1].value-e[0].value),(o&&U(o)?o(e):e).forEach(h=>{let c=h.point,u=h.value;if(!n){const p=h.value-l/2;if(this.isInValidValue(p))return;c=this.getTickCoord(p),u=p}const d=this.getVerticalCoord(c,a,r);if(this.mode==="3d"){const p=this.getVerticalVector(a,r,c);let g=0,f=0;Rt(p[0])>Rt(p[1])?g=Gt/2*(d.x>c.x?1:-1):f=Gt/2*(d.y>c.y?-1:1),i.push({start:c,end:d,value:u,id:\`tick-\${h.id}\`,anchor:[c.x,c.y],alpha:g,beta:f})}else i.push({start:c,end:d,value:u,id:\`tick-\${h.id}\`})}),i}getSubTickLineItems(){const{subTick:t}=this.attribute,e=[],{count:i=4,inside:n=!1,length:r=2}=t,a=this.tickLineItems,o=a.length;if(o>=2)for(let l=0;l<o-1;l++){const h=a[l],c=a[l+1];for(let u=0;u<i;u++){const d=(u+1)/(i+1),p=(1-d)*h.value+d*c.value,g=this.getTickCoord(p),f=this.getVerticalCoord(g,r,n);e.push({start:g,end:f,value:p,id:\`sub-tick-\${p}\`})}}return e}_getTickLineAttribute(t,e,i,n){let r=vt(this.attribute,\`\${t}.style\`);const a=this.data[i];r=U(r)?rt({},vt(Hp,\`\${t}.style\`),t==="tick"?r(a.rawValue,i,a,this.data):r(e.value,i,e,n)):r;const{start:o,end:l,anchor:h,alpha:c,beta:u}=e;return Object.assign({points:[o,l],anchor:h,alpha:c,beta:u},r)}_getLabelAttribute(t,e,i,n){var r,a;const{space:o=4,inside:l=!1,formatMethod:h,type:c="text",text:u}=this.attribute.label;let d=o,p=0;!((r=this.attribute.tick)===null||r===void 0)&&r.visible&&this.attribute.tick.inside===l&&(p=this.attribute.tick.length||4),!((a=this.attribute.subTick)===null||a===void 0)&&a.visible&&this.attribute.subTick.inside===l&&(p=Math.max(p,this.attribute.subTick.length||2)),d+=p;const g=this.getRelativeVector(t.point);n>0&&(g[1]===0?d+=(this.axisLabelLayerSize[n-1].height+vt(this.attribute,"label.space",4))*n:d+=(this.axisLabelLayerSize[n-1].width+vt(this.attribute,"label.space",4))*n);const f=this.getVerticalCoord(t.point,d,l),m=this.getVerticalVector(d||1,l,f),v=h?h(\`\${t.label}\`,t,e,i,n):t.label;let{style:y}=this.attribute.label;return y=U(y)?rt({},Hp.label.style,y(t,e,i,n)):y,y=rt(this.getLabelAlign(m,l,y.angle),y),U(y.text)&&(y.text=y.text({label:t.label,value:t.rawValue,index:t.index,layer:n})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(f,m,v,y)),{text:u??v,_originText:t.label,lineHeight:y==null?void 0:y.fontSize,type:c}),y)}getLabelPosition(t,e,i,n){return t}_transformItems(t){const e=[];return t.forEach(i=>{var n;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(n=i.id)!==null&&n!==void 0?n:i.label}))}),e}release(){super.release(),this._prevInnerView=null,this._innerView=null}}const m_={parity:function(s){return s.filter((t,e)=>e%2?t.setAttribute("opacity",0):1)},greedy:function(s,t){let e;return s.filter((i,n)=>n&&Yi(e,i,t)?i.setAttribute("opacity",0):(e=i,1))}};function JE(s){let t;return t=s.OBBBounds.empty()?s.AABBBounds:s.OBBBounds,t.width()>1&&t.height()>1}function v_(s,t,e,i){let n=arguments.length>4&&arguments[4]!==void 0&&arguments[4];if(e&&!s.attribute.opacity){const r=t.length;if(r>1){s.setAttribute("opacity",1);for(let a=0;a<r;a++){const o=n?t[r-1-a]:t[a];if(!i(o))break;o.setAttribute("opacity",0)}}}}function QE(s){for(let r=1;r<s.length;r++)if(t=s[r-1],e=s[r],i=void 0,n=void 0,!((i=t.OBBBounds)===null||i===void 0)&&i.empty()||!((n=e.OBBBounds)===null||n===void 0)&&n.empty()?Aa(t.AABBBounds,e.AABBBounds,!1)&&(!t.rotatedBounds||!e.rotatedBounds||Nf(t.rotatedBounds,e.rotatedBounds,!0)):t.OBBBounds.intersects(e.OBBBounds))return!0;var t,e,i,n;return!1}function tB(s,t){s!=="bottom"&&s!=="top"||function(e,i){i.forEach(n=>{n.attribute.angle&&n.setAttributes(Object.assign(Object.assign({},y_(e,n.attribute.angle)),{angle:Bc(n.attribute.angle)}))})}(s,t),s!=="left"&&s!=="right"||function(e,i){i.forEach((n,r)=>{n.attribute.angle&&n.setAttributes(Object.assign(Object.assign({},__(e,n.attribute.angle)),{angle:Bc(n.attribute.angle)}))})}(s,t),function(e){e.forEach(i=>{if(i.rotatedBounds||!i.attribute.angle)return;const n=function(l){const h=l.AABBBounds;return{x1:h.x1,x2:h.x2,y1:h.y1,y2:h.y2,centerX:l.attribute.x,centerY:l.attribute.y,angle:l.attribute.angle}}(i),r=sr({x:i.attribute.x,y:i.attribute.y},n.angle,{x:n.centerX,y:n.centerY}),a=r.x-n.centerX,o=r.y-n.centerY;n.x1+=a,n.x2+=a,n.y1+=o,n.y2+=o,n.centerX+=a,n.centerY+=o,i.rotatedBounds=n})}(t)}function Bc(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(s<0)for(;s<0;)s+=2*Math.PI;if(s>0)for(;s>=2*Math.PI;)s-=2*Math.PI;return s}function y_(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=["center","left","left","left","center","right","right","right","left"],i=["top","top","middle","bottom","bottom","bottom","middle","top","top"];s==="top"&&(e=["center","right","right","right","center","left","left","left","right"],i=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const n=(t=Bc(t))/(.5*Math.PI);let r;return r=n===Math.floor(n)?2*Math.floor(n):2*Math.floor(n)+1,{textAlign:e[r],textBaseline:i[r]}}function __(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=["right","right","center","left","left","left","center","right","right"],i=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];s==="right"&&(e=["left","left","center","right","right","right","center","left","left"],i=["middle","middle","bottom","bottom","middle","middle","top","middle","middle"]);const n=(t=Bc(t))/(.5*Math.PI);let r;return r=n===Math.floor(n)?2*Math.floor(n):2*Math.floor(n)+1,{textAlign:e[r],textBaseline:i[r]}}function eB(s,t){const{limitLength:e,verticalLimitLength:i,ellipsis:n="...",orient:r,axisLength:a}=t;if(ht(s)||!q(e))return;const o=function(y){return q(y)?{left:y,right:y}:_t(y)?{left:y.left||0,right:y.right||0}:{left:0,right:0}}(t.overflowLimitLength),l=s[0],h=l.attribute.angle,c=!I(h),u=c?Math.cos(h):1,d=c?Math.sin(h):0,p=Vp(h),g=p_(h),f=r==="top"||r==="bottom",m=l.attribute.direction,v=!p&&!g&&f&&(s.length<2||s.some(y=>Math.abs(y.AABBBounds.width()-l.AABBBounds.width())>=2))&&l.AABBBounds.width()>Math.abs(e/d);s.forEach(y=>{var _;if(f&&(g&&Math.floor(y.AABBBounds.height())<=e||p&&Math.floor(y.AABBBounds.width())<=i)||!f&&(m==="vertical"&&Math.floor(y.AABBBounds.height())<=i||m!=="vertical"&&(p&&Math.floor(y.AABBBounds.width())<=e||g&&Math.floor(y.AABBBounds.height())<=i)))return;let b=null;if(p||g)b=f?p?i:e:m==="vertical"||g?i:e;else if(f){const{x1:x,x2:S}=y.AABBBounds,A=d/u,w=Math.abs(e/d);if(v&&A>0&&x<=a+o.right&&e/A+x>a+o.right){const k=(a-x+o.right)/Math.abs(u);b=Math.min(k,w)}else if(v&&A<0&&S>=-o.left&&e/A+S<-o.left){const k=(S+o.left)/Math.abs(u);b=Math.min(k,w)}else b=w}else b=Math.abs(e/u);q(y.attribute.maxLineWidth)&&(b=q(b)?Math.min(y.attribute.maxLineWidth,b):y.attribute.maxLineWidth),y.setAttributes({maxLineWidth:b,ellipsis:(_=y.attribute.ellipsis)!==null&&_!==void 0?_:n})})}function b_(s,t,e){let i;return q(t)&&(i=Math.abs(t-s)),q(e)&&(i=q(i)?Math.min(Math.abs(s-e),i):Math.abs(s-e)),i}class x_{isInValidValue(t){return t<0||t>1}getTickCoord(t){const{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){const{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const{verticalFactor:i=1}=this.attribute,n=XE(this.getRelativeVector());return function(r,a){return[r[0]*a,r[1]*a]}([n[1],-1*n[0]],t*(e?1:-1)*i)}}var S_=function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e};Ii(),mo(),vo(),Dr(),Lr();class So extends ZE{constructor(t,e){super(e!=null&&e.skipDefault?t:rt({},So.defaultAttributes,t),e)}_renderInner(t){var e;if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){const n=[];for(let r=0;r<this.attribute.breaks.length;r++){const a=this.attribute.breaks[r],{range:o,breakSymbol:l,rawRange:h}=a;n.push({startPoint:this.getTickCoord(o[0]),endPoint:this.getTickCoord(o[1]),range:o,breakSymbol:l,rawRange:h})}this._breaks=n}super._renderInner(t),this._breaks&&this._breaks.length&&this._breaks.forEach((n,r)=>{const{startPoint:a,endPoint:o,breakSymbol:l,rawRange:h}=n;if((l==null?void 0:l.visible)!==!1){const c=gt.group({zIndex:999});c.name=xe.axisBreak,c.id=this._getNodeId(\`\${xe.axisBreak}-\${r}\`),c.data=h;const u=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var f,m;const{style:v={},angle:y=.5*Math.PI}=g,_=rt({},u_,v),b=(f=_.size)!==null&&f!==void 0?f:u_.size;return Object.assign(Object.assign({},_),{symbolType:(m=_.symbolType)!==null&&m!==void 0?m:\`M \${-b/2} \${b*Math.sin(y)} L \${b/2} \${-b*Math.sin(y)}\`,symbolSize:b})}(l),d=gt.symbol(Object.assign({x:a.x,y:a.y},u));d.name=xe.axisBreakSymbol;const p=gt.symbol(Object.assign({x:o.x,y:o.y},u));p.name=xe.axisBreakSymbol,c.add(d),c.add(p),t.add(c)}});const{panel:i}=this.attribute;if(i&&i.visible){const n=this.axisContainer,r=n.AABBBounds,a=gt.rect(Object.assign({x:r.x1,y:r.y1,width:r.width(),height:r.height()},i.style));a.name=xe.background,a.id=this._getNodeId("background"),a.states=rt({},Nr,(e=i.state)!==null&&e!==void 0?e:{}),n.insertBefore(a,n.firstChild)}}renderLine(t){const{start:e,end:i,line:n}=this.attribute,r=n,{startSymbol:a,endSymbol:o,style:l,state:h}=r,c=S_(r,["startSymbol","endSymbol","style","state"]),u=Object.assign({startSymbol:a,endSymbol:o,lineStyle:l},c);if(this._breaks&&this._breaks.length){const p=[];let g=e;this._breaks.forEach(f=>{const{startPoint:m,endPoint:v}=f;p.push([g,m]),g=v}),p.push([g,i]),u.points=p,u.multiSegment=!0}else u.points=[e,i];ht(h)||(u.state={line:rt({},Nr,h),symbol:rt({},Nr,h)});const d=new Ec(u);d.name=xe.line,d.id=this._getNodeId("line"),t.add(d)}getTextAlign(t){let e="center";return Oe(t[0],0)?Oe(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTitleAttribute(){var t,e,i;const n=this.attribute.title,{position:r="middle",space:a=4,textStyle:o={},autoRotate:l=!0,shape:h,background:c,state:u={},maxWidth:d}=n,p=S_(n,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let g=.5;r==="start"?g=0:r==="end"&&(g=1);const{verticalFactor:f=1}=this.attribute,m=-1*f,v=this.getTickCoord(g),y=this.getRelativeVector();let _=0;if(!((t=this.attribute.label)===null||t===void 0)&&t.visible&&this.attribute.label.inside===!1){const B=+vt(this.attribute,"label.space",4);_+=B;const O=Object.keys(this.axisLabelLayerSize).length;if(y[1]===0){const E=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(E)?_+=E+(O-1)*B:_=0}else if(y[0]===0)if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){const E=this.axisLabelLayerSize[0].labelPos,L=this.axisLabelsContainer.AABBBounds;_+=(m===1?L.x2>E?Math.min(L.x2-E,L.width()):0:L.x1<E?Math.min(E-L.x1,L.width()):0)+(O-1)*B}else _=0;else Object.keys(this.axisLabelLayerSize).forEach((E,L)=>{_+=this.axisLabelLayerSize[E].width+(L>0?B:0)})}let b=0;!((e=this.attribute.tick)===null||e===void 0)&&e.visible&&this.attribute.tick.inside===!1&&(b=this.attribute.tick.length||4),!((i=this.attribute.subTick)===null||i===void 0)&&i.visible&&this.attribute.subTick.inside===!1&&(b=Math.max(b,this.attribute.subTick.length||2));const x=b+_+a,S=this.getVerticalCoord(v,x,!1),A=this.getVerticalVector(x,!1,{x:0,y:0});let w,k,{angle:T}=p;if(w=r==="start"?"start":r==="end"?"end":"center",I(T)&&l){T=KE(y,[1,0],!0);const{verticalFactor:B=1}=this.attribute;k=-1*B==1?"bottom":"top"}else w=this.getTextAlign(A),k=this.getTextBaseline(A,!1);let C=d;if(I(C)){const{verticalLimitSize:B,verticalMinSize:O,orient:E}=this.attribute,L=Math.min(B||1/0,O||1/0);if(q(L))if(E==="bottom"||E==="top")if(T!==Math.PI/2){const P=Math.abs(Math.cos(T??0));C=P<1e-6?1/0:this.attribute.end.x/P}else C=L-x;else if(T&&T!==0){const P=Math.abs(Math.sin(T));C=P<1e-6?1/0:this.attribute.end.y/P}else C=L-x}const M=Object.assign(Object.assign(Object.assign({},S),p),{maxWidth:C,textStyle:Object.assign({textAlign:w,textBaseline:k},o),state:{text:rt({},Nr,u.text),shape:rt({},Nr,u.shape),panel:rt({},Nr,u.background)}});return M.angle=T,h&&h.visible&&(M.shape=Object.assign({visible:!0},h.style),h.space&&(M.space=h.space)),c&&c.visible&&(M.panel=Object.assign({visible:!0},c.style)),M}getTextBaseline(t,e){let i="middle";const{verticalFactor:n=1}=this.attribute,r=(e?1:-1)*n;return Oe(t[1],0)?i=!Oe(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":r===1?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){const n=this.attribute.orient;if(["top","bottom","right","left"].includes(n)||t[0]===0&&t[1]===0){if(n==="top"||n==="bottom")return y_(e?n==="bottom"?"top":"bottom":n,i);if(n==="left"||n==="right")return __(e?n==="left"?"right":"left":n,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,n,r){var a,o,l,h;const{flush:c=!1}=this.attribute.label||{};if(c&&t.length){const{orient:u,start:d,end:p}=this.attribute,g=u==="bottom"||u==="top",f=t[0],m=Wt(t),v=g?f.attribute.x>m.attribute.x:f.attribute.y<m.attribute.y;if(g){const y=v?m:f,_=v?f:m,b=d.x,x=p.x,S=y.AABBBounds.x1,A=_.AABBBounds.x2;S<b&&(y.attribute.angle?y.setAttributes({dx:((a=y.attribute.dx)!==null&&a!==void 0?a:0)+b-S}):y.setAttributes({x:b,textAlign:"left"})),A>x&&(_.attribute.angle?_.setAttributes({dx:((o=_.attribute.dx)!==null&&o!==void 0?o:0)+x-A}):_.setAttributes({x,textAlign:"right"}))}else{const y=v?m:f,_=v?f:m,b=y.AABBBounds.y2,x=_.AABBBounds.y1,S=d.y,A=p.y;x<S&&(_.attribute.angle?_.setAttributes({dy:((l=_.attribute.dy)!==null&&l!==void 0?l:0)+S-x}):_.setAttributes({y:S,textBaseline:"top"})),b>A&&(y.attribute.angle?y.setAttributes({dy:((h=y.attribute.dy)!==null&&h!==void 0?h:0)+A-b}):y.setAttributes({y:A,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,n,r){if(ht(t))return;const{verticalLimitSize:a,label:o,orient:l}=this.attribute,h=this._getAxisLabelLimitLength(a,r),{layoutFunc:c,autoRotate:u,autoRotateAngle:d,autoLimit:p,limitEllipsis:g,autoHide:f,autoHideMethod:m,autoHideSeparation:v,lastVisible:y,firstVisible:_,autoWrap:b,overflowLimitLength:x}=o;if(U(c))c(t,e,n,this);else{if(u?function(S,A){if(ht(S))return;const{orient:w,labelRotateAngle:k=[0,45,90]}=A;if(k.length===0||S.some(M=>!!M.attribute.angle))return;let T=0,C=0;for(k&&k.length>0&&(C=k.length);T<C;){const M=k[T++];if(S.forEach(B=>{B.attribute.angle=ei(M)}),tB(w,S),!QE(S))break}}(t,{labelRotateAngle:d,orient:l}):b&&function(S,A){const{limitLength:w,axisLength:k,ellipsis:T="...",orient:C}=A;if(ht(S)||!q(w))return;const M=S[0].attribute.angle,B=Vp(M),O=p_(M),E=C==="top"||C==="bottom";let L=k/S.length;S.forEach((P,F)=>{var j,D,N,J,X;if(E){if(O&&Math.floor(P.AABBBounds.height())<=w)return;if(B){const z=b_(P.attribute.x,(j=S[F+1])===null||j===void 0?void 0:j.attribute.x,(D=S[F-1])===null||D===void 0?void 0:D.attribute.x);q(z)&&(L=ke(L,z))}}else{if(O){const z=b_(P.attribute.y,(N=S[F+1])===null||N===void 0?void 0:N.attribute.y,(J=S[F-1])===null||J===void 0?void 0:J.attribute.y);q(z)&&(L=ke(L,z))}if(B&&Math.floor(P.AABBBounds.width())<=w)return}let $=null,G=null;E?O?($=w,G=L):($=L,G=w):O?($=L,G=w):($=w,G=L),P.setAttributes({maxLineWidth:$,ellipsis:(X=P.attribute.ellipsis)!==null&&X!==void 0?X:T,whiteSpace:"normal",heightLimit:G})})}(t,{orient:l,limitLength:h,axisLength:Math.abs(l==="left"||l==="right"?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x),ellipsis:g}),!b&&p&&q(h)&&h>0){const S=l==="left"||l==="right",A=Math.abs(S?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x);eB(t,{limitLength:h,verticalLimitLength:S?A/t.length:f||u?1/0:A/t.length,ellipsis:g,orient:l,axisLength:A,overflowLimitLength:x})}f&&function(S,A){if(ht(S))return;const w=S.filter(JE);if(ht(w))return;let k;k=function(B){return B.forEach(O=>O.setAttribute("opacity",1)),B}(w);const{method:T="parity",separation:C=0}=A,M=U(T)?T:m_[T]||m_.parity;if(k.length>=3&&Wp(k,C)){do k=M(k,C);while(k.length>=3&&Wp(k,C));const B=function(F,j){return(!(arguments.length>2&&arguments[2]!==void 0)||arguments[2])&&F<3||j},O=B(k.length,A.firstVisible,!1);let E=B(k.length,A.lastVisible);const L=w[0],P=Wt(w);Yi(L,P,C)&&O&&E&&(P.setAttribute("opacity",0),E=!1),v_(L,k,O,F=>Yi(F,L,C)),v_(P,k,E,F=>Yi(F,P,C)||!(!O||F===L)&&Yi(F,L,C),!0)}w.forEach(B=>{B.setAttribute("visible",!!B.attribute.opacity)})}(t,{method:m,separation:v,lastVisible:y,firstVisible:_})}}afterLabelsOverlap(t,e,i,n,r){const{verticalLimitSize:a,orient:o}=this.attribute,l=o==="bottom"||o==="top",h=i.AABBBounds;let c=l?h.height():h.width();const{verticalMinSize:u}=this.attribute;if(q(u)&&(!q(a)||u<=a)){const d=this._getAxisLabelLimitLength(u,r);let p,g;c=Math.max(c,d),o==="left"?(p=h.x2-c,g=h.y1):o==="right"?(p=h.x1,g=h.y1):o==="top"?(p=h.x1,g=h.y2-c):o==="bottom"&&(p=h.x1,g=h.y1);const f=gt.rect({x:p,y:g,width:l?h.width():c,height:l?c:h.height(),pickable:!1});f.name=xe.axisLabelBackground,f.id=this._getNodeId("axis-label-background"),i.insertBefore(f,i.firstChild)}if(R(this.attribute.label.containerAlign)){let d;o==="left"?d=h.x2-c:o==="right"?d=h.x1:o==="top"?d=h.y2-c:o==="bottom"&&(d=h.y1),function(p,g,f,m,v){m==="left"||m==="right"?v==="left"?p.forEach(y=>{var _;y.setAttributes({dx:((_=y.attribute.dx)!==null&&_!==void 0?_:0)+g-y.AABBBounds.x1})}):v==="right"?p.forEach(y=>{var _;y.setAttributes({dx:((_=y.attribute.dx)!==null&&_!==void 0?_:0)+g+f-y.AABBBounds.x2})}):v==="center"&&p.forEach(y=>{var _;y.setAttributes({dx:((_=y.attribute.dx)!==null&&_!==void 0?_:0)+g+f/2-(y.AABBBounds.x1+y.AABBBounds.x2)/2})}):m!=="bottom"&&m!=="top"||(v==="top"?p.forEach(y=>{var _;y.setAttributes({dy:((_=y.attribute.dy)!==null&&_!==void 0?_:0)+g-y.AABBBounds.y1})}):v==="bottom"?p.forEach(y=>{var _;y.setAttributes({dy:((_=y.attribute.dy)!==null&&_!==void 0?_:0)+g+f-y.AABBBounds.y2})}):v==="middle"&&p.forEach(y=>{var _;y.setAttributes({dy:((_=y.attribute.dy)!==null&&_!==void 0?_:0)+g+f/2-(y.AABBBounds.y1+y.AABBBounds.y2)/2})}))}(t,d,c,o,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,n,r,a,o;const{label:l,title:h,line:c,tick:u}=this.attribute,d=(i=l.space)!==null&&i!==void 0?i:4;let p=t,g=0,f=0;const m=c&&c.visible?(n=c.style.lineWidth)!==null&&n!==void 0?n:1:0,v=u&&u.visible?(r=u.length)!==null&&r!==void 0?r:4:0;if(h&&h.visible&&typeof h.text=="string"){g=zp(h.text,h.textStyle,(o=(a=this.stage)===null||a===void 0?void 0:a.getTheme())===null||o===void 0?void 0:o.text).height;const y=Si(h.padding);f=h.space+y[0]+y[2]}return p&&(p=(p-d-f-g-m-v)/e),p}release(){super.release(),this._breaks=null}}So.defaultAttributes=Hp,Ue(So,x_);class iB extends dr{constructor(){super(...arguments),this.mode=Ca.NORMAL}onBind(){const t=this.target.getInnerView(),e=this.target.getPrevInnerView();e&&(this._newElementAttrMap={},Gi(t,i=>{var n,r,a,o,l,h;if(i.type!=="group"&&i.id){const c=e[i.id];if(c){if(!Xt(i.attribute,c.attribute)){const u=Fi(i.attribute);this._newElementAttrMap[i.id]={state:"update",node:i,attrs:Object.assign(Object.assign({},u),{opacity:(n=u.opacity)!==null&&n!==void 0?n:1,fillOpacity:(r=u.fillOpacity)!==null&&r!==void 0?r:1,strokeOpacity:(a=u.strokeOpacity)!==null&&a!==void 0?a:1})},i.setAttributes(c.attribute)}}else{const u={opacity:(o=i.attribute.opacity)!==null&&o!==void 0?o:1,fillOpacity:(l=i.attribute.fillOpacity)!==null&&l!==void 0?l:1,strokeOpacity:(h=i.attribute.strokeOpacity)!==null&&h!==void 0?h:1};this._newElementAttrMap[i.id]={state:"enter",node:i,attrs:u},i.setAttributes({opacity:0,fillOpacity:0,strokeOpacity:0})}}}))}onStart(){let t=this.duration,e=this.easing;this._newElementAttrMap&&Object.keys(this._newElementAttrMap).forEach(i=>{var n;const{node:r,attrs:a,state:o}=this._newElementAttrMap[i];if(o==="enter"){const{enter:l={}}=(n=this.params)!==null&&n!==void 0?n:{};t=q(l.duration)?l.duration:t,e=l.easing?l.easing:e}r.type==="path"?r.animate({interpolate:(l,h,c,u,d)=>l==="path"&&(d.path=function(p,g){let f,m,v,y=Hu.lastIndex=Vu.lastIndex=0,_=-1;const b=[],x=[];for(p+="",g+="";(f=Hu.exec(p))&&(m=Vu.exec(g));)(v=m.index)>y&&(v=g.slice(y,v),b[_]?b[_]+=v:b[++_]=v),(f=f[0])===(m=m[0])?b[_]?b[_]+=m:b[++_]=m:(b[++_]=null,x.push({i:_,x:Sa(f,m)})),y=Vu.lastIndex;return y<g.length&&(v=g.slice(y),b[_]?b[_]+=v:b[++_]=v),b.length<2?x[0]?function(S){return function(A){return S(A)+""}}(x[0].x):function(S){return function(){return S}}(g):(g=x.length,function(S){for(let A,w=0;w<g;++w)b[(A=x[w]).i]=A.x(S);return b.join("")})}(c,u)(h),!0)}).to(a,t,e):r.animate().to(a,t,e)})}onUpdate(t,e,i){}}const Rn=s=>s.map((t,e)=>({index:e,value:t})),Rc=(s,t,e,i)=>e<s?Math.max(s-t/2,e):e>s?Math.min(s-t/2,e-t):e<i?e:e-t,Up=(s,t,e)=>{var i;const{labelStyle:n,axisOrientType:r,labelFlush:a,labelFormatter:o,startAngle:l=0}=e;let h=(i=n.angle)!==null&&i!==void 0?i:0;n.direction==="vertical"&&(h+=ei(90));const c=["bottom","top"].includes(r),u=["left","right"].includes(r);let d=1,p=0;c||(u?(d=0,p=1):l&&(d=Math.cos(l),p=-Math.sin(l)));const g=xo(n),f=s.range();return t.map((v,y)=>{var _,b;const x=o?o(v):\`\${v}\`,{width:S,height:A}=g.quickMeasure(x),w=Math.max(S,12),k=Math.max(A,12),T=s.scale(v),C=d*T,M=p*T;let B,O,E=C,L=M;a&&c&&y===0?E=Rc(C,w,f[0],f[f.length-1]):a&&c&&y===t.length-1?E=Rc(C,w,f[f.length-1],f[0]):B=(_=n.textAlign)!==null&&_!==void 0?_:"center",B==="right"?E-=w:B==="center"&&(E-=w/2),a&&u&&y===0?L=Rc(M,k,f[0],f[f.length-1]):a&&u&&y===t.length-1?L=Rc(M,k,f[f.length-1],f[0]):O=(b=n.textBaseline)!==null&&b!==void 0?b:"middle",O==="bottom"?L-=k:O==="middle"&&(L-=k/2);const P=new fe().set(E,L,E+w,L+k);return h&&P.rotate(h,C,M),P})};var Ee;(function(s){s.Identity="identity",s.Linear="linear",s.Log="log",s.Pow="pow",s.Sqrt="sqrt",s.Symlog="symlog",s.Time="time",s.Quantile="quantile",s.Quantize="quantize",s.Threshold="threshold",s.Ordinal="ordinal",s.Point="point",s.Band="band"})(Ee||(Ee={}));const A_={};function he(s){switch(s){case Ee.Linear:case Ee.Log:case Ee.Pow:case Ee.Sqrt:case Ee.Symlog:case Ee.Time:return!0;default:return!1}}function Gp(s){return!!A_[s]}function fi(s){switch(s){case Ee.Ordinal:case Ee.Point:case Ee.Band:return!0;default:return!1}}function Hr(s){return s}Object.values(Ee).forEach(s=>{A_[s]=!0});const sB=s=>-Math.log(-s),nB=s=>-Math.exp(-s),rB=s=>isFinite(s)?Math.pow(10,s):s<0?0:s,k_=s=>s===10?rB:s===Math.E?Math.exp:t=>Math.pow(s,t),w_=s=>s===Math.E?Math.log:s===10?Math.log10:s===2?Math.log2:(s=Math.log(s),t=>Math.log(t)/s),T_=s=>t=>Math.sign(t)*Math.log1p(Math.abs(t/s)),C_=s=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*s;function Yp(s,t){if(s=Number(s),t=Number(t),t-=s)return i=>(i-s)/t;const e=Number.isNaN(t)?NaN:.5;return()=>e}function M_(s,t,e){const i=s[0],n=s[1],r=t[0],a=t[1];let o,l;return n<i?(o=Yp(n,i),l=e(a,r)):(o=Yp(i,n),l=e(r,a)),h=>l(o(h))}function $p(s,t,e){let i;return i=s===1?s+2*e:s-t+2*e,s?i>0?i:1:0}function Xp(s,t,e,i){return e===1&&(e=0),$p(s,e,i)*(t/(1-e))}function E_(s,t){const e=(s[1]-s[0])/(t[1]-t[0]),i=s[0]-e*t[0];return[i,e+i]}function aB(s,t,e){const i=Math.min(s.length,t.length)-1,n=new Array(i),r=new Array(i);let a=-1;for(s[i]<s[0]&&(s=s.slice().reverse(),t=t.slice().reverse());++a<i;)n[a]=Yp(s[a],s[a+1]),r[a]=e(t[a],t[a+1]);return function(o){const l=Rf(s,o,1,i)-1;return r[l](n[l](o))}}const B_=function(s){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const e=Math.floor(Math.log10(s)),i=s/Math.pow(10,e);let n;return n=t?i<1.5?1:i<3?2:i<7?5:10:i<=1?1:i<=2?2:i<=5?5:10,n*Math.pow(10,e)};class R_{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:R(this._rangeFactorStart)&&R(this._rangeFactorEnd)&&t.length===2?(this._wholeRange=E_(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(t.length===2&&t.every(n=>n>=0&&n<=1)&&(this._wholeRange=null,t[0]===0&&t[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):R(this._rangeFactorStart)&&R(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return I(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!I(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=t,this._rangeFactorEnd=(i=this._rangeFactorEnd)!==null&&i!==void 0?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return I(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!I(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=t,this._rangeFactorStart=(i=this._rangeFactorStart)!==null&&i!==void 0?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:n}=this._fishEyeOptions,r=this.range(),a=r[0],o=r[r.length-1],l=Math.min(a,o),h=Math.max(a,o),c=ui((t=this._fishEyeOptions.focus)!==null&&t!==void 0?t:0,l,h),u=I(n)?(h-l)*i:n;let d=Math.exp(e);d=d/(d-1)*u;const p=e/u;this._fishEyeTransform=g=>{const f=Math.abs(g-c);if(f>=u)return g;if(f<=1e-6)return c;const m=d*(1-Math.exp(-f*p))/f*.75+.25;return c+(g-c)*m}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return(i=this==null?void 0:this[t])!==null&&i!==void 0?i:e}}const Kp=Symbol("implicit");class Ao extends R_{specified(t){var e;return t?(this._specified=Object.assign((e=this._specified)!==null&&e!==void 0?e:{},t),this):Object.assign({},this._specified)}_getSpecifiedValue(t){if(this._specified)return this._specified[t]}constructor(){super(),this.type=Ee.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=Kp}clone(){const t=new Ao().domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&t.specified(this._specified),t}calculateVisibleDomain(t){return R(this._rangeFactorStart)&&R(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:this._domain}scale(t){const e=\`\${t}\`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let n=this._index.get(e);if(!n){if(this._unknown!==Kp)return this._unknown;n=this._domain.push(t),this._index.set(e,n)}const r=this._ordinalRange[(n-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(r):r}invert(t){let e=0;for(;e<this._ordinalRange.length&&this._ordinalRange[e]!==t;)e++;return this._domain[(e-1)%this._domain.length]}domain(t){if(!t)return this._domain.slice();this._domain=[],this._index=new Map;for(const e of t){const i=\`\${e}\`;this._index.has(i)||this._index.set(i,this._domain.push(e))}return this}range(t){if(!t)return this._ordinalRange.slice();const e=Array.from(t);return this._ordinalRange=e,this}index(t){var e;return this._index&&(e=this._index.get(\`\${t}\`))!==null&&e!==void 0?e:-1}}function I_(s,t,e,i){const n=[];let r=s;for(;r<=t;)n.push(r),r+=e;return i&&n.reverse(),n}function O_(s,t,e,i){let n,r;if(t=Math.floor(+t),s=Math.floor(+s),!(e=Math.floor(+e)))return[];if(s===t)return[s];if(n=t<s){const o=s;s=t,t=o}let a=zu(1,t-s+1)(e);if(r=Math.floor((t-s+1)/a),!i)for(;Math.ceil((t-s+1)/r)>e&&a>1;)a-=1,r=Math.floor((t-s)/a);return I_(s,t,r,n)}class ko extends Ao{constructor(t){super(),this.type=Ee.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(t)}rescale(t,e){if(t)return this;this._wholeRange=null;const i=this._calculateWholeRange(this._range,e),n=super.domain().length,r=i[1]<i[0];let a=i[Number(r)-0];const o=i[1-Number(r)],l=$p(n,this._paddingInner,this._paddingOuter);return this._step=(o-a)/Math.max(1,l||1),this._round&&(this._step=Math.floor(this._step)),a+=(o-a-this._step*(n-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(a=Math.round(a),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:r,start:r?a+this._step*(n-1):a,count:n},this.generateFishEyeTransform(),this}scale(t){if(!this._bandRangeState)return;const e=\`\${t}\`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let n=this._index.get(e);if(!n){if(this._unknown!==Kp)return this._unknown;n=this._domain.push(t),this._index.set(e,n)}const{count:r,start:a,reverse:o}=this._bandRangeState,l=a+(n-1)%r*(o?-1:1)*this._step;return this._fishEyeTransform?this._fishEyeTransform(l):l}_calculateWholeRange(t,e){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let i;if(R(this._rangeFactorStart)&&R(this._rangeFactorEnd)&&t.length===2){const r=E_(t,[this._rangeFactorStart,this._rangeFactorEnd]);i=Math.abs(r[1]-r[0])}else i=Math.abs(t[1]-t[0]);const n=function(r,a,o,l,h){const c=$p(r,o,l);let u=a/Math.max(1,c||1);h&&(u=Math.floor(u));let d=u*(1-o);return h&&(d=Math.round(d)),d}(super.domain().length,i,this._paddingInner,this._paddingOuter,this._round);n<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):n>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=n,this._isFixed=!1)}if(this.isBandwidthFixed()){const i=Xp(super.domain().length,this._bandwidth,this._paddingInner,this._paddingOuter)*Math.sign(t[1]-t[0]),n=Math.min((t[1]-t[0])/i,1);if(R(this._rangeFactorStart)&&R(this._rangeFactorEnd)){const r=this._rangeFactorStart+n<=1,a=this._rangeFactorEnd-n>=0;if(e==="rangeFactorStart"&&r?this._rangeFactorEnd=this._rangeFactorStart+n:e==="rangeFactorEnd"&&a?this._rangeFactorStart=this._rangeFactorEnd-n:t[0]<=t[1]?r?this._rangeFactorEnd=this._rangeFactorStart+n:a?this._rangeFactorStart=this._rangeFactorEnd-n:(this._rangeFactorStart=0,this._rangeFactorEnd=n):a?this._rangeFactorStart=this._rangeFactorEnd-n:r?this._rangeFactorEnd=this._rangeFactorStart+n:(this._rangeFactorStart=1-n,this._rangeFactorEnd=1),i>0){const o=t[0]-i*this._rangeFactorStart,l=o+i;this._wholeRange=[o,l]}else{const o=t[1]+i*(1-this._rangeFactorEnd),l=o-i;this._wholeRange=[l,o]}}else this._rangeFactorStart=0,this._rangeFactorEnd=n,this._wholeRange=[t[0],t[0]+i];return this._wholeRange}return super._calculateWholeRange(t)}calculateWholeRangeSize(){const t=this._calculateWholeRange(this._range);return Math.abs(t[1]-t[0])}calculateVisibleDomain(t){const e=this._domain;if(R(this._rangeFactorStart)&&R(this._rangeFactorEnd)&&e.length){const i=this._getInvertIndex(t[0]),n=this._getInvertIndex(t[1]);return e.slice(Math.min(i,n),Math.max(i,n)+1)}return e}domain(t,e){return t?(super.domain(t),this.rescale(e)):super.domain()}range(t,e){return t?(this._range=[ba(t[0]),ba(t[1])],this.rescale(e)):this._range}rangeRound(t,e){return this._range=[ba(t[0]),ba(t[1])],this._round=!0,this.rescale(e)}ticks(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return t===-1?e:O_(0,e.length-1,t,!1).map(i=>e[i])}tickData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this.ticks(t).map((e,i)=>({index:i,tick:e,value:(this.scale(e)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])}))}forceTicks(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return O_(0,e.length-1,t,!0).filter(i=>i<e.length).map(i=>e[i])}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(i,n,r){let a;if(r=zu(1,(n=Math.floor(+n))-(i=Math.floor(+i))+1)(Math.floor(+r)),a=n<i){const o=i;i=n,n=o}return I_(i,n,r,a)}(0,e.length-1,t).map(i=>e[i])}_getInvertIndex(t){let e=0;const i=this.step()/2,n=this.bandwidth()/2,r=this._domain.length,a=this.range(),o=a[0]>a[a.length-1];for(e=0;e<r;e++){const l=this.scale(this._domain[e])+n;if(e===0&&(!o&&!ds(t,l+i)||o&&!Qi(t,l-i))||e===r-1||!Qi(t,l-i)&&!ds(t,l+i))break}return e>=0&&e<=r-1?e:r-1}invert(t){return this._domain[this._getInvertIndex(t)]}padding(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(t)?Math.min.apply(null,t):t)),this._paddingInner=this._paddingOuter,this.rescale(e)):this._paddingInner}paddingInner(t,e){return t!==void 0?(this._paddingInner=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingInner}paddingOuter(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingOuter}step(){return this._step}round(t,e){return t!==void 0?(this._round=t,this.rescale(e)):this._round}align(t,e){return t!==void 0?(this._align=Math.max(0,Math.min(1,t)),this.rescale(e)):this._align}rangeFactor(t,e){return t?(super.rangeFactor(t),this.rescale(e)):super.rangeFactor()}rangeFactorStart(t,e){return I(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this.rescale(e,"rangeFactorStart"))}rangeFactorEnd(t,e){return I(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this.rescale(e,"rangeFactorEnd"))}bandwidth(t,e){return t?(t==="auto"?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=t,this._isFixed=!0),this._userBandwidth=t,this.rescale(e)):this._bandwidth}maxBandwidth(t,e){return t?(this._maxBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._maxBandwidth}minBandwidth(t,e){return t?(this._minBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._minBandwidth}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&it(this._userBandwidth)}clone(){var t,e,i;return new ko(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth((t=this._userBandwidth)!==null&&t!==void 0?t:"auto",!0).maxBandwidth((e=this._maxBandwidth)!==null&&e!==void 0?e:"auto",!0).minBandwidth((i=this._maxBandwidth)!==null&&i!==void 0?i:"auto")}}const{interpolateRgb:qp}=cA;function oB(s,t){const e=typeof t;let i;if(I(t)||e==="boolean")return()=>t;if(e==="number")return Sa(s,t);if(e==="string"){if(i=re.parseColorString(t)){const n=qp(re.parseColorString(s),i);return r=>n(r).formatRgb()}return Sa(Number(s),Number(t))}return t instanceof ii?qp(s,t):t instanceof re?qp(s.color,t.color):t instanceof Date?function(n,r){const a=n.valueOf(),o=r.valueOf(),l=new Date;return h=>(l.setTime(a*(1-h)+o*h),l)}(s,t):Sa(Number(s),Number(t))}class P_ extends R_{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Hr,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Hr;super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=Hr,this._piecewise=M_,this._interpolate=oB}calculateVisibleDomain(t){var e;return R(this._rangeFactorStart)&&R(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:(e=this._niceDomain)!==null&&e!==void 0?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),Sa)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const n=Array.from(t,ba);return this._domain=n,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=nA,this.rescale(e)}rescale(t){var e;if(t)return this;const i=(e=this._niceDomain)!==null&&e!==void 0?e:this._domain,n=i.length,r=this._range.length;let a=Math.min(n,r);if(n&&n<r&&this._forceAlign){const o=r-n+1,l=i[n-1],h=n>=2?(l-i[n-2])/o:0;for(let c=1;c<=o;c++)i[n-2+c]=l-h*(o-c);a=r}return this._autoClamp&&(this._clamp=zu(i[0],i[a-1])),this._piecewise=a>2?aB:M_,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:Hr),this.rescale(i)):this._clamp!==Hr}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(){return[]}tickData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;const e=this.ticks(t);return(e??[]).map((i,n)=>({index:n,tick:i,value:(this.scale(i)-this._range[0])/(this._range[1]-this._range[0])}))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return I(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return I(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}}const lB=Math.sqrt(50),hB=Math.sqrt(10),cB=Math.sqrt(2),Ic=[1,2,5,10],L_=(s,t,e)=>{let i=1,n=s;const r=Math.floor((t-1)/2),a=Math.abs(s);return s>=0&&s<=Number.MIN_VALUE?n=0:s<0&&s>=-Number.MIN_VALUE?n=-(t-1):!e&&a<1?i=D_(a).step:(e||a>1)&&(n=Math.floor(s)-r*i),i>0?(s>0?n=Math.max(n,0):s<0&&(n=Math.min(n,-(t-1)*i)),function(o,l,h){R(l)||(l=o,o=0),R(h)||(h=1);let c=-1;const u=0|Math.max(0,Math.ceil((l-o)/h)),d=new Array(u);for(;++c<u;)d[c]=o+c*h;return d}(0,t).map(o=>n+o*i)):s>0?Oc(0,-(t-1)/i,i):Oc((t-1)/i,0,i)},uB=xa((s,t,e,i)=>{let n,r,a,o,l=-1;if(e=+e,(s=+s)==(t=+t))return[s];if(Math.abs(s-t)<=Number.MIN_VALUE&&e>0)return[s];if((n=t<s)&&(r=s,s=t,t=r),o=Zp(s,t,e).step,!isFinite(o))return[];if(o>0){let h=Math.round(s/o),c=Math.round(t/o);for(h*o<s&&++h,c*o>t&&--c,a=new Array(r=c-h+1);++l<r;)a[l]=(h+l)*o}else if(o<0&&(i!=null&&i.noDecimals)){o=1;const h=Math.ceil(s),c=Math.floor(t);if(!(h<=c))return[];for(a=new Array(r=c-h+1);++l<r;)a[l]=h+l}else{o=-o;let h=Math.round(s*o),c=Math.round(t*o);for(h/o<s&&++h,c/o>t&&--c,a=new Array(r=c-h+1);++l<r;)a[l]=(h+l)/o}return n&&a.reverse(),a}),Oc=(s,t,e)=>{let i,n,r=-1;if(e>0){let a=Math.floor(s/e),o=Math.ceil(t/e);for((a+1)*e<s&&++a,(o-1)*e>t&&--o,n=new Array(i=o-a+1);++r<i;)n[r]=(a+r)*e}else{e=-e;let a=Math.floor(s*e),o=Math.ceil(t*e);for((a+1)/e<s&&++a,(o-1)/e>t&&--o,n=new Array(i=o-a+1);++r<i;)n[r]=(a+r)/e}return n},Pc=xa((s,t,e,i)=>{let n,r,a;if(e=+e,(s=+s)==(t=+t)||Math.abs(s-t)<=Number.MIN_VALUE&&e>0)return L_(s,e,i==null?void 0:i.noDecimals);(n=t<s)&&(a=s,s=t,t=a);const o=Zp(s,t,e);let l=o.step;if(!isFinite(l))return[];if(l>0){let h=1;const{power:c,gap:u}=o,d=u===10?2*10**c:1*10**c;for(;h<=5&&(r=Oc(s,t,l),r.length>e+1)&&e>2;)l+=d,h+=1;e>2&&r.length<e-1&&(r=((p,g,f)=>{let m;const v=p[0],y=p[p.length-1],_=g-p.length;if(y<=0){const S=[];for(m=_;m>=1;m--)S.push(v-m*f);return S.concat(p)}if(v>=0){for(m=1;m<=_;m++)p.push(y+m*f);return p}let b=[];const x=[];for(m=1;m<=_;m++)m%2==0?b=[v-Math.floor(m/2)*f].concat(b):x.push(y+Math.ceil(m/2)*f);return b.concat(p).concat(x)})(r,e,l))}else i!=null&&i.noDecimals&&l<0&&(l=1),r=Oc(s,t,l);return n&&r.reverse(),r}),D_=s=>{const t=Math.floor(Math.log(s)/Math.LN10),e=s/10**t;let i=Ic[0];return e>=lB?i=Ic[3]:e>=hB?i=Ic[2]:e>=cB&&(i=Ic[1]),t>=0?{step:i*10**t,gap:i,power:t}:{step:-(10**-t)/i,gap:i,power:t}};function Zp(s,t,e){const i=(t-s)/Math.max(0,e);return D_(i)}function F_(s,t,e){let i;if(e=+e,(s=+s)==(t=+t)&&e>0)return[s];if(e<=0||(i=function(r,a,o){return(a-r)/Math.max(1,o-1)}(s,t,e))===0||!isFinite(i))return[];const n=new Array(e);for(let r=0;r<e;r++)n[r]=s+r*i;return n}function Jp(s){let t,e,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,n=0,r=s.length-1,a=s[n],o=s[r],l=10;for(o<a&&(e=a,a=o,o=e,e=n,n=r,r=e);l-- >0;){if(e=Zp(a,o,i).step,e===t)return s[n]=a,s[r]=o,s;if(e>0)a=Math.floor(a/e)*e,o=Math.ceil(o/e)*e;else{if(!(e<0))break;a=Math.ceil(a*e)/e,o=Math.floor(o*e)/e}t=e}}function j_(s,t){const e=it(t.forceMin),i=it(t.forceMax);let n=null;const r=[];let a=null;const o=e&&i?l=>l>=t.forceMin&&l<=t.forceMax:e?l=>l>=t.forceMin:i?l=>l<=t.forceMax:null;return e?r[0]=t.forceMin:it(t.min)&&t.min<=Math.min(s[0],s[s.length-1])&&(r[0]=t.min),i?r[1]=t.forceMax:it(t.max)&&t.max>=Math.max(s[0],s[s.length-1])&&(r[1]=t.max),it(r[0])&&it(r[1])?(a=s.slice(),a[0]=r[0],a[a.length-1]=r[1]):n=it(r[0])||it(r[1])?it(r[0])?"max":"min":"all",{niceType:n,niceDomain:a,niceMinMax:r,domainValidator:o}}const Qp=(s,t,e)=>Math.abs(t-s)<1?+e.toFixed(1):Math.round(+e),N_=xa((s,t,e,i,n,r,a)=>{let o=s,l=t;const h=l<o;h&&([o,l]=[l,o]);let c,u,d=n(o),p=n(l),g=[];if(!(i%1)&&p-d<e){if(d=Math.floor(d),p=Math.ceil(p),o>0){for(;d<=p;++d)for(c=1;c<i;++c)if(u=d<0?c/r(-d):c*r(d),!(u<o)){if(u>l)break;g.push(u)}}else for(;d<=p;++d)for(c=i-1;c>=1;--c)if(u=d>0?c/r(-d):c*r(d),!(u<o)){if(u>l)break;g.push(u)}2*g.length<e&&(g=Pc(o,l,e))}else g=Pc(d,p,Math.min(p-d,e)).map(r);return g=g.filter(f=>f!==0),a!=null&&a.noDecimals&&(g=Array.from(new Set(g.map(f=>Math.floor(f))))),h?g.reverse():g}),z_=xa((s,t,e,i,n,r)=>{const a=[],o={},l=n(s),h=n(t);let c=[];if(Number.isInteger(i))c=Pc(l,h,e);else{const u=(h-l)/(e-1);for(let d=0;d<e;d++)c.push(l+d*u)}return c.forEach(u=>{const d=r(u),p=Number.isInteger(i)?Qp(s,t,d):Qp(s,t,B_(d)),g=Qp(s,t,((f,m)=>{let v,y;return m[0]<m[1]?(v=m[0],y=m[1]):(v=m[1],y=m[0]),Math.min(Math.max(f,v),y)})(p,[s,t]));!o[g]&&!isNaN(g)&&c.length>1&&(o[g]=1,a.push(g))}),a}),Lc=xa((s,t,e,i,n)=>F_(i(s),i(t),e).map(r=>B_(n(r))));class wo extends P_{constructor(){super(...arguments),this.type=Ee.Linear}clone(){return new wo().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.calculateVisibleDomain(this._range);return uB(i[0],i[i.length-1],t,e)}ticks(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i;if(U(e==null?void 0:e.customTicks))return e.customTicks(this,t);if(R(this._rangeFactorStart)&&R(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(t,e);const n=(i=this._niceDomain)!==null&&i!==void 0?i:this._domain,r=this._domain,a=n[0],o=n[n.length-1];let l=Pc(r[0],r[r.length-1],t,e);if(!l.length)return l;if(this._domainValidator)l=l.filter(this._domainValidator);else if((l[0]!==a||l[l.length-1]!==o)&&this._niceType){const h=n.slice();if(this._niceType==="all"?(h[0]=l[0],h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()):this._niceType==="min"&&l[0]!==a?(h[0]=l[0],this._niceDomain=h,this.rescale()):this._niceType==="max"&&l[l.length-1]!==o&&(h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()),this._niceType!=="all"){const c=Math.min(h[0],h[h.length-1]),u=Math.max(h[0],h[h.length-1]);l=l.filter(d=>d>=c&&d<=u)}}return l}forceTicks(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return F_(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(i,n,r){let a,o,l=-1;if(r=+r,(o=(n=+n)<(i=+i))&&(a=i,i=n,n=a),!isFinite(r)||n-i<=r)return[i];const h=Math.floor((n-i)/r+1),c=new Array(h);for(;++l<h;)c[l]=i+l*r;return o&&c.reverse(),c}(e[0],e[e.length-1],t)}nice(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i,n;const r=this._domain;let a=[];if(e){const o=j_(r,e);if(a=o.niceMinMax,this._domainValidator=o.domainValidator,this._niceType=o.niceType,o.niceDomain)return this._niceDomain=o.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const o=Jp(r.slice(),t);this._niceType==="min"?o[o.length-1]=(i=a[1])!==null&&i!==void 0?i:o[o.length-1]:this._niceType==="max"&&(o[0]=(n=a[0])!==null&&n!==void 0?n:o[0]),this._niceDomain=o,this.rescale()}return this}niceMin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;this._niceType="min";const e=this._domain[this._domain.length-1],i=Jp(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;this._niceType="max";const e=this._domain[0],i=Jp(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}}class H_{nice(){let t=arguments.length>1?arguments[1]:void 0;var e,i,n,r;const a=this._domain;let o=[],l=null;if(t){const h=j_(a,t);if(o=h.niceMinMax,this._domainValidator=h.domainValidator,l=h.niceType,h.niceDomain)return this._niceDomain=h.niceDomain,this.rescale(),this}else l="all";if(l){const h=((c,u)=>{const d=c.slice();let p=0,g=d.length-1,f=d[p],m=d[g];return m<f&&([p,g]=[g,p],[f,m]=[m,f]),d[p]=u.floor(f),d[g]=u.ceil(m),d})(a.slice(),(i=(e=this.getNiceConfig)===null||e===void 0?void 0:e.call(this))!==null&&i!==void 0?i:{floor:c=>Math.floor(c),ceil:c=>Math.ceil(c)});return l==="min"?h[h.length-1]=(n=o[1])!==null&&n!==void 0?n:h[h.length-1]:l==="max"&&(h[0]=(r=o[0])!==null&&r!==void 0?r:h[0]),this._niceDomain=h,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}function V_(s){return t=>-s(-t)}function W_(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.EPSILON;return t=>Math.max(t,s)}class Dc extends P_{constructor(){super(w_(10),k_(10)),this.type=Ee.Log,this._limit=W_(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return new Dc().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();const i=w_(this._base),n=k_(this._base);return((e=this._niceDomain)!==null&&e!==void 0?e:this._domain)[0]<0?(this._logs=V_(i),this._pows=V_(n),this._limit=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.EPSILON;return a=>Math.min(a,-r)}(),this.transformer=sB,this.untransformer=nB):(this._logs=i,this._pows=n,this._limit=W_(),this.transformer=this._logs,this.untransformer=n),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return Hr}d3Ticks(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.domain(),n=this._limit(i[0]),r=this._limit(i[i.length-1]);return N_(n,r,t,this._base,this.transformer,this.untransformer,e)}ticks(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return z_(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return Lc(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Lc(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}getNiceConfig(){return{floor:t=>this._pows(Math.floor(this._logs(this._limit(t)))),ceil:t=>Math.abs(t)>=1?Math.ceil(t):this._pows(Math.ceil(this._logs(this._limit(t))))}}}Ue(Dc,H_);class Fc extends wo{constructor(){super(T_(1),C_(1)),this.type=Ee.Symlog,this._const=1}clone(){return new Fc().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(t,e){return arguments.length?(this._const=t,this.transformer=T_(t),this.untransformer=C_(t),this.rescale(e)):this._const}d3Ticks(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.domain(),n=i[0],r=i[i.length-1];return N_(n,r,t,this._const,this.transformer,this.untransformer,e)}ticks(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return z_(e[0],e[e.length-1],t,this._const,this.transformer,this.untransformer)}forceTicks(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return Lc(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Lc(e[0],e[e.length-1],t,this.transformer,this.untransformer)}}Ue(Fc,H_);class tg{constructor(){this.type=Ee.Threshold,this._range=[0,1],this._domain=[.5],this.n=1}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}scale(t){return!I(t)&&q(+t)?this._range[Rf(this._domain,t,0,this.n)]:this._unknown}invertExtent(t){const e=this._range.indexOf(t);return[this._domain[e-1],this._domain[e]]}domain(t){return t?(this._domain=Array.from(t),this.n=Math.min(this._domain.length,this._range.length-1),this):this._domain.slice()}range(t){return t?(this._range=Array.from(t),this.n=Math.min(this._domain.length,this._range.length-1),this):this._range.slice()}clone(){return new tg().domain(this._domain).range(this._range).unknown(this._unknown)}}function eg(s,t,e,i){let n;const{breakData:r}=s;if(r&&r()){const{breakDomains:a}=r(),o=t.domain();n=[];for(let l=0;l<o.length-1;l++)i(e,[o[l],o[l+1]]).forEach(h=>{a.some(c=>h>=c[0]&&h<=c[1])||n.push(h)});t.domain(o)}else n=i(e);return n}function U_(s,t,e,i){let n=arguments.length>4&&arguments[4]!==void 0&&arguments[4];if(e&&!t.includes(s)){let r=t.length;if(r>1){n?t.push(s):t.unshift(s);for(let a=0;a<r;a++){const o=n?r-1-a:a;if(!i(t[o]))break;t.splice(o,1),a--,r--}}}}const jc=(s,t)=>{var e,i;if(!he(s.type))return Rn(s.domain());const n=s.range(),r=Math.abs(n[n.length-1]-n[0]);if(r<2)return Rn([s.domain()[0]]);const{tickCount:a,forceTickCount:o,tickStep:l,noDecimals:h=!1,labelStyle:c,breakData:u}=t;let d;if(R(l))p=s.stepTicks(l),g=u&&u()?u().breakDomains:null,d=g&&g.length?p.filter(m=>g.every(v=>m<v[0]||m>v[1])):p;else if(R(o))d=eg(t,s,o,(m,v)=>v&&v.length?s.domain(v,!0).forceTicks(m):s.forceTicks(m));else if(t.tickMode==="d3"){const m=(e=U(a)?a({axisLength:r,labelStyle:c}):a)!==null&&e!==void 0?e:5;d=eg(t,s,m,(v,y)=>y&&y.length?s.domain(y,!0).d3Ticks(v,{noDecimals:h}):s.d3Ticks(v,{noDecimals:h}))}else{const m=(i=U(a)?a({axisLength:r,labelStyle:c}):a)!==null&&i!==void 0?i:5,v=U(t.tickMode)?t.tickMode:void 0;d=eg(t,s,m,(y,_)=>_&&_.length?s.domain(_,!0).ticks(y,{noDecimals:h,customTicks:v}):s.ticks(y,{noDecimals:h,customTicks:v}))}var p,g;const f=s.domain();if(t.labelFirstVisible&&f[0]!==d[0]&&!d.includes(f[0])&&d.unshift(f[0]),t.labelLastVisible&&f[f.length-1]!==d[d.length-1]&&!d.includes(f[f.length-1])&&d.push(f[f.length-1]),t.sampling&&d.length>1&&(t.coordinateType==="cartesian"||t.coordinateType==="polar"&&t.axisOrientType==="radius")){const{labelGap:m=4,labelFlush:v}=t,y=6;let _;if(d.length*y>r){const T=[],C=Math.floor(d.length*y/r);d.forEach((M,B)=>{B%C!=0&&B!==d.length-1||T.push(M)}),_=Up(s,T,t).map((M,B)=>({AABBBounds:M,value:T[B]}))}else _=Up(s,d,t).map((T,C)=>({AABBBounds:T,value:d[C]}));const b=_[0],x=Wt(_),S=u&&u()?G_.greedy:G_.parity;for(;_.length>=3&&Wp(_,m);)_=S(_,m);const A=t.labelFirstVisible;let w=t.labelLastVisible;Yi(b,x,m)&&_.includes(x)&&_.length>1&&A&&w&&(_.splice(_.indexOf(x),1),w=!1),U_(b,_,A,T=>Yi(T,b,m)),U_(x,_,w,T=>Yi(T,x,m)||!(!A||T===b)&&Yi(T,b,m),!0);const k=_.map(T=>T.value);k.length<3&&v&&(k.length>1&&k.pop(),Wt(k)!==Wt(d)&&k.push(Wt(d))),d=k}return Rn(d)},G_={parity:function(s){return s.filter((t,e)=>e%2==0)},greedy:function(s,t){let e;return s.filter((i,n)=>!(n&&Yi(e,i,t)||(e=i,0)))}},Y_=(s,t,e,i)=>Up(s,t,e).map(n=>i?[n.x1,n.x2,n.width()]:[n.y1,n.y2,n.height()]),$_=function(s,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return Math.max(s[0],t[0])-e/2<=Math.min(s[1],t[1])+e/2},X_=(s,t)=>s[1]<t[0]?t[0]-s[1]:t[1]<s[0]?s[0]-t[1]:0,dB=(s,t)=>{var e;const i=s.domain();if(!i.length)return[];const{tickCount:n,forceTickCount:r,tickStep:a,labelGap:o=4,axisOrientType:l,labelStyle:h}=t,c=(g=>["bottom","top","z"].includes(g))(l),u=s.range(),d=s.calculateWholeRangeSize();if(d<2)return t.labelLastVisible?Rn([i[i.length-1]]):Rn([i[0]]);let p;if(R(a))p=s.stepTicks(a);else if(R(r))p=s.forceTicks(r);else if(R(n)){const g=U(n)?n({axisLength:d,labelStyle:h}):n;p=s.ticks(g)}else if(t.sampling){const g=((e=t.labelStyle.fontSize)!==null&&e!==void 0?e:12)+2,f=ji(u),m=Ge(u);if(i.length<=d/g){const v=(m-f)/i.length,y=Y_(s,i,t,c),_=Math.min(...y.map(x=>x[2])),b=pB(i,y,o,t.labelLastVisible,Math.floor(_/v));p=s.stepTicks(b.step),t.labelLastVisible&&(b.delCount&&(p=p.slice(0,p.length-b.delCount)),p.push(i[i.length-1]))}else{const v=[i[0],i[Math.floor(i.length/2)],i[i.length-1]],y=Y_(s,v,t,c);let _=null;y.forEach(x=>{_?_[2]<x[2]&&(_=x):_=x});const b=m-f-o>0?Math.ceil(i.length*(o+_[2])/(m-f-o)):i.length-1;p=s.stepTicks(b),!t.labelLastVisible||p.length&&p[p.length-1]===i[i.length-1]||(p.length&&Math.abs(s.scale(p[p.length-1])-s.scale(i[i.length-1]))<_[2]&&(p=p.slice(0,-1)),p.push(i[i.length-1]))}}else p=s.domain();return Rn(p)},pB=(s,t,e,i,n,r)=>{let a=0,o=0,l=-1,h=Number.MAX_VALUE;const c=p=>{let g=!0,f=0;do f+p<s.length&&$_(t[f],t[f+p],e)&&(g=!1),f+=p;while(g&&f<s.length);return g},u=((p,g,f)=>{let m=p,v=g;for(;m<v;){const y=Math.floor((m+v)/2);f(y)>=0?v=y:m=y+1}return m})(n,s.length,p=>c(p)?1:-1);let d=u;do if(d>u&&!c(d))d++;else{if(!i){o=d;break}{const p=s.length-1;let g,f=0;g=s.length%d>0?s.length-s.length%d+d:s.length;do{if(g-=d,g!==p&&!$_(t[g],t[p],e))break;f++}while(g>0);if(g===p){o=d,a=f;break}{const m=Math.floor(s.length/d)-f+1;if(m<l)break;{l=m;const v=X_(t[g],t[p]),y=g-d>=0?X_(t[g-d],t[g]):v,_=Math.abs(v-y);if(_<h&&(h=_,o=d,a=f),v<=y)break}}}d++}while(d<=s.length);return{step:o,delCount:a}},Vs=new Uint32Array(33),$i=new Uint32Array(33);$i[0]=0,Vs[0]=~$i[0];for(let s=1;s<=32;++s)$i[s]=$i[s-1]<<1|1,Vs[s]=~$i[s];function K_(s,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,left:0,right:0,bottom:0};const{top:i=0,left:n=0,right:r=0,bottom:a=0}=e,o=Math.max(1,Math.sqrt(s*t/1e6)),l=~~((s+n+r+o)/o),h=~~((t+i+a+o)/o),c=u=>~~(u/o);return c.bitmap=()=>function(u,d){const p=new Uint32Array(~~((u*d+32)/32));function g(m,v){p[m]|=v}function f(m,v){p[m]&=v}return{array:p,get:(m,v)=>{const y=v*u+m;return p[y>>>5]&1<<(31&y)},set:(m,v)=>{const y=v*u+m;g(y>>>5,1<<(31&y))},clear:(m,v)=>{const y=v*u+m;f(y>>>5,~(1<<(31&y)))},getRange:m=>{let{x1:v,y1:y,x2:_,y2:b}=m;if(_<0||b<0||v>u||y>d)return!0;let x,S,A,w,k=b;for(;k>=y;--k)if(x=k*u+v,S=k*u+_,A=x>>>5,w=S>>>5,A===w){if(p[A]&Vs[31&x]&$i[1+(31&S)])return!0}else{if(p[A]&Vs[31&x]||p[w]&$i[1+(31&S)])return!0;for(let T=A+1;T<w;++T)if(p[T])return!0}return!1},setRange:m=>{let v,y,_,b,x,{x1:S,y1:A,x2:w,y2:k}=m;if(!(w<0||k<0||S>u||A>d))for(;A<=k;++A)if(v=A*u+S,y=A*u+w,_=v>>>5,b=y>>>5,_===b)g(_,Vs[31&v]&$i[1+(31&y)]);else for(g(_,Vs[31&v]),g(b,$i[1+(31&y)]),x=_+1;x<b;++x)g(x,4294967295)},clearRange:m=>{let v,y,_,b,x,{x1:S,y1:A,x2:w,y2:k}=m;for(;A<=k;++A)if(v=A*u+S,y=A*u+w,_=v>>>5,b=y>>>5,_===b)f(_,$i[31&v]|Vs[1+(31&y)]);else for(f(_,$i[31&v]),f(b,Vs[1+(31&y)]),x=_+1;x<b;++x)f(x,0)},outOfBounds:m=>{let{x1:v,y1:y,x2:_,y2:b}=m;return v<0||y<0||b>=d||_>=u},toImageData:m=>{const v=m.createImageData(u,d),y=v.data;for(let _=0;_<d;++_)for(let b=0;b<u;++b){const x=_*u+b,S=4*x,A=p[x>>>5]&1<<(31&x);y[S+0]=255*A,y[S+1]=255*A,y[S+2]=255*A,y[S+3]=31}return v}}}(l,h),c.x=u=>~~((u+n)/o),c.y=u=>~~((u+i)/o),c.ratio=o,c.padding=e,c.width=s,c.height=t,c}function q_(s,t){const{x1:e,x2:i,y1:n,y2:r}=t,{top:a=0,left:o=0,right:l=0,bottom:h=0}=s.padding,c=ui(e,-o,s.width+l),u=ui(i,-o,s.width+l),d=ui(n,-a,s.height+h),p=ui(r,-a,s.height+h);return{x1:s.x(c),x2:s.x(u),y1:s.y(d),y2:s.y(p)}}function hs(s,t){return arguments.length>2&&arguments[2]!==void 0&&arguments[2]?q_(s,t):{x1:s.x(t.x1),x2:s.x(t.x2),y1:s.y(t.y1),y2:s.y(t.y2)}}function To(s,t,e){let i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3],n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,r=e;n>0&&(r={x1:e.x1-n,x2:e.x2+n,y1:e.y1-n,y2:e.y2+n}),r=hs(s,r);const a=t.outOfBounds(r);return!(i&&a||(a&&(r=q_(s,r)),t.getRange(r)))}function ig(s,t,e){let i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,r=arguments.length>6&&arguments[6]!==void 0&&arguments[6];const a=(arguments.length>3&&arguments[3]!==void 0?arguments[3]:[]).filter(o=>R(o));for(let o=0;o<a.length;o++){let l;if(l=r?e:e.clone(),l.setAttributes(a[o]),To(s,t,l.AABBBounds,i,n))return t.setRange(hs(s,l.AABBBounds,!0)),a[o]}return!1}function gB(s,t,e,i,n,r,a){var o,l;const h=(o=i.overlap)===null||o===void 0?void 0:o.clampForce,c=(l=i.overlap)===null||l===void 0?void 0:l.overlapPadding;if(e.type==="bound"||e.type==="position"){if(U(a)){const d=((U(e.position)?e.position(n.attribute):e.position)||(u=i.type,u==="rect"?mB:fB)).map(g=>a(n.AABBBounds,r,g,i.offset)),p=e.restorePosition===!1;return ig(s,t,n,d,h,c,p)}return!1}var u;if(e.type==="moveY"){const d=(e.offset?U(e.offset)?e.offset(n.attribute):e.offset:[]).map(p=>({x:n.attribute.x,y:n.attribute.y+p}));return ig(s,t,n,d,h,c)}if(e.type==="moveX"){const d=(e.offset?U(e.offset)?e.offset(n.attribute):e.offset:[]).map(p=>({x:n.attribute.x+p,y:n.attribute.y}));return ig(s,t,n,d,h,c)}return!1}const fB=["top","bottom","right","left","top-right","bottom-right","top-left","bottom-left"],mB=["top","inside-top","inside"];function Z_(s,t,e){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const{x1:n,x2:r,y1:a,y2:o}=s.AABBBounds,{top:l=0,left:h=0,right:c=0,bottom:u=0}=i,d=Math.min(n,r),p=Math.max(n,r),g=Math.min(a,o),f=Math.max(a,o),m=t+c,v=e+u;let y=0,_=0;return d<0-h?y=-d:p>m&&(y=m-p),g<0-l?_=-g:f>v&&(_=v-f),{dx:y,dy:_}}const J_={fadeIn:function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var t,e,i;return{from:{opacity:0,fillOpacity:0,strokeOpacity:0},to:{opacity:(t=s.opacity)!==null&&t!==void 0?t:1,fillOpacity:(e=s.fillOpacity)!==null&&e!==void 0?e:1,strokeOpacity:(i=s.strokeOpacity)!==null&&i!==void 0?i:1}}},fadeOut:function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var t,e,i;return{from:{opacity:(t=s.opacity)!==null&&t!==void 0?t:1,fillOpacity:(e=s.fillOpacity)!==null&&e!==void 0?e:1,strokeOpacity:(i=s.strokeOpacity)!==null&&i!==void 0?i:1},to:{opacity:0,fillOpacity:0,strokeOpacity:0}}}};function Q_(s,t){var e,i;return(i=(e=J_[t])===null||e===void 0?void 0:e.call(J_,s))!==null&&i!==void 0?i:{from:{},to:{}}}const vB=(s,t,e,i)=>{const n=Object.assign({},s.attribute),r=Object.assign({},t.attribute);return Y(i==null?void 0:i.excludeChannels).forEach(a=>{delete r[a]}),Object.keys(r).forEach(a=>{e&&!e.includes(a)&&delete r[a]}),{from:n,to:r}};function tb(s,t,e,i){s.attribute.text!==t.attribute.text&&q(Number(s.attribute.text)*Number(t.attribute.text))&&s.animate().play(new Fk({text:s.attribute.text},{text:t.attribute.text},e,i))}const sg={mode:"same-time",duration:300,easing:"linear"};function In(s){return s===3||s===4}function yB(s,t){const{x1:e,y1:i,x2:n,y2:r}=s,{x1:a,y1:o,x2:l,y2:h}=t;return!(e<=a&&n<=a||e>=l&&n>=l||i<=o&&r<=o||i>=h&&r>=h)}const _B=s=>{if(!s||!s.attribute)return[];const{points:t,segments:e}=s.attribute;if(e&&e.length){const i=[];return e.forEach(n=>{n.points.forEach(r=>{i.push(r)})}),i}return t};function eb(s,t,e,i,n,r){return Math.abs(t/s)<r/n?{x:e+(s>0?n:-n),y:i+t*n/Math.abs(s)}:{x:e+s*r/Math.abs(t),y:i+(t>0?r:-r)}}const ib=(s,t)=>Math.ceil(s)>Math.floor(t),bB=(s,t)=>{let[e,i]=s,[n,r]=t;return r>e&&i>n};function xB(s,t){const[e,i]=s,[n,r]=t,a=Math.max(e,n),o=Math.min(i,r);return Math.max(0,o-a)}var SB=function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e};Ii(),Dr(),vo(),mo();class Ws extends Wi{setBitmap(t){this._bitmap=t}setBitmapTool(t){this._bmpTool=t}constructor(t,e){const{data:i}=t,n=SB(t,["data"]);super(e!=null&&e.skipDefault?t:Object.assign({data:i},rt({},Ws.defaultAttributes,n))),this.name="label",this._onHover=r=>{const a=r.target;a===this._lastHover||ht(a.states)||(a.addState(se.hover,!0),Gi(this,o=>{o===a||ht(o.states)||o.addState(se.hoverReverse,!0)}),this._lastHover=a)},this._onUnHover=r=>{this._lastHover&&(Gi(this,a=>{ht(a.states)||(a.removeState(se.hoverReverse),a.removeState(se.hover))}),this._lastHover=null)},this._onClick=r=>{const a=r.target;if(this._lastSelect===a&&a.hasState("selected"))return this._lastSelect=null,void Gi(this,o=>{ht(o.states)||(o.removeState(se.selectedReverse),o.removeState(se.selected))});ht(a.states)||(a.addState(se.selected,!0),Gi(this,o=>{o===a||ht(o.states)||o.addState(se.selectedReverse,!0)}),this._lastSelect=a)},this._handleRelatedGraphicSetState=r=>{var a,o,l,h,c;if(((a=r.detail)===null||a===void 0?void 0:a.type)===Pe.STATE||((o=r.detail)===null||o===void 0?void 0:o.type)===Pe.ANIMATE_UPDATE&&(!((l=r.detail.animationState)===null||l===void 0)&&l.isFirstFrameOfStep)){const u=(c=(h=r.target)===null||h===void 0?void 0:h.currentStates)!==null&&c!==void 0?c:[],d=this._isCollectionBase?[...this._graphicToText.values()]:[this._graphicToText.get(r.target)];this.updateStatesOfLabels(d,u)}}}labeling(t,e,i,n){}_getLabelLinePoints(t,e){return function(i,n){if(!i||!n||Aa(i,n,!0))return;const r=Math.min(i.x1,i.x2),a=Math.min(i.y1,i.y2),o=Math.min(n.x1,n.x2),l=Math.min(n.y1,n.y2),h=Math.abs(i.x2-r)/2,c=Math.abs(i.y2-a)/2,u=Math.abs(n.x2-o)/2,d=Math.abs(n.y2-l)/2,p=r+h,g=a+c,f=o+u,m=l+d,v=f-p,y=m-g;return[eb(v,y,p,g,h,c),eb(-v,-y,f,m,u,d)]}(t.AABBBounds,e==null?void 0:e.AABBBounds)}_createLabelLine(t,e){const i=this._getLabelLinePoints(t,e);if(i){const n=gt.line({points:i}),{line:r={}}=t.attribute;if(r.customShape){const a=r.customShape;n.pathProxy=o=>a({text:t,baseMark:e},o,new me)}return e&&e.attribute.fill&&n.setAttribute("stroke",e.attribute.fill),this.attribute.line&&!ht(this.attribute.line.style)&&n.setAttributes(this.attribute.line.style),this._setStatesOfLabelLine(n),n}}render(){if(this._prepare(),I(this._idToGraphic)||this._isCollectionBase&&I(this._idToPoint))return;const{overlap:t,smartInvert:e,dataFilter:i,customLayoutFunc:n,customOverlapFunc:r}=this.attribute;let a=this.attribute.data;if(U(i)&&(a=i(a)),a&&a.length){const l=new Set;a=a.filter(h=>!l.has(h.id)&&l.add(h.id))}let o=this._initText(a);o=U(n)?n(a,o,this.getRelatedGraphic.bind(this),this._isCollectionBase?l=>this._idToPoint.get(l.id):null,this):this._layout(o),U(r)?o=r(o,this.getRelatedGraphic.bind(this),this._isCollectionBase?l=>this._idToPoint.get(l.id):null,this):t!==!1&&(o=this._overlapping(o)),U(this.attribute.onAfterOverlapping)&&this.attribute.onAfterOverlapping(o,this.getRelatedGraphic.bind(this),this._isCollectionBase?l=>this._idToPoint.get(l.id):null,this),o&&o.length&&o.forEach(l=>{this._bindEvent(l),this._setStatesOfText(l)}),e!==!1&&this._smartInvert(o),this._renderLabels(o)}_bindEvent(t){if(this.attribute.disableTriggerEvent||!t)return;const{hover:e,select:i}=this.attribute;e&&(t.addEventListener("pointermove",this._onHover),t.addEventListener("pointerout",this._onUnHover)),i&&t.addEventListener("pointerdown",this._onClick)}_setStatesOfText(t){if(!t)return;const e=this.attribute.state;e&&!ht(e)&&(t.states=e)}_setStatesOfLabelLine(t){if(!t)return;const e=this.attribute.labelLineState;e&&!ht(e)&&(t.states=e)}_createLabelText(t){var e,i;return Tc(Object.assign(Object.assign({},(i=(e=this.stage)===null||e===void 0?void 0:e.getTheme())===null||i===void 0?void 0:i.text),t),"textType")}_prepare(){var t,e;const i=[];let n;if(n=U(this.attribute.getBaseMarks)?this.attribute.getBaseMarks():function(a,o){if(!o)return[];const l=a.find(h=>h.name===o,!0);return l?l.getChildren():[]}(this.getRootNode(),this.attribute.baseMarkGroupName),n.forEach(a=>{a.releaseStatus!=="willRelease"&&i.push(a)}),(t=this._idToGraphic)===null||t===void 0||t.clear(),(e=this._idToPoint)===null||e===void 0||e.clear(),this._baseMarks=i,this._isCollectionBase=this.attribute.type==="line-data",!i||i.length===0)return;const{data:r}=this.attribute;if(r&&r.length!==0){if(this._idToGraphic||(this._idToGraphic=new Map),this._isCollectionBase){this._idToPoint||(this._idToPoint=new Map);let a=0;for(let o=0;o<i.length;o++){const l=i[o],h=_B(l);if(h&&h.length)for(let c=0;c<h.length;c++){const u=r[a];u&&h[c]&&(R(u.id)||(u.id=\`vrender-component-\${this.name}-\${a}\`),this._idToPoint.set(u.id,h[c]),this._idToGraphic.set(u.id,l)),a++}}}else for(let a=0;a<i.length;a++){const o=r[a],l=i[a];o&&l&&(R(o.id)||(o.id=\`vrender-component-\${this.name}-\${a}\`),this._idToGraphic.set(o.id,l))}if(this.attribute.animation!==!1){const{animation:a,animationEnter:o,animationExit:l,animationUpdate:h}=this.attribute,c=_t(a)?a:{};this._animationConfig={enter:o!==!1&&rt({},sg,c,o??{}),exit:l!==!1&&rt({},sg,c,l??{}),update:h!==!1&&(W(h)?h:rt({},sg,c,h??{}))}}else this._animationConfig={enter:!1,exit:!1,update:!1}}}getRelatedGraphic(t){return this._idToGraphic.get(t.id)}_initText(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{textStyle:e={}}=this.attribute,i=[];for(let n=0;n<t.length;n++){const r=t[n],a=this.getRelatedGraphic(r);if(!a)continue;const o=Object.assign(Object.assign({fill:this._isCollectionBase?W(a.attribute.stroke)?a.attribute.stroke.find(h=>!!h&&h!==!0):a.attribute.stroke:a.attribute.fill},e),r),l=this._createLabelText(o);i.push(l)}return i}_layout(t){const{position:e,offset:i}=this.attribute;for(let n=0;n<t.length;n++){const r=t[n];if(!r)return;const a=r.attribute,o=this.getRelatedGraphic(a);if(!o)continue;r.attachedThemeGraphic=this;const l=this.getGraphicBounds(r);r.attachedThemeGraphic=null;const h=U(e)?e(a):e,c=this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(a.id),h):this.getGraphicBounds(o,{x:a.x,y:a.y},h),u=this.labeling(l,c,h,i);u&&r.setAttributes(u)}return t}_overlapping(t){var e,i,n;if(t.length===0)return[];const r=_t(this.attribute.overlap)?this.attribute.overlap:{},a=this.getBaseMarkGroup(),o=(e=r.size)!==null&&e!==void 0?e:{width:(i=a==null?void 0:a.AABBBounds.width())!==null&&i!==void 0?i:0,height:(n=a==null?void 0:a.AABBBounds.height())!==null&&n!==void 0?n:0};if(o.width===0||o.height===0)return t;const{strategy:l,priority:h}=r,c=this._bmpTool||K_(o.width,o.height),u=this._bitmap||c.bitmap();return h&&(t=t.sort((d,p)=>h(p.attribute.data)-h(d.attribute.data))),(l==null?void 0:l.type)==="shiftY"?this._overlapGlobal(t,r,c,u):this._overlapByStrategy(t,r,c,u)}_overlapGlobal(t,e,i,n){let r=t.filter(c=>c.attribute.visible&&c.attribute.opacity!==0&&this.isMarkInsideRect(this.getRelatedGraphic(c.attribute),i));const{clampForce:a=!0,hideOnHit:o=!0,overlapPadding:l,strategy:h}=e;if(a)for(let c=0;c<r.length;c++){const u=t[c],{dx:d=0,dy:p=0}=Z_(u,i.width,i.height,i.padding);d===0&&p===0||(u.setAttributes({x:u.attribute.x+d,y:u.attribute.y+p}),u._isClamped=!0)}r=function(c,u){const{maxY:d=Number.MAX_VALUE,labelling:p,globalShiftY:g={enable:!0,maxIterations:10,maxError:.1,padding:1}}=u,f=c.length;if(f<=1)return c;const m=new Map,v=new Map,y=E=>v.get(E).y1Initial,_=E=>v.get(E).height,b=E=>v.get(E).y1,x=E=>v.get(E).x,S=E=>v.get(E).x1,A=E=>v.get(E).x2,w=E=>v.get(E).attempts,k=(E,L)=>{v.get(E).y1=L},T=(E,L)=>{v.get(E).attempts=L};function C(E){for(let P=E.length-1;P>=0;P--){const F=E[P],j=E[P-1],D=E[P+1];if(j&&ib(b(j)+_(j),b(F))||b(F)===0&&F._isClamped){const{y:N}=p(F);D&&ib(N+_(F)/2,b(D))||N+_(F)/2<=d&&k(F,b(F)+N-(L=F,v.get(L).y))}}var L}c.sort((E,L)=>E.attribute.x-L.attribute.x);for(const E of c){const{y1:L,y2:P,x1:F,x2:j}=E.AABBBounds,{x:D,y:N}=E.attribute;v.set(E,{y1Initial:L,y1:L,y2:P,y:N,height:P-L,x1:F,x2:j,x:D,attempts:0});let J=!1;for(const[X,$]of m){const{start:G,end:z}=X;if(F>=G&&j<=z)$.push(E),J=!0;else if(Oe(D,x($[0]),void 0,5)){const ot={start:Math.min(G,F),end:Math.max(z,j)};$.push(E),m.set(ot,$),m.delete(X),J=!0}else if(xB([G,z],[F,j])/(z-G)>.5){const ot={start:Math.min(G,F),end:Math.max(z,j)};$.push(E),m.set(ot,$),m.delete(X),J=!0}if(J)break}J||m.set({start:F,end:j},[E])}for(const E of m.values())E.sort((L,P)=>y(L)-y(P)),C(E);if(g.enable!==!1){const{maxIterations:E=10,maxError:L=.1,padding:P=1,maxAttempts:F=1e3,deltaYTolerance:j=Number.MAX_VALUE}=g;for(let D=0;D<E;D++){c.sort((J,X)=>y(J)-y(X));let N=0;for(let J=0;J<f-1;J++){const X=c[J];if(w(X)>=F)continue;let $,G=J+1;for(;($=c[G])&&!bB([S(X),A(X)],[S($),A($)]);)G+=1;if($){const z=b(X),ot=_(X),ft=b($),ut=ft-(z+ot);if(ut<P){const tt=(P-ut)/2;if(N=Math.max(N,tt),z+tt+_($)>d){const lt=z-(P-ut),Mt=y(X)-lt;Math.abs(Mt)<=j&&(k(X,lt),T(X,w(X)+1))}else if(z-tt<0){const lt=ft+(P-ut),Mt=y($)-lt;Math.abs(Mt)<=j&&(k($,lt),T($,w($)+1))}else{const lt=z-tt,Mt=y(X)-lt,Pt=ft+tt,Dt=y($)-Pt;Math.abs(Mt)<=j&&Math.abs(Dt)<=j&&(k(X,lt),k($,Pt),T(X,w(X)+1),T($,w($)+1))}}}}if(N<L)break}}for(const E of c){const L=E.attribute.y+b(E)-y(E);E.setAttribute("y",L)}const M=[];c.sort((E,L)=>E.attribute.x-L.attribute.x);let B=0,O=c.length-1;for(;B<=O;)B===O?M.push(c[B]):(M.push(c[B]),M.push(c[O])),B++,O--;return M}(r,Object.assign(Object.assign({maxY:i.height},h),{labelling:c=>{const u=this.getRelatedGraphic(c.attribute),d=this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(c.attribute.id)):this.getGraphicBounds(u,c);return this.labeling(c.AABBBounds,d,"bottom",this.attribute.offset)}}));for(let c=0;c<r.length;c++){const u=r[c],d=u.AABBBounds,p=hs(i,d,!0);if(To(i,n,d,a,l))n.setRange(p);else{if(a&&this._processClampForce(u,i,n,l))continue;o?u.setAttributes({visible:!1}):n.setRange(p)}}return r}_processClampForce(t,e,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const{dy:r=0,dx:a=0}=Z_(t,e.width,e.height,e.padding);if(a===0&&r===0){if(To(e,i,t.AABBBounds,!1,n))return i.setRange(hs(e,t.AABBBounds,!0)),!0}else if(To(e,i,{x1:t.AABBBounds.x1+a,x2:t.AABBBounds.x2+a,y1:t.AABBBounds.y1+r,y2:t.AABBBounds.y2+r}))return t.setAttributes({x:t.attribute.x+a,y:t.attribute.y+r}),i.setRange(hs(e,t.AABBBounds,!0)),!0;return!1}_overlapByStrategy(t,e,i,n){var r;const{avoidBaseMark:a,strategy:o=[],hideOnHit:l=!0,clampForce:h=!0,avoidMarks:c=[],overlapPadding:u}=e,d=[],p=o.some(g=>g.type==="bound");a&&((r=this._baseMarks)===null||r===void 0||r.forEach(g=>{g.AABBBounds&&n.setRange(hs(i,g.AABBBounds,!0))})),c.length>0&&c.forEach(g=>{Q(g)?function(f,m){if(!m)return[];const v=f.find(y=>y.name===m,!0);return v?v.findAll(y=>y.type!=="group",!0):[]}(this.getRootNode(),g).forEach(f=>{f.AABBBounds&&n.setRange(hs(i,f.AABBBounds,!0))}):g.AABBBounds&&n.setRange(hs(i,g.AABBBounds,!0))});for(let g=0;g<t.length;g++){if(t[g].attribute.visible===!1)continue;const f=t[g],m=this.getRelatedGraphic(f.attribute);if(f.update(),!this.isMarkInsideRect(m,i))continue;if(To(i,n,f.AABBBounds,h,u)){if(!p){n.setRange(hs(i,f.AABBBounds,!0)),d.push(f);continue}if(p&&m&&m.AABBBounds&&this._canPlaceInside(f.AABBBounds,m.AABBBounds)){n.setRange(hs(i,f.AABBBounds,!0)),d.push(f);continue}}let v=!1;for(let y=0;y<o.length;y++)if(v=gB(i,n,o[y],this.attribute,f,this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(t[g].attribute.id)):this.getGraphicBounds(m,t[g].attribute),this.labeling),v!==!1){f.setAttributes({x:v.x,y:v.y}),d.push(f);break}(!v&&h&&this._processClampForce(f,i,n,u)||!v&&!l)&&d.push(f)}return d}isMarkInsideRect(t,e){const{left:i,right:n,top:r,bottom:a}=e.padding,o={x1:-i,x2:e.width+n,y1:-r,y2:e.height+a},l=t.AABBBounds;if(l.width()!==0&&l.height()!==0)return Aa(t.AABBBounds,o,!0);const{attribute:h}=t;if(t.type==="rect"){const{x:c,x1:u,y:d,y1:p}=h;return Ff({x:c??u,y:d??p},o)}return"x"in h&&"y"in h&&Ff({x:h.x,y:h.y},o)}getBaseMarkGroup(){const{baseMarkGroupName:t}=this.attribute;if(t)return this.getRootNode().find(e=>e.name===t,!0)}getGraphicBounds(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;if(t){if(t.attribute.visible!==!1)return t.AABBBounds;const{x:a,y:o}=t.attribute;return{x1:a,x2:a,y1:o,y2:o}}if(e&&i&&i==="inside-middle"){const{x:a,y:o,x1:l=a,y1:h=o}=e;return{x1:(a+l)/2,x2:(a+l)/2,y1:(o+h)/2,y2:(o+h)/2}}const{x:n,y:r}=e;return{x1:n,x2:n,y1:r,y2:r}}_renderLabels(t){var e;const{syncState:i}=this.attribute,n=new Map,r=this._graphicToText||new Map,a=[],o=[],{visible:l}=(e=this.attribute.line)!==null&&e!==void 0?e:{};t&&t.forEach((h,c)=>{var u;const d=this.getRelatedGraphic(h.attribute),p=this._isCollectionBase?h.attribute.id:d,g=r!=null&&r.get(p)?"update":"enter";let f;if(l&&(f=this._createLabelLine(h,d)),i&&this.updateStatesOfLabels([f?{text:h,labelLine:f}:{text:h}],(u=d.currentStates)!==null&&u!==void 0?u:[]),g==="enter")a.push(h),n.set(p,f?{text:h,labelLine:f}:{text:h}),this._addLabel({text:h,labelLine:f},a,o,c);else if(g==="update"){const m=r.get(p);r.delete(p),n.set(p,m),this._updateLabel(m,{text:h,labelLine:f})}}),this._removeLabel(r),this._graphicToText=n}_addLabel(t,e,i,n){const{text:r,labelLine:a}=t,o=this.getRelatedGraphic(r.attribute);if(this._syncStateWithRelatedGraphic(o),this._enableAnimation!==!1&&this._animationConfig.enter!==!1){if(o){const{from:l,to:h}=Q_(r.attribute,"fadeIn");r&&this.add(r),a&&(i.push(a),this.add(a)),this._animationConfig.enter.duration>0&&o.once("animate-bind",c=>{r.setAttributes(l),a&&a.setAttributes(l);const u=this._afterRelatedGraphicAttributeUpdate(r,e,a,i,n,o,h,this._animationConfig.enter);o.on("afterAttributeUpdate",u)})}}else r&&this.add(r),a&&this.add(a)}_updateLabel(t,e){const{text:i,labelLine:n}=t,{text:r,labelLine:a}=e;if(this._enableAnimation!==!1&&this._animationConfig.update!==!1){const{duration:o,easing:l}=this._animationConfig.update;(function(h,c,u){const d=(p,g)=>{const f={};for(const m in g.attribute)p.attribute[m]!==g.attribute[m]&&(f[m]=g.attribute[m]);return f};if(!W(u)){const{duration:p,easing:g,increaseEffect:f=!0}=u;return h.animate().to(d(h,c),p,g),void(f&&h.type==="text"&&c.type==="text"&&tb(h,c,p,g))}u.forEach(p=>{const{duration:g,easing:f,increaseEffect:m=!0,channel:v}=p,{to:y}=vB(h,c,v,p.options);ht(y)||h.animate().to(d(h,c),g,f),m&&h.type==="text"&&c.type==="text"&&tb(h,c,g,f)})})(i,r,this._animationConfig.update),n&&a&&t.labelLine.animate().to(a.attribute,o,l)}else t.text.setAttributes(r.attribute),n&&a&&t.labelLine.setAttributes(a.attribute)}_removeLabel(t){const e=i=>{this.removeChild(i.text),i.labelLine&&this.removeChild(i.labelLine)};if(this._enableAnimation!==!1&&this._animationConfig.exit!==!1){const{duration:i,easing:n}=this._animationConfig.exit;t.forEach(r=>{var a;(a=r.text)===null||a===void 0||a.animate().to(Q_(r.text.attribute,"fadeOut").to,i,n).onEnd(()=>{e(r)})})}else t.forEach(i=>{e(i)})}updateStatesOfLabels(t,e){t.forEach(i=>{i&&(i.text&&i.text.useStates(e),i.labelLine&&i.labelLine.useStates(e))})}_syncStateWithRelatedGraphic(t){this.attribute.syncState&&t&&t.on("afterAttributeUpdate",this._handleRelatedGraphicSetState)}_afterRelatedGraphicAttributeUpdate(t,e,i,n,r,a,o,l){let{mode:h,duration:c,easing:u,delay:d}=l;const p=g=>{var f,m,v;const{detail:y}=g;if(!y)return{};const _=(f=y.animationState)===null||f===void 0?void 0:f.step;if(y.type!==Pe.ANIMATE_UPDATE||!_||_.type==="wait"&&((m=_.prev)===null||m===void 0?void 0:m.type)==null)return{};if(y.type===Pe.ANIMATE_END)return t.setAttributes(o),void(i&&i.setAttributes(o));const b=()=>{a&&(a.onAnimateBind=void 0,a.removeEventListener("afterAttributeUpdate",p))};switch(h){case"after":y.animationState.end&&(t.animate({onStart:b}).wait(d).to(o,c,u),i&&i.animate().wait(d).to(o,c,u));break;case"after-all":r===e.length-1&&y.animationState.end&&(e.forEach(x=>{x.animate({onStart:b}).wait(d).to(o,c,u)}),n.forEach(x=>{x.animate().wait(d).to(o,c,u)}));break;default:if(this._isCollectionBase){const x=this._idToPoint.get(t.attribute.id);!x||t.animates&&t.animates.has("label-animate")||!a.containsPoint(x.x,x.y,rr.LOCAL,(v=this.stage)===null||v===void 0?void 0:v.getPickerService())||(t.animate({onStart:b}).wait(d).to(o,c,u),i&&i.animate().wait(d).to(o,c,u))}else y.animationState.isFirstFrameOfStep&&(t.animate({onStart:b}).wait(d).to(o,c,u),i&&i.animate().wait(d).to(o,c,u))}};return p}_smartInvert(t){var e,i,n,r,a,o,l;const h=_t(this.attribute.smartInvert)?this.attribute.smartInvert:{},{textType:c,contrastRatiosThreshold:u,alternativeColors:d,mode:p,interactInvertType:g}=h,f=(e=h.fillStrategy)!==null&&e!==void 0?e:"invertBase",m=(i=h.strokeStrategy)!==null&&i!==void 0?i:"base",v=(n=h.brightColor)!==null&&n!==void 0?n:"#ffffff",y=(r=h.darkColor)!==null&&r!==void 0?r:"#000000",_=(a=h.outsideEnable)!==null&&a!==void 0&&a;if(f!=="null"||m!=="null")for(let b=0;b<t.length;b++){const x=t[b];if(!x)continue;const S=this.getRelatedGraphic(x.attribute);let A=S.attribute.fill,w=x.attribute.fill;if(_t(A)&&A.gradient){const B=(l=(o=A.stops)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.color;B&&(A=B,w=B)}const k=i_(w,A,c,u,d,p),T=jp(k,v)?v:y,C=this._canPlaceInside(x.AABBBounds,S.AABBBounds),M=!C&&x.AABBBounds&&S.AABBBounds&&S.AABBBounds.intersects(x.AABBBounds);if(C||_||M&&g==="inside"){const B=wc(f,A,k,T);if(B&&x.setAttributes({fill:B}),x.attribute.lineWidth===0||x.attribute.strokeOpacity===0)continue;const O=wc(m,A,k,T);O&&x.setAttributes({stroke:O})}else if(M&&g!=="none"){if(x.attribute.lineWidth===0||x.attribute.strokeOpacity===0)continue;if(x.attribute.stroke){x.setAttributes({fill:i_(x.attribute.fill,x.attribute.stroke,c,u,d,p)});continue}const B=wc(f,A,k,T);B&&x.setAttributes({fill:B});const O=wc(m,A,k,T);O&&x.setAttributes({stroke:O})}}}_canPlaceInside(t,e){return!(!t||!e)&&e.encloses(t)}setLocation(t){this.translateTo(t.x,t.y)}disableAnimation(){this._enableAnimation=!1}enableAnimation(){this._enableAnimation=!0}}Ws.defaultAttributes={textStyle:{fontSize:12,textAlign:"center",textBaseline:"middle",boundsPadding:[-2,-1,-2,-1]},offset:0,pickable:!1};const sb={},Vr=(s,t)=>{sb[s]=t};var AB=function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e};class Co extends Ws{constructor(t,e){const{data:i}=t,n=AB(t,["data"]);super(e!=null&&e.skipDefault?t:Object.assign({data:i},rt({},Co.defaultAttributes,n))),this.name="symbol-label"}labeling(t,e){return function(i,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"top",a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(!i)return;const{x1:o,y1:l,x2:h,y2:c}=i,u=Math.abs(h-o),d=Math.abs(c-l),p=(n.x1+n.x2)/2,g=(n.y1+n.y2)/2;let f=0,m=0,v=0,y=0;n&&(v=Math.abs(n.x1-n.x2)/2,y=Math.abs(n.y1-n.y2)/2);const _={"top-right":-235,"top-left":235,"bottom-right":45,"bottom-left":-45};switch(r){case"top":m=-1;break;case"bottom":m=1;break;case"left":f=-1;break;case"right":f=1;break;case"bottom-left":case"bottom-right":case"top-left":case"top-right":f=Math.sin(_[r]*(Math.PI/180)),m=Math.cos(_[r]*(Math.PI/180));break;case"center":f=0,m=0}return{x:p+f*(a+v)+Math.sign(f)*(u/2),y:g+m*(a+y)+Math.sign(m)*(d/2)}}(t,e,arguments.length>2&&arguments[2]!==void 0?arguments[2]:"top",arguments.length>3&&arguments[3]!==void 0?arguments[3]:0)}}Co.defaultAttributes={textStyle:{fill:"#000"},position:"top",offset:5};const ng=()=>{Vr("symbol",Co),Vr("line-data",Co)};var kB=function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e};class Mo extends Ws{constructor(t,e){const{data:i}=t,n=kB(t,["data"]);super(e!=null&&e.skipDefault?t:Object.assign({data:i},rt({},Mo.defaultAttributes,n)))}labeling(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"top",n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(!t||!e)return;const{x1:r,y1:a,x2:o,y2:l}=t,h=Math.abs(o-r),c=Math.abs(l-a),{x:u,y:d}=((m,v)=>{const{x1:y,x2:_,y1:b,y2:x}=m,S=Math.abs(_-y),A=Math.abs(x-b);let w=(y+_)/2,k=(b+x)/2,T=0,C=0;switch(v){case"top":case"inside-top":C=-.5;break;case"bottom":case"inside-bottom":C=.5;break;case"left":case"inside-left":T=-.5;break;case"right":case"inside-right":T=.5;break;case"top-right":T=.5,C=-.5;break;case"top-left":T=-.5,C=-.5;break;case"bottom-right":T=.5,C=.5;break;case"bottom-left":T=-.5,C=.5}return w+=T*S,k+=C*A,{x:w,y:k}})(e,i);let p=0,g=0;const f=i.includes("inside");switch(i.includes("top")?g=f?1:-1:i.includes("bottom")?g=f?-1:1:i.includes("left")?p=f?1:-1:i.includes("right")&&(p=f?-1:1),i){case"top-right":case"bottom-right":p=-1;break;case"top-left":case"bottom-left":p=1}return{x:u+p*n+p*h/2,y:d+g*n+g*c/2}}}Mo.tag="rect-label",Mo.defaultAttributes={textStyle:{fill:"#000"},position:"top",offset:5};var wB=function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e};let rg=class j1 extends Ws{constructor(t,e){const{data:i}=t,n=wB(t,["data"]);super(e!=null&&e.skipDefault?t:Object.assign({data:i},rt({},j1.defaultAttributes,n))),this.name="line-label"}getGraphicBounds(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"end";if(!t||t.type!=="line"&&t.type!=="area")return super.getGraphicBounds(t,e);let n=t.attribute.points;const r=t.attribute.segments;!n&&r&&r.length&&(n=r.reduce((o,l)=>{var h;return o.concat((h=l.points)!==null&&h!==void 0?h:[])},[])),n&&n.length!==0||(n=[e]);const a=i==="start"?0:n.length-1;return n[a]?{x1:n[a].x,x2:n[a].x,y1:n[a].y,y2:n[a].y}:void 0}labeling(t,e){return function(i,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"end",a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(!i||!n)return{x:1/0,y:1/0};const{x1:o,x2:l}=i,h=Math.abs(l-o),c=n.x1;let u=c;return r==="end"?u=c+h/2+a:r==="start"&&(u=c-h/2-a),{x:u,y:n.y1}}(t,e,arguments.length>2&&arguments[2]!==void 0?arguments[2]:"end",arguments.length>3&&arguments[3]!==void 0?arguments[3]:0)}};rg.defaultAttributes={textStyle:{fill:"#000"},position:"end",offset:6};const nb=()=>{Vr("line",rg),Vr("area",rg)};var TB=function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e};class CB{constructor(t,e,i,n,r,a,o,l,h){this.refDatum=t,this.center=e,this.outerCenter=i,this.quadrant=n,this.radian=r,this.middleAngle=a,this.innerRadius=o,this.outerRadius=l,this.circleCenter=h,this.labelVisible=!0}getLabelBounds(){return this.labelPosition&&this.labelSize?{x1:this.labelPosition.x-this.labelSize.width/2,y1:this.labelPosition.y-this.labelSize.height/2,x2:this.labelPosition.x+this.labelSize.width/2,y2:this.labelPosition.y+this.labelSize.height/2}:{x1:0,x2:0,y1:0,y2:0}}}class Nc extends Ws{constructor(t,e){const{data:i}=t,n=TB(t,["data"]);super(e!=null&&e.skipDefault?t:Object.assign({data:i},rt({},Nc.defaultAttributes,n))),this.name="arc-label",this._ellipsisWidth=0,this._arcLeft=new Map,this._arcRight=new Map,this._line2MinLength=0,this._alignOffset=0}_overlapping(t){return["inside","inside-center"].includes(this.attribute.position)?super._overlapping(t):t}labeling(t,e){if(t&&e)return{x:0,y:0}}_layout(t){var e,i,n;if(!t||!t.length)return;const r=super._layout(t),a=r.map(d=>this.getGraphicBounds(d)),o=Object.assign(Object.assign({},this.attribute.textStyle),{text:"…"});let l=1/0;if(o.ellipsis!==!1){const d=this._createLabelText(o),p=this.getGraphicBounds(d);l=p.x2-p.x1}const h=r.map(d=>d.attribute),c=Array.from(this._idToGraphic.values());this._line2MinLength=U(this.attribute.line.line2MinLength)?this.attribute.line.line2MinLength(t,c,this.attribute):this.attribute.line.line2MinLength,this._alignOffset=(e=U(this.attribute.layout.alignOffset)?this.attribute.layout.alignOffset(t,c,this.attribute):this.attribute.layout.alignOffset)!==null&&e!==void 0?e:0;const u=this.layoutArcLabels(this.attribute.position,this.attribute,c,h,a,l);for(let d=0;d<h.length;d++){const p=h[d],g=u.find(f=>{var m;return((m=f.refDatum)===null||m===void 0?void 0:m.id)===p.id});if(g){const f={visible:g.labelVisible,x:g.labelPosition.x,y:g.labelPosition.y,angle:g.angle,points:g.pointA&&g.pointB&&g.pointC?[g.pointA,g.pointB,g.pointC]:void 0,line:g.labelLine};r[d].type==="richtext"?f.width=(i=g.labelLimit)!==null&&i!==void 0?i:r[d].attribute.width:f.maxLineWidth=(n=g.labelLimit)!==null&&n!==void 0?n:r[d].attribute.maxLineWidth,g.refArc&&g.refArc.type==="arc3d"&&(f.anchor3d=[g.circleCenter.x-f.x,g.circleCenter.y-f.y],f.beta=g.refArc.attribute.beta),r[d].setAttributes(f)}}return r}layoutArcLabels(t,e,i,n,r,a){this._arcLeft.clear(),this._arcRight.clear(),this._ellipsisWidth=a;let o=0;i.forEach(u=>{u.attribute.outerRadius>o&&(o=u.attribute.outerRadius)}),n.forEach((u,d)=>{var p,g;const f=this._idToGraphic.get(u.id),m=f.attribute,v={x:(p=m==null?void 0:m.x)!==null&&p!==void 0?p:0,y:(g=m==null?void 0:m.y)!==null&&g!==void 0?g:0};if(!I(n[d])&&!I(r[d])){const _=n[d]?n[d]:null,b=r[d]?r[d]:{x1:0,x2:0,y1:0,y2:0},x=(m.startAngle+m.endAngle)/2,S=m.endAngle-m.startAngle,A=Pf(m.endAngle-S/2),w=xi(v,m.outerRadius,x),k=xi(v,o+e.line.line1MinLength,x),T=new CB(_,w,k,A,S,x,m.innerRadius,m.outerRadius,v);T.refArc=f,T.pointA=xi(v,this.computeDatumRadius(2*v.x,2*v.y,m.outerRadius),T.middleAngle),T.labelSize={width:b.x2-b.x1,height:b.y2-b.y1},(y=T.quadrant)===1||y===2?this._arcRight.set(T.refDatum,T):In(T.quadrant)&&this._arcLeft.set(T.refDatum,T)}var y});const l=Array.from(this._arcLeft.values()),h=Array.from(this._arcRight.values()),c=[];switch(t){case"inside":case"inside-inner":case"inside-outer":case"inside-center":c.push(...this._layoutInsideLabels(h,e,i)),c.push(...this._layoutInsideLabels(l,e,i));break;default:c.push(...this._layoutOutsideLabels(h,e,i)),c.push(...this._layoutOutsideLabels(l,e,i))}return c}_layoutInsideLabels(t,e,i){var n,r;const a=e,o=a.spaceWidth,l=(n=a.position)!==null&&n!==void 0?n:"inside",h=(r=a.offsetRadius)!==null&&r!==void 0?r:-o;return t.forEach(c=>{var u,d,p;const{labelSize:g,radian:f}=c,m=c.innerRadius,v=c.outerRadius;let y;if(f<function(w,k){return k>2*w?NaN:2*Math.asin(k/2/w)}(v,g.height))y=0;else{let w;w=f>=Math.PI?m:Math.max(m,g.height/2/Math.tan(f/2)),y=v-w-o}a.rotate!==!0&&(y=v-o);const _=this._getFormatLabelText(c.refDatum,y);c.labelText=_;const b=Math.min(y,c.labelSize.width),x=this._computeAlign(c,e);let S,A=0;if(l==="inside"&&(A=x==="left"?b:x==="right"?0:b/2),S=l==="inside-inner"?m-h+A:l==="inside-center"?m+(v-m)/2:v+h-A,c.labelPosition=xi(c.circleCenter,S,c.middleAngle),c.labelLimit=b,ds(b,0)||(c.labelVisible=!1),a.rotate!==!1){c.angle=(d=(u=e.textStyle)===null||u===void 0?void 0:u.angle)!==null&&d!==void 0?d:c.middleAngle;let w=(p=a.offsetAngle)!==null&&p!==void 0?p:0;["inside-inner","inside-outer"].includes(l)&&(w+=Math.PI/2),c.angle+=w}}),t}_layoutOutsideLabels(t,e,i){var n,r,a;const o=(n=i[0].attribute.x)!==null&&n!==void 0?n:0,l=2*((r=i[0].attribute.y)!==null&&r!==void 0?r:0),h=e.layout,c=e.spaceWidth;if(t.forEach(d=>{const p=In(d.quadrant)?-1:1;d.labelPosition={x:d.outerCenter.x+p*(d.labelSize.width/2+this._line2MinLength+c),y:d.outerCenter.y}}),t.sort((d,p)=>d.labelPosition.y-p.labelPosition.y),e.coverEnable!==!1||h.strategy==="none"){for(const d of t){const{labelPosition:p,labelSize:g}=d;d.labelLimit=g.width,d.pointB=In(d.quadrant)?{x:p.x+g.width/2+this._line2MinLength+c,y:p.y}:{x:p.x-g.width/2-this._line2MinLength-c,y:p.y},this._computeX(d,e,i)}e.coverEnable===!1&&h.strategy==="none"&&this._coverLabels(t)}else{const d=l/(((a=e.textStyle)===null||a===void 0?void 0:a.fontSize)||16);this._adjustY(t,d,e,i);const{minY:p,maxY:g}=t.reduce((v,y)=>{const{y1:_,y2:b}=y.getLabelBounds();return v.minY=Math.max(0,Math.min(_,v.minY)),v.maxY=Math.min(l,Math.max(b,v.maxY)),v},{minY:1/0,maxY:-1/0}),f=Math.max(Math.abs(l/2-p),Math.abs(g-l/2)),m=this._computeLayoutRadius(f,e,i);for(const v of t)this._computePointB(v,m,e,i),this._computeX(v,e,i)}const u=2*o;return t.forEach(d=>{var p,g;d.labelVisible&&(Qi(d.pointB.x,this._line2MinLength+c)||ds(d.pointB.x,u-this._line2MinLength-c))&&(d.labelVisible=!1),d.angle=(g=(p=e.textStyle)===null||p===void 0?void 0:p.angle)!==null&&g!==void 0?g:0,e.offsetAngle&&(d.angle+=e.offsetAngle),d.labelLine=Object.assign(Object.assign({},e.line),{visible:d.labelVisible})}),t}_computeX(t,e,i){var n;const r=t.circleCenter,a=this.attribute.width;this.attribute.height;let o=0;i.forEach(A=>{A.attribute.outerRadius>o&&(o=A.attribute.outerRadius)});const l=this.computeLayoutOuterRadius(o,e.width,e.height),h=e.line.line1MinLength,c=(n=e.layout)===null||n===void 0?void 0:n.align,u=e.spaceWidth,{labelPosition:d,quadrant:p,pointB:g}=t;q(g.x*g.y)||(t.pointC={x:NaN,y:NaN},d.x=NaN,t.labelLimit=0);const f=this.computeRadius(l,e.width,e.height),m=In(p)?-1:1;let v=0,y=(m>0?a-g.x:g.x-0)+this._alignOffset-this._line2MinLength-u;c==="labelLine"&&(v=(f+h+this._line2MinLength)*m+r.x,y=(m>0?a-v:v-0)-u);const _=this._getFormatLabelText(t.refDatum,y);t.labelText=_;let b=Math.min(y,t.labelSize.width);switch(c){case"labelLine":break;case"edge":v=m>0?a-b-u:0+b+u;break;default:v=g.x+m*this._line2MinLength}b=Math.max(this._ellipsisWidth,b);const x=b<t.labelSize.width-1;t.labelLimit=x?b:null,t.pointC={x:v,y:d.y};const S=function(A){return A==="left"?0:A==="right"?1:.5}(this._computeAlign(t,e))*(x?b:t.labelSize.width);c==="edge"?(d.x=(m>0?a:0)-m*S+m*this._alignOffset,t.pointC.x+=m*this._alignOffset):d.x=v+m*(this._alignOffset+u+S)}_computeAlign(t,e){var i,n,r,a,o,l;const h=e,c=(n=(i=h.textStyle)===null||i===void 0?void 0:i.textAlign)!==null&&n!==void 0?n:(r=h.textStyle)===null||r===void 0?void 0:r.align,u=(o=(a=h.layout)===null||a===void 0?void 0:a.textAlign)!==null&&o!==void 0?o:(l=h.layout)===null||l===void 0?void 0:l.align;return h.position!=="inside"?I(c)||c==="auto"?u==="edge"?In(t.quadrant)?"left":"right":In(t.quadrant)?"right":"left":c:I(c)||c==="auto"?"center":c}_getFormatLabelText(t,e){var i;return(i=t==null?void 0:t.text)!==null&&i!==void 0?i:""}_adjustY(t,e,i,n){var r;n[0].attribute.x;const a=2*((r=n[0].attribute.y)!==null&&r!==void 0?r:0),o=i.layout;if(o.strategy==="vertical"){let l,h=0;const c=t.length;if(c<=0)return;for(let d=0;d<c;d++){const{y1:p}=t[d].getLabelBounds();if(l=p-h,Qi(l,0)){const f=this._shiftY(t,d,c-1,-l);this._shiftY(t,f,0,l/2)}const{y2:g}=t[d].getLabelBounds();h=g}const{y1:u}=t[0].getLabelBounds();l=u-0,Qi(l,0)&&this._shiftY(t,0,c-1,-l);for(let d=t.length-1;d>=0&&t[d].getLabelBounds().y2>a;d--)t[d].labelVisible=!1}else if(o.strategy!=="none"){const l=t.map((u,d)=>({arc:u,originIndex:d,priorityIndex:0}));l.sort((u,d)=>d.arc.radian-u.arc.radian),l.forEach((u,d)=>{u.priorityIndex=d,u.arc.labelVisible=!1});let h=1/0,c=-1/0;for(let u=0;u<e&&u<t.length;u++){this._storeY(t);const d=l[u].arc;this._computeYRange(d,i,n),d.labelVisible=!0;const p=d.labelPosition.y,{lastIndex:g,nextIndex:f}=this._findNeighborIndex(t,l[u]),m=t[g],v=t[f];if(g===-1&&f!==-1){const x=v.labelPosition.y;p>x?d.labelPosition.y=x-v.labelSize.height/2-d.labelSize.height/2:this._twoWayShift(t,d,v,f)}else if(g!==-1&&f===-1){const x=m.labelPosition.y;p<x?d.labelPosition.y=x+m.labelSize.height/2+d.labelSize.height/2:this._twoWayShift(t,m,d,l[u].originIndex)}else if(g!==-1&&f!==-1){const x=m.labelPosition.y,S=v.labelPosition.y;p>S?(d.labelPosition.y=S-v.labelSize.height/2-d.labelSize.height/2,this._twoWayShift(t,m,d,l[u].originIndex)):p<x?(d.labelPosition.y=x+m.labelSize.height/2+d.labelSize.height/2,this._twoWayShift(t,d,v,f)):(this._twoWayShift(t,m,d,l[u].originIndex),this._twoWayShift(t,d,v,f))}const y=Math.min(h,l[u].originIndex),_=Math.max(c,l[u].originIndex);let b;if(b=t[_].getLabelBounds().y2-a,ds(b,0)&&this._shiftY(t,_,0,-b),b=t[y].getLabelBounds().y1-0,Qi(b,0)&&this._shiftY(t,y,t.length-1,-b),b=t[_].getLabelBounds().y2-a,ds(b,0)){d.labelVisible=!1,this._restoreY(t);break}o.tangentConstraint&&!this._checkYRange(t)?(d.labelVisible=!1,this._restoreY(t)):(h=y,c=_)}}}_shiftY(t,e,i,n){const r=e<i?1:-1;let a=e;for(;a!==-1;){t[a].labelPosition.y+=n;const o=this._findNextVisibleIndex(t,a,i,r);if(o>=0&&o<t.length){const{y1:l,y2:h}=t[a].getLabelBounds(),{y1:c,y2:u}=t[o].getLabelBounds();if(r>0&&h<c||r<0&&l>u)return a}a=o}return i}_findNextVisibleIndex(t,e,i,n){const r=(i-e)*n;for(let a=1;a<=r;a++){const o=e+a*n;if(t[o].labelVisible)return o}return-1}_computePointB(t,e,i,n){const r=i;let a=0;n.forEach(h=>{h.attribute.outerRadius>a&&(a=h.attribute.outerRadius)});const o=this.computeLayoutOuterRadius(a,i.width,i.height),l=r.line.line1MinLength;if(r.layout.strategy==="none")t.pointB={x:t.outerCenter.x,y:t.outerCenter.y};else{const h=t.circleCenter,c=this.computeRadius(o,i.width,i.height),{labelPosition:u,quadrant:d}=t,p=e-Math.max(c+l,t.outerRadius),g=Math.sqrt(e**2-Math.abs(h.y-u.y)**2)-p;q(g)?t.pointB={x:h.x+g*(In(d)?-1:1),y:u.y}:t.pointB={x:NaN,y:NaN}}}_storeY(t){for(const e of t)e.labelVisible&&(e.lastLabelY=e.labelPosition.y)}_computeYRange(t,e,i){const n=t.circleCenter,r={width:2*n.x,height:2*n.y};let a=0;i.forEach(x=>{x.attribute.outerRadius>a&&(a=x.attribute.outerRadius)});const o=this.computeLayoutOuterRadius(a,e.width,e.height),l=e.line.line1MinLength,{width:h,height:c}=r,u=this.computeRadius(o,e.width,e.height),d=this._computeLayoutRadius(c/2,e,i),p=Math.abs(t.center.x-h/2),g=t.center.y-c/2;let f,m,v;if(Oe(h/2,p))f=0,m=1,v=-g;else if(Oe(c/2,g))f=1,m=0,v=-p;else{const x=-1/(g/p);f=x,m=-1,v=g-x*p}const y=function(x,S,A,w,k,T){if(x===0&&S===0||T<=0)return[];if(x===0){const P=-A/S,F=T**2-(P-k)**2;return F<0?[]:F===0?[{x:w,y:P}]:[{x:Math.sqrt(F)+w,y:P},{x:-Math.sqrt(F)+w,y:P}]}if(S===0){const P=-A/x,F=T**2-(P-w)**2;return F<0?[]:F===0?[{x:P,y:k}]:[{x:P,y:Math.sqrt(F)+k},{x:P,y:-Math.sqrt(F)+k}]}const C=(S/x)**2+1,M=2*((A/x+w)*(S/x)-k),B=M**2-4*C*((A/x+w)**2+k**2-T**2);if(B<0)return[];const O=(-M+Math.sqrt(B))/(2*C),E=(-M-Math.sqrt(B))/(2*C),L=-(S*O+A)/x;return B===0?[{x:L,y:O}]:[{x:L,y:O},{x:-(S*E+A)/x,y:E}]}(f,m,v,l+u-d,0,d);if(y.length<2)return;let _,b;y[0].x>y[1].x&&y.reverse(),y[0].x<0?Oe(y[0].y,y[1].y)?ds(t.middleAngle,-Math.PI)&&Qi(t.middleAngle,0)||ds(t.middleAngle,Math.PI)&&Qi(t.middleAngle,2*Math.PI)?(_=0,b=y[1].y+c/2):(_=y[1].y+c/2,b=c):y[0].y<y[1].y?(_=0,b=y[1].y+c/2):(_=y[1].y+c/2,b=r.height):(_=Math.min(y[0].y,y[1].y)+c/2,b=Math.max(y[0].y,y[1].y)+c/2),t.labelYRange=[_,b]}_computeLayoutRadius(t,e,i){const n=e,r=n.layoutArcGap,a=n.line.line1MinLength;let o=0;i.forEach(u=>{u.attribute.outerRadius>o&&(o=u.attribute.outerRadius)});const l=this.computeLayoutOuterRadius(o,e.width,e.height),h=this.computeRadius(l,e.width,e.height)+a,c=h-r;return Math.max((c**2+t**2)/(2*c),h)}_findNeighborIndex(t,e){const i=e.originIndex;let n=-1,r=-1;for(let a=i-1;a>=0;a--)if(t[a].labelVisible){n=a;break}for(let a=i+1;a<t.length;a++)if(t[a].labelVisible){r=a;break}return{lastIndex:n,nextIndex:r}}_twoWayShift(t,e,i,n){const r=i.getLabelBounds().y1-e.getLabelBounds().y2;if(Qi(r,0)){const a=this._shiftY(t,n,t.length-1,-r);this._shiftY(t,a,0,r/2)}}_restoreY(t){for(const e of t)e.labelVisible&&(e.labelPosition.y=e.lastLabelY)}_checkYRange(t){for(const e of t){const{labelYRange:i,labelPosition:n}=e;if(e.labelVisible&&i&&(Qi(n.y,i[0])||ds(n.y,i[1])))return!1}return!0}_coverLabels(t){if(t.length<=1)return;let e=t[0].getLabelBounds();for(let i=1;i<t.length;i++){const n=t[i].getLabelBounds();yB(e,n)?t[i].labelVisible=!1:e=n}}_getLabelLinePoints(t,e){return t.attribute.points}_createLabelLine(t,e){var i,n,r,a,o;const{line:l={},visible:h}=t.attribute,c=super._createLabelLine(t,e);if(c&&(c.setAttributes({visible:(r=(i=l.visible&&h)!==null&&i!==void 0?i:(n=t.attribute)===null||n===void 0?void 0:n.visible)===null||r===void 0||r,lineWidth:(o=(a=l.style)===null||a===void 0?void 0:a.lineWidth)!==null&&o!==void 0?o:1}),l.smooth&&c.setAttributes({curveType:"basis"}),e.type==="arc3d"&&e)){const{beta:u,x:d,y:p}=e.attribute;c.setAttributes({beta:u,anchor3d:[d,p]})}return c}computeRadius(t,e,i,n){return this.computeLayoutRadius(e||0,i||0)*t*(I(n)?1:n)}computeLayoutRadius(t,e){return Math.min(t/2,e/2)}_canPlaceInside(t,e){return this.attribute.position==="inside"||this.attribute.position==="inside-center"}computeLayoutOuterRadius(t,e,i){return t/(Math.min(e,i)/2)}computeDatumRadius(t,e,i){const n=this.computeLayoutOuterRadius(i,t,e);return this.computeLayoutRadius(t||0,e||0)*n}}Nc.defaultAttributes={coverEnable:!1,spaceWidth:5,layoutArcGap:6,textStyle:{visible:!0,fontSize:14,fontWeight:"normal",fillOpacity:1,boundsPadding:[-1,0,-1,0],ellipsis:!0},position:"outside",line:{visible:!0,line1MinLength:20,line2MinLength:10},layout:{align:"arc",strategy:"priority",tangentConstraint:!0}};var MB=function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e};class zc extends Wi{constructor(t,e){const{dataLabels:i}=t,n=MB(t,["dataLabels"]);super(e!=null&&e.skipDefault?t:Object.assign({dataLabels:i},rt({},zc.defaultAttributes,n))),this.name="data-label"}render(){var t;const{dataLabels:e,size:i}=this.attribute;if(!e||e.length===0)return;const{width:n=0,height:r=0,padding:a}=i||{};if(!n||!r||!q(r*n))return;this._componentMap||(this._componentMap=new Map);const o=K_(n,r,a),l=o.bitmap(),h=new Map,c=this._componentMap;for(let d=0;d<e.length;d++){const p=e[d],g=(u=p.type,sb[u]||Ws);if(g){const{baseMarkGroupName:f,type:m}=p,v=(t=p.id)!==null&&t!==void 0?t:\`\${f}-\${m}-\${d}\`;p.type==="arc"&&(p.width=i.width,p.height=i.height);let y=this._componentMap.get(v);y?(y.setBitmapTool(o),y.setBitmap(l),y.setAttributes(p),h.set(v,y)):(y=new g(p),y.setBitmap(l),y.setBitmapTool(o),this.add(y),h.set(v,y))}}var u;c.forEach((d,p)=>{h.get(p)||this.removeChild(d)}),this._componentMap=h}setLocation(t){this.translateTo(t.x,t.y)}disableAnimation(){this._componentMap.forEach(t=>{t.disableAnimation()})}enableAnimation(){this._componentMap.forEach(t=>{t.enableAnimation()})}}function ag(s,t,e,i){let n="";if(!s||t.length===0)return n;const r=t[0],a=Ne.distancePP(s,r),o=e?0:1;return i?n+=\`M\${s.x},\${s.y-a}A\${a},\${a},0,0,\${o},\${s.x},\${s.y+a}A\${a},\${a},0,0,\${o},\${s.x},\${s.y-a}Z\`:t.forEach((l,h)=>{h===0?n=\`M\${l.x},\${l.y}\`:n+=\`A\${a},\${a},0,0,\${o},\${l.x},\${l.y}\`}),n}function EB(s,t,e){const{type:i,closed:n}=e,r=t.slice(0).reverse();let a="",o="";if(i==="line"&&e.smoothLink&&e.center){const l=s[0],h=r[0],c=e.center;a=zr(s,!!n),o=zr(r,!!n);const u=Ne.distancePP(h,c),d=Ne.distancePP(l,c);a+=\`A\${u},\${u},0,0,1,\${h.x},\${h.y}L\${h.x},\${h.y}\`,o+=\`A\${d},\${d},0,0,0,\${l.x},\${l.y}\`}else if(i==="circle"){const{center:l}=e;a=ag(l,s,!1,!!n),o=ag(l,r,!0,!!n)}else i!=="line"&&i!=="polygon"||(a=zr(s,!!n),o=zr(r,!!n));return n?a+=o:(o="L"+o.substring(1),a+=o,a+="Z"),a}zc.defaultAttributes={pickable:!1};class Wr extends Wi{constructor(){super(...arguments),this.name="axis-grid",this.data=[]}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}render(){this._prevInnerView=this._innerView&&g_(this._innerView),this.removeAllChild(!0),this._innerView=gt.group({x:0,y:0,pickable:!1}),this.add(this._innerView);const{items:t,visible:e}=this.attribute;t&&t.length&&e!==!1&&(this.data=this._transformItems(t),this._renderGrid(this._innerView))}getVerticalCoord(t,e,i){return f_(t,this.getVerticalVector(e,i,t))}_transformItems(t){const e=[];return t.forEach(i=>{var n;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(n=i.id)!==null&&n!==void 0?n:i.label}))}),e}_renderGrid(t){const{visible:e}=this.attribute.subGrid||{};e&&this._renderGridByType(!0,t),this._renderGridByType(!1,t)}_renderGridByType(t,e){const i=rt({},this.attribute,this.getGridAttribute(t)),{type:n,items:r,style:a,closed:o,alternateColor:l,depth:h=0}=i,c=t?\`\${xe.grid}-sub\`:\`\${xe.grid}\`;if(r.forEach((u,d)=>{const{id:p,points:g}=u;let f="";if(n==="line"||n==="polygon")f=zr(g,!!o);else if(n==="circle"){const{center:v}=this.attribute;f=ag(v,g,!1,!!o)}const m=gt.path(Object.assign({path:f,z:h},U(a)?rt({},this.skipDefault?null:Wr.defaultAttributes.style,a(u,d)):a));m.name=\`\${c}-line\`,m.id=this._getNodeId(\`\${c}-path-\${p}\`),e.add(m)}),h&&n==="line"&&r.forEach((u,d)=>{const{id:p,points:g}=u,f=[];f.push(g[0]);const m=g[1].x-g[0].x,v=g[1].y-g[0].y,y=Math.sqrt(m*m+v*v),_=h/y;f.push({x:g[0].x+m*_,y:g[0].y+v*_});const b=zr(f,!!o),x=Rt(f[0].x-f[1].x),S=Rt(f[0].y-f[1].y),A=gt.path(Object.assign({path:b,z:0,alpha:x>S?(g[1].x-g[0].x>0?-1:1)*Gt/2:0,beta:x<S?-Gt/2:0,anchor3d:x>S?[f[0].x,0]:[0,f[0].y]},U(a)?rt({},this.skipDefault?null:Wr.defaultAttributes.style,a(u,d)):a));A.name=\`\${c}-line\`,A.id=this._getNodeId(\`\${c}-path-\${p}\`),e.add(A)}),r.length>1&&l){const u=W(l)?l:[l,"transparent"],d=b=>u[b%u.length],p=this.attribute.items,g=p[0],f=p[p.length-1],m=!Oe(g.value,0)&&!Oe(f.value,0),v=!Oe(g.value,1)&&!Oe(f.value,1),y=[],_=g.value>f.value;(_&&v||!_&&m)&&y.push(this.getGridPointsByValue(_?1:0)),r.forEach(b=>{y.push(b.points)}),(_&&m||!_&&v)&&y.push(this.getGridPointsByValue(_?0:1));for(let b=0;b<y.length-1;b++){const x=EB(y[b],y[b+1],i),S=gt.path({path:x,fill:d(b)});S.name=\`\${c}-region\`,S.id=this._getNodeId(\`\${c}-region-\${b}\`),e.add(S)}}}_getNodeId(t){return\`\${this.id}-\${t}\`}_parseTickSegment(){let t=1;return this.data.length>=2&&(t=this.data[1].value-this.data[0].value),t}_getPointsOfSubGrid(t,e){const i=this.data.length,n=[];return i>=2&&this.data.forEach(r=>{let a=r.value;if(!e){const o=r.value-t/2;if(this.isInValidValue(o))return;a=o}n.push({value:a})}),n}release(){super.release(),this._prevInnerView=null,this._innerView=null}}Wr.defaultAttributes={style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]}}},Ii(),WE();class rb extends Wr{constructor(t,e){super(e!=null&&e.skipDefault?t:rt({},Wr.defaultAttributes,t),e)}_getGridPoint(t,e){let i;if(t==="line"){const{length:n}=this.attribute;i=[e,this.getVerticalCoord(e,n,!0)]}else if(t==="circle"||t==="polygon"){const{center:n,sides:r=6,startAngle:a=GE,endAngle:o=YE}=this.attribute;i=function(l,h,c,u,d){const p=[],g=d-u;for(let f=0;f<h;f++){const m=u+f*g/h;p.push(xi(l,c,m))}return p}(n,r,Ne.distancePP(n,e),a,o)}return i}getGridPointsByValue(t){const e=this.getTickCoord(t);return this._getGridPoint(this.attribute.type,e)}getGridAttribute(t){const{type:e,alignWithLabel:i=!0}=this.attribute,n=this._parseTickSegment();let r,a=[];if(t){r=rt({},this.attribute,this.attribute.subGrid);const o=[],{count:l=4}=r;if(this.data.length>=2){const h=this._getPointsOfSubGrid(n,i);for(let c=0;c<h.length-1;c++){const u=h[c],d=h[c+1];o.push({id:\`sub-\${c}-0\`,points:this.getGridPointsByValue(u.value),datum:{}});for(let p=0;p<l;p++){const g=(p+1)/(l+1),f=(1-g)*u.value+g*d.value;o.push({id:\`sub-\${c}-\${p+1}\`,points:this.getGridPointsByValue(f),datum:{}})}c===h.length-2&&o.push({id:\`sub-\${c}-\${l+1}\`,points:this.getGridPointsByValue(d.value),datum:{}})}a=o}}else{r=this.attribute;const o=[];this.data.forEach(l=>{let{point:h}=l;if(!i){const c=l.value-n/2;if(this.isInValidValue(c))return;h=this.getTickCoord(c)}o.push({id:l.label,datum:l,points:this._getGridPoint(e,h)})}),a=o}return Object.assign(Object.assign({},r),{items:a})}}function ab(){Ii(),yo(),Dr()}Ue(rb,x_);const ob={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};ab();class Eo extends Wi{getCurrent(){return this._current}constructor(t,e){super(e!=null&&e.skipDefault?t:rt({},Eo.defaultAttributes,t)),this.name="pager",this._current=1,this._onHover=i=>{const n=i.target;n.hasState("disable")||n.addState("hover")},this._onUnHover=i=>{i.target.removeState("hover")},this._onClick=i=>{const n=i.target;if(n.name==="preHandler"){if(this._current===1)return;this._current-=1,this._current===1?n.addState("disable"):n.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:i})}if(n.name==="nextHandler"){if(this._current===this._total)return;this._current+=1,this._current===this._total?n.addState("disable"):n.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:i})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var t,e,i;this._reset();const{layout:n="horizontal",handler:r=ob,total:a,defaultCurrent:o=1,textStyle:l,padding:h=0}=this.attribute;this._current=o;const c=Si(h),u=n==="horizontal",d=gt.group({x:0,y:0}),p=r.style||{},g=p.size||15,f=(t=r.space)!==null&&t!==void 0?t:8,m=r.state||{};let{preShape:v,nextShape:y}=r;v||(v=u?"triangleLeft":"triangleUp"),y||(y=u?"triangleRight":"triangleDown");const _=gt.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},p),{x:0,y:0,symbolType:v,size:g}));_.states=m,_.name="preHandler",this.preHandler=_,d.add(_);const{width:b,height:x}=zp(this._getPageText(a),Object.assign({textAlign:"center",textBaseline:"middle"},l),(i=(e=this.stage)===null||e===void 0?void 0:e.getTheme())===null||i===void 0?void 0:i.text),S=it(g)?g:g[0],A=it(g)?g:g[1],w=gt.text(Object.assign({x:u?S/2+f+b/2:0,y:u?0:A/2+f+x/2,text:this._getPageText(o),textAlign:"center",textBaseline:"middle",lineHeight:l==null?void 0:l.fontSize},l));this.text=w,d.add(w);const k=gt.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},p),{x:u?S+2*f+b:0,y:u?0:A+2*f+x,symbolType:y,size:g}));k.name="nextHandler",k.states=m,this.nextHandler=k,d.add(k),this._total===1?(_.addState("disable"),k.addState("disable")):this._current===1?_.addState("disable"):this._current===a&&k.addState("disable");const T=d.AABBBounds,C=T.width(),M=T.height();d.translateTo(0-T.x1+c[3],0-T.y1+c[0]),this.add(d),this.attribute.width=C+c[1]+c[3],this.attribute.height=M+c[0]+c[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(t){const{pageFormatter:e}=this.attribute;return e?U(e)?e(t,this._total):\`\${e}\`.replace("{current}",\`\${t}\`).replace("{total}",\`\${this._total}\`):\`\${t}/\${this._total}\`}setTotal(t){t!==this.attribute.total&&(this._total=t,this._current!==1&&this._current<=t?this.setAttributes({total:t,defaultCurrent:this._current}):this.setAttribute("total",t))}}Eo.defaultAttributes={handler:ob,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};const Hc=16,Vc=8,og=12;var ct,Oi,He;(function(s){s.selected="selected",s.unSelected="unSelected",s.selectedHover="selectedHover",s.unSelectedHover="unSelectedHover",s.focus="focus"})(ct||(ct={})),function(s){s.legendItemHover="legendItemHover",s.legendItemUnHover="legendItemUnHover",s.legendItemClick="legendItemClick",s.legendItemAttributeUpdate="legendItemAttributeUpdate"}(Oi||(Oi={})),function(s){s.innerView="innerView",s.title="legendTitle",s.item="legendItem",s.itemShape="legendItemShape",s.itemLabel="legendItemLabel",s.itemValue="legendItemValue",s.focus="legendItemFocus"}(He||(He={}));class BB extends Wi{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);const{interactive:t=!0,title:e,padding:i=0}=this.attribute;this._parsedPadding=Si(i);const n=gt.group({x:this._parsedPadding[3],y:this._parsedPadding[0],pickable:t,childrenPickable:t});n.name=He.innerView,this.add(n),this._innerView=n,e!=null&&e.visible&&this._renderTitle(e),this._renderContent(),this._adjustLayout(),t&&this._bindEvents();const r=this._innerView.AABBBounds;this.attribute.width=r.width()+this._parsedPadding[1]+this._parsedPadding[3],this.attribute.height=r.height()+this._parsedPadding[0]+this._parsedPadding[2]}_renderTitle(t){const{text:e="",textStyle:i,padding:n=0,background:r,minWidth:a,maxWidth:o,shape:l}=t,h={x:0,y:0,text:e,textStyle:i,padding:Si(n),minWidth:a,maxWidth:o};l&&l.visible&&(h.shape=Object.assign({visible:!0},l.style),R(l.space)&&(h.space=l.space)),r&&r.visible&&(h.panel=Object.assign({visible:!0},r.style));const c=new Bn(h);c.name=He.title,this._title=c,this._innerView.add(c)}_adjustLayout(){var t;if(this._title){const e=this._innerView.AABBBounds.width(),i=this._title.AABBBounds.width(),n=(t=this.attribute.title)===null||t===void 0?void 0:t.align;n==="center"?this._title.setAttribute("x",(e-i)/2):n==="end"&&this._title.setAttribute("x",e-i)}}}var lb=function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e};const RB={[ct.focus]:{},[ct.selected]:{},[ct.selectedHover]:{},[ct.unSelected]:{},[ct.unSelectedHover]:{}};Ii(),o_(),ab(),Qy();let hb=class N1 extends BB{constructor(t,e){super(e!=null&&e.skipDefault?t:rt({},N1.defaultAttributes,t)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._contentMaxHeight=0,this._onHover=i=>{const n=i.target;if(n&&n.name&&n.name.startsWith(He.item)){const r=n.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===r.id)return;this._unHover(this._lastActiveItem,i)}this._hover(r,i)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onUnHover=i=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onClick=i=>{var n,r,a,o;const l=i.target;if(l&&l.name&&l.name.startsWith(He.item)){const h=l.delegate,{selectMode:c="multiple"}=this.attribute;if(l.name===He.focus||c==="focus"){const u=h.hasState(ct.focus);h.toggleState(ct.focus),u?(n=this._itemsContainer)===null||n===void 0||n.getChildren().forEach(d=>{this._removeLegendItemState(d,[ct.unSelected,ct.unSelectedHover,ct.focus],i),this._setLegendItemState(d,ct.selected,i)}):(this._setLegendItemState(h,ct.selected,i),this._removeLegendItemState(h,[ct.unSelected,ct.unSelectedHover],i),(r=this._itemsContainer)===null||r===void 0||r.getChildren().forEach(d=>{h!==d&&(this._removeLegendItemState(d,[ct.selected,ct.selectedHover,ct.focus],i),this._setLegendItemState(d,ct.unSelected,i))}))}else{(a=this._itemsContainer)===null||a===void 0||a.getChildren().forEach(g=>{g.removeState(ct.focus)});const{allowAllCanceled:u=!0}=this.attribute,d=h.hasState(ct.selected),p=this._getSelectedLegends();if(c==="multiple"){if(u===!1&&d&&p.length===1)return void this._dispatchLegendEvent(Oi.legendItemClick,h,i);d?(this._removeLegendItemState(h,[ct.selected,ct.selectedHover],i),this._setLegendItemState(h,ct.unSelected,i)):(this._setLegendItemState(h,ct.selected,i),this._removeLegendItemState(h,[ct.unSelected,ct.unSelectedHover],i))}else this._setLegendItemState(h,ct.selected,i),this._removeLegendItemState(h,[ct.unSelected,ct.unSelectedHover],i),(o=this._itemsContainer)===null||o===void 0||o.getChildren().forEach(g=>{h!==g&&(this._removeLegendItemState(g,[ct.selected,ct.selectedHover],i),this._setLegendItemState(g,ct.unSelected,i))})}this._dispatchLegendEvent(Oi.legendItemClick,h,i)}}}render(){super.render(),this._lastActiveItem=null}setSelected(t){var e;((e=this._itemsContainer)===null||e===void 0?void 0:e.getChildren()).forEach(i=>{const n=i.data;t.includes(n.label)?(this._setLegendItemState(i,ct.selected),this._removeLegendItemState(i,[ct.unSelected,ct.unSelectedHover])):(this._removeLegendItemState(i,[ct.selected,ct.selectedHover]),this._setLegendItemState(i,ct.unSelected))})}_renderItems(){const{item:t={},maxCol:e=1,maxRow:i=2,maxWidth:n,defaultSelected:r,lazyload:a,autoPage:o}=this.attribute,{spaceCol:l=Hc,spaceRow:h=Vc,verticalAlign:c="middle"}=t,u=this._itemsContainer,{items:d,isHorizontal:p,startIndex:g,isScrollbar:f}=this._itemContext,m=f?1:p?i:e,v=this._contentMaxHeight;let y,{doWrap:_,maxWidthInCol:b,startX:x,startY:S,pages:A}=this._itemContext,w=0,k=0;const T=[];for(let C=g,M=d.length;C<M&&!(a&&A>this._itemContext.currentPage*m);C++){a&&(this._itemContext.startIndex=C+1),y=d[C],y.id||(y.id=y.label),y.index=C;let B=!0;W(r)&&(B=r.includes(y.label));const O=this._renderEachItem(y,B,C,d),E=O.attribute.width,L=O.attribute.height;this._itemHeight=Math.max(this._itemHeight,L),b=Math.max(E,b),this._itemMaxWidth=Math.max(E,this._itemMaxWidth),p?(R(n)&&(f&&o?(A=Math.ceil((x+E)/n),_=A>1):x+E>n&&(_=!0,x>0&&(c!=="middle"&&c!=="bottom"||T.forEach(P=>{P.setAttributes({y:P.attribute.y+(k-P.attribute.height)/(c==="middle"?2:1)})}),A+=1,x=0,S+=k+h,k=0,T.length=0))),x===0&&S===0||O.setAttributes({x,y:S}),x+=l+E,k=Math.max(k,L),T.push(O)):(R(v)&&(f&&o?(A=Math.ceil((S+L)/v),_=A>1):v<=L?(A+=1,_=!0,S=0,C>0&&(x+=w+l)):v<S+L&&(A+=1,_=!0,S=0,x+=b+l,b=0)),x===0&&S===0||O.setAttributes({x,y:S}),S+=h+L),u.add(O),w=E}return!p||c!=="middle"&&c!=="bottom"||T.forEach(C=>{C.setAttributes({y:C.attribute.y+(k-C.attribute.height)/(c==="middle"?2:1)})}),this._itemContext.doWrap=_,this._itemContext.startX=x,this._itemContext.startY=S,this._itemContext.maxWidthInCol=b,this._itemContext.pages=A,this._itemContext.maxPages=m,f&&(this._itemContext.totalPage=A),a||(this._itemContext.startIndex=d.length),this._itemContext}_renderContent(){const{item:t={},items:e,reversed:i,maxWidth:n,maxHeight:r}=this.attribute;if(t.visible===!1||ht(e))return;let a=e;i&&(a=e==null?void 0:e.reverse()),this._contentMaxHeight=Math.max(0,r-this._parsedPadding[0]-this._parsedPadding[2]);const o=gt.group({x:0,y:0});this._itemsContainer=o;const{layout:l,autoPage:h}=this.attribute,c=l==="horizontal",{maxWidth:u,width:d,height:p}=t,g=[];R(u)&&g.push(u),R(d)&&g.push(d),g.length&&(R(n)&&g.push(n),this._itemWidthByUser=ji(g)),R(p)&&(this._itemHeightByUser=p);const f=this.attribute.pager;this._itemContext={currentPage:f&&f.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:a,isHorizontal:c,totalPage:1/0,isScrollbar:f&&f.type==="scrollbar",clipContainer:void 0},this._itemContext=this._renderItems();let m=!1;this._itemContext.doWrap&&h&&this._itemContext.pages>this._itemContext.maxPages&&(m=this._renderPagerComponent()),m||(o.setAttribute("y",this._title?this._title.AABBBounds.height()+vt(this.attribute,"title.space",8):0),this._innerView.add(o))}_bindEvents(){if(this.attribute.disableTriggerEvent||!this._itemsContainer)return;const{hover:t=!0,select:e=!0}=this.attribute;if(t){let i="pointermove",n="pointerleave";_t(t)&&(t.trigger&&(i=t.trigger),t.triggerOff&&(n=t.triggerOff)),this._itemsContainer.addEventListener(i,this._onHover),this._itemsContainer.addEventListener(n,this._onUnHover)}if(e){let i="pointerdown";_t(e)&&e.trigger&&(i=e.trigger),this._itemsContainer.addEventListener(i,this._onClick)}}_autoEllipsis(t,e,i,n){var r,a;const{label:o,value:l}=this.attribute.item,h=n.AABBBounds,c=i.AABBBounds,u=h.width(),d=c.width();let p=!1;t==="labelFirst"?d>e?p=!0:n.setAttribute("maxLineWidth",e-d):t==="valueFirst"?u>e?p=!0:i.setAttribute("maxLineWidth",e-u):u+d>e&&(p=!0),p&&(n.setAttribute("maxLineWidth",Math.max(e*((r=o.widthRatio)!==null&&r!==void 0?r:.5),e-d)),i.setAttribute("maxLineWidth",Math.max(e*((a=l.widthRatio)!==null&&a!==void 0?a:.5),e-u)))}_renderEachItem(t,e,i,n){var r,a;const{id:o,label:l,value:h,shape:c}=t,{padding:u=0,focus:d,focusIconStyle:p,align:g,autoEllipsisStrategy:f}=this.attribute.item,{shape:m,label:v,value:y,background:_}=this.attribute.item,b=this._handleStyle(m,t,e,i,n),x=this._handleStyle(v,t,e,i,n),S=this._handleStyle(y,t,e,i,n),A=this._handleStyle(_,t,e,i,n),w=Si(u);let k;_.visible===!1?(k=gt.group({x:0,y:0,cursor:(r=A.style)===null||r===void 0?void 0:r.cursor}),this._appendDataToShape(k,He.item,t,k)):(k=gt.group(Object.assign({x:0,y:0},A.style)),this._appendDataToShape(k,He.item,t,k,A.state)),k.id=\`\${o??l}-\${i}\`,k.addState(e?ct.selected:ct.unSelected);const T=gt.group({x:0,y:0,pickable:!1});k.add(T);let C,M=0,B=0,O=0;if(m&&m.visible!==!1){const $=vt(b,"style.size",10);B=W($)?$[0]||0:$,O=vt(m,"space",8);const G=gt.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},c),b.style));Object.keys(b.state||{}).forEach(z=>{const ot=b.state[z].fill||b.state[z].stroke;c.fill&&I(b.state[z].fill)&&ot&&(b.state[z].fill=ot),c.stroke&&I(b.state[z].stroke)&&ot&&(b.state[z].stroke=ot)}),this._appendDataToShape(G,He.itemShape,t,k,b.state),G.addState(e?ct.selected:ct.unSelected),T.add(G)}let E=0;if(d){const $=vt(p,"size",10);C=gt.symbol(Object.assign(Object.assign({x:0,y:-$/2-1,strokeBoundsBuffer:0,boundsPadding:w},p),{visible:!0,pickMode:"imprecise"})),this._appendDataToShape(C,He.focus,t,k),E=$}const L=v.formatMethod?v.formatMethod(l,t,i):l,P=Tc(Object.assign(Object.assign({x:B/2+O,y:0,textAlign:"start",textBaseline:"middle",lineHeight:(a=x.style)===null||a===void 0?void 0:a.fontSize},x.style),{text:L,_originText:v.formatMethod?l:void 0}));this._appendDataToShape(P,He.itemLabel,t,k,x.state),P.addState(e?ct.selected:ct.unSelected),T.add(P);const F=vt(v,"space",8);if(R(h)){const $=vt(y,"space",d?8:0),G=y.formatMethod?y.formatMethod(h,t,i):h,z=Tc(Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:S.style.fontSize},S.style),{text:G,_originText:y.formatMethod?h:void 0}));if(this._appendDataToShape(z,He.itemValue,t,k,S.state),z.addState(e?ct.selected:ct.unSelected),this._itemWidthByUser){const ot=this._itemWidthByUser-w[1]-w[3]-B-O-F-E-$;this._autoEllipsis(f,ot,P,z),y.alignRight?z.setAttributes({textAlign:"right",x:this._itemWidthByUser-B/2-w[1]-w[3]-E-$}):z.setAttribute("x",F+(P.AABBBounds.empty()?0:P.AABBBounds.x2))}else z.setAttribute("x",F+(P.AABBBounds.empty()?0:P.AABBBounds.x2));M=$+(z.AABBBounds.empty()?0:z.AABBBounds.x2),T.add(z)}else this._itemWidthByUser&&P.setAttribute("maxLineWidth",this._itemWidthByUser-w[1]-w[3]-B-O-E),M=F+(P.AABBBounds.empty()?0:P.AABBBounds.x2);C&&(C.setAttribute("x",M),T.add(C));const j=T.AABBBounds,D=j.width();if(g==="right"){const $=j.x2,G=j.x1;T.forEachChildren((z,ot)=>{z.type!=="symbol"&&z.attribute.textAlign!=="right"||z===C?z.setAttribute("x",G+$-z.attribute.x-z.AABBBounds.width()):z.type!=="symbol"?z.setAttributes({x:G+$-z.attribute.x,textAlign:"left"}):z.setAttribute("x",G+$-z.attribute.x)})}const N=j.height(),J=R(this.attribute.item.width)?this.attribute.item.width:D+w[1]+w[3],X=this._itemHeightByUser||N+w[0]+w[2];return k.attribute.width=J,k.attribute.height=X,C&&C.setAttribute("visible",!1),T.translateTo(-j.x1+w[3],-j.y1+w[0]),k}_createPager(t){var e,i;const{disableTriggerEvent:n,maxRow:r}=this.attribute,a=o=>o<=99?99:o<=999?999:9999;return this._itemContext.isHorizontal?new Eo(Object.assign(Object.assign({layout:r===1?"horizontal":"vertical",total:a(this._itemContext.pages)},rt({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},t)),{defaultCurrent:(e=this.attribute.pager)===null||e===void 0?void 0:e.defaultCurrent,disableTriggerEvent:n})):new Eo(Object.assign({layout:"horizontal",total:a(this._itemContext.pages),disableTriggerEvent:n,defaultCurrent:(i=this.attribute.pager)===null||i===void 0?void 0:i.defaultCurrent},t))}_createScrollbar(t,e){const{disableTriggerEvent:i}=this.attribute;return this._itemContext.isHorizontal?new bo(Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:i,range:[0,.5],height:t.visible===!1?0:12},t),{width:e})):new bo(Object.assign(Object.assign({direction:"vertical",width:t.visible===!1?0:12,range:[0,.5]},t),{height:e,disableTriggerEvent:i}))}_updatePositionOfPager(t,e,i){const{pager:n}=this.attribute,{totalPage:r,isHorizontal:a}=this._itemContext,o=n&&n.position||"middle";if(this._pagerComponent.setTotal(r),a){let l;l=o==="start"?t:o==="end"?t+i-this._pagerComponent.AABBBounds.height()/2:t+i/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:e-this._pagerComponent.AABBBounds.width(),y:l})}else{let l;l=o==="start"?0:o==="end"?e-this._pagerComponent.AABBBounds.width():(e-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:l,y:i-this._pagerComponent.AABBBounds.height()})}}_computeScrollbarDelta(){const{isHorizontal:t,clipContainer:e}=this._itemContext,i=this._itemsContainer.AABBBounds,n=e.AABBBounds;let r,a;return t?(a=n.width(),r=a/i.width()):(a=n.height(),r=a/i.height()),r}_updatePositionOfScrollbar(t,e,i){const{isHorizontal:n,currentPage:r,totalPage:a}=this._itemContext,o=(r-1)/a;this._pagerComponent.setScrollRange([o,o+this._computeScrollbarDelta()]),n?this._pagerComponent.setAttributes({x:0,y:i+e}):this._pagerComponent.setAttributes({x:t,y:i})}_bindEventsOfPager(t,e){const i=this.attribute.pager||{},{animation:n=!0,animationDuration:r=450,animationEasing:a="quadIn"}=i,o=this._itemContext.isScrollbar?c=>{const{value:u}=c.detail;let d;return d=u[0]===0?1:u[1]===1?this._itemContext.totalPage:u[0]*this._itemContext.totalPage+1,d}:c=>c.detail.current,l=c=>{const u=this._pagerComponent,d=u.getScrollRange(),{direction:p}=u.attribute,{width:g,height:f}=u.getSliderRenderBounds(),m=p==="vertical"?c.deltaY/f:c.deltaX/g;u.setScrollRange([d[0]+m,d[1]+m],!0),this.updateScrollMask()},h=c=>{const u=o(c);if(u!==this._itemContext.currentPage){if(this._itemContext.currentPage=u,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();const d=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);if(this._itemContext.totalPage=d,this._itemContext.isScrollbar&&this._pagerComponent){const p=this._computeScrollbarDelta(),[g]=this._pagerComponent.getScrollRange();this._pagerComponent.setScrollRange([g,g+p])}}if(this._itemContext.isScrollbar){const[d]=this._pagerComponent.getScrollRange();let p;p=this._itemContext.isHorizontal?this._itemsContainer.AABBBounds.width():this._itemsContainer.AABBBounds.height();const g=p*d;this.updateScrollMask(),n?this._itemsContainer.animate().to({[e]:-g},r,a):this._itemsContainer.setAttribute(e,-g)}else n?this._itemsContainer.animate().to({[e]:-(u-1)*t},r,a):this._itemsContainer.setAttribute(e,-(u-1)*t)}};this._itemContext.isScrollbar?(this._pagerComponent.addEventListener("scrollDrag",h),this._pagerComponent.addEventListener("scrollUp",h),this.attribute.pager.roamScroll&&(this.addEventListener("wheel",u=>u.nativeEvent.preventDefault()),this.addEventListener("wheel",tr(l,50)))):(this._pagerComponent.addEventListener("toPrev",h),this._pagerComponent.addEventListener("toNext",h))}_renderPager(){const t=this._title?this._title.AABBBounds.height()+vt(this.attribute,"title.space",8):0,{maxWidth:e,maxCol:i=1,maxRow:n=2,item:r={},pager:a={}}=this.attribute,{spaceCol:o=Hc,spaceRow:l=Vc}=r,h=this._itemsContainer,{space:c=og,defaultCurrent:u=1}=a,d=lb(a,["space","defaultCurrent"]),{isHorizontal:p}=this._itemContext,g=this._contentMaxHeight;let f,m=0,v=0,y=0,_=0,b=0,x=0,S=1;if(p){if(v=(n-1)*l+this._itemHeight*n,m=e,f=this._createPager(d),this._pagerComponent=f,this._innerView.add(f),y=e-f.AABBBounds.width()-c,y<=0)return this._innerView.removeChild(f),!1;h.getChildren().forEach((k,T)=>{const{width:C,height:M}=k.attribute;y<b+C&&(b=0,x+=M+l,S+=1),T>0&&k.setAttributes({x:b,y:x}),b+=o+C}),this._itemContext.startX=b,this._itemContext.startY=x,this._itemContext.pages=S;const w=Math.ceil(S/n);this._itemContext.totalPage=w,this._updatePositionOfPager(t,m,v)}else{if(m=this._itemMaxWidth*i+(i-1)*o,v=g,y=m,f=this._createPager(d),this._pagerComponent=f,this._innerView.add(f),_=g-f.AABBBounds.height()-c-t,_<=0)return this._innerView.removeChild(f),!1;h.getChildren().forEach((k,T)=>{const{height:C}=k.attribute;_<x+C&&(x=0,b+=this._itemMaxWidth+o,S+=1),T>0&&k.setAttributes({x:b,y:x}),x+=l+C});const w=Math.ceil(S/i);this._itemContext.totalPage=w,this._updatePositionOfPager(t,m,v)}u>1&&(p?h.setAttribute("y",-(u-1)*(v+l)):h.setAttribute("x",-(u-1)*(m+o)));const A=gt.group({x:0,y:t,width:p?y:m,height:p?v:_,clip:!0,pickable:!1});return A.add(h),this._innerView.add(A),this._itemContext.clipContainer=A,this._bindEventsOfPager(p?v+l:m+o,p?"y":"x"),!0}_renderScrollbar(){var t;const e=this._title?this._title.AABBBounds.height()+vt(this.attribute,"title.space",8):0,{maxWidth:i,item:n={},pager:r={}}=this.attribute,{spaceCol:a=Hc,spaceRow:o=Vc}=n,l=this._itemsContainer,{space:h=og,defaultCurrent:c=1}=r,u=lb(r,["space","defaultCurrent"]),{isHorizontal:d}=this._itemContext,p=this._contentMaxHeight;let g,f=0,m=0,v=0,y=1;if(d)f=i,m=this._itemHeight,g=this._createScrollbar(u,f),this._pagerComponent=g,this._innerView.add(g);else{if(m=p-e,f=this._itemMaxWidth,g=this._createScrollbar(u,m),this._pagerComponent=g,this._innerView.add(g),m<=0)return this._innerView.removeChild(g),!1;const b=l.getChildren(),x=b.map(S=>S.attribute.height);if(x.length===1||x.every(S=>S===x[0])){const S=x[0],A=m,w=Math.floor(A/(o+S));m=w*(o+S),y=Math.ceil(b.length/w)}else b.forEach((S,A)=>{const{height:w}=S.attribute,k=y,T=v;y=Math.floor((v+w)/m)+1,v+=o+w,k!==y&&A===l.getChildren().length-1&&v-m>=1/3*w&&(m=T+w,y-=1)});this._itemContext.totalPage=y,this._itemContext.pages=y}if(c>1)if(d){const b=this._itemsContainer.AABBBounds.width()-f;l.setAttribute("x",-Math.min((c-1)*(f+a),b))}else{const b=this._itemsContainer.AABBBounds.height()-m;l.setAttribute("y",-Math.min((c-1)*(m+o),b))}const _=gt.group({x:0,y:e,width:f,height:m,clip:!0,pickable:!1});return _.add(l),this._innerView.add(_),this._itemContext.clipContainer=_,this._updatePositionOfScrollbar(f,m,e),!((t=r.scrollMask)===null||t===void 0)&&t.visible&&this.renderScrollMask(_),this._bindEventsOfPager(d?f:m,d?"x":"y"),!0}renderScrollMask(t){const{scrollMask:e={}}=this.attribute.pager,{visible:i=!0,gradientLength:n=16,gradientStops:r}=e;if(!i||!r)return;const a=t.AABBBounds.width(),o=t.AABBBounds.height(),l=this._itemContext.isHorizontal?a:o,h=r.map(d=>({offset:n*d.offset/l,color:d.color})),c=r.map(d=>({offset:(l-n*d.offset)/l,color:d.color})),u=gt.rect({x:0,y:0,width:a,height:o});this._scrollMask=u,this._scrollMaskContext={startStops:h,endStops:c},this.updateScrollMask(),t.add(u)}updateScrollMask(){if(!this._scrollMask||!this._pagerComponent||!this._itemContext.isScrollbar)return;const[t,e]=this._pagerComponent.getScrollRange(),i=[];Oe(ui(e,0,1),1)||i.push(...this._scrollMaskContext.endStops),Oe(ui(t,0,1),0)||i.push(...this._scrollMaskContext.startStops),i.length&&(this._itemContext.isHorizontal?this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:i}}):this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:0,y1:1,stops:i}}))}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(t,e){this._lastActiveItem=t,t.hasState(ct.selected)?this._setLegendItemState(t,ct.selectedHover,e):this._setLegendItemState(t,ct.unSelectedHover,e);const i=t.getChildren()[0].find(n=>n.name===He.focus,!1);i&&i.setAttribute("visible",!0),this._dispatchLegendEvent(Oi.legendItemHover,t,e)}_unHover(t,e){let i=!1;(t.hasState(ct.unSelectedHover)||t.hasState(ct.selectedHover))&&(i=!0),t.removeState(ct.unSelectedHover),t.removeState(ct.selectedHover),t.getChildren()[0].getChildren().forEach(r=>{i||!r.hasState(ct.unSelectedHover)&&!r.hasState(ct.selectedHover)||(i=!0),r.removeState(ct.unSelectedHover),r.removeState(ct.selectedHover)});const n=t.getChildren()[0].find(r=>r.name===He.focus,!1);n&&n.setAttribute("visible",!1),i&&this._dispatchLegendEvent(Oi.legendItemAttributeUpdate,t,e),this._dispatchLegendEvent(Oi.legendItemUnHover,t,e)}_setLegendItemState(t,e,i){let n=!1;t.hasState(e)||(n=!0),t.addState(e,!0),t.getChildren()[0].getChildren().forEach(r=>{r.name!==He.focus&&(n||r.hasState(e)||(n=!0),r.addState(e,!0))}),n&&this._dispatchLegendEvent(Oi.legendItemAttributeUpdate,t,i)}_removeLegendItemState(t,e,i){let n=!1;e.forEach(r=>{!n&&t.hasState(r)&&(n=!0),t.removeState(r)}),t.getChildren()[0].getChildren().forEach(r=>{r.name!==He.focus&&e.forEach(a=>{!n&&r.hasState(a)&&(n=!0),r.removeState(a)})}),n&&this._dispatchLegendEvent(Oi.legendItemAttributeUpdate,t,i)}_getSelectedLegends(){var t;const e=[];return(t=this._itemsContainer)===null||t===void 0||t.getChildren().forEach(i=>{i.hasState(ct.selected)&&e.push(i.data)}),e}_appendDataToShape(t,e,i,n){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};t.name=e,t.data=i,t.delegate=n,t.states=rt({},RB,r)}_dispatchLegendEvent(t,e,i){const n=this._getSelectedLegends();n.sort((a,o)=>a.index-o.index);const r=n.map(a=>a.label);this._dispatchEvent(t,{item:e,data:e.data,selected:e.hasState(ct.selected),currentSelectedItems:n,currentSelected:r,event:i})}_handleStyle(t,e,i,n,r){const a={};return t.style&&(U(t.style)?a.style=t.style(e,i,n,r):a.style=t.style),t.state&&(a.state={},Object.keys(t.state).forEach(o=>{t.state[o]&&(U(t.state[o])?a.state[o]=t.state[o](e,i,n,r):a.state[o]=t.state[o])})),a}release(){super.release(),this.removeAllEventListeners()}};hb.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:Hc,spaceRow:Vc,shape:{space:8,style:{size:10,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:8,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:10,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:og,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0};const cb=function(s){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];const n=[s.shape,...e.map(o=>o==null?void 0:o.shape)],r=[s.key,...e.map(o=>o==null?void 0:o.key)],a=[s.value,...e.map(o=>o==null?void 0:o.value)];return rt(s,...e,{shape:n.every(I)?void 0:rt({},...n),key:r.every(I)?void 0:rt({},...r),value:a.every(I)?void 0:rt({},...a)})},Ur=s=>{const{width:t,height:e,wordBreak:i="break-word",textAlign:n,textBaseline:r,text:a}=s;return Array.isArray(a)?{width:t,height:e,wordBreak:i,textAlign:n,textBaseline:r,singleLine:!1,textConfig:Y(a).map(o=>Object.assign(Object.assign({},s),{text:o}))}:{width:t,height:e,wordBreak:i,textAlign:n,textBaseline:r,singleLine:!1,textConfig:a==null?void 0:a.text}},IB={panel:{visible:!0,cornerRadius:[3,3,3,3],fill:"white",shadow:!0,shadowBlur:12,shadowColor:"rgba(0, 0, 0, 0.1)",shadowOffsetX:0,shadowOffsetY:4,shadowSpread:0,stroke:"white"},titleStyle:{value:{fill:"#4E5969",fontFamily:_o,fontSize:14,lineHeight:18,textAlign:"left",textBaseline:"middle"},spaceRow:6},contentStyle:{shape:{fill:"black",size:8,symbolType:"circle",spacing:6},key:{fill:"#4E5969",fontFamily:_o,fontSize:12,lineHeight:18,textAlign:"left",textBaseline:"middle",spacing:26},value:{fill:"#4E5969",fontFamily:_o,fontSize:12,lineHeight:18,textAlign:"right",textBaseline:"middle",spacing:0},spaceRow:6},padding:10,positionX:"right",positionY:"bottom",offsetX:10,offsetY:10,parentBounds:new fe().setValue(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),autoCalculatePosition:!0,autoMeasure:!0,pickable:!1,childrenPickable:!1,zIndex:500},OB=["pointerX","pointerY","offsetX","offsetY","positionX","positionY","parentBounds"];Ii(),Lr(),yo(),Dr(),vo();let ub=class _i extends Wi{constructor(t,e){super(e!=null&&e.skipDefault?t:rt({},_i.defaultAttributes,t),e),this.name="tooltip"}render(){var t;const{visible:e,content:i,panel:n,keyWidth:r,valueWidth:a,hasContentShape:o,autoCalculatePosition:l,autoMeasure:h,align:c}=this.attribute;if(!e)return void this.hideAll();h&&_i.measureTooltip(this.attribute),l&&_i.calculateTooltipPosition(this.attribute);const u=Si(this.attribute.padding);this._tooltipPanel=this.createOrUpdateChild("tooltip-background",Object.assign({visible:!0},n),"rect"),this._tooltipTitleContainer=this.createOrUpdateChild("tooltip-title",{visible:!0,x:u[3],y:u[0]},"group");const d=_i.getTitleAttr(this.attribute);this._tooltipTitleSymbol=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-shape",rt({symbolType:"circle"},d.shape,{visible:Qt(d)&&Qt(d.shape)}),"symbol"),typeof d.value.text!="object"||d.value.text===null||d.value.text.type!=="rich"&&d.value.text.type!=="html"?d.value.multiLine?this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({visible:Qt(d)&&Qt(d.value)},Ur(d.value)),"richtext"):this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({text:(t=d.value.text)!==null&&t!==void 0?t:"",visible:Qt(d)&&Qt(d.value)},d.value),"text"):d.value.text.type==="rich"?this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({visible:Qt(d)&&Qt(d.value)},Ur(d.value)),"richtext"):d.value.text.type==="html"&&(this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({html:Object.assign(Object.assign({dom:d.value.text.text},t_),d.value),visible:Qt(d)&&Qt(d.value),width:d.value.width,height:d.value.height,wordBreak:d.value.wordBreak,textAlign:d.value.textAlign,textBaseline:d.value.textBaseline,singleLine:!1,textConfig:[]},d.value),"richtext"));const p=Qt(d.shape)?d.shape.size+d.shape.spacing:0,{textAlign:g,textBaseline:f}=d.value,m=n.width-u[3]-u[0]-p;g==="center"?this._tooltipTitle.setAttribute("x",p+m/2):g==="right"||g==="end"?this._tooltipTitle.setAttribute("x",p+m):this._tooltipTitle.setAttribute("x",p),f==="bottom"?this._tooltipTitle.setAttribute("y",d.height):f==="middle"?this._tooltipTitle.setAttribute("y",d.height/2):this._tooltipTitle.setAttribute("y",0);const v=Qt(d)?d.height+d.spaceRow:0;if(this._tooltipContent=this.createOrUpdateChild("tooltip-content",{visible:!0},"group"),this._tooltipContent.removeAllChild(!0),i&&i.length){this._tooltipContent.setAttribute("x",u[3]),this._tooltipContent.setAttribute("y",u[0]+v);let y=0;i.forEach((_,b)=>{const x=_i.getContentAttr(this.attribute,b);if(!Qt(x))return;const S=\`tooltip-content-\${b}\`,A=this._tooltipContent.createOrUpdateChild(S,{visible:!0,x:0,y},"group"),w=x.shape.size+x.shape.spacing;let k=c==="right"?(o?w:0)+(Qt(x.key)?r+x.key.spacing:0)+(Qt(x.value)?a:0):0;this._createShape(c==="right"?k-x.shape.size/2:k+x.shape.size/2,x,A,S),o&&(c==="right"?k-=w:k+=w);const T=this._createKey(x,A,S);T&&(a_(c,T,x.key.textAlign,k,r),T.setAttribute("y",0),c==="right"?k-=r+x.key.spacing:k+=r+x.key.spacing);const C=this._createValue(x,A,S);if(C){let M="right";R(x.value.textAlign)?M=x.value.textAlign:Qt(x.key)||c==="right"||(M="left"),C.setAttribute("textAlign",M),a_(c,C,M,k,a),C.setAttribute("y",0)}y+=x.height+x.spaceRow})}}_createShape(t,e,i,n){var r;if(Qt(e.shape))return i.createOrUpdateChild(\`\${n}-shape\`,Object.assign({visible:!0,x:t,y:e.shape.size/2+(((r=th(e.key.lineHeight,e.key.fontSize))!==null&&r!==void 0?r:e.key.fontSize)-e.shape.size)/2},e.shape),"symbol")}_createKey(t,e,i){var n;if(Qt(t.key)){let r;return r=t.key.multiLine?e.createOrUpdateChild(\`\${i}-key\`,Object.assign(Object.assign({visible:!0},Ur(t.key)),{textBaseline:"top"}),"richtext"):typeof t.key.text!="object"||t.key.text===null||t.key.text.type!=="rich"&&t.key.text.type!=="html"?e.createOrUpdateChild(\`\${i}-key\`,Object.assign(Object.assign({visible:!0,text:(n=t.key.text)!==null&&n!==void 0?n:""},t.key),{textBaseline:"top"}),"text"):t.key.text.type==="rich"?e.createOrUpdateChild(\`\${i}-value\`,Object.assign(Object.assign({visible:!0},Ur(t.key)),{textBaseline:"top"}),"richtext"):e.createOrUpdateChild(\`\${i}-value\`,{html:Object.assign(Object.assign({dom:t.key.text.text},t_),t.key)},"richtext"),r}}_createValue(t,e,i){var n;if(Qt(t.value)){let r;return r=t.value.multiLine?e.createOrUpdateChild(\`\${i}-value\`,Object.assign(Object.assign({visible:!0},Ur(t.value)),{textBaseline:"top"}),"richtext"):typeof t.value.text!="object"||t.value.text===null||t.value.text.type!=="rich"&&t.value.text.type!=="html"?e.createOrUpdateChild(\`\${i}-value\`,Object.assign(Object.assign({visible:!0,text:(n=t.value.text)!==null&&n!==void 0?n:""},t.value),{textBaseline:"top"}),"text"):t.value.text.type==="rich"?e.createOrUpdateChild(\`\${i}-value\`,Object.assign(Object.assign({visible:!0},Ur(t.value)),{textBaseline:"top"}),"richtext"):e.createOrUpdateChild(\`\${i}-value\`,{html:Object.assign({dom:t.value.text.text,container:"",width:30,height:30,style:{}},t.value)},"richtext"),r}}setAttributes(t,e){const i=Object.keys(t);this.attribute.autoCalculatePosition&&i.every(n=>OB.includes(n))?(this._mergeAttributes(t,i),I(this.attribute.panel.width)&&this.attribute.autoMeasure&&_i.measureTooltip(this.attribute),_i.calculateTooltipPosition(this.attribute),super.setAttributes({x:this.attribute.x,y:this.attribute.y},e)):super.setAttributes(t,e)}static calculateTooltipPosition(t){const{width:e=0,height:i=0}=t.panel,{offsetX:n,offsetY:r,pointerX:a,pointerY:o,positionX:l,positionY:h,parentBounds:c}=t;let u=a,d=o;return l==="left"?u-=e+n:l==="center"?u-=e/2:u+=n,h==="top"?d-=i+r:h==="middle"?d-=i/2:d+=r,u+e>c.x2&&(u-=e+n),d+i>c.y2&&(d-=i+r),u<c.x1&&(u=c.x1),d<c.y1&&(d=c.y1),t.x=u,t.y=d,t}static measureTooltip(t){const{content:e,contentStyle:i}=t,n=Si(t.padding),r=_i.getTitleAttr(t);let a=0,o=n[0]+n[2],l=0;const{value:h,shape:c}=r,{visible:u=!1,symbolType:d=""}=c??{};if(R(h)&&typeof r.value.text!="object"){const{width:p,height:g}=xo(h).quickMeasure(h.text);a=p,l=g}if(u&&ih[d]&&(a+=c.size+c.spacing,l=Math.max(c.size,l)),t.title&&(t.title.width=a,t.title.height=l),Qt(r)&&(o+=l+r.spaceRow),e&&e.length){const p=[];if(e.forEach((g,f)=>{const m=_i.getContentAttr(t,f);(g.key||g.value)&&Qt(m)&&p.push([g,m])}),p.length){let g=!1;const f=[],m=[],v=[];p.forEach((x,S)=>{let[A,w]=x;var k;const{key:T,value:C,shape:M,spaceRow:B}=w,O=Qt(M),E=(k=M==null?void 0:M.symbolType)!==null&&k!==void 0?k:"",L=xo(T),P=xo(C);let F=0;if(Qt(T)){const{width:j,height:D}=L.quickMeasure(T.text);m.push(j),F=Math.max(F,D)}if(Qt(C)){const{width:j,height:D}=P.quickMeasure(C.text);v.push(j),F=Math.max(F,D)}O&&ih[E]&&(g=!0,f.push(M.size),F=Math.max(M.size,F)),A.height=F,o+=F,S<p.length-1&&(o+=B??i.spaceRow)});const y=f.length?Math.max(...f):0,_=m.length?Math.max(...m):0,b=v.length?Math.max(...v):0;a=Math.max(_+b+i.key.spacing+i.value.spacing+(g?y+i.shape.spacing:0),a),e.forEach(x=>{x.width=a}),t.hasContentShape=g,t.keyWidth=_,t.valueWidth=b}}return t.panel.width=a+n[1]+n[3],t.panel.height=o,t}static getTitleAttr(t){return cb({},_i.defaultAttributes.titleStyle,_i.defaultAttributes.title,t.titleStyle,t.title)}static getContentAttr(t,e){return cb({},_i.defaultAttributes.contentStyle,t.contentStyle,t.content[e])}};function db(s,t){const e=Wc(s),i=Wc(t),n=Math.asin((s.x*t.y-t.x*s.y)/e/i),r=Math.acos((s.x*t.x+s.y*t.y)/e/i);return n<0?-r:r}function Wc(s,t={x:0,y:0}){return Ne.distancePP(s,t)}function qe(s,t,e){let i=!1;if(t&&U(t)){for(const n of s)for(const r of n.getSeries(e))if(i=!!t.call(null,r),i)return i}return i}ub.defaultAttributes=IB;function lg(s){return function(t){let e;return e=W(s)?s.reduce((i,n)=>i==null?void 0:i[n],t):t==null?void 0:t[s],e}}var pb,te,gb;function fb(s){var t,e;const{type:i}=s;return i===te.sankey?(t=s.direction)!==null&&t!==void 0?t:"horizontal":(e=s.direction)!==null&&e!==void 0?e:"vertical"}(function(s){s.area_horizontal="area_horizontal",s.area_vertical="area_vertical",s.area_stack="area_stack",s.line_horizontal="line_horizontal",s.line_vertical="line_vertical",s.line_stack="line_stack",s.bar_horizontal="bar_horizontal",s.bar_vertical="bar_vertical",s.bar_stack="bar_stack",s.bar3d_horizontal="bar3d_horizontal",s.bar3d_vertical="bar3d_vertical",s.bar3d_stack="bar3d_stack",s.rangeColumn_horizontal="rangeColumn_horizontal",s.rangeColumn_vertical="rangeColumn_vertical",s.rangeColumn3d_horizontal="rangeColumn3d_horizontal",s.rangeColumn3d_vertical="rangeColumn3d_vertical",s.rangeArea_horizontal="rangeArea_horizontal",s.rangeArea_vertical="rangeArea_vertical",s.linearProgress_horizontal="linearProgress_horizontal",s.linearProgress_vertical="linearProgress_vertical",s.linearProgress_stack="linearProgress_stack",s.boxPlot_horizontal="boxPlot_horizontal",s.boxPlot_vertical="boxPlot_vertical",s.sankey_horizontal="sankey_horizontal",s.sankey_vertical="sankey_vertical",s.waterfall_horizontal="waterfall_horizontal",s.waterfall_vertical="waterfall_vertical",s.circularProgress_stack="circularProgress_stack",s.radar_stack="radar_stack",s.rose_stack="rose_stack"})(pb||(pb={})),function(s){s.area="area",s.line="line",s.bar="bar",s.bar3d="bar3d",s.rangeColumn="rangeColumn",s.rangeColumn3d="rangeColumn3d",s.rangeArea="rangeArea",s.dot="dot",s.geo="geo",s.link="link",s.map="map",s.pie="pie",s.pie3d="pie3d",s.radar="radar",s.rose="rose",s.scatter="scatter",s.circularProgress="circularProgress",s.wordCloud="wordCloud",s.wordCloud3d="wordCloud3d",s.funnel="funnel",s.funnel3d="funnel3d",s.linearProgress="linearProgress",s.boxPlot="boxPlot",s.sankey="sankey",s.gaugePointer="gaugePointer",s.gauge="gauge",s.treemap="treemap",s.sunburst="sunburst",s.circlePacking="circlePacking",s.waterfall="waterfall",s.heatmap="heatmap",s.correlation="correlation",s.liquid="liquid",s.venn="venn",s.mosaic="mosaic",s.pictogram="pictogram"}(te||(te={})),function(s){s.label="label",s.point="point",s.line="line",s.area="area",s.bar="bar",s.bar3d="bar3d",s.boxPlot="boxPlot",s.outlier="outlier",s.circlePacking="circlePacking",s.group="group",s.gridBackground="gridBackground",s.grid="grid",s.dot="dot",s.title="title",s.subTitle="subTitle",s.symbol="symbol",s.funnel="funnel",s.funnel3d="funnel3d",s.transform="transform",s.transform3d="transform3d",s.transformLabel="transformLabel",s.outerLabel="outerLabel",s.outerLabelLine="outerLabelLine",s.pin="pin",s.pinBackground="pinBackground",s.pointer="pointer",s.segment="segment",s.track="track",s.cell="cell",s.cellBackground="cellBackground",s.link="link",s.arrow="arrow",s.pie="pie",s.pie3d="pie3d",s.labelLine="labelLine",s.progress="progress",s.minLabel="minLabel",s.maxLabel="maxLabel",s.rose="rose",s.node="node",s.sunburst="sunburst",s.nonLeaf="nonLeaf",s.leaf="leaf",s.nonLeafLabel="nonLeafLabel",s.leaderLine="leaderLine",s.stackLabel="stackLabel",s.word="word",s.fillingWord="fillingWord",s.wordMask="wordMask",s.nodePoint="nodePoint",s.ripplePoint="ripplePoint",s.centerPoint="centerPoint",s.centerLabel="centerLabel",s.barBackground="barBackground",s.lineLabel="lineLabel",s.areaLabel="areaLabel",s.liquidGroup="liquidGroup",s.liquid="liquid",s.liquidBackground="liquidBackground",s.liquidOutline="liquidOutline",s.circle="circle",s.overlap="overlap",s.overlapLabel="overlapLabel",s.pictogram="pictogram"}(gb||(gb={}));const PB={primaryFontColor:"titleFontColor",tertiaryFontColor:"labelFontColor",axisLabelFontColor:"axisFontColor",axisMarkerFontColor:"labelReverseFontColor",dataZoomHandleStrokeColor:"dataZoomHandlerStrokeColor",sliderHandleColor:"dataZoomHandlerFillColor",sliderRailColor:"dataZoomBackgroundColor",sliderTrackColor:"dataZoomSelectedColor",playerControllerColor:"dataZoomSelectedColor",popupBackgroundColor:"tooltipBackgroundColor",hoverBackgroundColor:"axisGridColor"},LB={titleFontColor:"primaryFontColor",labelFontColor:"tertiaryFontColor",axisFontColor:"axisLabelFontColor",labelReverseFontColor:"axisMarkerFontColor",dataZoomHandlerStrokeColor:"dataZoomHandleStrokeColor",dataZoomHandlerFillColor:"sliderHandleColor",dataZoomBackgroundColor:"sliderRailColor",dataZoomSelectedColor:"sliderTrackColor",tooltipBackgroundColor:"popupBackgroundColor"};function Gr(s,t){var e;if(!s)return[];const i=hg(s,t);if(!i||W(i))return(e=i)!==null&&e!==void 0?e:[];if(_t(i)){const{dataScheme:n}=i;return n?Yc(n)?n.map(r=>Object.assign(Object.assign({},r),{scheme:r.scheme.map(a=>Bo(a)?Gc(s,a,t):a).filter(R)})):n.map(r=>Bo(r)?Gc(s,r,t):r).filter(R):[]}return[]}function Uc(s,t){var e,i;return Yc(s)?(i=(e=s.find(n=>R(n.isAvailable)?U(n.isAvailable)?n.isAvailable(t):!!n.isAvailable:!R(n.maxDomainLength)||(t==null?void 0:t.length)<=n.maxDomainLength))===null||e===void 0?void 0:e.scheme)!==null&&i!==void 0?i:s[s.length-1].scheme:s}function Gc(s,t,e){var i;const n=hg(s,e);if(!n)return;let r;const{palette:a}=n;if(_t(a)&&(r=(i=function(l,h){const c=PB[h];if(c&&l[c])return l[c];if(l[h])return l[h];const u=LB[h];return u?l[u]:void 0}(a,t.key))!==null&&i!==void 0?i:t.default),!r)return;if(I(t.a)&&I(t.l)||!Q(r))return r;let o=new re(r);if(R(t.l)){const{r:l,g:h,b:c}=o.color,{h:u,s:d}=Sl(l,h,c),p=xl(u,d,t.l),g=new re(\`rgb(\${p.r}, \${p.g}, \${p.b})\`);g.setOpacity(o.color.opacity),o=g}return R(t.a)&&o.setOpacity(t.a),o.toRGBA()}const mb=(s,t,e)=>{if(t&&Bo(s)){const i=Gc(t,s,e);if(i)return i}return s};function Bo(s){return s&&s.type==="palette"&&!!s.key}function Yc(s){return!(!W(s)||s.length===0)&&s.every(t=>R(t.scheme))}function vb(s){return W(s)?{dataScheme:s}:s}function hg(s,t){var e,i;const{type:n}=t??{};let r;if(!t||I(n))r=s==null?void 0:s.default;else{const a=fb(t);r=(i=(e=s==null?void 0:s[\`\${n}_\${a}\`])!==null&&e!==void 0?e:s==null?void 0:s[n])!==null&&i!==void 0?i:s==null?void 0:s.default}return r}class yb extends Ao{range(t){return t?(this._range=t,this._resetRange(),this):super.range()}domain(t){return t?(super.domain(t),this._resetRange(),this):super.domain()}_resetRange(){if(!Yc(this._range))return void super.range(this._range);const t=Uc(this._range,this._domain);super.range(t)}}const DB={linear:wo,band:ko,point:class extends ko{constructor(s){super(!1),this.type=Ee.Point,this._padding=0,this.paddingInner(1,s),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}},ordinal:Ao,threshold:tg,colorOrdinal:yb};function cg(s){const t=DB[s];return t?new t:null}function Ze(s,t,e){if(!t)return s;const i=t.range(),n=e&&t._calculateWholeRange?t._calculateWholeRange(i):t.range(),r=Math.min(n[0],n[n.length-1]),a=Math.max(n[0],n[n.length-1]);return Math.min(Math.max(r,s),a)}function _b(s){return R(s==null?void 0:s.field)&&R(s==null?void 0:s.scale)}function bb(s){switch(s){case"left":case"right":case"top":case"bottom":return!0;default:return!1}}function Yr(s){return!!Q(s)&&!!s.endsWith("%")&&wr(s.substring(0,s.length-1))}function Je(s,t,e,i=0){var n,r;return it(s)?s:Yr(s)?Number(s.substring(0,s.length-1))*t/100:U(s)?s(e):_t(s)?t*((n=s.percent)!==null&&n!==void 0?n:0)+((r=s.offset)!==null&&r!==void 0?r:0):i}function xb(s,t,e){var i,n,r,a;const o={top:0,bottom:0,left:0,right:0};return Object.values(s).every(l=>it(l))?(o.top=(i=s.top)!==null&&i!==void 0?i:0,o.right=(n=s.right)!==null&&n!==void 0?n:0,o.bottom=(r=s.bottom)!==null&&r!==void 0?r:0,o.left=(a=s.left)!==null&&a!==void 0?a:0,o):([{orients:["left","right"],size:t.width},{orients:["top","bottom"],size:t.height}].forEach(l=>{l.orients.forEach(h=>{o[h]=Je(s[h],l.size,e)})}),o)}function Ro(s){let t={};return W(s)?(I(s[0])||(t.top=t.left=t.bottom=t.right=s[0]),I(s[1])||(t.left=t.right=s[1]),I(s[2])||(t.bottom=s[2]),I(s[3])||(t.left=s[3]),t):it(s)||Yr(s)||U(s)||_t(e=s)&&("percent"in e||"offset"in e)?(t.top=t.left=t.bottom=t.right=s,t):(_t(s)&&(t=Object.assign({},s)),t);var e}function Sb(s,t,e){return e?{x:s.x+t.x,y:s.y+t.y}:s}const $c=(s,t)=>{const e=Number(s),i=s.toString();return isNaN(e)&&i[i.length-1]==="%"?t*(Number(i.slice(0,i.length-1))/100):e},ug=[{maxDomainLength:10,scheme:["#1664FF","#1AC6FF","#FF8A00","#3CC780","#7442D4","#FFC400","#304D77","#B48DEB","#009488","#FF7DDA"]},{scheme:["#1664FF","#B2CFFF","#1AC6FF","#94EFFF","#FF8A00","#FFCE7A","#3CC780","#B9EDCD","#7442D4","#DDC5FA","#FFC400","#FAE878","#304D77","#8B959E","#B48DEB","#EFE3FF","#009488","#59BAA8","#FF7DDA","#FFCFEE"]}],FB={default:{dataScheme:ug,palette:{backgroundColor:"#ffffff",borderColor:"#e3e5e8",shadowColor:"rgba(33,37,44,0.1)",hoverBackgroundColor:"#f1f2f5",sliderRailColor:"#f1f3f4",sliderHandleColor:"#ffffff",sliderTrackColor:"#0040ff",popupBackgroundColor:"#ffffff",primaryFontColor:"#21252c",secondaryFontColor:"#606773",tertiaryFontColor:"#89909d",axisLabelFontColor:"#89909d",disableFontColor:"#bcc1cb",axisMarkerFontColor:"#ffffff",axisGridColor:"#f1f2f5",axisDomainColor:"#d9dde4",dataZoomHandleStrokeColor:"#aeb5be",dataZoomChartColor:"#c9ced8",playerControllerColor:"#0040ff",scrollBarSliderColor:"rgba(0,0,0,0.3)",axisMarkerBackgroundColor:"#21252c",markLabelBackgroundColor:"#f1f2f5",markLineStrokeColor:"#606773",dangerColor:"#e33232",warningColor:"#ffc528",successColor:"#07a35a",infoColor:"#3073f2",discreteLegendPagerTextColor:"rgb(51, 51, 51)",discreteLegendPagerHandlerColor:"rgb(47, 69, 84)",discreteLegendPagerHandlerDisableColor:"rgb(170, 170, 170)",emptyCircleColor:"#e3e5e8",linearProgressTrackColor:"#E7EBED"}}},Ab=s=>{const t={label:{style:{fill:"white",textBaseline:"middle",lineWidth:2}},outerLabel:{style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"secondaryFontColor"}},line:{style:{stroke:{type:"palette",key:"axisDomainColor"}}}},transformLabel:{style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"secondaryFontColor"},textBaseline:"middle"}}};return t[s?"transform3d":"transform"]={style:{fill:{type:"palette",key:"axisGridColor"}}},t},jB=Ab(),NB=Ab(!0),kb="M1 0 C1 0.55228 0.55228 1 0 1 C-0.552285 1 -1 0.55228 -1 0 C-1 -0.552285 -0.552285 -1 0 -1 C0.55228 -1 1 -0.552285 1 0Z",zB={pointer:{type:"path",width:.4,height:.4,style:{path:"M-0.020059 -0.978425 C-0.018029 -0.9888053 -0.013378 -1 0 -1 C0.01342 -1 0.01812 -0.989146 0.0201 -0.978425 C0.02161 -0.9702819 0.0692 -0.459505 0.09486 -0.184807 C0.10298 -0.097849 0.1089 -0.034548 0.11047 -0.018339 C0.11698 0.04908 0.07373 0.11111 0.00002 0.11111 C-0.07369 0.11111 -0.117184 0.04991 -0.110423 -0.018339 C-0.103662 -0.086591 -0.022089 -0.9680447 -0.020059 -0.978425Z"}},pin:{width:.025,height:.025,style:{path:kb,fill:"#888"}},pinBackground:{width:.06,height:.06,style:{path:kb,fill:"#ddd"}}},HB={word:{padding:1,style:{textAlign:"center",textBaseline:"alphabetic"}}},VB={word:{padding:1,style:{textAlign:"center",textBaseline:"alphabetic"}}},xt="__VCHART",On=500,Pn=500,dg=\`\${xt}_ARC_TRANSFORM_VALUE\`,WB=\`\${xt}_ARC_RATIO\`,wb=\`\${xt}_ARC_START_ANGLE\`,Tb=\`\${xt}_ARC_END_ANGLE\`,UB=\`\${xt}_ARC_K\`,Us=\`\${xt}_ARC_MIDDLE_ANGLE\`,GB=\`\${xt}_ARC_QUADRANT\`,YB=\`\${xt}_ARC_RADIAN\`,$B=-Math.PI/2,XB=3*Math.PI/2,KB={scatter:{point:{style:{size:8,symbolType:"circle",lineWidth:0,fillOpacity:.8}},label:{visible:!1,offset:5,position:"top",style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}}},line:{label:{visible:!1,position:"top",offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},point:{style:{symbolType:"circle"}}},area:{label:{visible:!1,offset:5,position:"top",style:{stroke:{type:"palette",key:"backgroundColor"},lineWidth:2}},point:{style:{symbolType:"circle"}},seriesMark:"area"},bar:{label:{visible:!1,position:"outside",offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}}},bar3d:{bar3d:{style:{length:3}},label:{visible:!1,style:{offset:12,position:"outside"}}},pie:{outerRadius:.6,pie:{style:{fillOpacity:1}},label:{visible:!1,interactive:!0,position:"outside",style:{fontWeight:"normal",stroke:{type:"palette",key:"backgroundColor"},fillOpacity:1}},innerLabel:{style:{lineWidth:2}},emptyCircle:{style:{fill:{type:"palette",key:"emptyCircleColor"},fillOpacity:1}}},pie3d:{outerRadius:.6,pie3d:{style:{height:10,fillOpacity:1}},label:{visible:!1,interactive:!0,position:"outside"}},map:{defaultFillColor:"#f3f3f3",area:{style:{lineWidth:.5,strokeOpacity:1,stroke:"black",fillOpacity:1}},label:{interactive:!1,style:{fontSize:{type:"token",key:"l6FontSize"},lineHeight:{type:"token",key:"l6LineHeight"},textBaseline:"middle",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"},stroke:{type:"palette",key:"backgroundColor"}}}},radar:{label:{visible:!1,offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},point:{style:{symbolType:"circle"}}},dot:{dot:{style:{size:10,fillOpacity:1}},symbol:{style:{size:10}},title:{style:{textAlign:"left",textBaseline:"middle",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}},subTitle:{style:{textAlign:"left",textBaseline:"top",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},link:{arrow:{style:{size:10}}},wordCloud:HB,wordCloud3d:VB,funnel:jB,funnel3d:NB,linearProgress:{bandWidth:30,progress:{style:{fillOpacity:1}},track:{style:{fill:{type:"palette",key:"linearProgressTrackColor"},fillOpacity:1}}},circularProgress:{outerRadius:.8,innerRadius:.6,progress:{style:{fillOpacity:1}},track:{style:{fillOpacity:.2}},tickMask:{visible:!1,angle:3,offsetAngle:0,forceAlign:!0}},waterfall:{seriesFieldName:{total:"total",increase:"increase",decrease:"decrease"},leaderLine:{style:{stroke:"black",lineWidth:1,lineDash:[4,4]}},stackLabel:{visible:!0,offset:12,position:"withChange",style:{fill:"black",fontSize:{type:"token",key:"l4FontSize"}}},label:{visible:!1,offset:12,position:"inside",style:{lineWidth:2}}},gauge:{outerRadius:.8,innerRadius:.6,padAngle:1.146,segment:{style:{fillOpacity:1}},tickMask:{visible:!1,angle:3,offsetAngle:0,forceAlign:!0}},gaugePointer:zB,treemap:{gapWidth:1,nodePadding:[5],nonLeaf:{visible:!1,style:{fillOpacity:.5}},label:{style:{fill:"white",textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}},nonLeafLabel:{padding:24,style:{fill:"black",stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},textBaseline:"middle",textAlign:"center"}}},sunburst:{innerRadius:0,outerRadius:1,startAngle:-90,endAngle:270,gap:0,labelLayout:{align:"center",offset:0,rotate:"radial"},sunburst:{style:{stroke:{type:"palette",key:"backgroundColor"},fillOpacity:1,cursor:"pointer"}},label:{visible:!0,style:{cursor:"pointer",fill:{type:"palette",key:"primaryFontColor"},fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},rangeColumn:{label:{visible:!1,offset:5,position:"inside",style:{lineWidth:2,fill:{type:"palette",key:"axisMarkerFontColor"}},minLabel:{position:"end"},maxLabel:{position:"start"}}},circlePacking:{layoutPadding:5,circlePacking:{visible:!0,style:{cursor:"pointer",stroke:{type:"palette",key:"backgroundColor"}}},label:{visible:!0,style:{cursor:"pointer",fill:"black",stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},heatmap:{cell:{style:{shape:"square",fillOpacity:1}},cellBackground:{visible:!1}},sankey:{link:{style:{fillOpacity:.15,round:!0}}},rose:{rose:{style:{fillOpacity:1}},label:{style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"},textAlign:"center",textBaseline:"middle"}}},boxPlot:{boxPlot:{style:{lineWidth:1}},label:{style:{lineWidth:2}}},correlation:{centerLabel:{visible:!0,position:"center",style:{fill:"#fff",text:""}},label:{visible:!0,position:"bottom",style:{fill:"#000"}}},liquid:{outlinePadding:10,liquidBackground:{style:{lineWidth:0,fillOpacity:.2}},liquidOutline:{style:{lineWidth:2}}},venn:{circle:{style:{opacity:.8},state:{hover:{opacity:1}}},overlap:{style:{opacity:.8},state:{hover:{opacity:1,stroke:"white",lineWidth:2}}},label:{visible:!0,style:{fill:"white",textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"}}},overlapLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},mosaic:{label:{visible:!1,position:"center",style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},bar:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}}}},Cb={label:{space:8},title:{space:8},maxHeight:"30%",unit:{visible:!1,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}}},qB={label:{space:12,autoLimit:!0},title:{space:12,autoRotate:!0},maxWidth:"30%",unit:{visible:!1,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}}},ZB=Object.assign(Object.assign({},Cb),{label:{space:0}}),JB={trigger:"hover",bandField:{visible:!1,line:{type:"rect",visible:!0,style:{fill:{type:"palette",key:"axisGridColor"},opacity:.7,lineWidth:0,stroke:{type:"palette",key:"markLineStrokeColor"},lineDash:[2,3]}},label:{visible:!1,style:{fontWeight:"normal",fill:{type:"palette",key:"axisMarkerFontColor"},fontSize:{type:"token",key:"l5FontSize"}},labelBackground:{padding:{bottom:0,top:0,left:2,right:2},style:{fill:{type:"palette",key:"axisMarkerBackgroundColor"},cornerRadius:1}}}},linearField:{visible:!1,line:{type:"line",visible:!0,style:{stroke:{type:"palette",key:"markLineStrokeColor"},fill:"transparent",opacity:.7,lineDash:[2,3]}},label:{visible:!1,style:{fontWeight:"normal",fill:{type:"palette",key:"axisMarkerFontColor"},fontSize:{type:"token",key:"l5FontSize"}},labelBackground:{padding:{bottom:0,top:0,left:2,right:2},style:{fill:{type:"palette",key:"axisMarkerBackgroundColor"},cornerRadius:1}}}}},Mb=s=>({area:{style:{visible:s,stroke:!1,fill:{type:"palette",key:"dataZoomChartColor"}}},line:{style:{visible:s,stroke:{type:"palette",key:"dataZoomChartColor"},lineWidth:1}}}),QB={padding:[12,0],showDetail:"auto",brushSelect:!1,middleHandler:{visible:!1,background:{size:6,style:{stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},cornerRadius:2}},icon:{style:{size:4,fill:{type:"palette",key:"sliderHandleColor"},stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},symbolType:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",lineWidth:.5}}},background:{size:20,style:{fill:{type:"palette",key:"sliderRailColor"},lineWidth:0}},selectedBackground:{style:{fill:{type:"palette",key:"sliderTrackColor"},fillOpacity:.1,outerBorder:{stroke:{type:"palette",key:"sliderTrackColor"},strokeOpacity:.2,distance:-.5,lineWidth:1}}},selectedBackgroundChart:Mb(!1),startHandler:{style:{symbolType:\`M-0.5-2.4h0.9c0.4,0,0.7,0.3,0.7,0.7v3.3c0,0.4-0.3,0.7-0.7,0.7h-0.9c-0.4,0-0.7-0.3-0.7-0.7v-3.3
C-1.2-2-0.9-2.4-0.5-2.4z M-0.4-1.4L-0.4-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C-0.4-1.4-0.4-1.4-0.4-1.4z M0.3-1.4L0.3-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C0.3-1.4,0.3-1.4,0.3-1.4z;\`,fill:{type:"palette",key:"sliderHandleColor"},scaleX:1.2,scaleY:1.2,stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},lineWidth:1}},endHandler:{style:{symbolType:\`M-0.5-2.4h0.9c0.4,0,0.7,0.3,0.7,0.7v3.3c0,0.4-0.3,0.7-0.7,0.7h-0.9c-0.4,0-0.7-0.3-0.7-0.7v-3.3
C-1.2-2-0.9-2.4-0.5-2.4z M-0.4-1.4L-0.4-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C-0.4-1.4-0.4-1.4-0.4-1.4z M0.3-1.4L0.3-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C0.3-1.4,0.3-1.4,0.3-1.4z;\`,fill:{type:"palette",key:"sliderHandleColor"},scaleX:1.2,scaleY:1.2,stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},lineWidth:1}},startText:{padding:8,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}}},endText:{padding:8,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}}},backgroundChart:Mb(!0)},Eb=(s,t)=>({fontSize:{type:"token",key:s},fill:{type:"palette",key:t},fontWeight:"normal",fillOpacity:1,textBaseline:"top",textAlign:"center"}),tR={title:{visible:!0,autoLimit:!1,autoFit:!1,style:Eb("l1FontSize","primaryFontColor")},content:{visible:!0,style:Eb("l2FontSize","tertiaryFontColor")}},Bb={orient:"right",position:"middle",padding:[16,24],title:{visible:!1,padding:0,textStyle:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"primaryFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6},endText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6},handlerText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6}},Rb=s=>{const t={width:200,height:8,style:{fill:{type:"palette",key:"sliderRailColor"}}};return s?(t.width=200,t.height=8):(t.width=8,t.height=200),Object.assign(Object.assign({},Bb),{rail:t,handler:{style:{symbolType:"circle",lineWidth:0,outerBorder:{lineWidth:2,distance:.8,stroke:"#ffffff"},shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:{type:"palette",key:"shadowColor"}}}})},eR={horizontal:Rb(!0),vertical:Rb(!1)},Ib=s=>{const t={style:{fill:{type:"palette",key:"sliderRailColor"}}};return s?(t.width=200,t.height=4):(t.height=200,t.width=4),Object.assign(Object.assign({},Bb),{sizeBackground:{fill:{type:"palette",key:"dataZoomChartColor"}},track:{style:{fill:{type:"palette",key:"sliderTrackColor",a:.8}}},rail:t,handler:{style:{symbolType:"circle",lineWidth:0,outerBorder:{lineWidth:2,distance:.8,stroke:{type:"palette",key:"sliderTrackColor"}},fill:{type:"palette",key:"sliderHandleColor"}}}})},iR={horizontal:Ib(!0),vertical:Ib(!1)},sR={visible:!0,offset:12,position:"top",space:10,nameLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"left",fill:"black",fontSize:{type:"token",key:"l6FontSize"}}},valueLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"left",fill:"black",fontSize:{type:"token",key:"l6FontSize"}}},background:{visible:!0,padding:{top:4,bottom:4,left:6,right:6},style:{cornerRadius:2,lineWidth:1,fill:"white",stroke:"grey"}},leader:{visible:!1,style:{lineWidth:1,stroke:"red"}}},Ob={area:{style:{fill:{type:"palette",key:"axisDomainColor",a:.25}}},label:{style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fontStyle:"normal",fill:{type:"palette",key:"primaryFontColor"}},labelBackground:{padding:{top:2,bottom:2,right:4,left:4},style:{cornerRadius:3,fill:{type:"palette",key:"markLabelBackgroundColor"}}}}},Pb=s=>({visible:s,symbolType:"triangle",size:10,style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}}),nR={style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fontStyle:"normal",fill:{type:"palette",key:"primaryFontColor"}},labelBackground:{padding:{top:2,bottom:2,right:4,left:4},style:{cornerRadius:3,fill:{type:"palette",key:"markLabelBackgroundColor"}}},refY:5},Lb={line:{style:{lineDash:[3,3],stroke:{type:"palette",key:"markLineStrokeColor"}}},startSymbol:Pb(!1),endSymbol:Pb(!0),label:nR},pg={itemLine:{decorativeLine:{visible:!1},startSymbol:{size:5,visible:!0,style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}},endSymbol:{style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}},line:{style:{stroke:{type:"palette",key:"markLineStrokeColor"}}}},itemContent:{offsetY:-50}};function Db(s,t){return s&&t.key in s?s[t.key]:t.default}function Fb(s){return s&&s.type==="token"&&!!s.key}const $r={fontFamily:"PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",fontSize:14,l1FontSize:32,l1LineHeight:"150%",l2FontSize:20,l2LineHeight:"140%",l3FontSize:16,l3LineHeight:"150%",l4FontSize:14,l4LineHeight:"150%",l5FontSize:12,l5LineHeight:"130%",l6FontSize:10,l6LineHeight:"120%"},Xc={name:"light",background:{type:"palette",key:"backgroundColor"},padding:20,fontFamily:{type:"token",key:"fontFamily"},colorScheme:FB,token:$r,mark:{text:{style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fillOpacity:1}}},markByName:{label:{style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fillOpacity:1,lineJoin:"bevel"}},area:{style:{fillOpacity:.2}},line:{style:{lineWidth:2,lineCap:"round",lineJoin:"round"}},point:{style:{size:8,stroke:{type:"palette",key:"backgroundColor"},lineWidth:1,fillOpacity:1}},word:{style:{fontWeight:null,fontSize:null}},fillingWord:{style:{fontWeight:null,fontSize:null}},sunburst:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}},circlePacking:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}},funnel3d:{style:{stroke:!1}},barBackground:{visible:!1,style:{fill:{type:"palette",key:"primaryFontColor",a:.06},stroke:"transparent"}}},series:KB,component:{discreteLegend:{orient:"bottom",position:"middle",padding:[16,24],title:{visible:!1,padding:0,textStyle:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"primaryFontColor"},fontWeight:"normal"},space:12},pager:{textStyle:{fill:{type:"palette",key:"discreteLegendPagerTextColor"}},handler:{style:{fill:{type:"palette",key:"discreteLegendPagerHandlerColor"}},state:{disable:{fill:{type:"palette",key:"discreteLegendPagerHandlerDisableColor"}}}}},item:{visible:!0,spaceCol:10,spaceRow:6,padding:2,background:{state:{selectedHover:{fill:{type:"palette",key:"hoverBackgroundColor"}},unSelectedHover:{fill:{type:"palette",key:"hoverBackgroundColor"}}}},shape:{space:6,style:{lineWidth:0,fillOpacity:1,opacity:1},state:{unSelected:{fillOpacity:.2,opacity:1}}},label:{space:6,style:{fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"},fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},opacity:1},state:{unSelected:{fill:{type:"palette",key:"disableFontColor"},opacity:1}}}},allowAllCanceled:!1},colorLegend:eR,sizeLegend:iR,axis:{domainLine:{visible:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisGridColor"},strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:{type:"palette",key:"axisGridColor"},strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,inside:!1,tickSize:4,alignWithLabel:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},subTick:{visible:!1,tickSize:2,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},label:{visible:!0,inside:!1,space:10,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}},title:{space:10,padding:0,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor"},fontWeight:"normal",fillOpacity:1}}},axisBand:{domainLine:{visible:!0},grid:{visible:!1},subGrid:{visible:!1},tick:{visible:!0},subTick:{visible:!1}},axisLinear:{domainLine:{visible:!1},grid:{visible:!0},subGrid:{visible:!1},tick:{visible:!1},subTick:{visible:!1}},axisX:Cb,axisY:qB,axisZ:ZB,axisAngle:{grid:{visible:!0,style:{lineDash:[6,6]}},label:{space:5}},axisRadius:{grid:{smooth:!0,visible:!0},subGrid:{smooth:!0,visible:!1}},markLine:Lb,markArea:Ob,markPoint:pg,polarMarkLine:Lb,polarMarkArea:Ob,polarMarkPoint:pg,geoMarkPoint:pg,tooltip:{offset:{x:10,y:10},panel:{padding:{top:10,left:10,right:10,bottom:10},backgroundColor:{type:"palette",key:"popupBackgroundColor"},border:{color:{type:"palette",key:"popupBackgroundColor"},width:0,radius:3},shadow:{x:0,y:4,blur:12,spread:0,color:{type:"palette",key:"shadowColor"}}},spaceRow:6,titleLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"primaryFontColor"},fontWeight:"bold",textBaseline:"middle",spacing:0},shape:{size:8,spacing:6},keyLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"secondaryFontColor"},textBaseline:"middle",spacing:26},valueLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"primaryFontColor"},fontWeight:"bold",textBaseline:"middle",spacing:0}},dataZoom:QB,crosshair:JB,player:{visible:!0,position:"start",padding:{top:20,bottom:20},slider:{space:10,trackStyle:{fill:{type:"palette",key:"sliderTrackColor"},fillOpacity:.8},railStyle:{fill:{type:"palette",key:"sliderRailColor"}},handlerStyle:{size:15,stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fill:{type:"palette",key:"playerControllerColor"}}},controller:{start:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},pause:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},backward:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},forward:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}}}},brush:{style:{fill:"#B0C8F9",fillOpacity:.2,stroke:"#B0C8F9",lineWidth:2},brushMode:"single",brushType:"rect",brushMoved:!0,removeOnClick:!0,delayType:"throttle",delayTime:0},indicator:tR,title:{padding:{top:4,bottom:20},textStyle:{fontSize:{type:"token",key:"l3FontSize"},lineHeight:{type:"token",key:"l3LineHeight"},fill:{type:"palette",key:"primaryFontColor"}},subtextStyle:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fill:{type:"palette",key:"tertiaryFontColor"}}},mapLabel:sR,poptip:{visible:!0,position:"auto",padding:8,titleStyle:{fontSize:{type:"token",key:"l5FontSize"},fontWeight:"bold",fill:{type:"palette",key:"primaryFontColor"}},contentStyle:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"primaryFontColor"}},panel:{visible:!0,fill:{type:"palette",key:"popupBackgroundColor"},cornerRadius:3,lineWidth:0,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:{type:"palette",key:"shadowColor"},size:0,space:12}},totalLabel:{visible:!1,offset:5,overlap:{clampForce:!0,strategy:[]},smartInvert:!1,animation:!1,style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"primaryFontColor"}}},scrollBar:{horizontal:{height:10,slider:{style:{fill:{type:"palette",key:"scrollBarSliderColor"}}}},vertical:{width:10,slider:{style:{fill:{type:"palette",key:"scrollBarSliderColor"}}}}}},animationThreshold:2e3},gg={name:"dark",colorScheme:{default:{dataScheme:ug,palette:{backgroundColor:"#202226",borderColor:"#404349",shadowColor:"rgba(0,0,0,0.1)",hoverBackgroundColor:"#404349",sliderRailColor:"#404349",sliderHandleColor:"#202226",sliderTrackColor:"#4284FF",popupBackgroundColor:"#404349",primaryFontColor:"#fdfdfd",secondaryFontColor:"#bbbdc3",tertiaryFontColor:"#888c93",axisLabelFontColor:"#888c93",disableFontColor:"#55595f",axisMarkerFontColor:"#202226",axisGridColor:"#404349",axisDomainColor:"#4b4f54",dataZoomHandleStrokeColor:"#bbbdc3",dataZoomChartColor:"#55595F",playerControllerColor:"#4284FF",scrollBarSliderColor:"rgba(255,255,255,0.3)",axisMarkerBackgroundColor:"#fdfdfd",markLabelBackgroundColor:"#404349",markLineStrokeColor:"#bbbdc3",dangerColor:"#eb4b4b",warningColor:"#f0bd30",successColor:"#14b267",infoColor:"#4284ff",discreteLegendPagerTextColor:"#BBBDC3",discreteLegendPagerHandlerColor:"#BBBDC3",discreteLegendPagerHandlerDisableColor:"#55595F",emptyCircleColor:"#bbbdc3",linearProgressTrackColor:"#404349"}}},component:{dataZoom:{selectedBackground:{style:{fillOpacity:.4,outerBorder:{strokeOpacity:.4}}}}}},fg=(s,t,e)=>{if(I(t))return s;const i=t[0];return I(i)?s:t.length===1?(s[i]=e,s):(I(s[i])&&(typeof t[1]=="number"?s[i]=[]:s[i]={}),fg(s[i],t.slice(1),e))};function mt(s){let t=-1;const e=arguments.length<=1?0:arguments.length-1;for(;++t<e;)Fu(s,t+1<1||arguments.length<=t+1?void 0:arguments[t+1],!0,!0);return s}let et=class Bt{static registerChart(t,e){Bt._charts[t]=e}static registerSeries(t,e){Bt._series[t]=e}static registerComponent(t,e,i){Bt._components[t]={cmp:e,alwaysCheck:i}}static registerMark(t,e){Bt._marks[t]=e}static registerRegion(t,e){Bt._regions[t]=e}static registerTransform(t,e){Bt.transforms[t]=e}static registerLayout(t,e){Bt._layout[t]=e}static registerAnimation(t,e){Bt._animations[t]=e}static registerImplement(t,e){Bt._implements[t]=e}static registerChartPlugin(t,e){Bt._chartPlugin[t]=e}static registerComponentPlugin(t,e){Bt._componentPlugin[t]=e}static createChart(t,e,i){return Bt._charts[t]?new Bt._charts[t](e,i):null}static createChartSpecTransformer(t,e){if(!Bt._charts[t])return null;const i=Bt._charts[t];return new i.transformerConstructor(Object.assign({seriesType:i.seriesType},e))}static createRegion(t,e,i){return Bt._regions[t]?new Bt._regions[t](e,i):null}static createRegionSpecTransformer(t,e){return Bt._regions[t]?new Bt._regions[t].transformerConstructor(e):null}static createSeries(t,e,i){return Bt._series[t]?new Bt._series[t](e,i):null}static createSeriesSpecTransformer(t,e){return Bt._series[t]?new Bt._series[t].transformerConstructor(e):null}static createMark(t,e,i){if(!Bt._marks[t])return null;const n=new Bt._marks[t](e,i);return n.type==="group"&&n.setMarkConfig({interactive:!1}),n}static getComponents(){return Object.values(Bt._components)}static getComponentInKey(t){return Bt._components[t].cmp}static getLayout(){return Object.values(Bt._layout)}static getLayoutInKey(t){return Bt._layout[t]}static getSeries(){return Object.values(Bt._series)}static getSeriesInType(t){return Bt._series[t]}static getRegionInType(t){return Bt._regions[t]}static getAnimationInKey(t){return Bt._animations[t]}static getImplementInKey(t){return Bt._implements[t]}static getSeriesMarkMap(t){return Bt._series[t]?Bt._series[t].mark:{}}static getChartPlugins(){return Object.values(Bt._chartPlugin)}static getComponentPlugins(){return Object.values(Bt._componentPlugin)}static getComponentPluginInType(t){return Bt._componentPlugin[t]}static registerFormatter(t){this._formatter=t}static getFormatter(){return this._formatter}};function Kc(s,...t){return mt(jb(s),...t.map(jb))}function jb(s){var t;if(!s)return s;const e=function(i){return i&&(i=Object.keys(i).reduce((n,r)=>{const a=i[r];return n[r]=vb(a),n},{})),i}(s.colorScheme);return Object.assign({},s,{colorScheme:e,token:(t=s.token)!==null&&t!==void 0?t:{},series:Object.assign({},s.series)})}et._charts={},et._series={},et._components={},et._marks={},et._regions={},et._animations={},et._implements={},et._chartPlugin={},et._componentPlugin={},et.transforms={fields:Jf,filter:(s,t)=>{const{callback:e}=t;return e&&(s=s.filter(e)),s},fold:(s,t)=>{const{fields:e,key:i,value:n,retains:r}=t,a=[];for(let o=0;o<s.length;o++)e.forEach(l=>{const h={};if(h[i]=l,h[n]=s[o][l],r)r.forEach(c=>{h[c]=s[o][c]});else for(const c in s[o])e.indexOf(c)===-1&&(h[c]=s[o][c]);a.push(h)});return a}},et.dataParser={csv:sm,dsv:im,tsv:nm},et._layout={};const rR=["animationThreshold","colorScheme","name","padding"];function qc(s,t,e,i){if(!s)return s;t||(t=s.colorScheme),e||(e=s.token);const n={};return Object.keys(s).forEach(r=>{const a=s[r];rR.includes(r)?n[r]=a:Ji(a)?Bo(a)?n[r]=mb(a,t,i):Fb(a)?n[r]=Db(e,a):n[r]=qc(a,t,e,i):n[r]=a}),n}const Xr={[Xc.name]:Xc},Kr=Xc.name,Ln=new Map(Object.keys(Xr).map(s=>[s,Xr[s]])),mg=new Map(Object.keys(Xr).map(s=>[s,qc(Xr[s])])),Io=new Map(Object.keys(Xr).map(s=>[s,s===Kr])),Zc=(s,t)=>{if(!s)return;const e=Hb(t);Ln.set(s,e),mg.set(s,qc(e)),Io.set(s,!0)},vg=(s=Kr,t=!1)=>(Io.has(s)&&!Io.get(s)&&Zc(s,Ln.get(s)),t?mg.get(s):Ln.get(s)),Nb=s=>Ln.delete(s)&&mg.delete(s)&&Io.delete(s),zb=s=>!!Q(s)&&Ln.has(s),Hb=s=>{var t;const e=(t=s.type)!==null&&t!==void 0?t:Kr;return Kc({},vg(e),s)};class Pi{static registerInstance(t){Pi.instances.set(t.id,t)}static unregisterInstance(t){Pi.instances.delete(t.id)}static getInstance(t){return Pi.instances.get(t)}static instanceExist(t){return Pi.instances.has(t)}static forEach(t,e=[],i){const n=Y(e);return Pi.instances.forEach((r,a,o)=>{n.includes(a)||t(r,a,o)},i)}}Pi.instances=new Map;let Gs=class Zn{static registerTheme(t,e){Zc(t,e)}static getTheme(t,e=!1){return vg(t,e)}static removeTheme(t){return Nb(t)}static themeExist(t){return zb(t)}static getDefaultTheme(){return Zn.themes.get(Kr)}static setCurrentTheme(t){Zn.themeExist(t)&&(Zn._currentThemeName=t,Pi.forEach(e=>e==null?void 0:e.setCurrentTheme(t)))}static getCurrentTheme(t=!1){return Zn.getTheme(Zn._currentThemeName,t)}static getCurrentThemeName(){return Zn._currentThemeName}};function Ys(s,t){return Q(s)?Gs.themeExist(s)?Gs.getTheme(s,t):{}:_t(s)?s:{}}function yg(s,t={data:e=>e}){if(!s)return s;if(s.constructor===Object){const e={};for(const i in s)if(Object.prototype.hasOwnProperty.call(s,i)){if(t[i]){e[i]=t[i](s[i]);continue}e[i]=yg(s[i],t)}return e}return W(s)?s.map(e=>yg(e,t)):s}function _g(s,t){if(!s)return s;if(Ji(s)){const e={};for(const i in s)if(Object.prototype.hasOwnProperty.call(s,i)){if(Q(s[i])&&t.getFunction(s[i])){e[i]=t.getFunction(s[i]);continue}e[i]=_g(s[i],t)}return e}return W(s)?s.map(e=>_g(e,t)):s}Gs.themes=Ln,Gs._currentThemeName=Kr;const aR=\`\${xt}_MEASURE_CANVAS_ID\`,Dn=\`\${xt}_DEFAULT_DATA_INDEX\`,Oo=\`\${xt}_DEFAULT_DATA_KEY\`,$s=\`\${xt}_DEFAULT_DATA_SERIES_FIELD\`,bg=\`\${xt}_DEFAULT_SERIES_STYLE_NAME\`,Vb=\`\${xt}_STACK_KEY\`,Xs=\`\${xt}_STACK_START\`,Xi=\`\${xt}_STACK_END\`,Fn=\`\${xt}_STACK_START_PERCENT\`,Ks=\`\${xt}_STACK_END_PERCENT\`,Jc=\`\${xt}_STACK_START_OffsetSilhouette\`,Qc=\`\${xt}_STACK_END_OffsetSilhouette\`,Wb=\`\${xt}_STACK_TOTAL\`,Ub=\`\${xt}_STACK_TOTAL_PERCENT\`,xg=\`\${xt}_STACK_TOTAL_TOP\`,Sg=\`\${xt}_STACK_TOTAL_BOTTOM\`,oR=\`\${xt}_MOSAIC_VALUE_START_PERCENT\`,lR=\`\${xt}_MOSAIC_VALUE_END_PERCENT\`,hR=\`\${xt}_MOSAIC_CAT_START_PERCENT\`,cR=\`\${xt}_MOSAIC_CAT_END_PERCENT\`,uR=\`\${xt}_SEGMENT_START\`,dR=\`\${xt}_SEGMENT_END\`;function qr(s,t){for(let e=0;e<t.length;e++){const i=t[e],n=pR(s,i.key);n?n.operations=[...new Set(n.operations.concat(i.operations))]:s.push(i)}return s}function pR(s,t){return s.find(e=>e.key===t)}function Gb(s,t){var e;if(!s)return t??null;const i=s.getFields();return i&&i[t]?(e=i[t].alias)!==null&&e!==void 0?e:t:t??null}function Yb(s,t,e){const i=s.getStackSort(),n={};let r=null;return i&&(r={},s.getSeries().forEach(a=>{const o=a.getSeriesField();if(o){const l=a.getRawDataStatisticsByField(o);l.values&&(r[o]||(r[o]={lastIndex:0,sort:{}}),l.values.forEach((h,c)=>{h in r[o].sort||(r[o].sort[h]=r[o].lastIndex,r[o].lastIndex++)}))}})),s.getSeries().forEach(a=>{var o;const l=a.getStackData(),h=a.getStackValue(),c=a.getStackValueField(),u=!e||e(a);l&&c&&u&&(n[h]=(o=n[h])!==null&&o!==void 0?o:{groupField:l.groupField,nodes:{}},qb(a,l,n[h],c,t,r))}),i?$b(n):n}function $b(s,t){var e;for(const i in s)!((e=s[i].sortDatums)===null||e===void 0)&&e.length?(s[i].sortDatums.sort((n,r)=>n.index-r.index),s[i].values=s[i].sortDatums.map(n=>n.datum)):$b(s[i].nodes);return s}function Xb(s,t){if("values"in s&&s.values.length){const e=function(n,r){return n.reduce((a,o)=>{const l=r?+o[r]:+o;return q(l)&&(a+=l),a},0)}(s.values,t),i=function(n,r){const a=[];return n.forEach(o=>{const l=+o[r];q(l)&&a.push(l)}),a.length===0?null:Ge(a)}(s.values,Ks);s.values.forEach(n=>{n[Wb]=e,n[Ub]=i})}else for(const e in s.nodes)Xb(s.nodes[e],t)}function gR(s){if(!s.values.length)return;const t=s.values[s.values.length-1][Xi]/2;for(let e=0;e<s.values.length;e++)s.values[e][Jc]=s.values[e][Xs]-t,s.values[e][Qc]=s.values[e][Xi]-t}function Kb(s,t,e,i,n={key:Vb,start:Xs,end:Xi,startPercent:Fn,endPercent:Ks,max:xg,min:Sg}){const r=i&&R(n.min),a=i&&R(n.max);if(s.values.length>0){let o=0,l=0,h=1,c=0,u=null,d=null;const p=s.values.length;for(let g=0;g<p;g++){const f=s.values[t?p-1-g:g];c=f[n.end],c>=0?(f[n.start]=o,o+=f[n.end],f[n.end]=o):(f[n.start]=l,l+=f[n.end],f[n.end]=l),f[n.key]=s.key,a&&(delete f[n.max],(!d||f[n.end]>d[n.end])&&(d=f)),r&&(delete f[n.min],(!u||f[n.start]<u[n.start])&&(u=f))}if(a&&d&&(d[n.max]=!0),r&&u&&(u[n.min]=!0),e)for(let g=0;g<p;g++){const f=s.values[t?p-1-g:g];c=f[n.end];const m=c>=0?o:l;h=c>=0?1:-1,f[n.startPercent]=m===0?0:Math.min(1,f[n.start]/m)*h,f[n.endPercent]=m===0?0:Math.min(1,f[n.end]/m)*h}}for(const o in s.nodes)Kb(s.nodes[o],t,e,i,n)}function qb(s,t,e,i,n,r,a){var o;if("values"in t)if(n&&t.values.forEach(l=>l[Xi]=function(h){if(q(h))return h;const c=+h;return q(c)?c:0}(l[i])),e.series.push({s,values:t.values}),r){const l=s.getSeriesField();t.values.forEach(h=>{e.sortDatums.push({series:s,datum:h,index:l?r[l].sort[h[l]]:0})})}else e.values.push(...t.values);else for(const l in t.nodes){const h=a?\`\${a}_\${l}\`:l;e.nodes[l]||(e.nodes[l]={values:[],series:[],nodes:{},sortDatums:[],key:h},R((o=t.nodes[l])===null||o===void 0?void 0:o.groupField)&&(e.nodes[l].groupField=t.nodes[l].groupField)),qb(s,t.nodes[l],e.nodes[l],i,n,r,h)}}function qs(s={}){const t=Object.assign({},s);if(U(s.style)?t.style=(e,i,n,r)=>Ht(s.style(e,i,n,r)):ht(s.style)||(t.style=Ht(s.style)),!ht(s.state)){const e={};Object.keys(s.state).forEach(i=>{U(s.state[i])?e[i]=(n,r,a,o)=>Ht(s.state[i](n,r,a,o)):ht(s.state[i])||(e[i]=Ht(s.state[i]))}),t.state=e}return t}function Zr(s){if(ht(s))return null;const t={};return Object.keys(s).forEach(e=>{U(s[e])?t[e]=(i,n,r,a)=>Ht(s[e](i,n,r,a)):ht(s[e])||(t[e]=Ht(s[e]))}),t}function Ht(s){return s!=null&&s.angle&&(s.angle=ei(s.angle)),s}var Zs,Kt,Z,ee,Zb,Ts,Fe,Jb,Qb,tx,ex,Cs,at,Ag,Po;(function(s){s.enter="enter",s.update="update",s.exit="exit",s.group="group",s.connectNulls="connectNulls"})(Zs||(Zs={})),function(s){s.enter="enter",s.update="update",s.exit="exit",s.unChange="unChange"}(Kt||(Kt={})),function(s){s.arc="arc",s.arc3d="arc3d",s.area="area",s.image="image",s.line="line",s.path="path",s.rect="rect",s.rect3d="rect3d",s.rule="rule",s.shape="shape",s.symbol="symbol",s.text="text",s.richtext="richtext",s.polygon="polygon",s.pyramid3d="pyramid3d",s.circle="circle",s.cell="cell",s.interval="interval",s.group="group",s.glyph="glyph",s.component="component",s.largeRects="largeRects",s.largeSymbols="largeSymbols"}(Z||(Z={})),function(s){s.axis="axis",s.grid="grid",s.legend="legend",s.slider="slider",s.label="label",s.datazoom="datazoom",s.player="player",s.title="title",s.scrollbar="scrollbar"}(ee||(ee={})),function(s){s[s.player=1]="player",s[s.rollUp=2]="rollUp",s[s.drillDown=3]="drillDown",s[s.slider=4]="slider",s[s.datazoom=5]="datazoom",s[s.legend=6]="legend",s[s.scrollbar=7]="scrollbar",s[s.brush=8]="brush",s[s.normal=9]="normal"}(Zb||(Zb={})),function(s){s.lineAxis="lineAxis",s.circleAxis="circleAxis"}(Ts||(Ts={})),function(s){s.lineAxisGrid="lineAxisGrid",s.circleAxisGrid="circleAxisGrid"}(Fe||(Fe={})),function(s){s.discreteLegend="discreteLegend",s.colorLegend="colorLegend",s.sizeLegend="sizeLegend"}(Jb||(Jb={})),function(s){s.lineCrosshair="lineCrosshair",s.rectCrosshair="rectCrosshair",s.sectorCrosshair="sectorCrosshair",s.circleCrosshair="circleCrosshair",s.polygonCrosshair="polygonCrosshair",s.ringCrosshair="ringCrosshair"}(Qb||(Qb={})),function(s){s.symbolLabel="symbolLabel",s.rectLabel="rectLabel",s.lineLabel="lineLabel",s.dataLabel="dataLabel"}(tx||(tx={})),function(s){s.continuousPlayer="continuousPlayer",s.discretePlayer="discretePlayer"}(ex||(ex={})),function(s){s.before="before",s.layouting="layouting",s.reevaluate="reevaluate",s.after="after"}(Cs||(Cs={})),function(s){s.BEFORE_EVALUATE_DATA="beforeEvaluateData",s.AFTER_EVALUATE_DATA="afterEvaluateData",s.BEFORE_EVALUATE_SCALE="beforeEvaluateScale",s.AFTER_EVALUATE_SCALE="afterEvaluateScale",s.BEFORE_PARSE_VIEW="beforeParseView",s.AFTER_PARSE_VIEW="afterParseView",s.BEFORE_TRANSFORM="beforeTransform",s.AFTER_TRANSFORM="afterTransform",s.BEFORE_CREATE_VRENDER_STAGE="beforeCreateVRenderStage",s.AFTER_CREATE_VRENDER_STAGE="afterCreateVRenderStage",s.BEFORE_CREATE_VRENDER_LAYER="beforeCreateVRenderLayer",s.AFTER_CREATE_VRENDER_LAYER="afterCreateVRenderLayer",s.BEFORE_STAGE_RESIZE="beforeStageResize",s.AFTER_STAGE_RESIZE="afterStageResize",s.BEFORE_VRENDER_DRAW="beforeVRenderDraw",s.AFTER_VRENDER_DRAW="afterVRenderDraw",s.BEFORE_MARK_JOIN="beforeMarkJoin",s.AFTER_MARK_JOIN="afterMarkJoin",s.BEFORE_MARK_UPDATE="beforeMarkUpdate",s.AFTER_MARK_UPDATE="afterMarkUpdate",s.BEFORE_MARK_STATE="beforeMarkState",s.AFTER_MARK_STATE="afterMarkState",s.BEFORE_MARK_ENCODE="beforeMarkEncode",s.AFTER_MARK_ENCODE="afterMarkEncode",s.BEFORE_DO_LAYOUT="beforeDoLayout",s.AFTER_DO_LAYOUT="afterDoLayout",s.BEFORE_MARK_LAYOUT_END="beforeMarkLayoutEnd",s.AFTER_MARK_LAYOUT_END="afterMarkLayoutEnd",s.BEFORE_DO_RENDER="beforeDoRender",s.AFTER_DO_RENDER="afterDoRender",s.BEFORE_MARK_RENDER_END="beforeMarkRenderEnd",s.AFTER_MARK_RENDER_END="afterMarkRenderEnd",s.BEFORE_CREATE_VRENDER_MARK="beforeCreateVRenderMark",s.AFTER_CREATE_VRENDER_MARK="afterCreateVRenderMark",s.BEFORE_ADD_VRENDER_MARK="beforeAddVRenderMark",s.AFTER_ADD_VRENDER_MARK="afterAddVRenderMark",s.AFTER_VRENDER_NEXT_RENDER="afterVRenderNextRender",s.BEFORE_ELEMENT_UPDATE_DATA="beforeElementUpdateData",s.AFTER_ELEMENT_UPDATE_DATA="afterElementUpdateData",s.BEFORE_ELEMENT_STATE="beforeElementState",s.AFTER_ELEMENT_STATE="afterElementState",s.BEFORE_ELEMENT_ENCODE="beforeElementEncode",s.AFTER_ELEMENT_ENCODE="afterElementEncode",s.ANIMATION_START="animationStart",s.ANIMATION_END="animationEnd",s.ELEMENT_ANIMATION_START="elementAnimationStart",s.ELEMENT_ANIMATION_END="elementAnimationEnd",s.ALL_ANIMATION_START="allAnimationStart",s.ALL_ANIMATION_END="allAnimationEnd"}(at||(at={})),function(s){s.signal="signal",s.data="data",s.scale="scale",s.coordinate="coordinate",s.mark="mark"}(Ag||(Ag={})),function(s){s.active="active",s.selected="selected",s.highlight="highlight",s.blur="blur"}(Po||(Po={}));const Jr="__vgrammar_scene_item__",fR=[Z.line,Z.area],mR=[Z.arc3d,Z.rect3d,Z.pyramid3d],oi="key",tu=[{}],vR=["key"],yR=!0,_R=!0,bR=!1,xR=!0,jn="_mo_hide_";function ix(s,t){return Y(s).reduce((e,i)=>{const n=Q(i)?t.getGrammarById(i):i;return n&&e.push(n),e},[])}function Nn(s,t){if(I(s))return[];if(!U(e=s)&&(e!=null&&e.signal)){const i=s.signal;if(Q(i))return Y(t.getGrammarById(i));if((i==null?void 0:i.grammarType)==="signal")return[i]}else if(function(i){return!U(i)&&!!(i!=null&&i.callback)}(s))return ix(s.dependency,t);var e;return[]}function Qr(s){return U(s)||(s==null?void 0:s.signal)||!!(s!=null&&s.callback)}function li(s,t,e,i){if(I(s))return s;if(U(s))return i?s.call(null,e,i,t):s.call(null,e,t);if(s.signal){const n=s.signal;return Q(n)?t==null?void 0:t[n]:n.output()}return s.callback?i?s.callback.call(null,e,i,t):s.callback.call(null,e,t):s}function eu(s,t){return Lo(s)?s.output():t[s]}const Lo=s=>s&&!I(s.grammarType),Do=s=>U(s)?s:t=>t[s];function kg(s){return!!(s!=null&&s.scale)}function wg(s){return!!(s!=null&&s.field)}function zn(s,t){if(!s)return[];let e=[];return s.scale&&(e=Lo(s.scale)?[s.scale]:Y(t.getScaleById(s.scale))),e.concat(Nn(s,t))}function sx(s,t){switch(t){case"line":return s.some(e=>["x","y","defined"].includes(e));case"area":return s.some(e=>["x","y","x1","y1","defined"].includes(e));case"largeRects":return s.some(e=>["x","y","width","y1"].includes(e));case"largeSymbols":return s.some(e=>["x","y"].includes(e))}return!1}function Js(s,t,e,i,n){e&&(Qr(e)?t.forEach(r=>{const a=li(e,i,r.datum,s);Object.assign(r.nextAttrs,a)}):Object.keys(e).forEach(r=>{var a,o;const l=e[r],h=n&&!function(c,u){if(["x","y","dx","dy"].includes(u))return!0;switch(c){case Z.arc:return["innerRadius","outerRadius","startAngle","endAngle"].includes(u);case Z.group:case Z.rect:case Z.image:return["width","height","y1"].includes(u);case Z.path:case Z.shape:return["path","customPath"].includes(u);case Z.line:return u==="defined";case Z.area:return["x1","y1","defined"].includes(u);case Z.rule:return["x1","y1"].includes(u);case Z.symbol:return u==="size";case Z.polygon:return u==="points";case Z.text:return u==="text"}return!1}(s.mark.markType,r)?[t[0]]:t;if(kg(l)){const c=eu(l.scale,i),u=(a=l==null?void 0:l.offset)!==null&&a!==void 0?a:0,d=!I(l.band)&&c.bandwidth?c.bandwidth()*l.band:null,p=Q(l==null?void 0:l.field),g=p?Qh(l.field):null;let f=p?null:I(l==null?void 0:l.value)?0:(o=c.scale)===null||o===void 0?void 0:o.call(c,l.value);h.forEach(m=>{var v;p&&(f=(v=c.scale)===null||v===void 0?void 0:v.call(c,g(m.datum))),m.nextAttrs[r]=it(f)||it(d)?f+u+d:f})}else if(wg(l)){const c=Qh(l.field);h.forEach(u=>{u.nextAttrs[r]=c(u.datum)})}else h.forEach(c=>{c.nextAttrs[r]=li(l,i,c.datum,s)})}))}function Hn(s,t,e,i){if(!s)return null;if(Qr(s))return li(s,i,t,e);const n={};return Object.keys(s).forEach(r=>{var a,o,l;const h=s[r];if(kg(h)){const c=eu(h.scale,i),u=(a=h==null?void 0:h.offset)!==null&&a!==void 0?a:0,d=!I(h.band)&&c.bandwidth?c.bandwidth()*h.band:null,p=Q(h==null?void 0:h.field),g=p?Qh(h.field):null,f=p?(o=c.scale)===null||o===void 0?void 0:o.call(c,g(t)):I(h==null?void 0:h.value)?0:(l=c.scale)===null||l===void 0?void 0:l.call(c,h.value);n[r]=it(f)||it(d)?f+u+d:f}else if(wg(h)){const c=Qh(h.field);n[r]=c(t)}else n[r]=li(h,i,t,e)}),n}class SR{constructor(t,e,i,n){this.channelEncoder={},this.marks=t,e&&this.registerChannelEncoder(e),i&&this.registerDefaultEncoder(i),this.progressiveChannels&&this.registerProgressiveChannels(n)}getMarks(){return this.marks}registerChannelEncoder(t,e){return Q(t)?this.channelEncoder[t]=e:Object.assign(this.channelEncoder,t),this}registerFunctionEncoder(t){return this.functionEncoder=t,this}registerDefaultEncoder(t){return this.defaultEncoder=t,this}registerProgressiveChannels(t){return this.progressiveChannels=Y(t),this}getChannelEncoder(){return this.channelEncoder}getFunctionEncoder(){return this.functionEncoder}getDefaultEncoder(){return this.defaultEncoder}getProgressiveChannels(){return this.progressiveChannels}}class V{static registerPlotMarks(t,e){V._plotMarks[t]=e}static createPlotMark(t,e){return V._plotMarks[t]?new V._plotMarks[t](e):null}static registerMark(t,e){V._marks[t]=e}static createMark(t,e,i){return V._marks[t]?new V._marks[t](e,t,i):null}static hasMark(t){return!!V._marks[t]}static getMark(t){return V._marks[t]}static registerComponent(t,e){V._components[t]=e}static createComponent(t,e,i,n){const r=V._components[t];return r?new r(e,i,n):null}static hasComponent(t){return!!V._components[t]}static registerGraphicComponent(t,e){V._graphicComponents[t]=e}static createGraphicComponent(t,e,i){const n=V._graphicComponents[t];return n?n(e,i):null}static registerTransform(t,e,i){V._transforms[t]=Object.assign(e,{type:t,isBuiltIn:!!i})}static getTransform(t){return V._transforms[t]}static unregisterRuntimeTransforms(){Object.keys(V._transforms).forEach(t=>{V._transforms[t]&&!V._transforms[t].isBuiltIn&&(V._transforms[t]=null)})}static registerGrammar(t,e,i){V._grammars[t]={grammarClass:e,specKey:i??t}}static createGrammar(t,e,i){var n;const r=(n=V._grammars[t])===null||n===void 0?void 0:n.grammarClass;return r?new r(e,i):null}static getGrammars(){return this._grammars}static getGlyph(t){return V._glyphs[t]}static createInteraction(t,e,i){const n=V._interactions[t];return n?new n(e,i):null}static hasInteraction(t){return!!V._interactions[t]}}V._plotMarks={},V._marks={},V._components={},V._graphicComponents={},V._transforms={},V._grammars={},V._glyphs={},V._animations={},V._interactions={},V._graphics={},V._stageEventPlugins={},V.registerGlyph=(s,t,e,i,n)=>(V._glyphs[s]=new SR(t,e,i,n),V._glyphs[s]),V.registerAnimationType=(s,t)=>{V._animations[s]=t},V.getAnimationType=s=>V._animations[s],V.registerInteraction=(s,t)=>{V._interactions[s]=t},V.registerGraphic=(s,t)=>{V._graphics[s]=t},V.getGraphicType=s=>V._graphics[s],V.createGraphic=(s,t)=>{const e=V._graphics[s];return e?e(t):null},V.registerDefaultLayout=s=>{V.defaultLayout=s},V.getDefaultLayout=()=>V.defaultLayout,V.registerStageEventPlugin=(s,t)=>{V._stageEventPlugins[s]=t},V.getStageEventPlugin=s=>V._stageEventPlugins[s];function Fo(s,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var i;const n=V.getGraphicType(t)?V.createGraphic(t,e):V.createGraphicComponent(t,e,{skipDefault:(i=s==null?void 0:s.spec)===null||i===void 0?void 0:i.skipTheme});return n||Tt.getInstance().error(\`create \${t} graphic failed!\`),n}const iu=s=>{s&&(s[Jr]=null,s.release(),s.parent&&s.parent.removeChild(s))},nx=["fillOpacity"],rx=(s,t,e)=>{var i;return t==="fillOpacity"?(s.fillOpacity=(i=e.fillOpacity)!==null&&i!==void 0?i:1,["fillOpacity"]):[]},Tg={rect3d:[{channels:["x","y","z","x1","y1","width","height","length"],transform:(s,t,e)=>{var i,n,r,a,o,l,h,c,u,d,p,g;q(t.width)||!q(t.x1)&&q(e.width)?(s.x=Math.min((i=e.x)!==null&&i!==void 0?i:0,(n=e.x1)!==null&&n!==void 0?n:1/0),s.width=e.width):q(t.x1)||!q(t.width)&&q(e.x1)?(s.x=Math.min(e.x,e.x1),s.width=Math.abs(e.x1-e.x)):(s.x=Math.min((r=e.x)!==null&&r!==void 0?r:0,(a=e.x1)!==null&&a!==void 0?a:1/0),s.width=e.width),q(t.height)||!q(t.y1)&&q(e.height)?(s.y=Math.min((o=e.y)!==null&&o!==void 0?o:0,(l=e.y1)!==null&&l!==void 0?l:1/0),s.height=e.height):q(t.y1)||!q(t.height)&&q(e.y1)?(s.y=Math.min(e.y,e.y1),s.height=Math.abs(e.y1-e.y)):(s.y=Math.min((h=e.y)!==null&&h!==void 0?h:0,(c=e.y1)!==null&&c!==void 0?c:1/0),s.height=e.height),q(t.length)||!q(t.z1)&&q(e.length)?(s.z=Math.min((u=e.z)!==null&&u!==void 0?u:0,(d=e.z1)!==null&&d!==void 0?d:1/0),s.length=e.length):q(t.z1)||!q(t.length)&&q(e.z1)?(s.z=Math.min(e.z,e.z1),s.length=Math.abs(e.z1-e.z)):(s.z=Math.min((p=e.z)!==null&&p!==void 0?p:0,(g=e.z1)!==null&&g!==void 0?g:1/0),s.length=e.length)},storedAttrs:"sizeAttrs"}],[Z.text]:[{channels:["text","limit","autoLimit","maxLineWidth","textType","_originText"],transform:(s,t,e)=>{var i,n,r,a;const o=(i=e.limit)!==null&&i!==void 0?i:1/0,l=(n=e.autoLimit)!==null&&n!==void 0?n:1/0,h=Math.min(o,l),c=Ji(e.text)&&!I(e.text.text),u=c?e.text.text:e.text;s.maxLineWidth=h===1/0?e.maxLineWidth:h,c||e.textType?e.text.type==="rich"||e.textType==="rich"?s.textConfig=u:e.text.type==="html"?(s.html=u,s.text=(r=e._originText)!==null&&r!==void 0?r:"",s.renderable=!1):e.text.type==="react"?(s.react=u,s.text=(a=e._originText)!==null&&a!==void 0?a:"",s.renderable=!1):s.text=u:s.text=u},storedAttrs:"limitAttrs"}],[Z.rule]:[{channels:["x","y","x1","y1"],transform:(s,t,e)=>{const i=function(n){const{x:r,y:a,x1:o,y1:l}=n;return q(r)&&q(a)&&q(o)&&q(l)?[{x:r,y:a},{x:o,y:l}]:[]}(e);s.points=i,s.x=0,s.y=0},storedAttrs:"pointAttrs"}],[Z.symbol]:[{channels:["shape","symbolType"],transform:(s,t,e)=>{var i;s.symbolType=(i=t.shape)!==null&&i!==void 0?i:t.symbolType}},{channels:["image","fill","background"],transform:(s,t,e)=>{t.image?(s.background=t.image,s.fill=!1):e.image?(s.background=e.image,s.fill=!1):(s.fill=e.fill,s.background=e.background)},storedAttrs:"imageAttrs"}]},ax=(s,t,e,i)=>{const n={},r=t?Object.keys(t):[],a=Q(s)?Tg[s]:s;if(a&&a.length){const o=[];r.forEach(l=>{let h=!1;a.forEach((c,u)=>{if(c.channels.includes(l)){if(!o[u])if(c.storedAttrs){const d=function(p,g,f,m,v,y){const _=v.getGraphicAttribute(p,!1,y);if(_)return g.forEach(x=>{x in m&&(_[x]=m[x])}),_;const b={};return g.forEach(x=>{b[x]=m[x]}),f[p]=b,b}(c.storedAttrs,c.channels,n,t,e,i);c.transform(n,t,d)}else c.transform(n,t,null);o[u]=!0,h=!0}}),h||(nx.includes(l)?rx(n,l,t):n[l]=t[l])})}else r.forEach(o=>{nx.includes(o)?rx(n,o,t):n[o]=t[o]});return n},AR=(s,t,e)=>!(!I(s)||!I(t))||!I(s)&&!I(t)&&(e==="lineDash"?((i,n)=>i.length===n.length&&i.join("-")===n.join("-"))(s,t):e==="stroke"||e==="fill"?((i,n)=>{if(i===n)return!0;if(typeof i!=typeof n||Q(i)||i.gradient!==n.gradient)return!1;const r=Object.keys(i),a=Object.keys(n);return r.length===a.length&&r.every(o=>o==="stops"?((l,h)=>{var c,u;if(l===h)return!0;const d=(c=l&&l.length)!==null&&c!==void 0?c:0;return d===((u=h&&h.length)!==null&&u!==void 0?u:0)&&d!==0&&l.every((p,g)=>!p&&!h[g]||p&&h[g]&&p.color===h[g].color&&p.offset===h[g].offset)})(i[o],n[o]):i[o]===n[o])})(s,t):s===t),ox=["stroke","strokeOpacity","lineDash","lineDashOffset","lineCap","lineJoin","lineWidth","miterLimit"],kR=["fill","fillOpacity","background","texture","texturePadding","textureSize","textureColor"].concat(ox);function Cg(s,t,e){var i;if(!s||s.length<=1)return null;const n=((i=e==null?void 0:e.mark)===null||i===void 0?void 0:i.markType)==="area"?kR:ox,r=[];let a=null;return s.forEach((o,l)=>{a&&n.every(h=>AR(a[h],o[h],h))||(r.length&&(r[r.length-1].endIndex=l),a=o,r.push({attrs:a,startIndex:l}))}),r.length>=2?r.map(o=>{const l=Mg(o.attrs);return l.points=t.slice(o.startIndex,I(o.endIndex)?t.length:o.endIndex),l}):null}function Mg(s){const t={};if(!s)return t;const e=["x","y","x1","y1","defined","size","width","height","context"];return Object.keys(s).forEach(i=>{e.includes(i)||(t[i]=s[i])}),t}class wR{constructor(t){this.data=null,this.states=[],this.diffState=Kt.enter,this.isReserved=!1,this.runtimeStatesEncoder=null,this.items=[],this.getStateAttrs=(e,i)=>{var n,r,a,o;const l=!I((n=this.runtimeStatesEncoder)===null||n===void 0?void 0:n[e]),h=l?Object.assign(Object.assign({},(r=this.mark.getSpec().encode)===null||r===void 0?void 0:r[e]),this.runtimeStatesEncoder[e]):(a=this.mark.getSpec().encode)===null||a===void 0?void 0:a[e];if(!h)return{};if(U(h))return h(this.getDatum(),this,e,i);if(!l&&(!((o=this.graphicItem.states)===null||o===void 0)&&o[e]))return this.graphicItem.states[e];const c=this.items.map(d=>Object.assign({},d,{nextAttrs:{}}));Js(this,c,h,this.mark.parameters());const u=this.transformElementItems(c,this.mark.markType);return this.graphicItem.states?this.graphicItem.states[e]||(this.graphicItem.states[e]=u):this.graphicItem.states={[e]:u},u},this.mark=t}initGraphicItem(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.graphicItem)return;const e=this.mark.getAttributeTransforms();if(this.graphicItem=this.mark.addGraphicItem(e?ax(e,t,this):t,this.groupKey),!this.graphicItem)return;const{graphicName:i}=this.mark.getSpec();Q(i)?this.graphicItem.name=i:U(i)&&(this.graphicItem.name=i(this)),this.graphicItem[Jr]=this,e&&(this.graphicItem.onBeforeAttributeUpdate=n=>this.mark?ax(e,n,this):n),this.clearGraphicAttributes(),this.mark.needAnimate()&&(this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(Object.assign({},t)),this.setFinalGraphicAttributes(Object.assign({},t)))}updateGraphicItem(){var t;if(!this.graphicItem)return;this.diffState===Kt.exit?this.graphicItem.releaseStatus="willRelease":this.graphicItem.releaseStatus=void 0;const e=(t=this.mark.animate)===null||t===void 0?void 0:t.getAnimationConfigs("state");e&&e.length!==0&&(this.graphicItem.stateAnimateConfig=e[0].originConfig)}getGraphicItem(){return this.graphicItem}removeGraphicItem(){var t,e;this.graphicItem&&((e=(t=this.graphicItem.animates)===null||t===void 0?void 0:t.forEach)===null||e===void 0||e.call(t,i=>i.stop())),this.graphicItem&&(iu(this.graphicItem),this.graphicItem[Jr]=null,this.graphicItem=null)}resetGraphicItem(){this.graphicItem&&(this.graphicItem=null)}getBounds(){var t;return(t=this.graphicItem)===null||t===void 0?void 0:t.AABBBounds}getStates(){return this.states}updateData(t,e,i){var n;this.mark.emit(at.BEFORE_ELEMENT_UPDATE_DATA,{groupKey:t,data:e,key:i},this),this.data=e;const r=Do(i);return this.items=e.map(a=>({datum:a,key:r(a),view:this.mark.view,nextAttrs:{}})),this.groupKey=t,this.key=this.mark.isCollectionMark()?t:(n=this.items)===null||n===void 0?void 0:n[0].key,this.mark.emit(at.AFTER_ELEMENT_UPDATE_DATA,{groupKey:t,data:e,key:i},this),this.items}state(t,e){var i;const n=this.mark.isCollectionMark(),r=this.states,a=Y(li(t,e,this.getDatum(),this)),o=(i=this.mark.getSpec())===null||i===void 0?void 0:i.stateSort;o&&a.length&&a.sort(o);const l=a.length!==r.length||a.some((h,c)=>h!==r[c]);this.states=a,!n&&l&&this.diffState===Kt.unChange&&(this.diffState=Kt.update)}encodeGraphic(t){this.coordinateTransformEncode(this.items);const e=this.transformElementItems(this.items,this.mark.markType);t&&Object.assign(e,t),this.graphicItem?(this.graphicItem.clearStates(),this.graphicItem.states={},this.graphicItem.stateProxy=null,jn in this.graphicItem.attribute&&"visible"in e&&delete this.graphicItem.attribute[jn],this.applyGraphicAttributes(e)):this.initGraphicItem(e),this.diffState!==Kt.enter&&this.diffState!==Kt.update||!this.states.length||this.useStates(this.states),this.mark.markType===Z.shape&&(this.graphicItem.datum=this.items[0].datum),this.items.forEach(i=>{i.nextAttrs={}}),this._setCustomizedShape()}_setCustomizedShape(){var t;if(!this.graphicItem)return;const e=(t=this.mark.getSpec())===null||t===void 0?void 0:t.setCustomizedShape;e&&(this.graphicItem.pathProxy=i=>e(this.data,i,new me))}encodeItems(t,e){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],n=arguments.length>3?arguments[3]:void 0;const r=this.mark.isCollectionMark(),a=e[Zs.update],o=e[Zs.enter],l=e[Zs.exit],h=this.mark.isLargeMode()||r&&!this.mark.getSpec().enableSegments;this.diffState===Kt.enter?(o&&Js(this,t,o,n,h),a&&Js(this,t,a,n,h)):this.diffState===Kt.update?((r&&o||i)&&Js(this,t,o,n,h),a&&Js(this,t,a,n,h)):this.diffState===Kt.exit&&l&&(i&&Js(this,t,o,n,h),Js(this,t,l,n,h))}coordinateTransformEncode(t){if(!this.mark.coord||this.mark.markType==="arc"||this.mark.disableCoordinateTransform===!0)return;const e=this.mark.coord.output();t.forEach(i=>{const n=i.nextAttrs,r=e.convert(n);Object.assign(n,r)})}hasStateAnimation(){var t;const e=(t=this.mark.animate)===null||t===void 0?void 0:t.getAnimationConfigs("state");return e&&e.length>0}clearStates(t){const e=pe(t)?t:this.hasStateAnimation();this.states=[],this.graphicItem&&this.graphicItem.clearStates(e),this.runtimeStatesEncoder&&(this.runtimeStatesEncoder={})}_updateRuntimeStates(t,e){this.runtimeStatesEncoder||(this.runtimeStatesEncoder={}),this.runtimeStatesEncoder[t]=e}hasState(t){return this.states&&t&&this.states.includes(t)}updateStates(t){if(!this.graphicItem)return!1;let e=this.states.slice();const i=this.mark.getSpec().encode;let n=!1,r=!1;return Object.keys(t).forEach(a=>{var o;if(!a)return;const l=t[a];if(_t(l)&&!Xt(l,(o=this.runtimeStatesEncoder)===null||o===void 0?void 0:o[a]))e.includes(a)?n=!0:e.push(a),this._updateRuntimeStates(a,l),r=!0;else if(l)!e.includes(a)&&(i!=null&&i[a])&&(e.push(a),r=!0);else if(e.length){const h=e.filter(c=>c!==a);h.length!==e.length&&(r=!0,e=h),this.runtimeStatesEncoder&&this.runtimeStatesEncoder[a]&&(this.runtimeStatesEncoder[a]=null)}}),n&&this.graphicItem.clearStates(),!!r&&(this.useStates(e),!0)}addState(t,e){var i;if(!this.graphicItem)return!1;if(e&&Q(t)&&!Xt(e,(i=this.runtimeStatesEncoder)===null||i===void 0?void 0:i[t])){const a=this.states.slice();return a.includes(t)?this.graphicItem.clearStates():a.push(t),this._updateRuntimeStates(t,e),this.useStates(a),!0}const n=this.mark.getSpec().encode,r=Y(t).reduce((a,o)=>(o&&!a.includes(o)&&(n!=null&&n[o])&&a.push(o),a),this.states.slice());return r.length!==this.states.length&&(this.useStates(r),!0)}removeState(t){if(!this.graphicItem)return!1;const e=Y(t);if(!e.length)return!1;const i=this.states.filter(n=>!e.includes(n));return i.length!==this.states.length&&(this.runtimeStatesEncoder&&e.forEach(n=>{this.runtimeStatesEncoder[n]=null}),this.useStates(i),!0)}useStates(t,e){var i;if(!this.graphicItem)return!1;this.mark.emit(at.BEFORE_ELEMENT_STATE,{states:t},this);const n=(i=this.mark.getSpec())===null||i===void 0?void 0:i.stateSort;n&&t.sort(n),this.states=t;const r=pe(e)?e:this.hasStateAnimation();return this.graphicItem.stateProxy=this.getStateAttrs,this.graphicItem.useStates(this.states,r),this.mark.emit(at.AFTER_ELEMENT_STATE,{states:t},this),!0}diffAttributes(t){const e={},i=this.getFinalGraphicAttributes();for(const n in t)_a(i,n)&&Xt(i[n],t[n])||(e[n]=t[n]);return e}transformElementItems(t,e,i){var n,r,a,o,l;const h=t[0];if(!h.nextAttrs||Object.keys(h.nextAttrs).length===0)return{};let c=h.nextAttrs;if(function(u){return[Z.line,Z.area,Z.largeRects,Z.largeSymbols].includes(u)}(e)&&t&&t.length&&I((n=h.nextAttrs)===null||n===void 0?void 0:n.points)&&(i===!0||sx(Object.keys(h.nextAttrs),this.mark.markType))){const u=this.mark.getSpec(),d=this.getGraphicAttribute("points",!1),p=this.getGraphicAttribute("segments",!1),g=u.enableSegments,f=(r=this.mark.getSpec().encode)===null||r===void 0?void 0:r[Zs.connectNulls],m=t.map(y=>y.nextAttrs),v=this.mark.isProgressive();if(c=Mg(c),e===Z.line||e===Z.area){const y=function(_,b,x,S){return _&&_.length&&(_.length!==1||b)?_.some(A=>sx(Object.keys(A.nextAttrs),"line"))?_.map((A,w)=>{var k;const T=A.nextAttrs,{x:C,y:M,x1:B,y1:O,defined:E}=(k=x==null?void 0:x[w])!==null&&k!==void 0?k:{};return I(T.x)&&(T.x=C),I(T.y)&&(T.y=M),I(T.defined)&&E===!1&&(T.defined=!1),T.context=A.key,S&&(I(T.x1)&&(T.x1=B),I(T.y1)&&(T.y1=O)),T}):x??[]:[]}(t,!0,d,e===Z.area);if(v)c.segments=((l=(o=(a=this.graphicItem)===null||a===void 0?void 0:a.attribute)===null||o===void 0?void 0:o.segments)!==null&&l!==void 0?l:[]).concat([{points:y}]);else if(f){if(c.segments=function(_,b,x){if(!_||_.length<=1)return null;const S=!!x&&x.mark.getSpec().enableSegments;let A,w,k=[],T=null;if(_.forEach((C,M)=>{T=b[M],T&&T.defined!==!1?(A||(w={items:[],points:[]},k.push(w)),w.points.push(T),w.items.push(C),A===!1&&(w.isConnect=!0,w={items:[],points:[]},k.push(w)),A=!0):A=!1}),k=k.filter(C=>C.points.length>0),k.length>=2){const C=[];return k.forEach(M=>{if(M.isConnect)return void C.push({points:M.points,isConnect:!0});if(S){const O=Cg(M.items,M.points,x);if(O)return void O.forEach(E=>{C.push(E)})}const B=Mg(M.items[0]);B.points=M.points,C.push(B)}),C}return S?Cg(_,b,x):null}(m,y,this),c.segments&&c.segments.some(_=>_.isConnect)){const _=Hn(f,this.getDatum(),this,this.mark.parameters());_&&c.segments.forEach(b=>{b.isConnect&&Object.assign(b,_)})}c.points=y}else if(g){const _=y&&y.length!==0?y:function(x){return x?x.reduce((S,A)=>S.concat(A.points),[]):null}(p),b=Cg(m,_,this);b?(c.segments=b,c.points=null):(c.segments=null,c.points=_),c=function(x,S){var A;if(!x||!x.segments||!x.segments.length)return x;const w=((A=S==null?void 0:S.mark)===null||A===void 0?void 0:A.markType)==="area"?["fillOpacity","strokeOpacity"]:["strokeOpacity"],k={};return Object.keys(x).forEach(T=>{w.includes(T)||(k[T]=x[T])}),k}(c,this)}else c.points=y,c.segments=null}else e===Z.largeRects?c.points=function(y,_){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(!y||!y.length||y.length===1&&!_)return[];const x=new Float32Array(4*y.length);return y.forEach((S,A)=>{var w,k,T,C;const M=S.nextAttrs,B=(w=M.x)!==null&&w!==void 0?w:b[4*A],O=(k=M.y)!==null&&k!==void 0?k:b[4*A+1],E=(T=M.width)!==null&&T!==void 0?T:b[4*A+2],L=(C=M.y1)!==null&&C!==void 0?C:b[4*A+3];x[4*A]=B,x[4*A+1]=O,x[4*A+2]=E,x[4*A+3]=L-O}),x}(t,!0,d):e===Z.largeSymbols&&(c.points=function(y,_){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(!y||!y.length||y.length===1&&!_)return[];const x=new Float32Array(2*y.length);return y.forEach((S,A)=>{var w,k;const T=S.nextAttrs,C=(w=T.x)!==null&&w!==void 0?w:b[2*A],M=(k=T.y)!==null&&k!==void 0?k:b[2*A+1];x[2*A]=C,x[2*A+1]=M}),x}(t,!0,d))}return c}applyGraphicAttributes(t){var e,i,n;if(!ht(t))if(this.mark.needAnimate()){const r=this.diffAttributes(t),a=(e=this.getPrevGraphicAttributes())!==null&&e!==void 0?e:{},o=(i=this.getFinalGraphicAttributes())!==null&&i!==void 0?i:{};Object.keys(r).forEach(u=>{a[u]=this.getGraphicAttribute(u),o[u]=r[u]}),this.setNextGraphicAttributes(r),this.setPrevGraphicAttributes(a),this.setFinalGraphicAttributes(o);const l=(n=this.mark.animate)===null||n===void 0?void 0:n.getElementAnimators(this).filter(u=>{var d;return!(!((d=u.animationOptions.timeline.controlOptions)===null||d===void 0)&&d.ignoreLoopFinalAttributes)||!u.animationOptions.timeline.loop}),h=(l||[]).reduce((u,d)=>Object.assign(u,d.getEndAttributes()),{}),c=Object.assign({},h,o);this.graphicItem.setAttributes(c)}else this.graphicItem.setAttributes(t)}getGraphicAttribute(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];var i;if(!this.graphicItem)return;if(e){let a;const o=this.getPrevGraphicAttributes();if(!I(a=vt(o,t)))return a}const n=this.mark.getAttributeTransforms();let r=[t];if(n&&n.length){const a=n.find(o=>o.storedAttrs&&o.channels.includes(t));a&&(r=[a.storedAttrs,t])}return vt((i=this.graphicItem)===null||i===void 0?void 0:i.attribute,r)}setGraphicAttribute(t,e){let i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(!this.graphicItem)return;const n=this.getFinalGraphicAttributes(),r=this.getPrevGraphicAttributes();i&&n&&(n[t]=e),r&&!_a(r,t)&&(r[t]=this.graphicItem.attribute[t]),this.graphicItem.setAttribute(t,e)}setGraphicAttributes(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this.graphicItem)return;const i=this.getFinalGraphicAttributes(),n=this.getPrevGraphicAttributes();Object.keys(t).forEach(r=>{i&&e&&(i[r]=t[r]),n&&!_a(n,r)&&(n[r]=this.graphicItem.attribute[r])}),this.graphicItem.setAttributes(t)}getFinalGraphicAttributes(){return this.graphicItem.finalAttrs}setFinalGraphicAttributes(t){this.graphicItem.finalAttrs=t}getPrevGraphicAttributes(){return this.graphicItem.prevAttrs}setPrevGraphicAttributes(t){this.graphicItem.prevAttrs=t}getNextGraphicAttributes(){return this.graphicItem.nextAttrs}getFinalAnimationAttribute(t){var e,i;return(i=(e=this.getFinalGraphicAttributes())===null||e===void 0?void 0:e[t])!==null&&i!==void 0?i:this.getGraphicAttribute(t)}getFinalAnimationAttributes(){var t;return(t=this.getFinalGraphicAttributes())!==null&&t!==void 0?t:this.graphicItem.attribute}setNextGraphicAttributes(t){this.graphicItem.nextAttrs=t}clearChangedGraphicAttributes(){this.graphicItem&&(this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(null))}clearGraphicAttributes(){this.graphicItem&&(this.graphicItem.prevAttrs&&this.setPrevGraphicAttributes(null),this.graphicItem.nextAttrs&&this.setNextGraphicAttributes(null),this.graphicItem.finalAttrs&&this.setFinalGraphicAttributes(null))}remove(){this.graphicItem&&(iu(this.graphicItem),this.graphicItem=null)}release(){this.removeGraphicItem(),this.mark=null,this.data=null,this.items=null}getItemAttribute(t){var e,i;if(!((e=this.items)===null||e===void 0)&&e.length)return this.mark.isCollectionMark()?I(t)?this.items.map(n=>n.nextAttrs):this.items.map(n=>{var r;return(r=n.nextAttrs)===null||r===void 0?void 0:r[t]}):I(t)?this.items[0].nextAttrs:(i=this.items[0].nextAttrs)===null||i===void 0?void 0:i[t]}setItemAttributes(t){var e;!((e=this.items)===null||e===void 0)&&e.length&&(this.mark.isCollectionMark()?W(t)&&this.items.forEach((i,n)=>{Object.assign(i.nextAttrs,t[n])}):Object.assign(this.items[0].nextAttrs,t))}getItem(){var t,e;return this.mark&&this.mark.isCollectionMark()?(t=this.items)!==null&&t!==void 0?t:[]:(e=this.items)===null||e===void 0?void 0:e[0]}getDatum(){var t,e;return this.mark&&this.mark.isCollectionMark()?(t=this.data)!==null&&t!==void 0?t:[]:(e=this.data)===null||e===void 0?void 0:e[0]}}class lx{constructor(t,e){this.references=new Map,this.view=t,this.depend(e==null?void 0:e.dependency)}getStartState(){return null}depend(t){this.references.clear(),Y(t).map(e=>Q(e)?this.view.getGrammarById(e):e).filter(e=>!I(e)).forEach(e=>{var i;this.references.set(e,((i=this.references.get(e))!==null&&i!==void 0?i:0)+1)})}parameters(){const t={};return this.references.forEach((e,i)=>{R(i.id())&&(t[i.id()]=i.output())}),t}bind(){const t=this.getEvents();(t??[]).forEach(e=>{e.type&&e.handler&&(W(e.type)?e.type.forEach(i=>{i&&i!=="none"&&this.view.addEventListener(i,e.handler)}):e.type!=="none"&&this.view.addEventListener(e.type,e.handler))})}unbind(){const t=this.getEvents();(t??[]).forEach(e=>{e.type&&e.handler&&(W(e.type)?e.type.forEach(i=>{i&&i!=="none"&&this.view.removeEventListener(i,e.handler)}):e.type!=="none"&&this.view.removeEventListener(e.type,e.handler))})}start(t){}reset(t){}dispatchEvent(t,e){this.view.emit(\`\${this.type}:\${t}\`,e),t==="start"&&this.options.onStart?this.options.onStart(e):t==="reset"&&this.options.onReset?this.options.onReset(e):t==="update"&&this.options.onUpdate?this.options.onUpdate(e):t==="end"&&this.options.onEnd&&this.options.onEnd(e)}}const hx=(s,t)=>{if(!t||!s)return null;const e={};return s.forEach(i=>{const n=i&&i.getSpec(),r=n&&n.encode;r&&t.forEach(a=>{a&&r[a]&&(e[a]||(e[a]=[]),e[a].push(i))})}),e};class Qs extends lx{constructor(t,e){super(t,e),this.type=Qs.type,this._resetType=[],this.resetAll=()=>{const{state:i,reverseState:n}=this.options;this._statedElements&&this._statedElements.length&&(this.clearAllStates(i,n),this.dispatchEvent("reset",{elements:this._statedElements,options:this.options}),this._statedElements=[])},this.handleStart=i=>{this.start(i.element)},this.handleReset=i=>{if(!this._statedElements||!this._statedElements.length)return;const n=i.element,r=n&&this._marks&&this._marks.includes(n.mark);(this._resetType.includes("view")&&!r||this._resetType.includes("self")&&r)&&this.resetAll()},this.options=Object.assign({},Qs.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector),this._stateMarks=hx(this._marks,[this.options.state,this.options.reverseState])}getStartState(){return this.options.state}getEvents(){const t=this.options.triggerOff,e=this.options.trigger,i=[{type:e,handler:this.handleStart}],{eventNames:n,resetType:r}=(a=>{const o=Y(a),l=[],h=[];return o.forEach(c=>{c==="empty"?l.push("view"):Q(c)&&c!=="none"?c.includes("view:")?(h.push(c.replace("view:","")),l.push("view")):(h.push(c),l.push("self")):it(c)&&l.push("timeout")}),{eventNames:h,resetType:l}})(t);return n.forEach(a=>{a&&(W(e)?!e.includes(a):a!==e)&&i.push({type:a,handler:this.handleReset})}),this._resetType=r,i}start(t){const{state:e,reverseState:i,isMultiple:n}=this.options;if(t&&this._marks&&this._marks.includes(t.mark))if(t.hasState(e)){if(this._resetType.includes("self")){const r=this._statedElements&&this._statedElements.filter(a=>a!==t);r&&r.length?this._statedElements=this.updateStates(r,this._statedElements,e,i):this.resetAll()}}else this._timer&&clearTimeout(this._timer),t.addState(e),this._statedElements=this.updateStates(n&&this._statedElements?[...this._statedElements,t]:[t],this._statedElements,e,i),this.dispatchEvent("start",{elements:this._statedElements,options:this.options}),this._resetType.includes("timeout")&&(this._timer=setTimeout(()=>{this.resetAll()},this.options.triggerOff));else this._resetType.includes("view")&&this._statedElements&&this._statedElements.length&&this.resetAll()}reset(t){t?this._marks&&this._marks.includes(t.mark)&&t.removeState([this.options.state,this.options.reverseState]):this.resetAll()}}Qs.type="element-select",Qs.defaultOptions={state:Po.selected,trigger:"click"};class tn extends lx{constructor(t,e){super(t,e),this.type=tn.type,this.handleStart=i=>{this.start(i.element)},this.handleReset=i=>{if(!this._statedElements||!this._statedElements.length)return;const n=i.element;if(n){const r=this._marks&&this._marks.includes(n.mark);this._resetType!=="view"||r?this._resetType==="self"&&r&&this.resetAll():this.resetAll()}},this.options=Object.assign({},tn.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector),this._stateMarks=hx(this._marks,[this.options.highlightState,this.options.blurState])}getStartState(){return this.options.highlightState}getEvents(){const t=this.options.triggerOff,e=[{type:this.options.trigger,handler:this.handleStart}];let i=t;return Q(t)&&t.includes("view:")?(i=t.replace("view:",""),this._resetType="view"):this._resetType="self",e.push({type:i,handler:this.handleReset}),e}resetAll(){const{highlightState:t,blurState:e}=this.options;this._lastElement&&(this.clearAllStates(t,e),this.dispatchEvent("reset",{elements:[this._lastElement],options:this.options}),this._lastElement=null,this._statedElements=null)}start(t){if(t&&this._marks&&this._marks.includes(t.mark)){const{highlightState:e,blurState:i}=this.options;if(this._lastElement===t)return;this._statedElements=this.updateStates([t],this._statedElements,e,i),this._lastElement=t,this.dispatchEvent("start",{elements:[t],options:this.options})}else this._lastElement&&this._resetType==="view"&&this.resetAll()}reset(t){t?this._marks&&this._marks.includes(t.mark)&&t.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}tn.type="element-highlight",tn.defaultOptions={highlightState:Po.highlight,blurState:Po.blur,trigger:"pointerover",triggerOff:"pointerout"};class cx{updateStates(t,e,i,n){return t&&t.length?(i&&n?e&&e.length?(this.toggleReverseStateOfElements(t,e,n),this.toggleStateOfElements(t,e,i)):this.addBothStateOfElements(t,i,n):i&&(e&&e.length?this.toggleStateOfElements(t,e,i):this.addStateOfElements(t,i)),t):null}toggleReverseStateOfElements(t,e,i){e.forEach(n=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(n.mark)&&n.addState(i)}),t.forEach(n=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(n.mark)&&n.removeState(i)})}toggleStateOfElements(t,e,i){e.forEach(n=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(n.mark)&&n.removeState(i)}),t.forEach(n=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(n.mark)&&n.addState(i)})}addBothStateOfElements(t,e,i){this._marks.forEach(n=>{var r;const a=i&&this._stateMarks[i]&&this._stateMarks[i].includes(n),o=e&&this._stateMarks[e]&&this._stateMarks[e].includes(n);(a||o)&&((r=n.elements)===null||r===void 0||r.forEach(l=>{t&&t.includes(l)?o&&l.addState(e):a&&l.addState(i)}))})}addStateOfElements(t,e){this._marks.forEach(i=>{var n;const r=e&&this._stateMarks[e]&&this._stateMarks[e].includes(i);r&&((n=i.elements)===null||n===void 0||n.forEach(a=>{t&&t.includes(a)&&r&&a.addState(e)}))})}clearAllStates(t,e){this._statedElements&&this._statedElements.length&&this._marks.forEach(i=>{i&&i.elements&&(e&&this._stateMarks[e]&&this._stateMarks[e].includes(i)&&i.elements.forEach(n=>{n.removeState(e)}),t&&this._stateMarks[t]&&this._stateMarks[t].includes(i)&&i.elements.forEach(n=>{this._statedElements.includes(n)&&n.removeState(t)}))})}}const ux=()=>{Ue(Qs,cx),V.registerInteraction(Qs.type,Qs)},dx=()=>{Ue(tn,cx),V.registerInteraction(tn.type,tn)},px=(s,t)=>Lo(s)?s.output():s&&_t(s)?U(s.callback)?e=>s.callback(e,t):U(s.value)?s.value(t):s:s,TR=(s,t)=>s&&(_t(s)?Object.keys(s).reduce((e,i)=>{const n=s[i];return e[i]=px(n,t),e},{}):s.map(e=>px(e,t)));let CR=-1;class Eg extends Ps{constructor(t){super(),this.spec={},this.references=new Map,this.targets=[],this.transforms=[],this.view=t,this.uid=++CR}parse(t){return this.id(t.id),this.name(t.name),this.depend(t.dependency),this}depend(t){var e;if(!((e=this.spec)===null||e===void 0)&&e.dependency){const n=Y(this.spec.dependency).map(r=>Q(r)?this.view.getGrammarById(r):r);this.detach(n)}this.spec.dependency=t;const i=Y(t).map(n=>Q(n)?this.view.getGrammarById(n):n);return this.attach(i),this.commit(),this}addEventListener(t,e,i){let n=e;return i&&i.trap===!1||(n=e,n.raw=e),i&&i.target&&(n.target=i.target),this.on(t,n),this}removeEventListener(t,e){return e?this.off(t,e):this.off(t),this}emit(t){for(var e,i,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(i=(e=this.view)===null||e===void 0?void 0:e.emit)===null||i===void 0||i.call(e,t,...r),super.emit(t,...r)}emitGrammarEvent(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return super.emit(t,...i)}evaluateTransform(t,e,i){if(!t||!t.length)return e;let n=e,r=0;const a=t.length;for(;r<a;){const o=t[r];this.emit(at.BEFORE_TRANSFORM,o.type),n=o.transform(o.isRawOptions?o.options:TR(o.options,i),n,i,this.view),r++,this.emit(at.AFTER_TRANSFORM,o.type)}return n}set(t){return!1}id(t){return arguments.length?(this.view.grammars.unrecord(this),this._id=t,this.view.grammars.record(this),this):this._id}name(t){return arguments.length?(this._name=t,this):this._name}attach(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Y(t).filter(i=>!I(i)).forEach(i=>{var n;I(t)||(i.targets.includes(this)||i.targets.push(this),this.references.set(i,((n=this.references.get(i))!==null&&n!==void 0?n:0)+e))}),this}detach(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Y(t).filter(i=>!I(i)).forEach(i=>{const n=this.references.get(i)-e;n>0?this.references.set(i,n-1):(this.references.delete(i),i.targets.includes(this)&&(i.targets=i.targets.filter(r=>r!==this)))}),this}detachAll(){this.references.forEach((t,e)=>{this.detach(e,t)})}link(t){this.grammarSource=t}run(){var t;const e=(t=this.grammarSource)===null||t===void 0?void 0:t.output(),i=this.parameters();return this.evaluate(e,i)}commit(){this.view.commit(this)}parameters(){const t={};return this.references.forEach((e,i)=>{R(i.id())&&(t[i.id()]=i.output())}),t}getSpec(){return this.spec}reuse(t){return this}clear(){this.spec=null,this.view=null}release(){this.clear()}setFunctionSpec(t,e){return I(this.spec[e])||this.detach(Nn(this.spec[e],this.view)),this.spec[e]=t,this.attach(Nn(t,this.view)),this.commit(),this}}const gx=(s,t,e)=>{var i,n;if(s==="callback"&&U(t))return{references:[],value:{callback:t,dependency:[]}};if(!I(t.data)){const r=e.getDataById(t.data);return{references:[r],value:r}}if(!I(t.customized)){const r=e.getCustomizedById(t.customized);return{references:[r],value:r}}if(!I(t.scale)){const r=e.getScaleById(t.scale);return{references:[r],value:r}}if((n=t)&&(n.signal||n.callback)){const r=Nn(t,e);return{references:r,value:t.callback?{value:t.callback,dependency:r}:(i=r==null?void 0:r[0])!==null&&i!==void 0?i:t}}return{value:t}},MR=(s,t)=>{const e=V.getTransform(s.type);if(!e)return;const i={};let n=[];return Object.keys(s).forEach(r=>{var a;if(r==="type")return;const o=s[r];if(r==="dependency")return void((o==null?void 0:o.length)&&(n=n.concat(ix(o,t))));const l=((h,c,u)=>{if(I(c))return{value:c};if(W(c)){const d=c.map(p=>gx(h,p,u));return{references:d.reduce((p,g)=>(g.references&&p.concat(g.references),p),[]),value:d.map(p=>p.value)}}return gx(h,c,u)})(r,o,t);l&&(!((a=l.references)===null||a===void 0)&&a.length&&(n=n.concat(l.references)),i[r]=l.value)}),{markPhase:e.markPhase,transform:e.transform,canProgressive:e.canProgressive,type:e.type,options:i,references:n}},su=(s,t)=>{if(s!=null&&s.length){const e=[];let i=[];return s.forEach(n=>{var r;const a=MR(n,t);a&&(!((r=a.references)===null||r===void 0)&&r.length&&(i=i.concat(a.references)),e.push(a))}),{transforms:e,refs:i}}return null},fx={csv:sm,dsv:im,tsv:nm,json:function(s){if(!Q(s))return Y(s);try{return Y(JSON.parse(s))}catch{return[]}}};class ER extends Eg{constructor(t,e,i){super(t),this.grammarType="data",this.spec={},this._dataIDKey=\`VGRAMMAR_DATA_ID_KEY_\${this.uid}\`,this._loadTasks=[],this._postFilters=[],this.ingest=n=>{const r=function(a,o){if(I(a))return a;if(U(a))return a.call(null,o);if(a.signal){const l=a.signal;return Q(l)?o==null?void 0:o[l]:l.output()}return a.callback?a.callback.call(null,o):a}(n.format,this.parameters());return this._input=((a,o)=>{if(!o||!fx[o.type])return Y(a);const l=o.type==="dsv"?{delimiter:o.delimiter}:{};return fx[o.type](a,l,new _e(new Tl))})(n.values,r),this._input},this.load=n=>{if(n.values)return this.ingest(n)},this.relay=n=>n[0],this._loadTasks=[],I(e)||this.values(e,i)}parse(t){return super.parse(t),this._isLoaded=!1,this.source(t.source,t.format,!1),this.url(t.url,t.format,!1),this.values(t.values,t.format,!1),this.transform(t.transform),this.parseLoad(t),this.commit(),this}parseDataSource(t){const e=[],i=[],n=t.format?Nn(t.format,this.view)[0]:null;if(n&&e.push(n),t.values){const r=Nn(t.values,this.view)[0];r&&e.push(r),i.push({type:"ingest",transform:this.ingest,isRawOptions:!0,options:{values:t.values,format:t.format}})}else if(t.url){const r=Nn(t.url,this.view)[0];r&&e.push(r),i.push({type:"load",transform:this.load,options:{url:r??t.url,format:n??t.format}})}else if(t.source){const r=[];Y(t.source).forEach(a=>{const o=Lo(a)?a:this.view.getDataById(a);o&&(e.push(o),r.push(o))}),r.length&&(i.push({type:"relay",transform:this.relay,options:r}),this.grammarSource=r[0])}return{transforms:i,refs:e}}evaluate(t,e){this.view.emit(at.BEFORE_EVALUATE_DATA);const i=this._isLoaded?this.transforms:this._loadTasks.concat(this.transforms);this.grammarSource&&(this._input=t);const n=this.evaluateTransform(i,this._input,e),r=this._evaluateFilter(n,e);return this.setValues(r),this._isLoaded=!0,this.view.emit(at.AFTER_EVALUATE_DATA),this}output(){return this._values}getDataIDKey(){return this._dataIDKey}values(t,e){let i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];const n=Object.assign({},this.spec,{values:t,format:e});return I(t)||(n.url=void 0,n.source=void 0),i?this.parseLoad(n):this}url(t,e){let i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];const n=Object.assign({},this.spec,{url:t,format:e});return I(t)||(n.values=void 0,n.source=void 0),i?this.parseLoad(n):this}source(t,e){let i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];const n=Object.assign({},this.spec,{source:t,format:e});return I(t)||(n.values=void 0,n.url=void 0),i?this.parseLoad(n):this}parseLoad(t){this.detach(this.parseDataSource(this.spec).refs),this.spec=t;const e=this.parseDataSource(this.spec);return this.attach(e.refs),this._loadTasks=e.transforms,this._isLoaded=!1,this.commit(),this}setValues(t){this._values=Y(t).map((e,i)=>{const n=e===Object(e)?e:{data:e};return n[this._dataIDKey]=i,n})}field(t){return this._values.map(e=>e[t])}transform(t){const e=su(this.spec.transform,this.view);e&&(this.detach(e.refs),this.transforms=[]),this.spec.transform=t;const i=su(this.spec.transform,this.view);return i&&(this.attach(i.refs),this.transforms=i.transforms),this.commit(),this}getValue(){return this._values}getInput(){return this._input}addDataFilter(t){return this._postFilters=this._postFilters.concat(Y(t)),this._postFilters.sort((e,i)=>{var n,r;return((n=e.rank)!==null&&n!==void 0?n:0)-((r=i.rank)!==null&&r!==void 0?r:0)}),this}removeDataFilter(t){const e=Y(t);return this._postFilters=this._postFilters.filter(i=>!e.includes(i)),this}_evaluateFilter(t,e){return this._postFilters.reduce((i,n)=>n.filter(i,e),t)}reuse(t){return t.grammarType!==this.grammarType||(this._isLoaded=!1,this._values=t.output()),this}clear(){super.clear(),this._input=null,this._values=null}}function nu(s,t,e,i){let n,r;const a=s[t];for(;t>e&&(r=Math.floor((t-1)/2),n=s[r],a&&n&&i(a,n)<0);)s[t]=n,t=r;return s[t]=a}function Bg(s,t,e,i){const n=t,r=s.length,a=s[t];let o,l=2*t+1;for(;l<r;)o=l+1,o<r&&i(s[l],s[o])>=0&&(l=o),s[t]=s[l],l=2*(t=l)+1;return s[t]=a,nu(s,t,n,i)}class BR{constructor(t){this.compare=t,this.nodes=[]}size(){return this.nodes.length}last(){return this.nodes[0]}validate(){for(let t=this.nodes.length-1;t>0;t-=1){const e=Math.floor((t-1)/2);if(this.compare(this.nodes[e],this.nodes[t])>0)return!1}return!0}push(t){if(this.nodes.includes(t)){const e=this.nodes.indexOf(t);return nu(this.nodes,e,0,this.compare),Bg(this.nodes,e,null,this.compare)}return this.nodes.push(t),nu(this.nodes,this.nodes.length-1,0,this.compare)}remove(t){if(this.nodes.includes(t)){const e=this.nodes.indexOf(t);this.nodes=this.nodes.slice(0,e).concat(this.nodes.slice(e+1)),nu(this.nodes,e,0,this.compare),Bg(this.nodes,e,null,this.compare)}}pop(){const t=this.nodes.pop();let e;return this.nodes.length?(e=this.nodes[0],this.nodes[0]=t,Bg(this.nodes,0,null,this.compare)):e=t,e}clear(){this.nodes=[]}}class mx{constructor(t){this.list=[],this.ids={},this.idFunc=t||PC}add(t){const e=this.idFunc(t);return this.ids[e]||(this.ids[e]=1,this.list.push(t)),this}remove(t){const e=this.idFunc(t);return this.ids[e]&&(this.ids[e]=0,this.list=this.list.filter(i=>i!==t)),this}forEach(t,e){e?this.list.slice().reverse().forEach(t):this.list.forEach(t)}filter(t){return this.list.filter(t)}get length(){return this.list.length}getElementByIndex(t){return this.list[t]}}class RR{constructor(){this.grammars=[],this.logger=Tt.getInstance(),this._curRank=0,this._committed=new mx(t=>t.uid),this._heap=new BR((t,e)=>(t==null?void 0:t.qrank)-(e==null?void 0:e.qrank)),this._beforeRunner=null,this._afterRunner=null,this._updateCounter=0,this._finishFirstRender=!1}add(t){if(t)return this._setRankOfGrammar(t),this.commit(t),!this.grammars.includes(t)&&(this.grammars.push(t),!0)}remove(t){t&&(this._committed.remove(t),this._heap.remove(t),this.grammars=this.grammars.filter(e=>e!==t))}_setRankOfGrammar(t){t&&(t.rank=++this._curRank)}_reRank(t){const e=[t];for(;e.length;){const i=e.pop();this._setRankOfGrammar(i);const n=i.targets;n&&n.forEach(r=>{e.push(r),r===t&&this.logger.error("Cycle detected in dataflow graph.")})}}_enqueue(t){t&&(t.qrank=t.rank,this._heap.push(t))}_logGrammarRunInfo(t){if(this.logger.canLogError()){const e=[{key:"id",value:t.id()},{key:"name",value:t.name()}].reduce((i,n,r)=>I(n.value)?i:\`\${i}\${r?" , ":""}\${n.key}: \${n.value}\`,"");this.logger.debug("Run Operator: ",t,e)}}hasCommitted(){return!!this._committed.length}commit(t){return this._committed.add(t),this}_beforeEvaluate(){this.grammars.forEach(t=>{t.targets.some(e=>(e==null?void 0:e.rank)<(t==null?void 0:t.rank))&&this._reRank(t)}),this._committed.forEach(t=>this._enqueue(t)),this._committed=new mx(t=>t.uid)}_enqueueTargets(t){t.targets&&t.targets.length&&this._finishFirstRender&&t.targets.forEach(e=>this._enqueue(e))}evaluate(){if(this._beforeRunner&&this._beforeRunner(this),!this._committed.length)return this.logger.info("Dataflow invoked, but nothing to do."),!1;this._updateCounter+=1;let t,e,i=0;for(this.logger.canLogInfo()&&(e=Date.now(),this.logger.debug(\`-- START PROPAGATION (\${this._updateCounter}) -----\`)),this._beforeEvaluate();this._heap.size()>0;)t=this._heap.pop(),t&&(t.rank===t.qrank?(t.run(),this._logGrammarRunInfo(t),this._enqueueTargets(t),i+=1):this._enqueue(t));return this.logger.canLogInfo()&&(e=Date.now()-e,this.logger.info(\`> \${i} grammars updated; \${e} ms\`)),this._afterRunner&&this._afterRunner(this),this._finishFirstRender=!0,!0}runBefore(t){this._beforeRunner=t}runAfter(t){this._afterRunner=t}release(){this._heap&&(this._heap.clear(),this._heap=null),this.logger=null,this._committed=null}}const Rg=(s,t,e,i,n)=>{const r=a=>{if(n||!a||i&&!i(a)||e.call(null,a),a.markType===Z.group){const o=a[t];o&&o.forEach(l=>{r(l)})}n&&(!a||i&&!i(a)||e.call(null,a))};r(s)};class IR{constructor(t){this.handleAfterNextRender=()=>{this._stage&&!this._viewOptions.disableDirtyBounds&&this._stage.enableDirtyBounds(),this._view.emit(at.AFTER_VRENDER_DRAW),this._view.emit(at.AFTER_VRENDER_NEXT_RENDER)},this._view=t}initialize(t,e,i,n){return this._width=t,this._height=e,this._viewOptions=i,this._eventConfig=n,this.initStage(),this}stage(){var t;return(t=this._stage)!==null&&t!==void 0?t:null}gestureController(){var t;return(t=this._gestureController)!==null&&t!==void 0?t:null}canvas(){return this._stage?this._stage.window.getNativeHandler().nativeCanvas:null}context(){return this._stage?this._stage.window.getContext().nativeContext:null}combineIncrementalLayers(){return this._stage&&function(t){return _w(this,void 0,void 0,function*(){const e=[],i=t.getChildren();yield new Promise(n=>{H.global.getRequestAnimationFrame()(()=>{n(null)})}),i.forEach(n=>{n.subLayers.size&&n.subLayers.forEach(r=>{r.drawContribution&&r.drawContribution.hooks&&r.drawContribution.rendering&&e.push(new Promise(a=>{r.drawContribution.hooks.completeDraw.tap("outWait",()=>{r.drawContribution.hooks.completeDraw.taps=r.drawContribution.hooks.completeDraw.taps.filter(o=>o.name!=="outWait"),a(null)})}))})}),yield Promise.all(e)})}(this._stage).then(()=>{this._stage&&this._stage.defaultLayer.combineSubLayer()}),this}background(t){if(this._stage)return this._stage.background=t,this}setDpr(t,e){var i,n;return(n=(i=this._stage)===null||i===void 0?void 0:i.setDpr)===null||n===void 0||n.call(i,t),e&&this.renderNextFrame(),this}shouldResize(t,e){return t!==this._width||e!==this._height}resize(t,e){return this._view.emit(at.BEFORE_STAGE_RESIZE),this.shouldResize(t,e)&&(this._width=t,this._height=e,this._stage&&this._stage.resize(t,e)),this._view.emit(at.AFTER_STAGE_RESIZE),this}setViewBox(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return this._stage?(!t||this._viewBox&&t.x1===this._viewBox.x1&&t.x2===this._viewBox.x2&&t.y1===this._viewBox.y1&&t.y2===this._viewBox.y2||(this._viewBox=t,this._stage.setViewBox(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1,e)),this):this}render(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return this._view.emit(at.BEFORE_VRENDER_DRAW),this.initStage(),this._stage.disableDirtyBounds(),this._stage.afterNextRender(this.handleAfterNextRender),t&&(this._stage.render(),this._view.emit(at.AFTER_VRENDER_DRAW)),this}renderNextFrame(){return this.initStage(),this._stage.renderNextFrame(),this}toCanvas(){return this._stage?this._stage.toCanvas():null}preventRender(t){this._stage&&this._stage.preventRender(t)}release(){var t;this._view.traverseMarkTree(e=>{e.release()}),this._dragController&&this._dragController.release(),this._gestureController&&this._gestureController.release(),this._stage!==((t=this._viewOptions)===null||t===void 0?void 0:t.stage)&&this._stage.release(),this._stage=null,this._layer=null,this._dragController=null,this._gestureController=null}createStage(){var t,e,i,n,r;this._view.emit(at.BEFORE_CREATE_VRENDER_STAGE);const a=this._viewOptions,o=(t=a.stage)!==null&&t!==void 0?t:(l={width:this._width,height:this._height,renderStyle:a.renderStyle,viewBox:a.viewBox,dpr:a.dpr,canvas:a.renderCanvas,canvasControled:a.canvasControled,container:a.container,title:a.rendererTitle,beforeRender:a.beforeRender,afterRender:a.afterRender,disableDirtyBounds:!0,autoRender:!0,pluginList:a.pluginList,enableHtmlAttribute:a.enableHtmlAttribute,optimize:a.optimize,ticker:a.ticker,supportsTouchEvents:a.supportsTouchEvents,supportsPointerEvents:a.supportsPointerEvents,event:{clickInterval:this._eventConfig.clickInterval,autoPreventDefault:!!this._eventConfig.autoPreventDefault},ReactDOM:a.ReactDOM,autoRefresh:a.autoRefresh},new dC(l));var l;!((e=a.options3d)===null||e===void 0)&&e.enable&&o.set3dOptions(a.options3d),o.enableIncrementalAutoRender(),this._viewBox=a.viewBox,this._view.emit(at.AFTER_CREATE_VRENDER_STAGE),this._view.emit(at.BEFORE_CREATE_VRENDER_LAYER);const h=(i=a.layer)!==null&&i!==void 0?i:o.defaultLayer;if(this._view.emit(at.AFTER_CREATE_VRENDER_LAYER),!((n=this._eventConfig)===null||n===void 0)&&n.drag&&V.getStageEventPlugin("drag")&&(this._dragController=new(V.getStageEventPlugin("drag"))(o)),((r=this._eventConfig)===null||r===void 0?void 0:r.gesture)&&V.getStageEventPlugin("gesture")){const c=_t(this._eventConfig.gesture)?this._eventConfig.gesture:{};this._gestureController=new(V.getStageEventPlugin("gesture"))(o,c)}return{stage:o,layer:h}}initStage(){if(!this._stage){const{stage:t,layer:e}=this.createStage();this._stage=t,this._layer=e;const i=this._view.background();this.background(i)}}}const OR="window",ru="view",en="width",sn="height",jo="viewWidth",No="viewHeight",Ki="padding",Ig="viewBox",zo="autoFit";function vx(s,t,e,i){var n,r;let a=(n=t.target)===null||n===void 0?void 0:n[Jr];if(!a&&i===ru){let o=t.target;const l=(r=s.rootMark)===null||r===void 0?void 0:r.graphicItem;for(;o!=null&&o.parent&&o.parent!==l;)if(o=o.parent,o[Jr]){a=o[Jr];break}}return t.element=a,t}class PR extends Eg{constructor(){super(...arguments),this.grammarType="signal",this.spec={value:null,update:null}}parse(t){return super.parse(t),this.value(t.value),this.update(t.update),this.commit(),this}evaluate(t,e){return this._signal=this.spec.update?li(this.spec.update,e,this._signal):this.spec.value,this.spec.value=this._signal,this}output(){return this._signal}getValue(){return this.output()}set(t){if(W(t)&&W(this.value)&&t.length===this.value.length){for(let e=0;e<t.length;e++)if(this.value[e]!==t[e])return this._signal=t,this.spec.value=t,!0;return!1}return this._signal!==t&&(this._signal=t,this.spec.value=t,!0)}update(t){return I(t)||this.value(void 0),this.setFunctionSpec(t,"update")}value(t){return I(t)||this.update(void 0),this.spec.value=t,this.commit(),this}reuse(t){return t.grammarType!==this.grammarType||(this._signal=t.output()),this}clear(){super.clear(),this._signal=null}}let LR=-1;const yx=[en,sn,Ki,jo,No,Ig,zo],ta=s=>{var t,e,i,n;return it(s)?{top:s,bottom:s,left:s,right:s}:{top:(t=s==null?void 0:s.top)!==null&&t!==void 0?t:0,bottom:(e=s==null?void 0:s.bottom)!==null&&e!==void 0?e:0,left:(i=s==null?void 0:s.left)!==null&&i!==void 0?i:0,right:(n=s==null?void 0:s.right)!==null&&n!==void 0?n:0}};function nn(s,t,e){const i=new Map;if(!s||s.length===0)return{keys:[],data:i};if(!t)return i.set(oi,e?s.slice().sort(e):s.slice()),{keys:vR,data:i};const n=Do(t);if(s.length===1){const a=n(s[0]);return i.set(a,[s[0]]),{keys:[a],data:i}}const r=new Set;return s.forEach(a=>{var o;const l=n(a),h=(o=i.get(l))!==null&&o!==void 0?o:[];h.push(a),i.set(l,h),r.add(l)}),e&&r.forEach(a=>{i.get(a).sort(e)}),{keys:Array.from(r),data:i}}class _x{constructor(t,e,i){this.prevData=t!=null&&t.length?nn(t,e??null,i):null}setCurrentData(t){this.currentData=t}getCurrentData(){return this.currentData}doDiff(){if(this.callback)if(this.currentData&&this.prevData){const t=new Map(this.prevData.data);this.currentData.keys.forEach(e=>{this.callback(e,this.currentData.data.get(e),t.get(e)),t.delete(e)}),this.prevData.keys.forEach(e=>{t.has(e)&&this.callback(e,null,t.get(e))})}else this.currentData?this.currentData.keys.forEach(t=>{this.callback(t,this.currentData.data.get(t),null)}):this.prevData&&this.prevData.keys.forEach(t=>{this.callback(t,null,this.prevData.data.get(t))})}setCallback(t){this.callback=t}updateToCurrent(){this.prevData=this.currentData,this.currentData=null}reset(){this.prevData=null}}class au extends Eg{constructor(t,e,i){super(t),this.grammarType="mark",this.elements=[],this.elementMap=new Map,this.isUpdated=!0,this._isReentered=!1,this.differ=new _x([]),this.markType=e,this.spec.type=e,this.spec.encode={update:{}},this.spec.group=i,i&&(this.group=i,this.attach(i),i.appendChild(this))}parse(t){var e,i,n;if(super.parse(t),this.spec.group){const a=Q(this.spec.group)?this.view.getMarkById(this.spec.group):this.spec.group;this.detach(a)}const r=Q(t.group)?this.view.getMarkById(t.group):t.group;return this.attach(r),this.join((e=t.from)===null||e===void 0?void 0:e.data,t.key,t.sort,t.groupBy,t.groupSort),this.coordinate(t.coordinate),this.state(t.state,this.spec.stateSort),Object.keys((i=this.spec.encode)!==null&&i!==void 0?i:{}).forEach(a=>{this.encodeState(a,{},!0)}),Object.keys((n=t.encode)!==null&&n!==void 0?n:{}).forEach(a=>{this.encodeState(a,t.encode[a])}),this.animation(t.animation),this.animationState(t.animationState),this.morph(t.morph,t.morphKey,t.morphElementKey),this.layout(t.layout),this.configure(t),this.transform(t.transform),this.parseAddition(t),this.spec=t,this.markType=t.type,this.commit(),this}parameters(){var t;return(t=this._finalParameters)!==null&&t!==void 0?t:super.parameters()}parseAddition(t){return this}reuse(t){var e;if(t.grammarType!==this.grammarType)return this;const i=t;return this.markType=i.markType,this.coord=i.coord,this.elementMap=i.elementMap,this.elements=i.elements,this.elementMap.forEach(n=>n.mark=this),this.differ=i.differ,(e=this.reuseAnimate)===null||e===void 0||e.call(this,i),this._context=i._context,this.graphicItem=i.graphicItem,this.graphicIndex=i.graphicIndex,this.graphicParent=i.graphicParent,this.needClear=i.needClear,this.isUpdated=i.isUpdated,this}needLayout(){return!I(this.spec.layout)}handleLayoutEnd(){}handleRenderEnd(){this.needClear&&(this.cleanExitElements(),this.elementMap.forEach(t=>{t.diffState===Kt.exit?t.clearGraphicAttributes():t.clearChangedGraphicAttributes()}),this.differ.updateToCurrent(),this.needClear=!1)}evaluateMainTasks(t,e){var i,n;if(this.needSkipBeforeLayout()&&this.view.getLayoutState()===Cs.before)return this;const r=(i=this.view.renderer)===null||i===void 0?void 0:i.stage();this.init(r,e);const a=this.evaluateTransform(this._getTransformsBeforeJoin(),t??tu,e),o=a==null?void 0:a.progressive;if(o?this.renderContext={large:!1}:(this.evaluateGroup(a),this.renderContext=this.parseRenderContext(a,e)),(n=this.renderContext)===null||n===void 0?void 0:n.progressive)this.differ.reset(),this.elementMap.clear(),this.evaluateProgressive();else{let l=null;if(o){if(this.renderContext.parameters=e,this.renderContext.beforeTransformProgressive=a.progressive,l=a.progressive.output(),a.progressive.canAnimate&&a.progressive.unfinished())return this.update(this.spec),this}else l=a;this.emit(at.BEFORE_MARK_JOIN),this.evaluateJoin(l),this.emit(at.AFTER_MARK_JOIN),this.emit(at.BEFORE_MARK_STATE),this.evaluateState(this.elements,this.spec.state,e),this.emit(at.AFTER_MARK_STATE),this.emit(at.BEFORE_MARK_ENCODE),this.evaluateEncode(this.elements,this._getEncoders(),e),this.emit(at.AFTER_MARK_ENCODE)}return this.update(this.spec),this}evaluateGroup(t){if(this.markType===Z.group)return;const e=nn(t??tu,this.spec.groupBy,this.spec.groupSort);this._groupEncodeResult=null,this._groupedData=e}_getTransformsAfterEncodeItems(){return this.transforms&&this.transforms.filter(t=>t.markPhase==="afterEncodeItems")}_getTransformsAfterEncode(){return this.transforms&&this.transforms.filter(t=>I(t.markPhase)||t.markPhase==="afterEncode")}_getTransformsBeforeJoin(){return this.transforms?this.transforms.filter(t=>t.markPhase==="beforeJoin"):[]}evaluate(t,e){var i;return this.evaluateMainTasks(t,e),!((i=this.renderContext)===null||i===void 0)&&i.progressive||this.evaluateTransform(this._getTransformsAfterEncode(),this.elements,e),this}output(){return this}join(t,e,i,n,r){return this.grammarSource&&(this.detach(this.grammarSource),this.grammarSource=null),this.spec.from=null,I(t)||(Q(t)?this.grammarSource=this.view.getDataById(t):this.grammarSource=t,this.spec.from={data:t},this.attach(this.grammarSource)),this.spec.key=e,this.spec.sort=i,this.spec.groupBy=n,this.spec.groupSort=r,this.commit(),this}coordinate(t){return Q(t)?this.coord=this.view.getCoordinateById(t):this.coord=t,this.attach(this.coord),this.commit(),this}state(t,e){return this.spec.stateSort=e,this.setFunctionSpec(t,"state")}encode(t,e,i){return this.encodeState(Kt.update,t,e,i)}encodeState(t,e,i,n){if(t===Kt.enter&&(this._isReentered=!0),this.spec.encode[t]){const r=this.spec.encode[t];if(Qr(r))this.detach(zn(r,this.view));else{const a=Q(e);a&&n||!a&&i?(Object.keys(r).forEach(o=>{this.detach(zn(r[o],this.view))}),this.spec.encode[t]={}):a?this.detach(zn(r[e],this.view)):Object.keys(e).forEach(o=>{this.detach(zn(r[o],this.view))})}}return e&&(this.spec.encode[t]||(this.spec.encode[t]={}),Q(e)?(this.spec.encode[t][e]=i,this.attach(zn(i,this.view))):Qr(e)?(this.spec.encode[t]=e,this.attach(zn(e,this.view))):e&&(Object.assign(this.spec.encode[t],e),Object.values(e).forEach(r=>{this.attach(zn(r,this.view))}))),this.commit(),this}_getEncoders(){var t;return(t=this.spec.encode)!==null&&t!==void 0?t:{}}animation(t){return this.spec.animation=t,this}animationState(t){return this.setFunctionSpec(t,"animationState")}layout(t){return this.spec.layout=t,this.commit(),this}morph(t,e,i){return this.spec.morph=t,this.spec.morphKey=e,this.spec.morphElementKey=i,this}transform(t){const e=su(this.spec.transform,this.view);e&&(this.detach(e.refs),this.transforms=[]);const i=su(t,this.view);return i&&(this.attach(i.refs),this.transforms=i.transforms),this.spec.transform=t,this.commit(),this}configure(t){const e=["clip","clipPath","zIndex","interactive","context","setCustomizedShape","large","largeThreshold","progressiveStep","progressiveThreshold","support3d","morph","morphKey","morphElementKey","attributeTransforms","skipTheme","enableSegments","stateSort","graphicName","overflow"];return t===null?(e.forEach(i=>{I(this.spec[i])||(this.spec[i]=void 0)}),this):(e.forEach(i=>{I(t[i])||(this.spec[i]=t[i])}),this)}context(t){return this.spec.context=t,this._context=t,this}isCollectionMark(){return fR.includes(this.markType)}needAnimate(){var t;return!(!((t=this.renderContext)===null||t===void 0)&&t.progressive)&&!I(this.spec.animation)}getAllElements(){const t=this.elements.slice();return this.elementMap.forEach(e=>{e.diffState!==Kt.exit||t.includes(e)||t.push(e)}),this.spec.sort&&t.sort((e,i)=>this.spec.sort(e.getDatum(),i.getDatum())),t}getScales(){const t={};return this.references.forEach((e,i)=>{i.grammarType===Ag.scale&&(t[i.id()]=i.output())}),t}getScalesByChannel(){const t=this.spec.encode;if(!t)return{};const e={},i=this.parameters();return Object.keys(t).forEach(n=>{const r=t[n];r&&!Qr(r)&&Object.keys(r).forEach(a=>{kg(r[a])&&(e[a]=eu(r[a].scale,i))})}),e}getFieldsByChannel(){const t=this.spec.encode;if(!t)return{};const e={};return Object.keys(t).forEach(i=>{const n=t[i];Qr(n)||Object.keys(n).forEach(r=>{wg(n[r])&&(e[r]=n[r].field)})}),e}init(t,e){var i,n,r,a,o;if(this._delegateEvent||(this._delegateEvent=(c,u)=>{const d=vx(this.view,c,0,ru),p=c.element;(p==null?void 0:p.mark)===this&&this.emitGrammarEvent(u,d,p)},this.initEvent()),(i=this.initAnimate)===null||i===void 0||i.call(this,this.spec),!this.group){const c=eu(this.spec.group,e);this.group=c,c&&c.appendChild(this)}const l=this.group?this.group.getGroupGraphicItem():t.defaultLayer,h=(a=(r=(n=this.group)===null||n===void 0?void 0:n.children)===null||r===void 0?void 0:r.indexOf(this))!==null&&a!==void 0?a:0;if(this.markType!==Z.group){if(!this.graphicItem){const c=Fo(this,Z.group,{pickable:!1,zIndex:(o=this.spec.zIndex)!==null&&o!==void 0?o:0,overflow:this.spec.overflow});(this.spec.support3d||mR.includes(this.markType))&&c.setMode("3d"),c.name=\`\${this.id()||this.markType}\`,this.graphicItem=c}this.graphicParent=this.graphicItem,!l||this.graphicIndex===h&&this.graphicItem.parent===l||l.insertIntoKeepIdx(this.graphicItem,h)}else this.graphicParent=l,this.graphicParent.setAttributes({overflow:this.spec.overflow});this.graphicIndex=h}update(t){var e;if(this.emit(at.BEFORE_MARK_UPDATE),this._context=this.spec.context,this.isUpdated=!0,this.renderContext.progressive||(e=this.updateAnimate)===null||e===void 0||e.call(this,t),this.markType!==Z.group){if(I(t.zIndex)||this.graphicItem.setAttribute("zIndex",t.zIndex),I(t.clip)||this.graphicItem.setAttribute("clip",t.clip),!I(t.clipPath)){const i=W(t.clipPath)?t.clipPath:t.clipPath(this.elements);i&&i.length?this.graphicItem.setAttribute("path",i):this.graphicItem.setAttributes({path:i,clip:!1})}I(t.overflow)||this.graphicItem.setAttribute("overflow",t.overflow),this.elementMap.forEach(i=>{i.updateGraphicItem()})}else this.elementMap.forEach(i=>{i.updateGraphicItem()});this.emit(at.AFTER_MARK_UPDATE)}createElement(){return new wR(this)}evaluateJoin(t){var e,i,n,r;this.needClear=!0;const a=Do((n=(e=this.spec.key)!==null&&e!==void 0?e:(i=this.grammarSource)===null||i===void 0?void 0:i.getDataIDKey())!==null&&n!==void 0?n:()=>oi),o=Do((r=this.spec.groupBy)!==null&&r!==void 0?r:()=>oi),l=this.spec.sort,h=this.isCollectionMark(),c=new Set(this.elements.filter(p=>p.diffState===Kt.enter)),u=[];this.differ.setCallback((p,g,f)=>{var m;const v=p;let y;if(I(g))y=this.elementMap.get(v),y&&(y.diffState=Kt.exit);else if(I(f)){if(y=this.elementMap.has(v)?this.elementMap.get(v):this.createElement(),y.diffState===Kt.exit){y.diffState=Kt.enter;const b=(m=this.animate)===null||m===void 0?void 0:m.getElementAnimators(y,Kt.exit);b&&b.forEach(x=>x.stop("start"))}y.diffState=Kt.enter;const _=h?p:o(g[0]);y.updateData(_,g,a),this.elementMap.set(v,y),u.push(y)}else if(y=this.elementMap.get(v),y){y.diffState=Kt.update;const _=h?p:o(g[0]);y.updateData(_,g,a),u.push(y)}c.delete(y)});const d=t??tu;h?this.differ.setCurrentData(this._groupedData):this.differ.setCurrentData(nn(d,p=>\`\${o(p)}-\${a(p)}\`,void 0)),this.differ.doDiff(),c.forEach(p=>{this.elementMap.delete(h?p.groupKey:\`\${p.groupKey}-\${p.key}\`),p.remove(),p.release()}),this.elements=u,l&&this.elements.length>=2&&this.elements.sort((p,g)=>l(p.getDatum(),g.getDatum()))}evaluateState(t,e,i){e&&t.forEach(n=>{n.state(e,i)})}evaluateGroupEncode(t,e,i){if(!this._groupedData||!e)return;const n={};return this._groupedData.keys.forEach(r=>{const a=t.find(o=>o.groupKey===r);a&&(n[r]=Hn(e,a.items&&a.items[0]&&a.items[0].datum,a,i))}),this._groupEncodeResult=n,n}getChannelsFromConfig(t){const e=this.spec;return I(e.interactive)?null:{pickable:e.interactive}}evaluateEncode(t,e,i,n){const r=this.getChannelsFromConfig();if(e){this.emit(at.BEFORE_ELEMENT_ENCODE,{encoders:e,parameters:i},this);const a=n?null:this.evaluateGroupEncode(t,e[Zs.group],i);t.forEach(o=>{this.markType===Z.glyph&&this._groupEncodeResult?o.items.forEach(l=>{l.nextAttrs=Object.assign(l.nextAttrs,r,this._groupEncodeResult[o.groupKey])}):a!=null&&a[o.groupKey]&&!this.isCollectionMark()?o.items.forEach(l=>{l.nextAttrs=Object.assign(l.nextAttrs,r,a[o.groupKey])}):r&&o.items.forEach(l=>{l.nextAttrs=Object.assign(l.nextAttrs,r)}),o.encodeItems(o.items,e,this._isReentered,i),this.isCollectionMark()&&(a!=null&&a[o.groupKey])&&R(a[o.groupKey].defined)&&(o.items.forEach(l=>{l.nextAttrs.defined=a[o.groupKey].defined}),delete a[o.groupKey].defined)}),this._isReentered=!1,this.evaluateTransform(this._getTransformsAfterEncodeItems(),t,i),t.forEach(o=>{o.encodeGraphic(this.isCollectionMark()?a==null?void 0:a[o.groupKey]:null)}),this.emit(at.AFTER_ELEMENT_ENCODE,{encoders:e,parameters:i},this)}else t.forEach(a=>{a.initGraphicItem(r)})}addGraphicItem(t,e,i){var n;const r=i??Fo(this,this.markType,t);if(r){if(!((n=this.renderContext)===null||n===void 0)&&n.progressive){let a;if(this._groupedData){const o=this._groupedData.keys.indexOf(e);o>=0&&(a=this.graphicParent.getChildAt(o))}else a=this.graphicParent.at(0);this.isCollectionMark()?(r.incremental=1,a.appendChild(r)):a.incrementalAppendChild(r)}else this.graphicParent.appendChild(r);return r}}parseRenderContext(t,e){const i=this.markType!==Z.group&&this.spec.progressiveStep>0&&this.spec.progressiveThreshold>0&&this.spec.progressiveStep<this.spec.progressiveThreshold,n=this.spec.large&&this.spec.largeThreshold>0&&t.length>=this.spec.largeThreshold;if(i){const r=this._groupedData;return r&&r.keys&&r.keys.some(a=>r.data.get(a).length>this.spec.progressiveThreshold)?{large:n,parameters:e,progressive:{data:t,step:this.spec.progressiveStep,currentIndex:0,totalStep:r.keys.reduce((a,o)=>Math.max(Math.ceil(r.data.get(o).length/this.spec.progressiveStep),a),1),groupedData:r.data}}:{large:n}}return{large:n}}isProgressive(){return this.renderContext&&(!!this.renderContext.progressive||!!this.renderContext.beforeTransformProgressive)}canAnimateAfterProgressive(){return this.renderContext&&this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.canAnimate()}isDoingProgressive(){return this.renderContext&&(this.renderContext.progressive&&this.renderContext.progressive.currentIndex<this.renderContext.progressive.totalStep||this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.unfinished())}clearProgressive(){this.renderContext&&this.renderContext.progressive&&(this.elements=[],this.graphicParent.children.forEach(t=>{t.incrementalClearChild()}),this.graphicParent.removeAllChild()),this.renderContext&&this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.release(),this.renderContext=null}restartProgressive(){this.renderContext&&this.renderContext.progressive&&(this.renderContext.progressive.currentIndex=0)}evaluateJoinProgressive(){var t,e,i;const n=this.renderContext.progressive.currentIndex,r=Do((i=(t=this.spec.key)!==null&&t!==void 0?t:(e=this.grammarSource)===null||e===void 0?void 0:e.getDataIDKey())!==null&&i!==void 0?i:()=>oi),a=[];if(this.isCollectionMark())return this._groupedData.keys.forEach((l,h)=>{const c=this.renderContext.progressive.groupedData.get(l),u=this.renderContext.progressive.step,d=c.slice(n*u,(n+1)*u);if(n===0){const p=this.createElement();p.diffState=Kt.enter,p.updateData(l,d,r),a.push(p)}else{const p=this.elements[h];p.updateData(l,d,r),a.push(p)}}),a;const o={};return this._groupedData.keys.forEach(l=>{const h=this.renderContext.progressive.groupedData.get(l),c=this.renderContext.progressive.step,u=h.slice(n*c,(n+1)*c),d=[];u.forEach(p=>{const g=this.createElement();g.diffState=Kt.enter,g.updateData(l,[p],r),d.push(g),a.push(g)}),o[l]=d}),{groupElements:o,elements:a}}evaluateEncodeProgressive(t,e,i){const n=this.renderContext.progressive.currentIndex;if(n===0){if(this.evaluateEncode(t,e,i),n===0&&this._groupEncodeResult&&!this.isCollectionMark()&&this.markType!==Z.glyph){const r=t[0],a=r.getGraphicItem(),o=a==null?void 0:a.parent;o&&this._groupEncodeResult[r.groupKey]&&o.setTheme({common:this._groupEncodeResult[r.groupKey]})}}else this.evaluateEncode(t,e,i,!0)}evaluateProgressive(){var t,e,i;if(!((t=this.renderContext)===null||t===void 0)&&t.beforeTransformProgressive){const l=this.renderContext.beforeTransformProgressive;l.progressiveRun();const h=l.output();if(l.canAnimate){if(l.unfinished())return;this.evaluateGroup(h)}return this.emit(at.BEFORE_MARK_JOIN),this.evaluateJoin(h),this.emit(at.AFTER_MARK_JOIN),this.emit(at.BEFORE_MARK_STATE),this.evaluateState(this.elements,this.spec.state,this.renderContext.parameters),this.emit(at.AFTER_MARK_STATE),this.emit(at.BEFORE_MARK_ENCODE),this.evaluateEncode(this.elements,this._getEncoders(),this.renderContext.parameters),void this.emit(at.AFTER_MARK_ENCODE)}if(!(!((e=this.renderContext)===null||e===void 0)&&e.progressive))return;const n=this.renderContext.parameters;this.emit(at.BEFORE_MARK_JOIN);const r=this.evaluateJoinProgressive(),a=Array.isArray(r)?r:r.elements;if(this.emit(at.AFTER_MARK_JOIN),this.renderContext.progressive.currentIndex===0?(this.graphicParent.removeAllChild(),this._groupedData.keys.forEach(l=>{const h=Fo(this,Z.group,{pickable:!1,zIndex:this.spec.zIndex});h.incremental=this.renderContext.progressive.step,this.graphicParent.appendChild(h)}),this.elements=a):this.elements=this.elements.concat(a),this.emit(at.BEFORE_MARK_STATE),this.evaluateState(a,this.spec.state,n),this.emit(at.AFTER_MARK_STATE),this.emit(at.BEFORE_MARK_ENCODE),Array.isArray(r))this.evaluateEncodeProgressive(a,this._getEncoders(),n);else{const l=r.groupElements;Object.keys(l).forEach(h=>{this.evaluateEncodeProgressive(l[h],this._getEncoders(),n)})}this.emit(at.AFTER_MARK_ENCODE);const o=(i=this._getTransformsAfterEncode())===null||i===void 0?void 0:i.filter(l=>l.canProgressive===!0);o!=null&&o.length&&this.evaluateTransform(o,this.elements,n),this.renderContext.progressive.currentIndex+=1}isLargeMode(){return this.renderContext&&this.renderContext.large}cleanExitElements(){this.elementMap.forEach((t,e)=>{t.diffState!==Kt.exit||t.isReserved||(this.elementMap.delete(e),t.remove(),t.release())})}getGroupGraphicItem(){if(this.elements&&this.elements[0]&&this.elements[0].getGraphicItem)return this.elements[0].getGraphicItem()}getBounds(){var t;return this.graphicItem?this.graphicItem.AABBBounds:(t=this.getGroupGraphicItem())===null||t===void 0?void 0:t.AABBBounds}getMorphConfig(){var t;return{morph:(t=this.spec.morph)!==null&&t!==void 0&&t,morphKey:this.spec.morphKey,morphElementKey:this.spec.morphElementKey}}getAttributeTransforms(){var t;return(t=this.spec.attributeTransforms)!==null&&t!==void 0?t:Tg[this.markType]}getContext(){return this._context}needSkipBeforeLayout(){var t,e;if(((t=this.spec.layout)===null||t===void 0?void 0:t.skipBeforeLayouted)===!0)return!0;let i=this.group;for(;i;){if(((e=i.getSpec().layout)===null||e===void 0?void 0:e.skipBeforeLayouted)===!0)return!0;i=i.group}return!1}initEvent(){if(this._delegateEvent){const t=this.view.renderer.stage();t&&t.on("*",this._delegateEvent)}}releaseEvent(){if(this._delegateEvent){const t=this.view.renderer.stage();t&&t.off("*",this._delegateEvent)}}clear(){var t;this.releaseEvent(),this.transforms=null,this.elementMap=null,this.elements=null,this.graphicItem=null,this.animate=null,(t=this.group)===null||t===void 0||t.removeChild(this),this.group=null,super.clear()}prepareRelease(){var t;this.differ.setCurrentData(null),(t=this.animate)===null||t===void 0||t.stop(),this.elementMap.forEach(e=>e.diffState=Kt.exit),this._finalParameters=this.parameters()}release(){this.releaseEvent(),this.elements.forEach(t=>t.release()),this.differ=null,this.elements=[],this.elementMap.clear(),this._finalParameters=null,this.animate&&this.animate.release(),this.graphicItem&&iu(this.graphicItem),this.detachAll(),super.release()}}let DR=class extends au{constructor(s,t){super(s,Z.group,t),this.children=[]}parseRenderContext(){return{large:!1}}appendChild(s){return this.children.push(s),this}removeChild(s){return this.children=this.children.filter(t=>t!==s),this}includesChild(s){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return!!this.children.includes(s)||!!t&&this.children.some(e=>e.markType===Z.group&&e.includesChild(s,!0))}updateLayoutChildren(){return this.children.length?(this.layoutChildren||(this.layoutChildren=[]),this.layoutChildren=this.children.filter(s=>s.needLayout()),this):this}getAttributeTransforms(){return Tg.rect}evaluateJoin(s){if(!this.elements.length){const t=this.createElement();t.updateData(oi,tu,()=>""),this.elements=[t],this.elementMap.set(oi,t)}}getChannelsFromConfig(s){const t=this.spec,e={};if(I(t.clip)||(e.clip=t.clip),I(t.zIndex)||(e.zIndex=t.zIndex),!I(t.clipPath)){const i=U(t.clipPath)?t.clipPath([s]):t.clipPath;i&&i.length?e.path=i:(e.path=null,e.clip=!1)}return I(t.interactive)||(e.pickable=t.interactive),e}evaluateGroupEncode(s,t,e){var i;const n=this.elements[0],r={};return Js(n,[Object.assign({},(i=n.items)===null||i===void 0?void 0:i[0],{nextAttrs:r})],t,e),this._groupEncodeResult=r,r}evaluateEncode(s,t,e,i){const n=this.getChannelsFromConfig();if(t){this.emit(at.BEFORE_ELEMENT_ENCODE,{encoders:t,parameters:e},this);const r=i?null:this.evaluateGroupEncode(s,t[Zs.group],e);s.forEach(a=>{a.items.forEach(o=>{o.nextAttrs=Object.assign(o.nextAttrs,n,r)}),a.encodeItems(a.items,t,this._isReentered,e)}),this._isReentered=!1,this.evaluateTransform(this._getTransformsAfterEncodeItems(),s,e),s.forEach(a=>{a.encodeGraphic()}),this.emit(at.AFTER_ELEMENT_ENCODE,{encoders:t,parameters:e},this)}else s.forEach(r=>{r.initGraphicItem(n)})}addGraphicItem(s,t,e){const i=e??Fo(this,this.markType,s);if(i)return this.emit(at.BEFORE_ADD_VRENDER_MARK,{graphicItem:i}),i.name=\`\${this.id()||this.markType}\`,this.graphicParent.insertIntoKeepIdx(i,this.graphicIndex),this.emit(at.AFTER_ADD_VRENDER_MARK,{graphicItem:i}),i}};class bx{constructor(t,e){this._grammars={signal:[],data:[],scale:[],coordinate:[],mark:[],customized:[]},this._grammarMap={signal:{},data:{},scale:{},coordinate:{},mark:{},customized:{}},this._size=0,this._mapKey=Q(t)?i=>i[t]:t,this._warning=e}record(t){var e,i;const n=t.grammarType,r=this._mapKey(t);return this._grammarMap[n]?(this._grammars[n].push(t),I(r)||(this._grammarMap[n][r]?(e=this._warning)===null||e===void 0||e.call(this,r,t):this._grammarMap[n][r]=t)):(this._grammars.customized.push(t),I(r)||(this._grammarMap.customized[r]?(i=this._warning)===null||i===void 0||i.call(this,r,t):this._grammarMap.customized[r]=t)),this._size+=1,this}unrecord(t){const e=t.grammarType,i=this._mapKey(t);return this._grammarMap[e]?(this._grammars[e]=this._grammars[e].filter(n=>n!==t),I(i)||this._grammarMap[e][i]!==t||delete this._grammarMap[e][i]):(this._grammars.customized=this._grammars.customized.filter(n=>n!==t),I(i)||this._grammarMap.customized[i]!==t||delete this._grammarMap.customized[i]),this._size-=1,this}size(){return this._size}getSignal(t){var e;return(e=this._grammarMap.signal[t])!==null&&e!==void 0?e:null}getData(t){var e;return(e=this._grammarMap.data[t])!==null&&e!==void 0?e:null}getScale(t){var e;return(e=this._grammarMap.scale[t])!==null&&e!==void 0?e:null}getCoordinate(t){var e;return(e=this._grammarMap.coordinate[t])!==null&&e!==void 0?e:null}getMark(t){var e;return(e=this._grammarMap.mark[t])!==null&&e!==void 0?e:null}getCustomized(t){var e;return(e=this._grammarMap.customized[t])!==null&&e!==void 0?e:null}getGrammar(t){return this._grammarMap.data[t]?this._grammarMap.data[t]:this._grammarMap.signal[t]?this._grammarMap.signal[t]:this._grammarMap.scale[t]?this._grammarMap.scale[t]:this._grammarMap.coordinate[t]?this._grammarMap.coordinate[t]:this._grammarMap.mark[t]?this._grammarMap.mark[t]:this._grammarMap.customized[t]?this._grammarMap.customized[t]:null}getAllSignals(){return this._grammars.signal}getAllData(){return this._grammars.data}getAllScales(){return this._grammars.scale}getAllCoordinates(){return this._grammars.coordinate}getAllMarks(){return this._grammars.mark}getAllCustomized(){return this._grammars.customized}traverse(t){var e;Object.values((e=this._grammars)!==null&&e!==void 0?e:{}).forEach(i=>(i??[]).forEach(n=>{t.call(null,n)}))}find(t){let e=null;return this.traverse(i=>t.call(null,i)===!0&&(e=i,!0)),e}filter(t){const e=[];return this.traverse(i=>{t.call(null,i)===!0&&e.push(i)}),e}clear(){this._size=0,this._grammars={signal:[],data:[],scale:[],coordinate:[],mark:[],customized:[]},this._grammarMap={signal:{},data:{},scale:{},coordinate:{},mark:{},customized:{}}}release(){this._size=0,this._grammars=null,this._grammarMap=null}}class FR extends bx{constructor(){super(...arguments),this._markNodes=[]}record(t){if(super.record(t),t.grammarType==="mark"){const e=t,i={mark:e,parent:null,children:[]};this._markNodes.forEach(n=>{const r=n.mark;r.markType===Z.group&&r.includesChild(e,!1)?(n.children.push(i),i.parent=n):e.markType===Z.group&&e.includesChild(r,!1)&&(i.children.push(n),n.parent=i)}),this._markNodes.push(i)}return this}unrecord(t){if(super.unrecord(t),t.grammarType==="mark"){const e=t,i=this._markNodes.find(n=>n.mark===e);this._markNodes.forEach(n=>{n.mark.markType===Z.group&&n.children.includes(i)?(n.children=n.children.filter(r=>r!==i),i.parent=null):e.markType===Z.group&&i.children.includes(n)&&(i.children=i.children.filter(r=>r!==n),n.parent=null)}),this._markNodes=this._markNodes.filter(n=>n!==i)}return this}getAllMarkNodes(){return this._markNodes}clear(){super.clear(),this._markNodes=[]}release(){super.release(),this._markNodes=null}}class xx extends au{addGraphicItem(t,e){const i=t&&t.limitAttrs,n=Fo(this,i&&(i.textType==="rich"||i.text&&i.text.type==="rich")?Z.richtext:Z.text,t);return super.addGraphicItem(t,e,n)}release(){super.release()}}xx.markType=Z.text;const Sx={axis:{label:{visible:!0,inside:!1,space:4,style:{fontSize:12,fill:"#89909d",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},items:[],start:{x:0,y:0},end:{x:100,y:0},x:0,y:0},circleAxis:{title:{space:4,padding:[0,0,0,0],textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1},text:"theta"},label:{visible:!0,inside:!1,space:4,style:{fontSize:12,fill:"#6F6F6F",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},items:[],startAngle:0,endAngle:2*Math.PI,radius:100,innerRadius:0,center:{x:0,y:0},x:0,y:0},grid:{style:{stroke:"#f1f2f5"}},circleGrid:{style:{stroke:"#f1f2f5"}},discreteLegend:{layout:"vertical",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:10,spaceRow:10,shape:{space:4,style:{size:10,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8",stroke:"#D8D8D8",fillOpacity:.5}}},label:{space:4,style:{fontSize:12,fill:"black",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8",fillOpacity:.5}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"},state:{selectedHover:{fillOpacity:.7,fill:"gray"},unSelectedHover:{fillOpacity:.2,fill:"gray"}}},focus:!1,focusIconStyle:{size:10,fill:"#333",cursor:"pointer"},visible:!0,padding:{top:2,bottom:2,left:2,right:2}},autoPage:!0,pager:{space:12,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!1,items:[{index:0,id:"",label:"",shape:{fill:"#6690F2",stroke:"#6690F2",symbolType:"circle"}}]},colorLegend:{title:{visible:!1,text:""},colors:[],layout:"horizontal",railWidth:200,railHeight:8,railStyle:{cornerRadius:5}},sizeLegend:{title:{visible:!1,text:""},trackStyle:{fill:"#ccc"},layout:"horizontal",align:"bottom",railWidth:200,railHeight:6,min:0,max:1,value:[0,1]},lineCrosshair:{start:{x:0,y:0},end:{x:0,y:0}},rectCrosshair:{start:{x:0,y:0},end:{x:0,y:0},rectStyle:{width:10,height:10}},sectorCrosshair:{center:{x:0,y:0},radius:100,startAngle:0,endAngle:Math.PI/6},circleCrosshair:{center:{x:0,y:0},radius:100,startAngle:0,endAngle:2*Math.PI},polygonCrosshair:{center:{x:0,y:0},radius:100,startAngle:0,endAngle:2*Math.PI,sides:6},slider:{layout:"horizontal",railWidth:200,railHeight:10,railStyle:{cornerRadius:5},range:{draggableTrack:!0},startText:{visible:!0,text:"",space:8},endText:{visible:!0,text:"",space:8},min:0,max:1,value:[0,1]},dataLabel:{size:{width:400,height:400},dataLabels:[]},pointLabel:{data:[{text:"",fill:"#606773",data:{}}],overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},lineLabel:{type:"line",data:[{text:"",data:{}}],position:"start",overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},areaLabel:{type:"area",data:[{text:"",data:{}}],position:"end",overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},rectLabel:{type:"rect",data:[{text:"",fill:"#606773",data:{}}],position:"top",overlap:{size:{width:1e3,height:1e3},strategy:[{type:"position"}]},smartInvert:!1},symbolLabel:{type:"symbol",data:[{text:"",fill:"#606773",data:{}}],position:"top",overlap:{avoidBaseMark:!0,size:{width:1e3,height:1e3},strategy:[{type:"position"}]},smartInvert:!1},arcLabel:{type:"arc",data:[{text:"",fill:"#606773",data:{}}],width:800,height:600,position:"outside",zIndex:302},lineDataLabel:{type:"line-data",data:[{text:""}],position:"top",overlap:{avoidBaseMark:!1,clampForce:!1},smartInvert:!1},datazoom:{orient:"bottom",showDetail:"auto",brushSelect:!0,start:0,end:1,position:{x:0,y:0},size:{width:500,height:40},previewData:[]},continuousPlayer:{},discretePlayer:{},tooltip:{},title:{textStyle:{fill:"#21252c"},subtextStyle:{fill:"#606773"}},scrollbar:{width:12,height:12,padding:[2,2],railStyle:{fill:"rgba(0, 0, 0, .1)"}}},Ax={symbol:{shape:"circle",size:8},text:{fontSize:14,fill:"#000000"}},Ve=Object.assign({},Sx);Ve.axis=Object.assign({},Ve.axis,{label:{style:{fill:"#bbbdc3"}},line:{style:{stroke:"#4b4f54"}},tick:{style:{stroke:"#4b4f54"}},subTick:{style:{stroke:"#4b4f54"}}}),Ve.circleAxis=Object.assign({},Ve.circleAxis,{label:{style:{fill:"#bbbdc3"}},line:{style:{stroke:"#4b4f54"}},tick:{style:{stroke:"#4b4f54"}},subTick:{style:{stroke:"#4b4f54"}}}),Ve.grid=Object.assign({},Ve.grid,{style:{stroke:"#404349"}}),Ve.circleGrid=Object.assign({},Ve.circleGrid,{style:{stroke:"#404349"}}),Ve.rectLabel=Object.assign({},Ve.rectLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),Ve.lineLabel=Object.assign({},Ve.lineLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),Ve.symbolLabel=Object.assign({},Ve.symbolLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),Ve.title=Object.assign({},Ve.title,{textStyle:{fill:"#fdfdfd"},subtextStyle:{fill:"#888c93"}});const jR={name:"dark",padding:5,background:"#202226",palette:{default:["#5383F4","#7BCF8E","#FF9D2C","#FFDB26","#7568D9","#80D8FB","#1857A3","#CAB0E8","#FF8867","#B9E493","#2CB4A8","#B9E4E3"]},marks:Ax,components:Ve},NR={name:"default",padding:5,palette:{default:["#6690F2","#70D6A3","#B4E6E2","#63B5FC","#FF8F62","#FFDC83","#BCC5FD","#A29BFE","#63C4C7","#F68484"]},marks:Ax,components:Sx};class Li{static registerTheme(t,e){t&&Li._themes.set(t,e)}static unregisterTheme(t){Li._themes.delete(t)}static getTheme(t){return Li._themes.get(t)}static getDefaultTheme(){return Li.getTheme("default")}}Li._themes=new Map,Li.registerTheme("default",NR),Li.registerTheme("dark",jR);class Og extends au{constructor(t,e,i,n){super(t,Z.component,i),this._componentDatum={[oi]:0},this.componentType=e,this.spec.type="component",this.spec.componentType=e,this.mode=n,this._updateComponentEncoders()}configureComponent(t){return this.spec.componentConfig=t,this.commit(),this}addGraphicItem(t,e,i){const n=i??V.createGraphicComponent(this.componentType,t,{mode:this.mode,skipDefault:this.spec.skipTheme});return n&&(this.emit(at.BEFORE_ADD_VRENDER_MARK,{graphicItem:n}),this.graphicParent.appendChild(n),this.emit(at.AFTER_ADD_VRENDER_MARK,{graphicItem:n})),n}join(t){return super.join(t,oi)}encodeState(t,e,i){return super.encodeState(t,e,i),this._updateComponentEncoders(),this}parseRenderContext(){return{large:!1}}_prepareRejoin(){this._componentDatum[oi]+=1}evaluateJoin(t){return this.spec.key=oi,t?(t[oi]=this._componentDatum[oi],this._componentDatum=t):this._componentDatum={[oi]:this._componentDatum[oi]},super.evaluateJoin([this._componentDatum])}_updateComponentEncoders(){this._encoders=this.spec.encode}_getEncoders(){var t;return(t=this._encoders)!==null&&t!==void 0?t:{}}}const Pg=Symbol.for("key");class zR{diffGrammar(t,e){return function(i,n,r){const a={enter:[],exit:[],update:[]},o=new _x(i,r);return o.setCallback((l,h,c)=>{I(h)?a.exit.push({prev:c[0]}):I(c)?a.enter.push({next:h[0]}):a.update.push({next:h[0],prev:c[0]})}),o.setCurrentData(nn(n,r)),o.doDiff(),a}(t,e,i=>{var n;return(n=i.id())!==null&&n!==void 0?n:Symbol()})}diffMark(t,e,i){const n={enter:[],exit:[],update:[]};let r=[],a=[];t.forEach(u=>{u.markType!==Z.group&&(i.morph&&u.getMorphConfig().morph||i.morphAll||i.reuse)?r.push(u):n.exit.push({prev:[u]})}),e.forEach(u=>{u.markType!==Z.group&&(i.morph&&u.getMorphConfig().morph||i.morphAll||i.reuse)?a.push(u):n.enter.push({next:[u]})});const o=this.diffUpdateByGroup(r,a,u=>u.getMorphConfig().morphKey,u=>u.getMorphConfig().morphKey);r=o.prev,a=o.next,n.update=n.update.concat(o.update);const l=this.diffUpdateByGroup(r,a,u=>u.id(),u=>u.id());r=l.prev,a=l.next,n.update=n.update.concat(l.update);const h=nn(r,u=>{var d,p;return(p=(d=u.group)===null||d===void 0?void 0:d.id)===null||p===void 0?void 0:p.call(d)}),c=nn(a,u=>{var d,p;return(p=(d=u.group)===null||d===void 0?void 0:d.id)===null||p===void 0?void 0:p.call(d)});return Object.keys(c).forEach(u=>{const d=h.data.get(u),p=c.data.get(u);if(d&&p){for(let g=0;g<Math.max(d.length,p.length);g+=1){const f=d[g],m=p[g];f&&m?n.update.push({prev:[f],next:[m]}):f?n.exit.push({prev:[f]}):m&&n.enter.push({next:[m]})}r=r.filter(g=>!d.includes(g)),a=a.filter(g=>!p.includes(g))}}),r.forEach(u=>n.exit.push({prev:[u]})),a.forEach(u=>n.enter.push({next:[u]})),n}diffUpdateByGroup(t,e,i,n){const r=nn(t,c=>{var u;return(u=i(c))!==null&&u!==void 0?u:Pg}),a=nn(e,c=>{var u;return(u=n(c))!==null&&u!==void 0?u:Pg});let o=t,l=e;const h=[];return a.keys.forEach(c=>{if(c!==Pg){const u=r.data.get(c),d=a.data.get(c);u&&d&&(h.push({prev:u,next:d}),o=o.filter(p=>!u.includes(p)),l=l.filter(p=>!d.includes(p)))}}),{prev:o,next:l,update:h}}}class Ho extends Ps{static useRegisters(t){t.forEach(e=>{e()})}constructor(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),t=this,this._observer=null,this._onResize=yl(function(){const n=t._getContainerSize();n&&t.resize(n.width,n.height)},100),this.delegateEvent=(n,r)=>{const a=vx(this,n,0,ru);this.emit(r,a,n.element)},this.handleProgressiveFrame=()=>{this._progressiveMarks.length&&this._progressiveMarks.forEach(n=>{n.isDoingProgressive()&&n.evaluateProgressive()}),this.doPreProgressive()},this._config=i,this._options=Object.assign({mode:"browser"},e),this.initialize()}getGrammarById(t){return this.grammars.getGrammar(t)}getSignalById(t){return this.grammars.getSignal(t)}getDataById(t){return this.grammars.getData(t)}getScaleById(t){return this.grammars.getScale(t)}getCoordinateById(t){return this.grammars.getCoordinate(t)}getMarkById(t){return this.grammars.getMark(t)}getCustomizedById(t){return this.grammars.getCustomized(t)}getGrammarsByName(t){return this.grammars.filter(e=>e.name()===t)}getGrammarsByType(t){return this.grammars.filter(e=>e.grammarType===t)}getMarksByType(t){return this.grammars.getAllMarks().filter(e=>e.markType===t)}getMarksByName(t){return this.grammars.getAllMarks().filter(e=>e.name()===t)}getMarksBySelector(t){if(!t)return null;const e=Y(t),i=[];return e.forEach(n=>{if(Lo(n))return void i.push(n);if(n[0]==="#"){const a=this.getMarkById(n.slice(1));return void(a&&i.push(a))}const r=n[0]==="@"?this.getMarksByName(n.slice(1)):Z[n]?this.getMarksByType(n):null;r&&r.length&&r.forEach(a=>{i.push(a)})}),i}updateSignal(t,e){Q(t)&&(t=this.getSignalById(t)),t.set(e),this.commit(t)}signal(t,e){const i=new PR(this);return arguments.length>=1&&i.value(t),arguments.length>=2&&i.update(e),this.grammars.record(i),this._dataflow.add(i),i}data(t){const e=new ER(this,t);return this.grammars.record(e),this._dataflow.add(e),e}scale(t){const e=V.createGrammar("scale",this,t);return e&&(this.grammars.record(e),this._dataflow.add(e)),e}coordinate(t){const e=V.createGrammar("coordinate",this,t);return e&&(this.grammars.record(e),this._dataflow.add(e)),e}mark(t,e,i){const n=Q(e)?this.getMarkById(e):e;let r;switch(t){case Z.group:r=new DR(this,n);break;case Z.glyph:const a=V.getMark(Z.glyph);a&&(r=new a(this,i==null?void 0:i.glyphType,n));break;case Z.component:r=V.hasComponent(i==null?void 0:i.componentType)?V.createComponent(i==null?void 0:i.componentType,this,n,i==null?void 0:i.mode):new Og(this,i==null?void 0:i.componentType,n,i==null?void 0:i.mode);break;case Z.text:r=new xx(this,t,n);break;default:r=V.hasMark(t)?V.createMark(t,this,n):new au(this,t,n)}return this.grammars.record(r),this._dataflow.add(r),r}group(t){return this.mark(Z.group,t)}glyph(t,e){return this.mark(Z.glyph,e,{glyphType:t})}component(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"2d";return this.mark(Z.component,e,{componentType:t,mode:i})}axis(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"2d";return this.mark(Z.component,t,{componentType:ee.axis,mode:e})}grid(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"2d";return this.mark(Z.component,t,{componentType:ee.grid,mode:e})}legend(t){return this.mark(Z.component,t,{componentType:ee.legend})}slider(t){return this.mark(Z.component,t,{componentType:ee.slider})}label(t){return this.mark(Z.component,t,{componentType:ee.label})}datazoom(t){return this.mark(Z.component,t,{componentType:ee.datazoom})}player(t){return this.mark(Z.component,t,{componentType:ee.player})}title(t){return this.mark(Z.component,t,{componentType:ee.title})}scrollbar(t){return this.mark(Z.component,t,{componentType:ee.scrollbar})}customized(t,e){const i=V.createGrammar(t,this,e==null?void 0:e.type);if(i)return i.parse(e),this.grammars.record(i),this._dataflow.add(i),i}addGrammar(t){return this.grammars.find(e=>e.uid===t.uid)||(this.grammars.record(t),this._dataflow.add(t),t.parse(t.getSpec()),this._needBuildLayoutTree=!0),this}removeGrammar(t){const e=Q(t)?this.getGrammarById(t):t;return e&&this.grammars.find(i=>i.uid===e.uid)?(e.grammarType==="mark"&&e.prepareRelease(),this._cachedGrammars.record(e),this._dataflow.remove(e),this.grammars.unrecord(e),this._needBuildLayoutTree=!0,this):this}removeAllGrammars(){return this.grammars.traverse(t=>{t.grammarType==="signal"&&yx.includes(t.id())||t.grammarType==="mark"&&t.id()==="root"||this.removeGrammar(t)}),this}removeAllGraphicItems(){return this.traverseMarkTree(t=>{t.graphicItem&&(iu(t.graphicItem),t.elementMap.forEach(e=>{e.resetGraphicItem()}),t.graphicItem=null)}),this}parseSpec(t){var e,i,n,r,a,o,l,h;if(this.emit(at.BEFORE_PARSE_VIEW),this._spec=t,(u=>{var d;const p=(g,f)=>{var m,v;g.group=f;const y=(m=g.id)!==null&&m!==void 0?m:"VGRAMMAR_MARK_"+ ++LR;g.id=y,((v=g.marks)!==null&&v!==void 0?v:[]).forEach(_=>p(_,y))};((d=u.marks)!==null&&d!==void 0?d:[]).forEach(g=>p(g,"root"))})(t),t.theme?this.theme(t.theme):this.theme(Li.getDefaultTheme()),t.width&&this.width(t.width),t.height&&this.height(t.height),this.padding((i=(e=t.padding)!==null&&e!==void 0?e:this._options.padding)!==null&&i!==void 0?i:this._theme.padding),!this.width()||!this.height()){const u=this._getContainerSize();u&&(this.updateSignal(en,u.width),this.updateSignal(sn,u.height))}!((n=t.signals)===null||n===void 0)&&n.length&&t.signals.forEach(u=>{this.signal().parse(u)}),!((r=t.data)===null||r===void 0)&&r.length&&t.data.forEach(u=>{this.data(null).parse(u)}),!((a=t.coordinates)===null||a===void 0)&&a.length&&t.coordinates.forEach(u=>{var d;(d=this.coordinate(u.type))===null||d===void 0||d.parse(u)}),!((o=t.scales)===null||o===void 0)&&o.length&&t.scales.forEach(u=>{var d;(d=this.scale(u.type))===null||d===void 0||d.parse(u)});const c=V.getGrammars();return Object.keys(c).forEach(u=>{const{specKey:d}=c[u];t[d]&&t[d].length&&t[d].forEach(p=>{this.customized(u,p)})}),t.marks&&t.marks.length&&t.marks.forEach(u=>{this.parseMarkSpec(u)}),t.events&&t.events.length&&t.events.forEach(u=>{var d;(d=this.event)===null||d===void 0||d.call(this,u)}),t.interactions&&t.interactions.length&&t.interactions.forEach(u=>{this.interaction(u.type,u)}),t.animation===!1?(l=this.animate)===null||l===void 0||l.disable():(h=this.animate)===null||h===void 0||h.enable(),this.emit(at.AFTER_PARSE_VIEW),this._needBuildLayoutTree=!0,this._layoutState=Cs.before,this}updateSpec(t){return this.removeAllInteractions(),this.removeAllGrammars(),this.parseSpec(t)}parseBuiltIn(){((t,e,i)=>{var n,r,a,o,l;return[{id:en,value:(n=t[en])!==null&&n!==void 0?n:0},{id:sn,value:(r=t[sn])!==null&&r!==void 0?r:0},{id:Ki,value:ta((o=(a=t[Ki])!==null&&a!==void 0?a:e[Ki])!==null&&o!==void 0?o:i==null?void 0:i.padding)},{id:jo,update:{callback:(h,c)=>{const u=ta(c[Ki]);return c[en]-u.left-u.right},dependency:[en,Ki]}},{id:No,update:{callback:(h,c)=>{const u=ta(c[Ki]);return c[sn]-u.top-u.bottom},dependency:[sn,Ki]}},{id:Ig,update:{callback:(h,c)=>{const u=ta(c[Ki]);return(h||new es).setValue(u.left,u.top,u.left+c[jo],u.top+c[No])},dependency:[jo,No,Ki]}},{id:zo,value:(l=t[zo])!==null&&l!==void 0?l:e[zo]}]})(this._options,this._config,this.getCurrentTheme()).forEach(t=>{const e=this.signal().parse(t);t.value&&e.set(t.value)}),this.parseMarkSpec({id:"root",type:"group",encode:{enter:{x:0,y:0},update:{width:{signal:"width"},height:{signal:"height"}}}}),this.rootMark=this.getMarkById("root")}parseMarkSpec(t){var e;const i=t.type===Z.glyph?{glyphType:t.glyphType}:t.type===Z.component?{componentType:t.componentType,mode:t.mode}:null;this.mark(t.type,t.group,i).parse(t),(e=t.marks)===null||e===void 0||e.forEach(n=>{this.parseMarkSpec(n)})}theme(t){var e,i,n,r,a,o;Q(t)?this._theme=(e=Li.getTheme(t))!==null&&e!==void 0?e:Li.getDefaultTheme():this._theme=t;const{background:l,padding:h}=(i=this._spec)!==null&&i!==void 0?i:{};return this._theme?(this.background((n=l??this._options.background)!==null&&n!==void 0?n:this._theme.background),this.padding((r=h??this._options.padding)!==null&&r!==void 0?r:this._theme.padding),(o=(a=this.renderer.stage())===null||a===void 0?void 0:a.setTheme)===null||o===void 0||o.call(a,Object.assign({},this._theme.marks))):(this.background(l??this._options.background),this.padding(h??this._options.padding)),this}getCurrentTheme(){return this._theme}setCurrentTheme(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return this.theme(t),this.grammars.getAllMarks().forEach(i=>{i.commit()}),e?(this.evaluate(),this.renderer.render(!0)):this._dataflow.evaluate(),this}background(t){return arguments.length?(this._background=t,this.renderer.background(t),t):this._background}width(t){const e=this.getSignalById(en);return arguments.length?(this._options.width=t,this.updateSignal(e,t),t):e.output()}height(t){const e=this.getSignalById(sn);return arguments.length?(this._options.height=t,this.updateSignal(e,t),t):e.output()}viewWidth(t){const e=this.getSignalById(jo);if(arguments.length){const i=this.padding();return this.width(t+i.left+i.right),t}return e.output()}viewHeight(t){const e=this.getSignalById(No);if(arguments.length){const i=this.padding();return this.height(t+i.top+i.bottom),t}return e.output()}padding(t){const e=this.getSignalById(Ki);if(arguments.length){const i=ta(t);return this.updateSignal(e,i),i}return ta(e.output())}autoFit(t){const e=this.getSignalById(zo);return arguments.length?(this.updateSignal(e,t),t):e.output()}getViewBox(){const t=this.getSignalById(Ig);return t==null?void 0:t.output()}updateLayoutTag(){return this._layoutState=Cs.before,this}getLayoutState(){return this._layoutState}buildLayoutTree(){const t={},e=[];this.traverseMarkTree(i=>{t[i.id()]=!0,i.group&&t[i.group.id()]||e.push(i),i.markType===Z.group&&i.updateLayoutChildren()},i=>i.needLayout()),this._layoutMarks=e}doLayout(){var t;const e=this._options.doLayout||V.getDefaultLayout();e&&(!((t=this._layoutMarks)===null||t===void 0)&&t.length)&&(this.emit(at.BEFORE_DO_LAYOUT),e(this._layoutMarks,this._options,this),this.emit(at.AFTER_DO_LAYOUT))}handleLayoutEnd(){this.emit(at.BEFORE_MARK_LAYOUT_END),this._layoutMarks.forEach(t=>{Rg(t,"layoutChildren",e=>{e.handleLayoutEnd()},e=>e!==t)}),this.emit(at.AFTER_MARK_LAYOUT_END)}handleRenderEnd(){this.emit(at.BEFORE_MARK_RENDER_END),Rg(this.rootMark,"children",t=>{t.handleRenderEnd()}),this.emit(at.AFTER_MARK_RENDER_END)}commit(t){return this._dataflow.commit(t),this}run(t){return this.evaluate(t),this}doRender(t){this.emit(at.BEFORE_DO_RENDER),this.renderer&&(!this._progressiveMarks&&this.animate?this.animate.animate():this.traverseMarkTree(e=>{e.cleanExitElements()},null,!0),this.renderer.render(t),this.handleRenderEnd()),this.emit(at.AFTER_DO_RENDER)}evaluate(t){var e,i;const n=(l=>{var h,c,u,d,p;const{reuse:g=yR,morph:f=_R,morphAll:m=bR,animation:v={},enableExitAnimation:y=xR}=l??{};return{reuse:g,morph:f,morphAll:m,animation:{easing:(h=v.easing)!==null&&h!==void 0?h:"quintInOut",delay:(c=v.delay)!==null&&c!==void 0?c:0,duration:(u=v.duration)!==null&&u!==void 0?u:1e3,oneByOne:(d=v.oneByOne)!==null&&d!==void 0&&d,splitPath:(p=v.splitPath)!==null&&p!==void 0?p:null},enableExitAnimation:y}})(t),r=this._cachedGrammars.size()>0;r&&(this.reuseCachedGrammars(n),this.detachCachedGrammar());const a=this._resizeRenderer(),o=this._dataflow.hasCommitted();return r||o||this._layoutState||a?(this.clearProgressive(),this._dataflow.evaluate(),this._needBuildLayoutTree&&(this.buildLayoutTree(),this._needBuildLayoutTree=!1),this._layoutState&&(this._layoutState=Cs.layouting,this.doLayout(),this._dataflow.hasCommitted()&&(this._layoutState=Cs.reevaluate,this._dataflow.evaluate()),this._layoutState=Cs.after,!((e=this._layoutMarks)===null||e===void 0)&&e.length&&this.handleLayoutEnd()),this._layoutState=null,this.findProgressiveMarks(),this._resizeRenderer(),(i=this.morph)===null||i===void 0||i.call(this,n),this.releaseCachedGrammars(n),this.doRender(!0),this.doPreProgressive(),this):this}reuseCachedGrammars(t){if(t.reuse){const e=i=>{i.next.reuse(i.prev),i.prev.detachAll(),i.prev.clear(),this._cachedGrammars.unrecord(i.prev)};this._differ.diffGrammar(this._cachedGrammars.getAllSignals(),this.grammars.getAllSignals().filter(i=>!yx.includes(i.id()))).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllData(),this.grammars.getAllData()).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllScales(),this.grammars.getAllScales()).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllCoordinates(),this.grammars.getAllCoordinates()).update.forEach(e)}this._differ.diffMark(this._cachedGrammars.getAllMarks(),this.grammars.getAllMarks().filter(e=>e.id()!=="root"),t).update.forEach(e=>{var i;const n=e.prev.length===1&&e.next.length===1&&e.prev[0].markType===e.next[0].markType,r=e.prev.every(a=>a.getMorphConfig().morph)&&e.next.every(a=>a.getMorphConfig().morph);this.morph&&(t.morph&&r||t.morphAll)?(i=this.addMorphMarks)===null||i===void 0||i.call(this,{prev:e.prev,next:e.next}):n&&t.reuse&&(e.next[0].reuse(e.prev[0]),e.prev[0].detachAll(),e.prev[0].clear(),this._cachedGrammars.unrecord(e.prev[0]))})}detachCachedGrammar(){this._cachedGrammars.traverse(t=>{var e,i;if(t.detachAll(),t.grammarType==="mark"){const n=t;(i=(e=n.group)===null||e===void 0?void 0:e.removeChild)===null||i===void 0||i.call(e,n)}})}releaseCachedGrammars(t){this._cachedGrammars.traverse(n=>{n.grammarType!=="mark"&&n.release()});const e=this._cachedGrammars.getAllMarkNodes();e.forEach(n=>{var r;(r=n.mark.animate)===null||r===void 0||r.stop(),t.enableExitAnimation&&this.animate&&this.animate.animateAddition(n.mark)});const i=n=>{if(n.mark.view&&(!n.mark.animate||n.mark.animate.getAnimatorCount()===0)&&(!n.children||n.children.length===0)){n.mark.release();const r=n.parent;r&&(n.parent.children=n.parent.children.filter(a=>a!==n),n.parent=null,i(r))}};e.forEach(n=>{const r=n.mark;r.animate&&r.animate.getAnimatorCount()!==0?r.addEventListener("animationEnd",()=>{r.animate&&r.animate.getAnimatorCount()===0&&i(n)}):i(n)}),this._cachedGrammars.clear()}runAfter(t){return this._dataflow.runAfter(()=>{t.call(null,this)}),this}runBefore(t){return this._dataflow.runBefore(()=>{t.call(null,this)}),this}getImageBuffer(){var t,e;if(this._options.mode!=="node")return void this.logger.error(new TypeError("getImageBuffer() now only support node environment."));const i=(e=(t=this.renderer)===null||t===void 0?void 0:t.stage)===null||e===void 0?void 0:e.call(t);return i?(i.render(),i.window.getImageBuffer()):(this.logger.error(new ReferenceError("render is not defined")),null)}traverseMarkTree(t,e,i){return Rg(this.rootMark,"children",t,e,i),this}_bindResizeEvent(){var t,e,i,n,r,a;if(this.autoFit()){const o=(r=(n=(i=(e=(t=this.renderer)===null||t===void 0?void 0:t.stage)===null||e===void 0?void 0:e.call(t))===null||i===void 0?void 0:i.window)===null||n===void 0?void 0:n.getContainer)===null||r===void 0?void 0:r.call(n);if(o){const l=window.ResizeObserver;this._observer=new l(this._onResize),(a=this._observer)===null||a===void 0||a.observe(o)}window.addEventListener("resize",this._onResize)}}_unBindResizeEvent(){this.autoFit()&&(window.removeEventListener("resize",this._onResize),this._observer&&(this._observer.disconnect(),this._observer=null))}_getContainerSize(){var t,e,i,n,r,a,o,l,h,c,u;const d=(r=(n=(i=(e=(t=this.renderer)===null||t===void 0?void 0:t.stage)===null||e===void 0?void 0:e.call(t))===null||i===void 0?void 0:i.window)===null||n===void 0?void 0:n.getContainer)===null||r===void 0?void 0:r.call(n);if(d){const{width:p,height:g}=Ku(d);return{width:(l=(o=(a=this._spec)===null||a===void 0?void 0:a.width)!==null&&o!==void 0?o:this._options.width)!==null&&l!==void 0?l:p,height:(u=(c=(h=this._spec)===null||h===void 0?void 0:h.height)!==null&&c!==void 0?c:this._options.height)!==null&&u!==void 0?u:g}}return null}resize(t,e){let i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],n=!1;return t!==this.width()&&(n=!0,this.updateSignal(en,t)),e!==this.height()&&(n=!0,this.updateSignal(sn,e)),n&&(i?this.evaluate({morph:!1}):this._dataflow.evaluate()),this}_resizeRenderer(){const t=this.width(),e=this.height();return!!this.renderer.shouldResize(t,e)&&(this.renderer.resize(t,e),this.emit("resize",{},{width:t,height:e}),!0)}interaction(t,e){const i=V.createInteraction(t,this,e);return i&&(i.bind(),this._boundInteractions||(this._boundInteractions=[]),this._boundInteractions.push(i)),i}removeInteraction(t,e){if(this._boundInteractions){const i=this._boundInteractions.filter(n=>{var r;return I(e)?Q(t)?n.type===t:t?n===t:void 0:((r=n.options)===null||r===void 0?void 0:r.id)===e});i.length&&i.forEach(n=>{n.unbind()})}return this}removeAllInteractions(){return this._boundInteractions&&(this._boundInteractions.forEach(t=>{t.unbind()}),this._boundInteractions=null),this}initializeEventConfig(t){const e=Object.assign({defaults:{}},t),i=(n,r)=>{r.forEach(a=>{W(n[a])&&(n[a]=n[a].reduce((o,l)=>(o[l]=!0,o),{}))})};return i(e.defaults,["prevent","allow"]),i(e,[ru,OR]),e}initEvent(){const t=this.renderer.stage();t&&t.on("*",this.delegateEvent)}releaseStageEvent(){const t=this.renderer.stage();t&&t.off("*",this.delegateEvent)}addEventListener(t,e,i){let n=e;return i&&i.trap===!1||(n=e,n.raw=e),i&&i.target&&(n.target=i.target),this.on(t,n),this}removeEventListener(t,e){return e?this.off(t,e):this.off(t),this}initializeRenderer(){const t=this._options.width,e=this._options.height;this.renderer=new IR(this),this.renderer.initialize(t,e,this._options,this._eventConfig).background(this._background)}initialize(){var t,e,i;this.grammars=new bx(n=>n.id(),(n,r)=>this.logger.warn(\`Grammar id '\${n}' has been occupied\`,r)),this._cachedGrammars=new FR(n=>n.id()),this._options.logger&&Tt.setInstance(this._options.logger),this.logger=Tt.getInstance((t=this._options.logLevel)!==null&&t!==void 0?t:0),this._dataflow=new RR,this.animate=(e=this.initAnimate)===null||e===void 0?void 0:e.call(this,this),this._differ=new zR,this._options.hooks&&(Object.keys(this._options.hooks).forEach(n=>{this.on(n,this._options.hooks[n])}),this.hooks=this._options.hooks),this.container=null,this.renderer=null,this._eventListeners=[],this._eventConfig=this.initializeEventConfig(this._options.eventConfig),this._theme=this._options.disableTheme?null:Li.getDefaultTheme(),this.parseBuiltIn(),(i=this._options).mode&&Me.setEnv(i.mode,i.modeParams||{}),this.initializeRenderer(),this._eventConfig.disable||this.initEvent(),this._bindResizeEvent(),this._needBuildLayoutTree=!0,this._layoutState=Cs.before,this.theme(this._theme)}pauseProgressive(){return!1}resumeProgressive(){return!1}restartProgressive(){return!1}findProgressiveMarks(){const t=[];return this.traverseMarkTree(e=>{t.push(e)},e=>e.markType!==Z.group&&e.isProgressive()),t.length?(this._progressiveMarks=t,this.renderer&&this.renderer.combineIncrementalLayers(),t):(this._progressiveMarks=null,null)}doPreProgressive(){if(this._progressiveMarks&&this._progressiveMarks.some(t=>t.isDoingProgressive())){const t=Me.getRequestAnimationFrame();this._progressiveRafId=t(this.handleProgressiveFrame)}else this._progressiveMarks&&this.animate&&this._progressiveMarks.every(t=>t.canAnimateAfterProgressive())?this.animate.animate():this._progressiveMarks&&(this._progressiveMarks=null)}clearProgressive(){this._progressiveRafId&&Me.getCancelAnimationFrame()(this._progressiveRafId),this._progressiveMarks&&this._progressiveMarks.length&&(this._progressiveMarks.forEach(t=>{t.clearProgressive()}),this._progressiveMarks=null)}release(){var t,e,i,n;this.removeAllInteractions(),this.releaseStageEvent(),this._unBindResizeEvent(),this.clearProgressive(),V.unregisterRuntimeTransforms(),Tt.setInstance(null),(t=this.animate)===null||t===void 0||t.stop(),this.grammars.release(),this._cachedGrammars.release(),this._dataflow.release(),this._dataflow=null,(i=(e=this.renderer)===null||e===void 0?void 0:e.release)===null||i===void 0||i.call(e),this.renderer=null,this._boundInteractions=null,this.removeAllListeners(),(n=this._eventListeners)===null||n===void 0||n.forEach(r=>{r.source.removeEventListener(r.type,r.handler)}),this._eventListeners=null}}const HR=()=>{En(),HE(),V.registerGraphic(Z.arc,Xd),Vr("arc",Nc)},VR=()=>{En(),Lr(),Vr("rect",Mo),V.registerGraphic(Z.rect,fh)};class kx extends Og{parseAddition(t){return super.parseAddition(t),this.scale(t.scale),this}scale(t){if(this.spec.scale){const i=Q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this.detach(i),this.spec.scale=void 0}const e=Q(t)?this.view.getScaleById(t):t;return this.spec.scale=e,this.attach(e),this._updateComponentEncoders(),this.commit(),this}getScale(){return Q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale}}const Tx=(s,t,e,i,n,r)=>{var a;const o=s.getCoordinateAxisPosition();n&&n.position==="auto"&&(n.position=e?"content":o);const l=s.getCoordinateAxisPoints(i);if(l){const u={start:l[0],end:l[1],verticalFactor:(o==="top"||o==="left"?-1:1)*(e?-1:1)*(!((a=s.getSpec().range)===null||a===void 0)&&a.reversed?-1:1)};if(r&&t.type==="polar"){const d=t.angle();u.center=t.origin(),u.startAngle=d[0],u.endAngle=d[1]}return u}const h=t.radius(),c=t.angle();return{center:t.origin(),radius:h[1],innerRadius:h[0],inside:e,startAngle:c[0],endAngle:c[1]}};class Cx extends kx{constructor(t,e,i){super(t,ee.axis,e),this.spec.componentType=ee.axis,this.mode=i}parseAddition(t){return super.parseAddition(t),this.axisType(t.axisType),this.tickCount(t.tickCount),this.inside(t.inside),this.baseValue(t.baseValue),this}scale(t){return super.scale(t),this._axisComponentType=null,this}axisType(t){return this.spec.axisType=t,this._axisComponentType=null,this._prepareRejoin(),this.commit(),this}addGraphicItem(t,e){const i=rt({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},t),n=V.createGraphicComponent(this._getAxisComponentType(),i,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(i,e,n)}tickCount(t){const e=Q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return e&&e.tickCount(t),this.setFunctionSpec(t,"tickCount")}inside(t){return this.setFunctionSpec(t,"inside")}baseValue(t){return this.setFunctionSpec(t,"baseValue")}getAxisComponentType(){return this._axisComponentType}_updateComponentEncoders(){const t=Q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale,e=Object.assign({update:{}},this.spec.encode),i=Object.keys(e).reduce((n,r)=>{const a=e[r];return a&&(n[r]={callback:(o,l,h)=>{var c,u;const d=this.spec.skipTheme?null:this.view.getCurrentTheme();let p=Hn(a,o,l,h);const g=li(this.spec.inside,h,o,l),f=li(this.spec.baseValue,h,o,l),m=(c=t==null?void 0:t.getCoordinate)===null||c===void 0?void 0:c.call(t);m&&(p=Object.assign(Tx(t,m,g,f,this.spec.layout),p));const v=(u=t==null?void 0:t.getScale)===null||u===void 0?void 0:u.call(t),y=li(this.spec.tickCount,h,o,l);switch(this._getAxisComponentType()){case Ts.lineAxis:return((_,b,x,S)=>{var A,w,k,T;const C=(w=(A=b==null?void 0:b.components)===null||A===void 0?void 0:A.axis)!==null&&w!==void 0?w:{};return _?rt({},C,{items:[((T=(k=_.tickData)===null||k===void 0?void 0:k.call(_,S))!==null&&T!==void 0?T:[]).map(M=>({id:M.index,label:M.tick,value:M.value,rawValue:M.tick}))]},x??{}):rt({},C,x??{})})(v,d,p,y);case Ts.circleAxis:return((_,b,x,S)=>{var A,w,k,T;const C=(w=(A=b==null?void 0:b.components)===null||A===void 0?void 0:A.circleAxis)!==null&&w!==void 0?w:{};return _?rt({},C,{items:[((T=(k=_.tickData)===null||k===void 0?void 0:k.call(_,S))!==null&&T!==void 0?T:[]).map(M=>({id:M.index,label:M.tick,value:M.value,rawValue:M.tick}))]},x??{}):rt({},C,x??{})})(v,d,p,y)}return p}}),n},{});this._encoders=i}_getAxisComponentType(){var t;if(this._axisComponentType)return this._axisComponentType;let e=this.spec.axisType;if(I(e)){const i=Q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;e=!((t=i==null?void 0:i.getCoordinate)===null||t===void 0)&&t.call(i)?i.getCoordinateAxisPoints()?"line":"circle":"line"}return this._axisComponentType=e==="circle"?Ts.circleAxis:Ts.lineAxis,this._axisComponentType}}Cx.componentType=ee.axis;const Mx=()=>{V.registerGraphicComponent(Ts.lineAxis,(s,t)=>new So(s,t)),V.registerComponent(ee.axis,Cx)};var WR=function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e};let Ex=class extends Og{constructor(s,t){super(s,ee.label,t),this.spec.componentType=ee.label}parseAddition(s){return super.parseAddition(s),this.labelStyle(s.labelStyle),this.size(s.size),this.target(s.target),this}labelStyle(s){return this.setFunctionSpec(s,"labelStyle")}size(s){return this.setFunctionSpec(s,"size")}target(s){if(this.spec.target){const t=Y(this.spec.target).map(e=>Q(e)?this.view.getMarkById(e):e);this.detach(t)}if(this.spec.target=s,s){const t=Y(s).map(e=>Q(e)?this.view.getMarkById(e):e);this.attach(t)}return this.commit(),this}_updateComponentEncoders(){const s=Object.assign({update:{}},this.spec.encode),t=Object.keys(s).reduce((e,i)=>{const n=s[i];return n&&(e[i]={callback:(r,a,o)=>{var l,h,c,u;const d=Y(this.spec.target).map(m=>Q(m)?this.view.getMarkById(m):m),p=(h=(l=this.group)===null||l===void 0?void 0:l.getGroupGraphicItem)===null||h===void 0?void 0:h.call(l);let g=li(this.spec.size,o);g||(g=p?{width:(c=p.attribute.width)!==null&&c!==void 0?c:p.AABBBounds.width(),height:(u=p.attribute.height)!==null&&u!==void 0?u:p.AABBBounds.height()}:{width:1/0,height:1/0});const f=this.spec.skipTheme?null:this.view.getCurrentTheme();return function(m,v,y,_,b){let x=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};var S;const A=(S=x.components)===null||S===void 0?void 0:S.dataLabel,w=m.map((T,C)=>{var M,B,O,E,L;const P=Object.assign(Object.assign({},b),{labelIndex:C}),F=(M=li(_,P,T))!==null&&M!==void 0?M:{},{components:j={}}=x;let D={};switch(T.markType){case Z.line:case Z.area:D=F.type==="line"?j.lineLabel:F.type==="area"?j.areaLabel:j.lineDataLabel;break;case Z.rect:case Z.rect3d:case Z.interval:D=j.rectLabel;break;case Z.symbol:case Z.circle:case Z.cell:D=j.symbolLabel;break;case Z.arc:case Z.arc3d:D=j.arcLabel;break;case Z.polygon:case Z.path:default:D=j.pointLabel}const N=(B=F.data)!==null&&B!==void 0?B:[],J=(E=(O=D==null?void 0:D.data)===null||O===void 0?void 0:O[0])!==null&&E!==void 0?E:{};if(N&&N.length>0)N.forEach(($,G)=>{if(T.elements[G]){const z=Hn(y,$,T.elements[G],P);rt($,J,z)}});else{const $=(G,z)=>{const{data:ot}=G,ft=WR(G,["data"]);return Object.assign(Object.assign({},rt({},z,ft)),{data:ot})};T.elements.forEach(G=>{if(G.getGraphicItem().releaseStatus!=="willRelease")if(T.isCollectionMark())G.getDatum().forEach(z=>{const ot=Hn(y,z,G,P);N.push($(ot,J))});else{const z=Hn(y,G.getDatum(),G,P);N.push($(z,J))}})}const X=rt({},D,{baseMarkGroupName:(L=T.graphicItem)===null||L===void 0?void 0:L.name,getBaseMarks:()=>T.elements.map($=>$.getGraphicItem())},F??{});return X.data=N??D.data,X}).filter(T=>!I(T)),k=rt({},A,{size:v});return k.dataLabels=w,k}(d,g,n,this.spec.labelStyle,o,f)}}),e},{});this._encoders=t}};Ex.componentType=ee.label;class Bx extends kx{constructor(t,e,i){super(t,ee.grid,e),this.spec.componentType=ee.grid,this.mode=i}parseAddition(t){return super.parseAddition(t),this.target(t.target),this.gridType(t.gridType),this.gridShape(t.gridShape),this}scale(t){return super.scale(t),this._gridComponentType=null,this}gridType(t){return this.spec.gridType=t,this._gridComponentType=null,this._prepareRejoin(),this.commit(),this}gridShape(t){return this.spec.gridShape=t,this.commit(),this}target(t){if(this.spec.target){const i=Q(this.spec.target)?this.view.getMarkById(this.spec.target):this.spec.target;this.detach(i)}this.spec.target=t;const e=Q(t)?this.view.getMarkById(t):t;return this.attach(e),this._targetAxis=e,this._gridComponentType=null,this._updateComponentEncoders(),this.commit(),this}tickCount(t){const e=Q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return e&&e.tickCount(t),this.setFunctionSpec(t,"tickCount")}inside(t){return this.setFunctionSpec(t,"inside")}baseValue(t){return this.setFunctionSpec(t,"baseValue")}addGraphicItem(t,e){const i=rt({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},t),n=V.createGraphicComponent(this._getGridComponentType(),i,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(i,e,n)}_updateComponentEncoders(){const t=Object.assign({update:{}},this.spec.encode),e=Object.keys(t).reduce((i,n)=>{const r=t[n];return r&&(i[n]={callback:(a,o,l)=>{var h,c,u,d;const p=this.spec.skipTheme?null:this.view.getCurrentTheme();let g,f=Hn(r,a,o,l);const m=li(this.spec.baseValue,l,a,o);if(this._targetAxis){const _=(h=this._targetAxis.getSpec())===null||h===void 0?void 0:h.scale;g=Q(_)?this.view.getScaleById(_):_;const b=this._targetAxis.elements[0];if(b)switch(this._getGridComponentType()){case Fe.lineAxisGrid:f=Object.assign({x:b.getGraphicAttribute("x"),y:b.getGraphicAttribute("y"),start:b.getGraphicAttribute("start"),end:b.getGraphicAttribute("end"),verticalFactor:(c=b.getGraphicAttribute("verticalFactor"))!==null&&c!==void 0?c:1},f);break;case Fe.circleAxisGrid:f=Object.assign({x:b.getGraphicAttribute("x"),y:b.getGraphicAttribute("y"),center:b.getGraphicAttribute("center"),radius:b.getGraphicAttribute("radius"),innerRadius:b.getGraphicAttribute("innerRadius"),inside:b.getGraphicAttribute("inside"),startAngle:b.getGraphicAttribute("startAngle"),endAngle:b.getGraphicAttribute("endAngle")},f)}}else{g=Q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;const _=li(this.spec.inside,l,a,o),b=(u=g==null?void 0:g.getCoordinate)===null||u===void 0?void 0:u.call(g);b&&(f=Object.assign(Tx(g,b,_,m,this.spec.layout,!0),f))}this._getGridComponentType()===Fe.lineAxisGrid&&(f=this.spec.gridShape!=="line"&&this.spec.gridShape?Object.assign({center:f.start,closed:!0},f,{type:this.spec.gridShape}):Object.assign({},f,{type:"line"}));const v=(d=g==null?void 0:g.getScale)===null||d===void 0?void 0:d.call(g),y=li(this.spec.tickCount,l,a,o);switch(this._getGridComponentType()){case Fe.lineAxisGrid:return((_,b,x,S)=>{var A,w,k,T;const C=(w=(A=b==null?void 0:b.components)===null||A===void 0?void 0:A.grid)!==null&&w!==void 0?w:{};return _?rt({},C,{items:((T=(k=_.tickData)===null||k===void 0?void 0:k.call(_,S))!==null&&T!==void 0?T:[]).map(M=>({id:M.index,label:M.tick,value:M.value,rawValue:M.tick}))},x??{}):rt({},C,x??{})})(v,p,f,y);case Fe.circleAxisGrid:return((_,b,x,S)=>{var A,w,k,T;const C=(w=(A=b==null?void 0:b.components)===null||A===void 0?void 0:A.circleGrid)!==null&&w!==void 0?w:{};return _?rt({},C,{items:((T=(k=_.tickData)===null||k===void 0?void 0:k.call(_,S))!==null&&T!==void 0?T:[]).map(M=>({id:M.index,label:M.tick,value:M.value,rawValue:M.tick}))},x??{}):rt({},C,x??{})})(v,p,f,y)}return f}}),i},{});this._encoders=e}_getGridComponentType(){var t;if(this._gridComponentType)return this._gridComponentType;if(this.spec.gridType)this.spec.gridType==="circle"?this._gridComponentType=Fe.circleAxisGrid:this._gridComponentType=Fe.lineAxisGrid;else if(this._targetAxis)switch(this._targetAxis.getAxisComponentType()){case Ts.circleAxis:this._gridComponentType=Fe.circleAxisGrid;break;case Ts.lineAxis:default:this._gridComponentType=Fe.lineAxisGrid}else if(this.spec.scale){const e=Q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this._gridComponentType=!((t=e==null?void 0:e.getCoordinate)===null||t===void 0)&&t.call(e)?e.getCoordinateAxisPoints()?Fe.lineAxisGrid:Fe.circleAxisGrid:Fe.lineAxisGrid}else this._gridComponentType=Fe.lineAxisGrid;return this._gridComponentType}}Bx.componentType=ee.grid;const Rx=()=>{V.registerGraphicComponent(Fe.lineAxisGrid,(s,t)=>new rb(s,t)),V.registerComponent(ee.grid,Bx)};function Ix(s){return s.reduce((t,e)=>t+e,0)}const UR={min:ji,max:Ge,average:function(s){return s.length===0?0:Ix(s)/s.length},sum:Ix};function GR(s,t,e,i){const n=Math.floor(t.length/s),r=[],a=t.length;let o,l,h,c=0,u=0;r[u++]=c;for(let d=1;d<a-1;d+=n){const p=Math.min(d+n,a-1),g=Math.min(d+2*n,a),f=(g+p)/2;let m=0;for(let x=p;x<g;x++){const S=t[x][i];Number.isNaN(S)||(m+=S)}m/=g-p;const v=d,y=Math.min(d+n,a),_=d-1,b=t[c][i];o=-1,h=v;for(let x=v;x<y;x++){const S=t[x][i];Number.isNaN(i)||(l=Math.abs((_-f)*(S-b)-(_-x)*(m-b)),l>o&&(o=l,h=x))}r[u++]=h,c=h}return r[u-1]!==a-1&&(r[u++]=a-1),r.map(d=>e?t[d].i:d)}function ou(s,t,e,i,n){let r=Math.floor(t.length/s);const a=[],o=t.length;let l=0,h=[];a.push(l),t[l][n]=t[l][n];for(let c=1;c<o-1;c+=r){r>o-c&&(r=o-c,h.length=r),h=[];for(let d=0;d<r;d++)h.push(t[c+d][n]);const u=UR[i](h);l=Math.min(Math.round(c+h.length/2)||0,o-1),t[l][n]=u,a.push(l)}return a.map(c=>e?t[c].i:c)}function YR(s,t,e,i){return ou(s,t,e,"min",i)}function $R(s,t,e,i){return ou(s,t,e,"max",i)}function XR(s,t,e,i){return ou(s,t,e,"average",i)}function KR(s,t,e,i){return ou(s,t,e,"sum",i)}const qR=(s,t)=>{let e=s.size;const i=s.factor||1;if(Array.isArray(e)&&(e=Math.floor(e[1]-e[0])),e*=i,e<=0)return[];if(t.length<=e)return t;if(s.skipfirst)return t.slice(0,1);const{mode:n,yfield:r,groupBy:a}=s,o=r??"y";let l=GR;if(n==="min"?l=YR:n==="max"?l=$R:n==="average"?l=XR:n==="sum"&&(l=KR),t.length){const h={};if(a){for(let u=0,d=t.length;u<d;u++){const p=t[u],g=p[a];h[g]?h[g].push({[o]:p[o],i:u}):(h[g]=[],h[g].push({[o]:p[o],i:u}))}let c=[];return Object.keys(h).forEach(u=>{const d=h[u];if(d.length<=e){const p=d.map(g=>g.i);c=c.concat(p)}else{const p=l(e,d,!0,o);c=c.concat(p),d.forEach(g=>t[g.i][o]=g[o])}}),c.sort((u,d)=>u-d),c.map(u=>t[u])}return l(e,t,!1,o).map(c=>t[c])}return[]},ZR=(s,t)=>{if(!t||t.length===0)return;let{radius:e}=s;I(e)&&t[0].mark.markType==="symbol"&&(e=!0);const{direction:i,delta:n,deltaMul:r=1,groupBy:a}=s,o=l=>{(function(c){c.forEach(u=>{u.getGraphicAttribute(jn)&&(u.setGraphicAttribute("visible",!0),u.setGraphicAttribute(jn,!1))})})(l);const h=s.sort?l.slice().sort((c,u)=>c.getGraphicAttribute("x")-u.getGraphicAttribute("x")):l;i===0?function(c,u,d,p){if(p){let f=-1/0,m=0,v=0;const y=I(u);let _=u;c.forEach(b=>{if(b.getGraphicAttribute("visible")===!1)return;const x=b.getGraphicAttribute("size")/2,S=b.getGraphicAttribute("x"),A=b.getGraphicAttribute("y");y&&(_=(x+m)*d),v=(-1/0-S)**2+(f-A)**2,v<(_+m+x)**2?b.getGraphicAttribute("forceShow")||(b.setGraphicAttribute(jn,!0),b.setGraphicAttribute("visible",!1)):f=A,m=x})}}(h,n,r,e):i===1?function(c,u,d,p){if(p){let g=-1/0,f=0;const m=I(u);let v=u;c.forEach(y=>{if(y.getGraphicAttribute("visible")===!1)return;const _=y.getGraphicAttribute("size")/2,b=y.getGraphicAttribute("x");m&&(v=(_+f)*d),Math.abs(b-g)<v+f+_?y.getGraphicAttribute("forceShow")||(y.setGraphicAttribute(jn,!0),y.setGraphicAttribute("visible",!1)):g=b,f=_})}}(h,n,r,e):function(c,u,d,p){if(p){let g=-1/0,f=0;const m=I(u);let v=u;c.forEach(y=>{if(y.getGraphicAttribute("visible")===!1)return;const _=y.getGraphicAttribute("size")/2,b=y.getGraphicAttribute("y");m&&(v=(_+f)*d),Math.abs(b-g)<v+f+_?y.getGraphicAttribute("forceShow")||(y.setGraphicAttribute(jn,!0),y.setGraphicAttribute("visible",!1)):g=b,f=_})}}(h,n,r,e)};if(a){const l=t.reduce((h,c)=>{const u=c.getDatum()[a];return h[u]?h[u].push(c):h[u]=[c],h},{});Object.keys(l).forEach(h=>{o(l[h])})}else o(t);return t},Lg=()=>{V.registerTransform("sampling",{transform:qR,markPhase:"afterEncode"},!0)},Ox=()=>{V.registerTransform("markoverlap",{transform:ZR,markPhase:"afterEncode"},!0)},JR=(s,t,e)=>{var i;const n=s.getGraphicAttribute("clipRangeByDimension",!1),r=(i=s.getGraphicAttribute("clipRange",!1))!==null&&i!==void 0?i:1;return t&&t.clipDimension?{from:{clipRange:0,clipRangeByDimension:t.clipDimension},to:{clipRange:r,clipRangeByDimension:n}}:{from:{clipRange:0},to:{clipRange:r}}},QR=(s,t,e)=>{var i;const n=s.getGraphicAttribute("clipRangeByDimension",!0),r=(i=s.getGraphicAttribute("clipRange",!0))!==null&&i!==void 0?i:1;return t&&t.clipDimension?{from:{clipRange:r,clipRangeByDimension:t.clipDimension},to:{clipRange:0,clipRangeByDimension:n}}:{from:{clipRange:r},to:{clipRange:0}}},tI=(s,t,e)=>{switch(t==null?void 0:t.direction){case"x":{const i=s.getFinalAnimationAttribute("x"),n=s.getFinalAnimationAttribute("x1"),r=s.getFinalAnimationAttribute("width");return{from:R(r)?{x:i+r/2,x1:void 0,width:0}:{x:(i+n)/2,x1:(i+n)/2,width:void 0},to:{x:i,x1:n,width:r}}}case"y":{const i=s.getFinalAnimationAttribute("y"),n=s.getFinalAnimationAttribute("y1"),r=s.getFinalAnimationAttribute("height");return{from:R(r)?{y:i+r/2,y1:void 0,height:0}:{y:(i+n)/2,y1:(i+n)/2,height:void 0},to:{y:i,y1:n,height:r}}}default:{const i=s.getFinalAnimationAttribute("x"),n=s.getFinalAnimationAttribute("x1"),r=s.getFinalAnimationAttribute("width"),a=s.getFinalAnimationAttribute("y"),o=s.getFinalAnimationAttribute("y1"),l=s.getFinalAnimationAttribute("height"),h={};return R(r)?(h.x=i+r/2,h.width=0,h.x1=void 0):(h.x=(i+n)/2,h.x1=(i+n)/2,h.width=void 0),R(l)?(h.y=a+l/2,h.height=0,h.y1=void 0):(h.y=(a+o)/2,h.y1=(a+o)/2,h.height=void 0),{from:h,to:{x:i,y:a,x1:n,y1:o,width:r,height:l}}}}},eI=(s,t,e)=>{switch(t==null?void 0:t.direction){case"x":{const i=s.getFinalAnimationAttribute("x"),n=s.getFinalAnimationAttribute("x1"),r=s.getFinalAnimationAttribute("width");return{to:R(r)?{x:i+r/2,x1:void 0,width:0}:{x:(i+n)/2,x1:(i+n)/2,width:void 0}}}case"y":{const i=s.getFinalAnimationAttribute("y"),n=s.getFinalAnimationAttribute("y1"),r=s.getFinalAnimationAttribute("height");return{to:R(r)?{y:i+r/2,y1:void 0,height:0}:{y:(i+n)/2,y1:(i+n)/2,height:void 0}}}default:{const i=s.getFinalAnimationAttribute("x"),n=s.getFinalAnimationAttribute("y"),r=s.getFinalAnimationAttribute("x1"),a=s.getFinalAnimationAttribute("y1"),o=s.getFinalAnimationAttribute("width"),l=s.getFinalAnimationAttribute("height"),h={};return R(o)?(h.x=i+o/2,h.width=0,h.x1=void 0):(h.x=(i+r)/2,h.x1=(i+r)/2,h.width=void 0),R(l)?(h.y=n+l/2,h.height=0,h.y1=void 0):(h.y=(n+a)/2,h.y1=(n+a)/2,h.height=void 0),{to:h}}}},iI=(s,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?function(n,r,a){var o;const l=n.getFinalAnimationAttribute("x"),h=n.getFinalAnimationAttribute("x1"),c=n.getFinalAnimationAttribute("width");let u;return r&&r.orient==="negative"?it(r.overall)?u=r.overall:a.group?(u=(o=a.groupWidth)!==null&&o!==void 0?o:a.group.getBounds().width(),a.groupWidth=u):u=a.width:u=it(r==null?void 0:r.overall)?r==null?void 0:r.overall:0,{from:{x:u,x1:I(h)?void 0:u,width:I(c)?void 0:0},to:{x:l,x1:h,width:c}}}(s,t,e):function(n,r,a){const o=n.getFinalAnimationAttribute("x"),l=n.getFinalAnimationAttribute("x1"),h=n.getFinalAnimationAttribute("width");if(r&&r.orient==="negative"){const u=R(h)?Math.max(o,o+h):Math.max(o,l);return{from:{x:u,x1:I(l)?void 0:u,width:I(h)?void 0:0},to:{x:o,x1:l,width:h}}}const c=R(h)?Math.min(o,o+h):Math.min(o,l);return{from:{x:c,x1:I(l)?void 0:c,width:I(h)?void 0:0},to:{x:o,x1:l,width:h}}}(s,t)},sI=(s,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?function(n,r,a){var o;const l=n.getFinalAnimationAttribute("x1"),h=n.getFinalAnimationAttribute("width");let c;return r&&r.orient==="negative"?it(r.overall)?c=r.overall:a.group?(c=(o=a.groupWidth)!==null&&o!==void 0?o:a.group.getBounds().width(),a.groupWidth=c):c=a.width:c=it(r==null?void 0:r.overall)?r.overall:0,{to:{x:c,x1:I(l)?void 0:c,width:I(h)?void 0:0}}}(s,t,e):function(n,r,a){const o=n.getFinalAnimationAttribute("x"),l=n.getFinalAnimationAttribute("x1"),h=n.getFinalAnimationAttribute("width");if(r&&r.orient==="negative"){const u=R(h)?Math.max(o,o+h):Math.max(o,l);return{to:{x:u,x1:I(l)?void 0:u,width:I(h)?void 0:0}}}const c=R(h)?Math.min(o,o+h):Math.min(o,l);return{to:{x:c,x1:I(l)?void 0:c,width:I(h)?void 0:0}}}(s,t)},nI=(s,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?function(n,r,a){var o;const l=n.getFinalAnimationAttribute("y"),h=n.getFinalAnimationAttribute("y1"),c=n.getFinalAnimationAttribute("height");let u;return r&&r.orient==="negative"?it(r.overall)?u=r.overall:a.group?(u=(o=a.groupHeight)!==null&&o!==void 0?o:a.group.getBounds().height(),a.groupHeight=u):u=a.height:u=it(r==null?void 0:r.overall)?r.overall:0,{from:{y:u,y1:I(h)?void 0:u,height:I(c)?void 0:0},to:{y:l,y1:h,height:c}}}(s,t,e):function(n,r,a){const o=n.getFinalAnimationAttribute("y"),l=n.getFinalAnimationAttribute("y1"),h=n.getFinalAnimationAttribute("height");if(r&&r.orient==="negative"){const u=R(h)?Math.max(o,o+h):Math.max(o,l);return{from:{y:u,y1:I(l)?void 0:u,height:I(h)?void 0:0},to:{y:o,y1:l,height:h}}}const c=R(h)?Math.min(o,o+h):Math.min(o,l);return{from:{y:c,y1:I(l)?void 0:c,height:I(h)?void 0:0},to:{y:o,y1:l,height:h}}}(s,t)},rI=(s,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?function(n,r,a){var o;const l=n.getFinalAnimationAttribute("y1"),h=n.getFinalAnimationAttribute("height");let c;return r&&r.orient==="negative"?it(r.overall)?c=r.overall:a.group?(c=(o=a.groupHeight)!==null&&o!==void 0?o:a.group.getBounds().height(),a.groupHeight=c):c=a.height:c=it(r==null?void 0:r.overall)?r.overall:0,{to:{y:c,y1:I(l)?void 0:c,height:I(h)?void 0:0}}}(s,t,e):function(n,r,a){const o=n.getFinalAnimationAttribute("y"),l=n.getFinalAnimationAttribute("y1"),h=n.getFinalAnimationAttribute("height");if(r&&r.orient==="negative"){const u=R(h)?Math.max(o,o+h):Math.max(o,l);return{to:{y:u,y1:I(l)?void 0:u,height:I(h)?void 0:0}}}const c=R(h)?Math.min(o,o+h):Math.min(o,l);return{to:{y:c,y1:I(l)?void 0:c,height:I(h)?void 0:0}}}(s,t)},aI=(s,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?((n,r,a)=>{const o=n.getFinalAnimationAttributes();if(r&&r.orient==="anticlockwise"){const h=it(r.overall)?r.overall:2*Math.PI;return{from:{startAngle:h,endAngle:h},to:{startAngle:o==null?void 0:o.startAngle,endAngle:o==null?void 0:o.endAngle}}}const l=it(r==null?void 0:r.overall)?r.overall:0;return{from:{startAngle:l,endAngle:l},to:{startAngle:o==null?void 0:o.startAngle,endAngle:o==null?void 0:o.endAngle}}})(s,t):((n,r,a)=>{const o=n.getFinalAnimationAttributes();return r&&r.orient==="anticlockwise"?{from:{startAngle:o==null?void 0:o.endAngle},to:{startAngle:o==null?void 0:o.startAngle}}:{from:{endAngle:o==null?void 0:o.startAngle},to:{endAngle:o==null?void 0:o.endAngle}}})(s,t)},oI=(s,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?((n,r,a)=>{if(r&&r.orient==="anticlockwise"){const l=it(r.overall)?r.overall:2*Math.PI;return{from:{startAngle:n.getGraphicAttribute("startAngle",!0),endAngle:n.getGraphicAttribute("endAngle",!0)},to:{startAngle:l,endAngle:l}}}const o=it(r==null?void 0:r.overall)?r.overall:0;return{from:{startAngle:n.getGraphicAttribute("startAngle",!0),endAngle:n.getGraphicAttribute("endAngle",!0)},to:{startAngle:o,endAngle:o}}})(s,t):((n,r,a)=>{const o=n.getFinalAnimationAttributes();return r&&r.orient==="anticlockwise"?{from:{startAngle:n.getGraphicAttribute("startAngle",!0)},to:{startAngle:o==null?void 0:o.endAngle}}:{from:{endAngle:n.getGraphicAttribute("endAngle",!0)},to:{endAngle:o==null?void 0:o.startAngle}}})(s,t)},lI=(s,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?((n,r,a)=>{const o=n.getFinalAnimationAttributes(),l=it(r==null?void 0:r.overall)?r.overall:0;return{from:{innerRadius:l,outerRadius:l},to:{innerRadius:o==null?void 0:o.innerRadius,outerRadius:o==null?void 0:o.outerRadius}}})(s,t):((n,r,a)=>{const o=n.getFinalAnimationAttributes();return r&&r.orient==="inside"?{from:{innerRadius:o==null?void 0:o.outerRadius},to:{innerRadius:o==null?void 0:o.innerRadius}}:{from:{outerRadius:o==null?void 0:o.innerRadius},to:{outerRadius:o==null?void 0:o.outerRadius}}})(s,t)},hI=(s,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?((n,r,a)=>{const o=it(r==null?void 0:r.overall)?r.overall:0;return{from:{innerRadius:n.getGraphicAttribute("innerRadius",!0),outerRadius:n.getGraphicAttribute("outerRadius",!0)},to:{innerRadius:o,outerRadius:o}}})(s,t):((n,r,a)=>{const o=n.getFinalAnimationAttributes();return r&&r.orient==="inside"?{from:{innerRadius:n.getGraphicAttribute("innerRadius",!0)},to:{innerRadius:o==null?void 0:o.outerRadius}}:{from:{outerRadius:n.getGraphicAttribute("outerRadius",!0)},to:{outerRadius:o==null?void 0:o.innerRadius}}})(s,t)},Px=(s,t,e)=>{const i=s.getGraphicAttribute("points",!1),n={x:0,y:0};return i.forEach(r=>{n.x+=r.x,n.y+=r.y}),n.x/=i.length,n.y/=i.length,t&&t.center&&(q(t.center.x)&&(n.x=t.center.x),q(t.center.y)&&(n.y=t.center.y)),s.mark.markType==="area"&&(n.x1=n.x,n.y1=n.y),i.map(r=>Object.assign({},r,n))},cI=(s,t,e)=>({from:{points:Px(s,t)},to:{points:s.getGraphicAttribute("points",!1)}}),uI=(s,t,e)=>({from:{points:s.getGraphicAttribute("points",!0)},to:{points:Px(s,t)}}),Lx=(s,t,e)=>s.getGraphicAttribute("points",!1).map(i=>{var n;if(t&&t.orient==="negative"){let r=e.width;return e.group&&(r=(n=e.groupWidth)!==null&&n!==void 0?n:e.group.getBounds().width(),e.groupWidth=r),Object.assign(Object.assign({},i),{x:r,y:i.y,x1:r,y1:i.y1,defined:i.defined!==!1})}return Object.assign(Object.assign({},i),{x:0,y:i.y,x1:0,y1:i.y1,defined:i.defined!==!1})}),dI=(s,t,e)=>({from:{points:Lx(s,t,e)},to:{points:s.getGraphicAttribute("points",!1)}}),pI=(s,t,e)=>({from:{points:s.getGraphicAttribute("points",!0)},to:{points:Lx(s,t,e)}}),Dx=(s,t,e)=>s.getGraphicAttribute("points",!1).map(i=>{var n;if(t&&t.orient==="negative"){let r=e.height;return e.group&&(r=(n=e.groupHeight)!==null&&n!==void 0?n:e.group.getBounds().height(),e.groupHeight=r),Object.assign(Object.assign({},i),{x:i.x,y:r,x1:i.x1,y1:r,defined:i.defined!==!1})}return Object.assign(Object.assign({},i),{x:i.x,y:0,x1:i.x1,y1:0,defined:i.defined!==!1})}),gI=(s,t,e)=>({from:{points:Dx(s,t,e)},to:{points:s.getGraphicAttribute("points",!1)}}),fI=(s,t,e)=>({from:{points:s.getGraphicAttribute("points",!0)},to:{points:Dx(s,t,e)}}),mI=()=>{V.registerAnimationType("clipIn",JR)},vI=()=>{V.registerAnimationType("clipOut",QR)},yI=()=>{V.registerAnimationType("growCenterIn",tI)},_I=()=>{V.registerAnimationType("growCenterOut",eI)},bI=()=>{V.registerAnimationType("growHeightIn",nI)},xI=()=>{V.registerAnimationType("growHeightOut",rI)},SI=()=>{V.registerAnimationType("growWidthIn",iI)},AI=()=>{V.registerAnimationType("growWidthOut",sI)},kI=()=>{V.registerAnimationType("growPointsIn",cI)},wI=()=>{V.registerAnimationType("growPointsOut",uI)},TI=()=>{V.registerAnimationType("growPointsXIn",dI)},CI=()=>{V.registerAnimationType("growPointsXOut",pI)},MI=()=>{V.registerAnimationType("growPointsYIn",gI)},EI=()=>{V.registerAnimationType("growPointsYOut",fI)},BI=()=>{V.registerAnimationType("growAngleIn",aI)},RI=()=>{V.registerAnimationType("growAngleOut",oI)},II=()=>{V.registerAnimationType("growRadiusIn",lI)},OI=()=>{V.registerAnimationType("growRadiusOut",hI)},PI=()=>{V.registerStageEventPlugin("gesture",DC)},LI=["pointerdown","pointerup","pointerupoutside","pointertap","pointerover","pointermove","pointerenter","pointerleave","pointerout","mousedown","mouseup","mouseupoutside","rightdown","rightup","rightupoutside","click","dblclick","mousemove","mouseover","mouseout","mouseenter","mouseleave","wheel","touchstart","touchend","touchendoutside","touchmove","touchcancel","tap","dragstart","drag","dragenter","dragleave","dragover","dragend","drop","pan","panstart","panend","press","pressup","pressend","pinch","pinchstart","pinchend","swipe"];var pt,It,We;(function(s){s.initialized="initialized",s.rendered="rendered",s.renderFinished="renderFinished",s.animationFinished="animationFinished",s.regionSeriesDataFilterOver="regionSeriesDataFilterOver",s.afterInitData="afterInitData",s.afterInitEvent="afterInitEvent",s.afterInitMark="afterInitMark",s.rawDataUpdate="rawDataUpdate",s.viewDataFilterOver="viewDataFilterOver",s.viewDataUpdate="viewDataUpdate",s.viewDataStatisticsUpdate="viewDataStatisticsUpdate",s.markDeltaYUpdate="markDeltaYUpdate",s.viewDataLabelUpdate="viewDataLabelUpdate",s.scaleDomainUpdate="scaleDomainUpdate",s.scaleUpdate="scaleUpdate",s.dataZoomChange="dataZoomChange",s.drill="drill",s.layoutStart="layoutStart",s.layoutEnd="layoutEnd",s.layoutRectUpdate="layoutRectUpdate",s.playerPlay="playerPlay",s.playerPause="playerPause",s.playerEnd="playerEnd",s.playerChange="playerChange",s.playerForward="playerForward",s.playerBackward="playerBackward",s.scrollBarChange="scrollBarChange",s.brushStart="brushStart",s.brushChange="brushChange",s.brushEnd="brushEnd",s.brushClear="brushClear",s.legendSelectedDataChange="legendSelectedDataChange",s.legendFilter="legendFilter",s.legendItemClick="legendItemClick",s.legendItemHover="legendItemHover",s.legendItemUnHover="legendItemUnHover",s.tooltipShow="tooltipShow",s.tooltipHide="tooltipHide",s.tooltipRelease="tooltipRelease",s.afterResize="afterResize",s.afterRender="afterRender",s.afterLayout="afterLayout"})(pt||(pt={})),function(s){s.chart="chart",s.window="window",s.canvas="canvas"}(It||(It={})),function(s){s.vchart="vchart",s.chart="chart",s.model="model",s.mark="mark"}(We||(We={}));const lu=[We.mark,We.model,We.chart,We.vchart],Fx=(s,t)=>{var e,i;return s===t||!I(s)&&!I(t)&&s.value===t.value&&((e=s.axis)===null||e===void 0?void 0:e.id)===((i=t.axis)===null||i===void 0?void 0:i.id)},DI=(s,t)=>{const e=s.tooltipFilterRange,i=typeof e=="function"?e({scale:t}):e;return q(i)?[-i,i]:i},Dg=(s,t,e,i)=>{var n;const r=t.getScale(),a=fi(r.type),o=[],l=t.getOption().getChart().getSeriesInIndex(t.getSpecInfo().seriesIndexes);for(const h of l)if(h.coordinate===e){const c=Y(i(h)),u=(n=h.getViewData())===null||n===void 0?void 0:n.latestData;if(c&&u)if(a){const d=[],p=[];u.forEach((g,f)=>{var m;((m=g[c[0]])===null||m===void 0?void 0:m.toString())===(s==null?void 0:s.toString())&&(d.push(g),p.push(f))}),o.push({series:h,datum:d,key:Fg(h,p)})}else if(R(c[1])){const d=[],p=[];u.forEach((g,f)=>{var m;(((m=g[c[0]])===null||m===void 0?void 0:m.toString())===(s==null?void 0:s.toString())||R(g[c[0]])&&R(g[c[1]])&&s>=g[c[0]]&&s<g[c[1]])&&(d.push(g),p.push(f))}),o.push({series:h,datum:d,key:Fg(h,p)})}else{const d=t.getSpec(),p=DI(d,r);let g=[],f=[];if(p)u.forEach((m,v)=>{if(R(m[c[0]])){const y=m[c[0]]-s;y>=p[0]&&y<=p[1]&&(g.push(m),f.push(v))}});else{let m=1/0,v=0;u.forEach((y,_)=>{if(R(y[c[0]])){const b=Math.abs(y[c[0]]-s),x=Math.sign(y[c[0]]-s);b<m?(m=b,g=[y],f=[_],v=x):b===m&&x===v&&(g.push(y),f.push(_))}})}o.push({series:h,datum:g,key:Fg(h,f)})}}return o},Fg=(s,t)=>\`\${s.id}_\${t.join("_")}\`,hu=(s,t,e)=>{const i=s.getAllComponents().filter(n=>n.specKey==="axes"&&t(n)&&((r,a,o)=>{const l=r.getRegionsInIds(Y(a.layout.layoutBindRegionID));return l==null?void 0:l.some(h=>{const c=h.getLayoutRect(),u=h.getLayoutStartPoint();return((d,p,g)=>d.x>=p.x&&d.x<=g.x&&d.y>=p.y&&d.y<=g.y)(o,{x:u.x,y:u.y},{x:c.width+u.x,y:c.height+u.y})})})(s,n,e));return i.length?i:null},jx=(s,t)=>{if(!s)return null;const e=hu(s,l=>l.getOrient()==="angle",t),i=hu(s,l=>l.getOrient()==="radius",t);if(!(e&&e.length||i&&i.length))return null;const n=[],r=l=>l.getDimensionField()[0],{x:a,y:o}=t;return e&&e.forEach(l=>{var h;const c=l.getScale();if(c&&fi(c.type)){const u=c.domain(),d=c.range(),p=l.getCenter(),g={x:a-l.getLayoutStartPoint().x-p.x,y:o-l.getLayoutStartPoint().y-p.y};let f=db({x:1,y:0},g);f=((S,A)=>{const w=2*Math.PI,k=ji(A),T=Ge(A);return S<k?S+=Math.ceil((k-S)/w)*w:S>T&&(S-=Math.ceil((S-T)/w)*w),S})(f,d);const m=Wc(g),v=(h=i[0])===null||h===void 0?void 0:h.getScale(),y=v==null?void 0:v.range();if((f-(d==null?void 0:d[0]))*(f-(d==null?void 0:d[1]))>0||(m-(y==null?void 0:y[0]))*(m-(y==null?void 0:y[1]))>0)return;const _=l.invert(f);if(I(_))return;let b=u.findIndex(S=>(S==null?void 0:S.toString())===_.toString());b<0&&(b=void 0);const x=Dg(_,l,"polar",r);n.push({index:b,value:_,position:c.scale(_),axis:l,data:x})}}),i&&i.forEach(l=>{var h;const c=l.getScale(),u=c==null?void 0:c.range();if(c&&fi(c.type)){const d=l.getCenter(),p={x:a-l.getLayoutStartPoint().x-d.x,y:o-l.getLayoutStartPoint().y-d.y};let g=db({x:1,y:0},p);g<-Math.PI/2&&(g=2*Math.PI+g);const f=Wc(p),m=(h=e[0])===null||h===void 0?void 0:h.getScale(),v=m==null?void 0:m.range();if((g-(v==null?void 0:v[0]))*(g-(v==null?void 0:v[1]))>0||(f-(u==null?void 0:u[0]))*(f-(u==null?void 0:u[1]))>0)return;const y=c.invert(f);if(I(y))return;let _=c.domain().findIndex(x=>(x==null?void 0:x.toString())===y.toString());_<0&&(_=void 0);const b=Dg(y,l,"polar",r);n.push({index:_,value:y,position:c.scale(y),axis:l,data:b})}}),n.length?n:null};function Yt(s){return s==="bottom"||s==="top"}function Ms(s){return s==="left"||s==="right"}function Es(s){return s==="z"}function ea(s,t){return bb(s.orient)||t&&t.includes(s.orient)?s.orient:"left"}function Nx(s,t){var e;const i=(e=s.type)!==null&&e!==void 0?e:function(n,r){return r?Yt(n)?"linear":"band":Yt(n)?"band":"linear"}(s.orient,t);return{axisType:i,componentName:\`\${st.cartesianAxis}-\${i}\`}}const zx=s=>s.fieldX[0],Hx=s=>s.fieldY[0],FI=s=>{var t;return[s.fieldX[0],(t=s.fieldX2)!==null&&t!==void 0?t:s.fieldX[1]]},jI=s=>{var t;return[s.fieldY[0],(t=s.fieldY2)!==null&&t!==void 0?t:s.fieldY[1]]},Vx=(s,t)=>s?t?zx:FI:t?Hx:jI,Wx=(s,t,e)=>{var i,n;if(!s)return null;const{x:r,y:a}=t,o=(i=hu(s,g=>Yt(g.getOrient()),t))!==null&&i!==void 0?i:[],l=(n=hu(s,g=>Ms(g.getOrient()),t))!==null&&n!==void 0?n:[];if(!o.length&&!l.length)return null;const h=new Set,c=new Set,u=new Set;[o,l].forEach(g=>g.forEach(f=>{fi(f.getScale().type)?h.add(f):c.add(f),e&&f.getSpec().hasDimensionTooltip&&u.add(f)}));const d=[],p=g=>{const f=g==="x",m=f?r:a;(f?o:l).forEach(v=>{if(u.size>0){if(u.has(v)){const y=Ux(v,m,Vx(f,fi(v.getScale().type)));y&&d.push(y)}}else{const y=h.size>0;if((y?h:c).has(v)){const _=Ux(v,m,Vx(f,y));_&&d.push(_)}}})};return s.getSpec().direction==="horizontal"?(p("y"),d.length===0&&p("x")):(p("x"),d.length===0&&p("y")),d.length?d:null},Ux=(s,t,e)=>{const i=s.positionToData(t,!0);return I(i)?null:Gx(s,i,e)},Gx=(s,t,e)=>{const i=s.getScale();if(I(t))return null;let n=i.domain().findIndex(a=>(a==null?void 0:a.toString())===t.toString());n<0&&(n=void 0);const r=Dg(t,s,"cartesian",e??(Yt(s.getOrient())?zx:Hx));return{index:n,value:t,position:i.scale(t),axis:s,data:r}};class Yx{constructor(t,e){this._eventDispatcher=t,this._mode=e}get chart(){var t,e;return this._chart||(this._chart=(e=(t=this._eventDispatcher.globalInstance).getChart)===null||e===void 0?void 0:e.call(t)),this._chart}register(t,e){var i,n;((n=(i=this.chart)===null||i===void 0?void 0:i.getOption().onError)!==null&&n!==void 0?n:co)("Method not implemented.")}unregister(){var t,e;((e=(t=this.chart)===null||t===void 0?void 0:t.getOption().onError)!==null&&e!==void 0?e:co)("Method not implemented.")}getTargetDimensionInfo(t,e){var i,n;const r=(i=Wx(this.chart,{x:t,y:e}))!==null&&i!==void 0?i:[],a=(n=jx(this.chart,{x:t,y:e}))!==null&&n!==void 0?n:[],o=[].concat(r,a);return o.length===0?null:o}dispatch(t,e){var i;const n=(i=this.chart)===null||i===void 0?void 0:i.getAllComponents().filter(l=>l.specKey==="axes"&&(!(e!=null&&e.filter)||e.filter(l))),r=n.filter(l=>fi(l.getScale().type)),a=r.length?r:n.filter(l=>{const h=l.getOrient();return Yt(h)||h==="angle"}),o=[];return a.forEach(l=>{const h=Gx(l,t);h&&o.push(h)}),this._callback.call(null,{action:"enter",dimensionInfo:o}),o}}var Bs;(function(s){s.dimensionHover="dimensionHover",s.dimensionClick="dimensionClick"})(Bs||(Bs={}));const jg={[Bs.dimensionHover]:class extends Yx{constructor(){super(...arguments),this._cacheDimensionInfo=null,this.onMouseMove=s=>{if(!s)return;const t=s.event.viewX,e=s.event.viewY,i=this.getTargetDimensionInfo(t,e);i===null&&this._cacheDimensionInfo!==null?(this._callback.call(null,Object.assign(Object.assign({},s),{action:"leave",dimensionInfo:this._cacheDimensionInfo.slice()})),this._cacheDimensionInfo=i):i===null||this._cacheDimensionInfo!==null&&i.length===this._cacheDimensionInfo.length&&!i.some((n,r)=>!Fx(n,this._cacheDimensionInfo[r]))?i!==null&&this._callback.call(null,Object.assign(Object.assign({},s),{action:"move",dimensionInfo:i.slice()})):(this._callback.call(null,Object.assign(Object.assign({},s),{action:"enter",dimensionInfo:i.slice()})),this._cacheDimensionInfo=i)},this.onMouseOut=s=>{s&&(this._callback.call(null,Object.assign(Object.assign({},s),{action:"leave",dimensionInfo:this._cacheDimensionInfo?this._cacheDimensionInfo.slice():[]})),this._cacheDimensionInfo=null)}}register(s,t){this._callback=t.callback,this._eventDispatcher.register("pointermove",{query:Object.assign(Object.assign({},t.query),{source:It.chart}),callback:this.onMouseMove}),this._eventDispatcher.register("pointerout",{query:Object.assign(Object.assign({},t.query),{source:It.canvas}),callback:this.onMouseOut}),Ar(this._mode)&&this._eventDispatcher.register("pointerdown",{query:Object.assign(Object.assign({},t.query),{source:It.chart}),callback:this.onMouseMove})}unregister(){this._eventDispatcher.unregister("pointermove",{query:null,callback:this.onMouseMove}),Ar(this._mode)&&this._eventDispatcher.unregister("pointerdown",{query:null,callback:this.onMouseMove})}},[Bs.dimensionClick]:class extends Yx{constructor(){super(...arguments),this.onClick=s=>{if(!s)return;const t=s.event.viewX,e=s.event.viewY,i=this.getTargetDimensionInfo(t,e);i&&this._callback.call(null,Object.assign(Object.assign({},s),{action:"click",dimensionInfo:i.slice()}))}}register(s,t){this._callback=t.callback,this._eventDispatcher.register("pointertap",{query:Object.assign(Object.assign({},t.query),{source:It.chart}),callback:this.onClick})}unregister(){this._eventDispatcher.unregister("pointertap",{query:null,callback:this.onClick})}}};let cu=class{getComposedEventMap(){return this._composedEventMap}constructor(s,t){this._composedEventMap=new Map,this._eventDispatcher=s,this._mode=t}on(s,t,e){const i=typeof t=="function"?{query:null,callback:t}:{query:t,callback:e};if(jg[s]){const n=new jg[s](this._eventDispatcher,this._mode);n.register(s,i),this._composedEventMap.set(e,{eventType:s,event:n})}else this._eventDispatcher.register(s,i);return this}off(s,t,e){var i,n;const r=e??t;if(jg[s])if(r)(i=this._composedEventMap.get(r))===null||i===void 0||i.event.unregister(),this._composedEventMap.delete(r);else for(const a of this._composedEventMap.entries())a[1].eventType===s&&((n=this._composedEventMap.get(a[0]))===null||n===void 0||n.event.unregister(),this._composedEventMap.delete(a[0]));else if(r){const a={callback:r,query:null,filter:{nodeName:null,type:s,level:null,source:t.source,markName:null,filter:null,userId:null}};this._eventDispatcher.unregister(s,a)}else this._eventDispatcher.unregister(s);return this}emit(s,t,e){return this._eventDispatcher.dispatch(s,t,e),this}prevent(s,t){return this._eventDispatcher.prevent(s,t),this}allow(s){return this._eventDispatcher.allow(s),this}release(){this._eventDispatcher.clear(),this._composedEventMap.clear()}};class NI{constructor(){this._map=new Map,this._levelNodes=new Map,this._levelNodes.set(We.vchart,[]),this._levelNodes.set(We.chart,[]),this._levelNodes.set(We.model,[]),this._levelNodes.set(We.mark,[])}addHandler(t,e){var i;const n={level:e,handler:t};return(i=this._levelNodes.get(e))===null||i===void 0||i.push(n),this._map.set(t.callback,n),this}removeHandler(t){const e=this._map.get(t.callback);if(!e)return this;this._map.delete(t.callback);const i=this._levelNodes.get(e.level),n=i==null?void 0:i.findIndex(r=>r.handler.callback===t.callback);return n!==void 0&&n>=0&&(i==null||i.splice(n,1)),this}preventHandler(t){return t&&(t.prevented=!0),this}allowHandler(t){return t&&(t.prevented=!1),this}getHandlers(t){var e;return((e=this._levelNodes.get(t))===null||e===void 0?void 0:e.map(i=>i.handler))||[]}getAllHandlers(){return Array.from(this._map.values()).map(t=>t.handler)||[]}getCount(){return this._map.size}release(){this._map.clear(),this._levelNodes.clear()}}const $x={cartesianAxis:"axis","cartesianAxis-band":"axis","cartesianAxis-linear":"axis","cartesianAxis-time":"axis",polarAxis:"axis","polarAxis-band":"axis","polarAxis-linear":"axis",discreteLegend:"legend",continuousLegend:"legend",colorLegend:"legend",sizeLegend:"legend"};class zI{constructor(t,e){this._viewBubbles=new Map,this._windowBubbles=new Map,this._canvasBubbles=new Map,this._viewListeners=new Map,this._windowListeners=new Map,this._canvasListeners=new Map,this._onDelegate=i=>{var n,r;const a=this.globalInstance.getChart(),o=R(i.modelId)&&(a==null?void 0:a.getModelById(i.modelId))||void 0,l=R(i.markId)&&(a==null?void 0:a.getMarkById(i.markId))||null,h=new Map;let c=(n=i.item)===null||n===void 0?void 0:n.mark;for(c&&R(c.id())&&h.set(c.id(),i.item);c!=null&&c.elements;){const g=c.id();R(g)&&!h.has(g)&&h.set(g,c.elements[0]),c=c.group}const u=vt(i.event,"target");let d=i.datum;o&&o.modelType==="component"&&(d=(r=o.getDatum(u))!==null&&r!==void 0?r:d);const p={event:i.event,item:i.item,source:i.source,datum:d,itemMap:h,chart:a,model:o,mark:l??void 0,node:vt(i.event,"target")};this.dispatch(i.type,p)},this._onDelegateInteractionEvent=i=>{const n=this.globalInstance.getChart(),r=i.event;let a=null;r.elements&&(a=r.elements);const o={event:i.event,chart:n,items:a,datums:a&&a.map(l=>l.getDatum())};this.dispatch(i.type,o)},this.globalInstance=t,this._compiler=e}register(t,e){var i,n,r,a,o;this._parseQuery(e);const l=this.getEventBubble(((i=e.filter)===null||i===void 0?void 0:i.source)||It.chart),h=this.getEventListeners(((n=e.filter)===null||n===void 0?void 0:n.source)||It.chart);if(l.get(t)||l.set(t,new NI),l.get(t).addHandler(e,(r=e.filter)===null||r===void 0?void 0:r.level),this._isValidEvent(t)&&!h.has(t)){const c=this._onDelegate.bind(this);this._compiler.addEventListener((a=e.filter)===null||a===void 0?void 0:a.source,t,c),h.set(t,c)}else if(this._isInteractionEvent(t)&&!h.has(t)){const c=this._onDelegateInteractionEvent.bind(this);this._compiler.addEventListener((o=e.filter)===null||o===void 0?void 0:o.source,t,c),h.set(t,c)}return this}unregister(t,e){var i,n,r,a;let o=!1;const l=this.getEventBubble(((i=e==null?void 0:e.filter)===null||i===void 0?void 0:i.source)||It.chart),h=this.getEventListeners(((n=e==null?void 0:e.filter)===null||n===void 0?void 0:n.source)||It.chart);if(e){const c=l.get(t);c==null||c.removeHandler(e),(c==null?void 0:c.getCount())===0&&(c==null||c.release(),l.delete(t),o=!0),!((r=e==null?void 0:e.wrappedCallback)===null||r===void 0)&&r.cancel&&e.wrappedCallback.cancel()}else{const c=l.get(t);c==null||c.release(),l.delete(t),o=!0}if(o&&this._isValidEvent(t)){const c=h.get(t);this._compiler.removeEventListener(((a=e==null?void 0:e.filter)===null||a===void 0?void 0:a.source)||It.chart,t,c),h.delete(t)}return this}dispatch(t,e,i){const n=this.getEventBubble(e.source||It.chart).get(t);if(!n)return this;let r=!1;if(i){const a=n.getHandlers(i);r=this._invoke(a,t,e)}else{let a=0;for(;!r&&a<lu.length;)r=this._invoke(n.getHandlers(lu[a]),t,e),a++}return this}prevent(t,e){return["canvas","chart","window"].forEach(i=>{const n=this.getEventBubble(i).get(t);n&&n.getAllHandlers().forEach(r=>{e?lu.indexOf(r.filter.level)<lu.indexOf(e.level)&&r.callback!==e.handler&&n.preventHandler(r):n.preventHandler(r)})}),this}allow(t){return["canvas","chart","window"].forEach(e=>{const i=this.getEventBubble(e).get(t);i&&i.getAllHandlers().forEach(n=>i.allowHandler(n))}),this}clear(){[It.chart,It.window,It.canvas].forEach(t=>{const e=this.getEventListeners(t);for(const i of e.entries())this._compiler.removeEventListener(t,i[0],i[1]);e.clear()}),[this._viewBubbles,this._windowBubbles,this._canvasBubbles].forEach(t=>{for(const e of t.values())e.release();t.clear()})}release(){this.clear(),this.globalInstance=null,this._compiler=null}_filter(t,e,i){var n,r,a;if(U(t.filter)&&!t.filter(i)||t.nodeName&&vt(i,"node.name")!==t.nodeName||t.markName&&((n=i==null?void 0:i.mark)===null||n===void 0?void 0:n.name)!==t.markName)return!1;let o=(r=i.model)===null||r===void 0?void 0:r.type;return $x[o]&&(o=$x[o]),(!t.type||o===t.type)&&!(t.level==="mark"&&!t.type&&!(i!=null&&i.mark))&&!(t.level==="model"&&!t.type&&!(i!=null&&i.model))&&(!R(t.userId)||((a=i.model)===null||a===void 0?void 0:a.userId)===t.userId)}_prepareParams(t,e){if(t.markName&&e.mark&&e.itemMap){const i=e.mark.getProductId(),n=e.itemMap.get(i),r=n==null?void 0:n.getDatum();return Object.assign(Object.assign({},e),{item:n,datum:r})}return Object.assign({},e)}_invoke(t,e,i){return t.map(r=>{var a,o,l;const h=r.filter;if(!r.prevented&&(!r.query||this._filter(h,e,i))){const c=(r.wrappedCallback||r.callback).call(null,this._prepareParams(h,i)),u=c??((a=r.query)===null||a===void 0?void 0:a.consume);return u&&((o=i.event)===null||o===void 0||o.stopPropagation(),(l=i.event)===null||l===void 0||l.preventDefault()),!!u}}).some(r=>r===!0)}_getQueryLevel(t){return t?t.level?t.level:R(t.id)?We.model:We.vchart:We.vchart}_parseQuery(t){var e;const i=t.query;i!=null&&i.throttle?t.wrappedCallback=tr(t.callback,i.throttle):i!=null&&i.debounce&&(t.wrappedCallback=yl(t.callback,i.debounce));let n=this._getQueryLevel(i),r=null,a=It.chart,o=null,l=null,h=null;return i!=null&&i.nodeName&&(o=i.nodeName),i!=null&&i.markName&&(l=i.markName),!(i!=null&&i.type)||n!==We.model&&n!==We.mark||(r=i.type),i!=null&&i.source&&(a=i.source),R(i==null?void 0:i.id)&&(h=i==null?void 0:i.id,n=We.model),t.filter={level:n,markName:l,type:r,source:a,nodeName:o,userId:h,filter:(e=i==null?void 0:i.filter)!==null&&e!==void 0?e:null},t}getEventBubble(t){switch(t){case It.chart:return this._viewBubbles;case It.window:return this._windowBubbles;case It.canvas:return this._canvasBubbles;default:return this._viewBubbles}}getEventListeners(t){switch(t){case It.chart:return this._viewListeners;case It.window:return this._windowListeners;case It.canvas:return this._canvasListeners;default:return this._viewListeners}}_isValidEvent(t){return LI.includes(t)||Object.values(at).includes(t)}_isInteractionEvent(t){let e;return t&&(e=t.split(":")[0],e)&&V.hasInteraction(e)}}function Se(s,t,e){s.getTransform(t)||s.registerTransform(t,e)}function uu(s,t,e){s.getParser(t)||s.registerParser(t,e)}const HI=new Map;function Xx(s,t=!1){let e=t;return s.latestData instanceof _e&&(e=!1),e?Fi(s.latestData):s.latestData&&s.latestData.slice()}const Kx=(s,t)=>s.length===0?[]:s.length===1?Xx(s[0],t==null?void 0:t.deep):s.map(e=>Xx(e,t==null?void 0:t.deep));function qx(s,t,e){Se(t=t instanceof Tl?t:s.dataSet,"copyDataView",Kx);const i=new _e(t,e);return i.parse([s],{type:"dataview"}),i.transform({type:"copyDataView",level:du.copyDataView}),i}function Ng(s,t,e=[]){var i;if(s instanceof _e)return s;const{id:n,values:r=[],fromDataIndex:a,fromDataId:o,transforms:l=[]}=s,h=s.parser?Fi(s.parser):{clone:!0},c=Fi(s.fields);let u;h.clone=h.clone!==!1;const d=e.find(p=>p.name===n);if(d)u=d;else{const p={name:n};if(c&&(p.fields=c),u=new _e(t,p),typeof o=="string"){const g=e.find(f=>f.name===o);if(!g)return os(\`no data matches fromDataId \${o}\`),null;u.parse([g],{type:"dataview"}),u.transform({type:"copyDataView"})}else if(typeof a=="number"){const g=e[a];if(!g)return os(\`no data matches fromDataIndex \${a}\`),null;u.parse([g],{type:"dataview"}),u.transform({type:"copyDataView"})}else Array.isArray(r)?u.parse(r,h):!Q(r)||h&&!["csv","dsv","tsv"].includes(h.type)?(u.parse([]),os("values should be array")):u.parse(r,(i=h)!==null&&i!==void 0?i:{type:"csv"});l&&l.length&&l.forEach(g=>{t.getTransform(g.type)&&u.transform(g)})}return u}function zg(s,t,e){s&&(t.fields&&s.setFields(t.fields,e),s.parseNewData(t.values,t.parser))}var du,ce,rn,Vt,Vo;function VI(s){switch(s){case K.RenderModeEnum["desktop-browser"]:case K.RenderModeEnum["mobile-browser"]:return"browser";case K.RenderModeEnum.node:case K.RenderModeEnum.worker:return"node";case K.RenderModeEnum.miniApp:case K.RenderModeEnum["desktop-miniApp"]:return"feishu";case K.RenderModeEnum.lynx:return"lynx";case K.RenderModeEnum.wx:return"wx";case K.RenderModeEnum.tt:return"tt";case K.RenderModeEnum.harmony:return"harmony"}return"browser"}(function(s){s[s.copyDataView=-10]="copyDataView",s[s.treemapFilter=-8]="treemapFilter",s[s.treemapFlatten=-7]="treemapFlatten",s[s.dotObjFlat=-7]="dotObjFlat",s[s.linkDotInfo=-7]="linkDotInfo",s[s.sankeyLayout=-7]="sankeyLayout",s[s.dataZoomFilter=-6]="dataZoomFilter",s[s.legendFilter=-5]="legendFilter"})(du||(du={})),function(s){s.appear="appear",s.disappear="disappear",s.enter="enter",s.update="update",s.state="state",s.exit="exit",s.normal="normal",s.none="none"}(ce||(ce={})),function(s){s.data="data",s.signal="signal",s.mark="mark"}(rn||(rn={}));class WI{getVGrammarView(){return this._view}getModel(){return this._model}constructor(t,e){this._viewListeners=new Map,this._windowListeners=new Map,this._canvasListeners=new Map,this.isInited=!1,this._released=!1,this._model={[rn.signal]:{},[rn.data]:{},[rn.mark]:{}},this._compileChart=null,this.handleStageRender=()=>{var i,n;(n=(i=this._compileChart)===null||i===void 0?void 0:i.getEvent())===null||n===void 0||n.emit(pt.afterRender,{chart:this._compileChart})},this._container=t,this._option=e}getRenderer(){var t;return(t=this._view)===null||t===void 0?void 0:t.renderer}getCanvas(){var t;return(t=this._view)===null||t===void 0?void 0:t.renderer.canvas()}getStage(){var t;return(t=this._view)===null||t===void 0?void 0:t.renderer.stage()}initView(){var t,e,i,n;if(this._released||(this.isInited=!0,this._view))return;const r=new Tt((t=this._option.logLevel)!==null&&t!==void 0?t:ci.Error);!((e=this._option)===null||e===void 0)&&e.onError&&r.addErrorHandler((...m)=>{var v,y;(y=(v=this._option)===null||v===void 0?void 0:v.onError)===null||y===void 0||y.call(v,...m)});const a=this._option,{performanceHook:o,autoRefreshDpr:l,dpr:h,mode:c,gestureConfig:u,interactive:d,clickInterval:p,autoPreventDefault:g}=a,f=ne(a,["performanceHook","autoRefreshDpr","dpr","mode","gestureConfig","interactive","clickInterval","autoPreventDefault"]);this._view=new Ho(Object.assign(Object.assign({width:this._width,height:this._height,container:(i=this._container.dom)!==null&&i!==void 0?i:null,renderCanvas:(n=this._container.canvas)!==null&&n!==void 0?n:null,hooks:o},f),{dpr:h,autoRefresh:R(l)?l:!R(h),mode:VI(c),autoFit:!1,eventConfig:{gesture:R(u)?u:Ar(c),disable:d===!1,clickInterval:p,autoPreventDefault:g},doLayout:()=>{var m;(m=this._compileChart)===null||m===void 0||m.onLayout(this._view)},logger:r,logLevel:r.level()})),this._setCanvasStyle(),this.getStage().hooks.afterRender.tap("chart-event",this.handleStageRender),d!==!1&&this._viewListeners.forEach(m=>{var v;(v=this._view)===null||v===void 0||v.addEventListener(m.type,m.callback)})}_setCanvasStyle(){if(this._view&&this._container.dom&&!Q(this._container.dom)){this._container.dom.style.display="block",this._container.dom.style.position="relative";const t=this.getCanvas();t&&(t.style.display="block")}}compileInteractions(){var t;if(this._view.removeAllInteractions(),(t=this._interactions)===null||t===void 0?void 0:t.length){const e={};this._interactions.forEach(i=>{var n;if(i.regionId){const r=\`\${i.regionId}-\${i.type}-\${(n=i.id)!==null&&n!==void 0?n:""}\`,a=e[r];e[r]=a?Object.assign(Object.assign(Object.assign({},a),i),{selector:[...a.selector,...i.selector]}):i}else this._view.interaction(i.type,i)}),Object.keys(e).forEach(i=>{const n=this._view.interaction(e[i].type,e[i]);if(this._compileChart){const r=this._compileChart.getRegionsInIds([e[i].regionId])[0];r&&r.interaction.addVgrammarInteraction(n.getStartState(),n)}})}}compile(t,e){if(this._released)return;const{chart:i}=t;this._compileChart=i,this.initView(),this._view&&(i.compile(),i.afterCompile(),this.updateDepend(),this.compileInteractions())}clearNextRender(){return!!this._nextRafId&&(Me.getCancelAnimationFrame()(this._nextRafId),this._nextRafId=null,!0)}clear(t,e=!1){const{chart:i}=t;this.clearNextRender(),i.clear(),this.releaseGrammar(e)}renderNextTick(t){this._released||this._nextRafId||(this._nextRafId=Me.getRequestAnimationFrame()(()=>{this._nextRafId=null,this.render(t)}))}render(t){var e,i;this._released||(this.initView(),this._view&&((e=this._view)===null||e===void 0||e.run(t),this.clearNextRender()&&((i=this._view)===null||i===void 0||i.run(t))))}updateViewBox(t,e=!0){this._view&&this._view.renderer.setViewBox(t,e)}resize(t,e,i=!0){this._view&&(this._width=t,this._height=e,this._view.resize(t,e),i&&this.render({morph:!1}))}setBackground(t){var e;(e=this._view)===null||e===void 0||e.background(t)}setSize(t,e){this._width=t,this._height=e,this._view&&(this._view.width(t),this._view.height(e))}setViewBox(t,e=!0){this._view&&this._view.renderer.setViewBox(t,e)}addEventListener(t,e,i){var n,r;if(this._option.interactive!==!1){if(t===It.chart){const a=(function(o,l){var h,c,u;const d=(c=(h=l==null?void 0:l.mark)===null||h===void 0?void 0:h.getContext())!==null&&c!==void 0?c:{},p=R(d.modelId)?d.modelId:null,g=R(d.markId)?d.markId:null,f=R(d.modelUserId)?d.modelUserId:null,m=R(d.markUserId)?d.markUserId:null,v={event:o,type:e,source:t,item:l,datum:((u=l==null?void 0:l.getDatum)===null||u===void 0?void 0:u.call(l))||null,markId:g,modelId:p,markUserId:m,modelUserId:f};i.call(null,v)}).bind(this);this._viewListeners.set(i,{type:e,callback:a}),(n=this._view)===null||n===void 0||n.addEventListener(e,a)}else if(t===It.window){const a=(function(l){const h={event:l,type:e,source:t,item:null,datum:null,markId:null,modelId:null,markUserId:null,modelUserId:null};i.call(null,h)}).bind(this);this._windowListeners.set(i,{type:e,callback:a});const o=this._getGlobalThis();o==null||o.addEventListener(e,a)}else if(t===It.canvas){const a=(function(l){const h={event:l,type:e,source:t,item:null,datum:null,markId:null,modelId:null,markUserId:null,modelUserId:null};i.call(null,h)}).bind(this);this._canvasListeners.set(i,{type:e,callback:a});const o=(r=this.getStage())===null||r===void 0?void 0:r.window;o==null||o.addEventListener(e,a)}}}removeEventListener(t,e,i){var n,r,a,o,l;if(this._option.interactive!==!1){if(t===It.chart){const h=(n=this._viewListeners.get(i))===null||n===void 0?void 0:n.callback;h&&((r=this._view)===null||r===void 0||r.removeEventListener(e,h)),this._viewListeners.delete(i)}else if(t===It.window){const h=this._getGlobalThis(),c=(a=this._windowListeners.get(i))===null||a===void 0?void 0:a.callback;c&&(h==null||h.removeEventListener(e,c)),this._windowListeners.delete(i)}else if(t===It.canvas){const h=(o=this.getStage())===null||o===void 0?void 0:o.window,c=(l=this._canvasListeners.get(i))===null||l===void 0?void 0:l.callback;h&&c&&(h==null||h.removeEventListener(e,c)),this._canvasListeners.delete(i)}}}releaseEvent(){const t=this.getStage();t&&t.hooks.afterRender.unTap("chart-event",this.handleStageRender),this._viewListeners.clear(),this._windowListeners.clear(),this._canvasListeners.clear()}release(){var t;this.clearNextRender(),this.releaseEvent(),this._option=this._container=null,this._releaseModel(),(t=this._view)===null||t===void 0||t.release(),this._view=null,this.isInited=!1,this._compileChart=null,this._released=!0}releaseGrammar(t=!1){var e,i;this._releaseModel(),t&&((e=this._view)===null||e===void 0||e.removeAllGraphicItems()),(i=this._view)===null||i===void 0||i.removeAllGrammars()}_releaseModel(){Object.keys(this._model).forEach(t=>{Object.values(this._model[t]).forEach(e=>{Object.values(e).forEach(i=>{i.removeProduct(!0)})}),this._model[t]={}})}addGrammarItem(t){const e=t.getProduct();if(I(e))return;const i=e.id(),n=t.grammarType;I(this._model[n][i])&&(this._model[n][i]={}),this._model[n][i][t.id]=t}removeGrammarItem(t,e){var i;const n=t.getProduct();if(I(n))return;const r=n.id(),a=t.grammarType,o=this._model[a][r];R(o)&&(delete o[t.id],Object.keys(o).length===0&&delete this._model[a][r]),e||(i=this._view)===null||i===void 0||i.removeGrammar(n)}addInteraction(t){this._interactions||(this._interactions=[]),this._interactions.push(t)}removeInteraction(t){this._interactions&&(this._interactions=this._interactions.filter(e=>e.seriesId!==t))}updateDepend(t){return R(t)&&t.length>0?t.every(e=>e.updateDepend()):(Object.values(this._model).forEach(e=>{Object.values(e).forEach(i=>{const n=Object.values(i),r=n[0].getProduct(),a=n.reduce((o,l)=>l.getDepend().length>0?o.concat(l.getDepend()):o,[]).filter(o=>!!o).map(o=>o.getProduct());r.depend(a)})}),!0)}_getGlobalThis(){var t;return ks(this._option.mode)?globalThis:(t=this.getStage())===null||t===void 0?void 0:t.window}}function UI(s,t){var e;return Ie(this,void 0,void 0,function*(){if(!s)return"";try{if(OffscreenCanvas!==void 0&&s instanceof OffscreenCanvas)return function(i){return new Promise(n=>{i.convertToBlob().then(r=>{const a=new FileReader;a.readAsDataURL(r),a.onload=()=>{n(a.result)}})})}(s)}catch(i){((e=t==null?void 0:t.onError)!==null&&e!==void 0?e:co)(\`getCanvasDataURL error : \${i.toString()}\`)}return s.toDataURL()})}function Hg(s){s.crosshair=Y(s.crosshair||{}).map(t=>mt({[s.direction==="horizontal"?"yField":"xField"]:{visible:!0,line:{visible:!0,type:"rect"}}},t))}function Zx(s,t,e){var i;const{width:n,height:r}=s;if(R(n)&&R(r))return{width:n,height:r};let a=e.width,o=e.height;const l=t.container,h=t.canvas;if(l){const{width:c,height:u}=Ku(l,e.width,e.height);a=c,o=u}else if(h&&ks(t.mode)){let c;c=Q(h)?Me.getElementById(h):h;const{width:u,height:d}=Ku(c,e.width,e.height);a=u,o=d}else if(kr(t.mode)&&(!((i=t.modeParams)===null||i===void 0)&&i.domref)){const c=t.modeParams.domref;a=c.width,o=c.height}return a=n??a,o=r??o,{width:a,height:o}}function ia(s,...t){const e=i=>t.reduce((n,r)=>n||(r==null?void 0:r[i]),s[i]);return Object.assign(s,{change:e("change"),reCompile:e("reCompile"),reMake:e("reMake"),reRender:e("reRender"),reSize:e("reSize"),reTransformSpec:e("reTransformSpec"),changeTheme:e("changeTheme"),changeBackground:e("changeBackground")}),s}function Jx(s,t){return s==="line"||s==="area"||s==="common"&&t.series.every(e=>e.type==="area"||e.type==="line")?{paddingInner:1,paddingOuter:0}:{paddingOuter:0}}(function(s){s.STATE_NORMAL="normal",s.STATE_HOVER="hover",s.STATE_HOVER_REVERSE="hover_reverse",s.STATE_DIMENSION_HOVER="dimension_hover",s.STATE_DIMENSION_HOVER_REVERSE="dimension_hover_reverse",s.STATE_SELECTED="selected",s.STATE_SELECTED_REVERSE="selected_reverse",s.STATE_SANKEY_EMPHASIS="selected",s.STATE_SANKEY_EMPHASIS_REVERSE="blur"})(Vt||(Vt={})),function(s){s.STATE_HOVER_REVERSE="hover_reverse",s.STATE_DIMENSION_HOVER_REVERSE="dimension_hover_reverse",s.STATE_SELECTED_REVERSE="selected_reverse"}(Vo||(Vo={}));class sa{constructor(){this._children=[],this._markNameMap={},this._infoMap=new Map}getMarkNameMap(){return this._markNameMap}addMark(t,e){I(t)||(this._children.push(t),this._markNameMap[t.name]=t,this._infoMap.set(t,rt({},sa.defaultMarkInfo,e)))}removeMark(t){const e=this._children.findIndex(i=>i.name===t);e>=0&&(this._infoMap.delete(this._children[e]),delete this._markNameMap[t],this._children.splice(e,1))}clear(){this._children=[],this._markNameMap={},this._infoMap.clear()}forEach(t){this._children.forEach(t)}includes(t,e){return this._children.includes(t,e)}get(t){return isNaN(Number(t))?this._markNameMap[t]:this._children[t]}getMarks(){return this._children.slice()}getMarksInType(t){const e=Y(t);return this._children.filter(i=>e.includes(i.type))}getMarkInId(t){return this._children.find(e=>e.id===t)}getMarkWithInfo(t){return this._children.find(e=>Object.keys(t).every(i=>t[i]===this._infoMap.get(e)[i]))}}sa.defaultMarkInfo={};class GI{get hover(){return this._hover}get select(){return this._select}constructor(t){this._marks=new sa,this._markReverse=new sa,this.onHover=e=>{switch(e.action){case"enter":this.interaction.getEventElement(Vt.STATE_DIMENSION_HOVER).forEach(i=>this.interaction.addEventElement(Vt.STATE_DIMENSION_HOVER_REVERSE,i)),this.interaction.clearEventElement(Vt.STATE_DIMENSION_HOVER,!1),this.getEventElement(e).forEach(i=>this.interaction.addEventElement(Vt.STATE_DIMENSION_HOVER,i)),this.interaction.reverseEventElement(Vt.STATE_DIMENSION_HOVER);break;case"leave":this.interaction.clearEventElement(Vt.STATE_DIMENSION_HOVER,!0),e=null}},this._option=t,this.event=this._option.model.getOption().getChart().getEvent(),this.interaction=t.interaction,this.initConfig(t.mode)}setStateKeys(t){}registerMark(t){ht(t.stateStyle[Vt.STATE_DIMENSION_HOVER])||this._marks.addMark(t),ht(t.stateStyle[Vt.STATE_DIMENSION_HOVER_REVERSE])||this._markReverse.addMark(t)}init(){this.initEvent()}release(){this.releaseEvent()}initEvent(){this.event.on(Bs.dimensionHover,this.onHover)}releaseEvent(){this.event.release()}initConfig(t){}getEventElement(t,e=!1){const i=[];return t.dimensionInfo.forEach(n=>{n.data.forEach(r=>{(e?this._markReverse:this._marks).getMarks().filter(o=>o.model===r.series&&o.getVisible()).forEach(o=>{const l=o.getProduct();if(!l||!l.elements)return;const h=l.elements.filter(c=>{const u=c.getDatum();let d;return d=W(u)?u.every((p,g)=>p===r.datum[g]):r.datum.some(p=>p===u),e?!d:d});i.push(...h)})})}),i}}const Qx={};Object.values(Vt).forEach(s=>{Qx[s]=!0});const YI={[Vt.STATE_HOVER]:Vt.STATE_HOVER_REVERSE,[Vt.STATE_SELECTED]:Vt.STATE_SELECTED_REVERSE,[Vt.STATE_DIMENSION_HOVER]:Vt.STATE_DIMENSION_HOVER_REVERSE};function pu(s){return YI[s]}class $I{constructor(){this._stateMarks=new Map,this._stateElements=new Map,this._vgrammarInteractions=new Map,this._disableTriggerEvent=!1}addVgrammarInteraction(t,e){t&&(this._vgrammarInteractions.get(t)?this._vgrammarInteractions.get(t).push(e):this._vgrammarInteractions.set(t,[e]))}static markStateEnable(t,e){return!ht(t.stateStyle[e])}setDisableActiveEffect(t){this._disableTriggerEvent=t}registerMark(t,e){var i;this._stateMarks.has(t)||this._stateMarks.set(t,[]),(i=this._stateMarks.get(t))===null||i===void 0||i.push(e)}getStateMark(t){return this._stateMarks.get(t)}filterEventMark(t,e){var i;return!(!t.mark||!(!((i=this._stateMarks.get(e))===null||i===void 0)&&i.includes(t.mark)))}getEventElement(t){var e;return(e=this._stateElements.get(t))!==null&&e!==void 0?e:[]}getEventElementData(t){return this.getEventElement(t).map(e=>e.getDatum())}exchangeEventElement(t,e){var i;if(this._disableTriggerEvent)return;const n=pu(t);(i=this._stateElements.get(t))===null||i===void 0||i.forEach(r=>{r.removeState(t),n&&this.addEventElement(n,r)}),e.getStates().includes(t)||(e.addState(t),n&&e.removeState(n)),this._stateElements.set(t,[e])}removeEventElement(t,e){var i,n;if(this._disableTriggerEvent)return;e.removeState(t);const r=(n=(i=this._stateElements.get(t))===null||i===void 0?void 0:i.filter(o=>o!==e))!==null&&n!==void 0?n:[];this._stateElements.set(t,r);const a=pu(t);a&&(r.length===0?this.clearEventElement(a,!1):this.addEventElement(a,e))}addEventElement(t,e){var i;if(this._disableTriggerEvent)return;e.getStates().includes(t)||e.addState(t);const n=(i=this._stateElements.get(t))!==null&&i!==void 0?i:[];n.push(e),this._stateElements.set(t,n)}clearEventElement(t,e){var i;if(!this._disableTriggerEvent&&((i=this._stateElements.get(t))===null||i===void 0||i.forEach(n=>{n.removeState(t)}),this._stateElements.set(t,[]),e)){const n=pu(t);n&&this.clearEventElement(n,!1)}}clearAllEventElement(){if(!this._disableTriggerEvent)for(const[t,e]of this._stateElements)e.forEach(i=>{i.clearStates()}),this._stateElements.set(t,[])}reverseEventElement(t){if(this._disableTriggerEvent)return;const e=pu(t);if(!e)return;const i=this.getStateMark(e);if(!i)return;const n=this.getEventElement(t);n.length&&(this.getEventElement(e).length||(n.length===1?i.forEach(r=>{r.getProduct().elements.filter(a=>a!==n[0]).forEach(a=>{this.addEventElement(e,a)})}):i.forEach(r=>{r.getProduct().elements.filter(a=>!n.includes(a)).forEach(a=>{this.addEventElement(e,a)})})))}startInteraction(t,e){const i=this._vgrammarInteractions.get(t);i&&i.forEach(n=>{n.start(e)})}resetInteraction(t,e){const i=this._vgrammarInteractions.get(t);i&&i.forEach(n=>{n.reset(e)})}resetAllInteraction(){for(const[t,e]of this._vgrammarInteractions)e&&e.forEach(i=>{i.reset(null)})}}var Qe,Wo,St;(function(s){s[s.SeriesGroup=0]="SeriesGroup",s[s.Axis_Grid=50]="Axis_Grid",s[s.CrossHair_Grid=100]="CrossHair_Grid",s[s.Region=450]="Region",s[s.Mark=300]="Mark",s[s.Node=400]="Node",s[s.Axis=100]="Axis",s[s.MarkLine=500]="MarkLine",s[s.MarkArea=100]="MarkArea",s[s.MarkPoint=500]="MarkPoint",s[s.DataZoom=500]="DataZoom",s[s.ScrollBar=500]="ScrollBar",s[s.Player=500]="Player",s[s.Legend=500]="Legend",s[s.CrossHair=500]="CrossHair",s[s.Indicator=500]="Indicator",s[s.Title=500]="Title",s[s.Label=500]="Label",s[s.Brush=500]="Brush",s[s.CustomMark=500]="CustomMark",s[s.Interaction=700]="Interaction"})(Qe||(Qe={})),function(s){s[s.Indicator=10]="Indicator",s[s.Region=20]="Region",s[s.Axis=30]="Axis",s[s.DataZoom=40]="DataZoom",s[s.Player=40]="Player",s[s.ScrollBar=40]="ScrollBar",s[s.Legend=50]="Legend",s[s.Title=70]="Title",s[s.CustomMark=70]="CustomMark"}(Wo||(Wo={})),function(s){s[s.Default=0]="Default",s[s.Theme=1]="Theme",s[s.Chart=2]="Chart",s[s.Base_Series=3]="Base_Series",s[s.Series=4]="Series",s[s.Mark=5]="Mark",s[s.User_Chart=6]="User_Chart",s[s.User_Series=7]="User_Series",s[s.User_Mark=8]="User_Mark",s[s.User_SeriesStyle=9]="User_SeriesStyle",s[s.Built_In=99]="Built_In"}(St||(St={}));class gu{getOption(){return this._option}constructor(t){this._option=t,this.getCompiler=this._option.getCompiler}getVGrammarView(){var t;return(t=this.getCompiler())===null||t===void 0?void 0:t.getVGrammarView()}release(){this._option=null,this.getCompiler=null}}class Vg extends gu{constructor(){super(...arguments),this.id=Tn(),this._compiledProductId=null,this._depend=[]}getProduct(){if(R(this._product))return this._product;const t=this.getVGrammarView(),e=this.getProductId();return R(e)&&R(t)&&(this._product=this._lookupGrammar(e)),this._product}getProductId(){var t;return(t=this._compiledProductId)!==null&&t!==void 0?t:this.generateProductId()}getDepend(){return this._depend}setDepend(...t){this._depend=t}compile(t){this._compileProduct(t),this._afterCompile(t)}_afterCompile(t){var e;R(this._product)&&((e=this.getCompiler())===null||e===void 0||e.addGrammarItem(this))}updateDepend(){if(R(this._product)){const t=this.getDepend().map(e=>e.getProduct()).filter(R);return this._product.depend(t),t.length===this.getDepend().length}return!1}release(){this.removeProduct(),super.release(),this._depend=[]}removeProduct(t){this.getCompiler().removeGrammarItem(this,t),this._product=null,this._compiledProductId=null}}class XI extends Vg{getValue(){return this._value}getUpdateFunc(){return this._updateFunc}constructor(t,e,i,n){super(t),this.grammarType=rn.signal,this.name=e,this._value=i,this._updateFunc=n}updateSignal(t,e){this._value=t,this._updateFunc=e,this.compile()}_compileProduct(){const t=this.getVGrammarView();if(t){if(!this.getProduct()){const e=this.getProductId();this._product=t.signal().id(e),this._compiledProductId=e}R(this._value)&&this._product.value(this._value),R(this._updateFunc)&&this._product.update(this._updateFunc)}}generateProductId(){return this.name}_lookupGrammar(t){var e;return(e=this.getCompiler().getVGrammarView())===null||e===void 0?void 0:e.getSignalById(t)}}class KI extends gu{constructor(){super(...arguments),this._signalMap={}}getSignalMap(){return this._signalMap}getSignal(t){return this._signalMap[t]}updateSignal(t,e,i){this._signalMap[t]?this._signalMap[t].updateSignal(e,i):(this._signalMap[t]=new XI(this._option,t,e,i),this._signalMap[t].compile())}compile(){Object.values(this._signalMap).forEach(t=>{t.compile()})}release(){super.release(),Object.values(this._signalMap).forEach(t=>{t.release()}),this._signalMap={}}}class tS extends KI{getStateMap(){return this._stateMap}_getDefaultStateMap(){return{}}constructor(t){super(t),t.stateKeyToSignalName?this.stateKeyToSignalName=t.stateKeyToSignalName:this.stateKeyToSignalName=()=>"state_signal",this.initStateMap()}initStateMap(t){this._stateMap=t??this._getDefaultStateMap()}compile(t){const e=t??this._stateMap;Object.keys(e).forEach(i=>{const n=this.stateKeyToSignalName(i),r=e[i];this.updateSignal(n,r)})}updateState(t,e){if(t&&(rt(this._stateMap,t),this.compile(t),!e))return this.getCompiler().renderNextTick()}}class eS extends tS{constructor(){super(...arguments),this.id=Tn(),this.stateKeyToSignalName=t=>\`\${xt}_animate_\${this.id}_\${t}\`}getAnimationStateSignalName(){return this.stateKeyToSignalName("animationState")}updateAnimateState(t,e){t===ce.update?this.updateState({animationState:{callback:(i,n)=>n.diffState}},e):t===ce.appear?this.updateState({animationState:{callback:(i,n)=>n.diffState==="exit"?ce.none:ce.appear}},e):this.updateState({animationState:{callback:(i,n)=>t}},e)}_getDefaultStateMap(){return{animationState:{callback:(t,e)=>e.diffState==="exit"?ce.exit:e.diffState==="update"?ce.update:ce.appear}}}}class fu{constructor(t){this._option=t,this.type=t.type}_initTheme(t,e){return this._theme=this.getTheme(t,e),this._mergeThemeToSpec(t,e)}getTheme(t,e){}transformSpec(t,e,i){this._transformSpecBeforeMergingTheme(t,e,i);const n=this._initTheme(t,e);return this._transformSpecAfterMergingTheme(n.spec,e,i),n}_transformSpecBeforeMergingTheme(t,e,i){}_transformSpecAfterMergingTheme(t,e,i){}_mergeThemeToSpec(t,e){const i=this._theme;if(this._shouldMergeThemeToSpec()){const n=this._getDefaultSpecFromChart(e),r=a=>mt({},i,n,a);return W(t)?{spec:t.map(a=>r(a)),theme:i}:{spec:r(t),theme:i}}return{spec:t,theme:i}}_shouldMergeThemeToSpec(){return!0}_getDefaultSpecFromChart(t){}}class Wg extends gu{getSpec(){return this._spec||{}}getSpecPath(){var t;return(t=this._option)===null||t===void 0?void 0:t.specPath}getSpecInfoPath(){var t,e,i;return(e=(t=this._option)===null||t===void 0?void 0:t.specInfoPath)!==null&&e!==void 0?e:(i=this._option)===null||i===void 0?void 0:i.specPath}getData(){return this._data}get layout(){return this._layout}getOption(){return this._option}getMarks(){var t,e;return(e=(t=this._marks)===null||t===void 0?void 0:t.getMarks())!==null&&e!==void 0?e:[]}getMarkNameMap(){var t;return(t=this._marks)===null||t===void 0?void 0:t.getMarkNameMap()}getMarkSet(){return this._marks}getChart(){return this._option.getChart()}get _theme(){var t;return(t=this.getSpecInfo())===null||t===void 0?void 0:t.theme}constructor(t,e){var i;super(e),this.transformerConstructor=fu,this.type="null",this.modelType="null",this.userId=void 0,this._data=null,this._layout=null,this.specKey="",this._marks=new sa,this._lastLayoutRect=null,this.id=Tn(),this.userId=t.id,this._spec=t,this.effect={},this.event=new cu(e.eventDispatcher,e.mode),(i=e.map)===null||i===void 0||i.set(this.id,this)}_releaseEvent(){this.event.release()}created(){this.setAttrFromSpec()}init(t){}afterInit(){}getVisible(){var t;return((t=this._spec)===null||t===void 0?void 0:t.visible)!==!1}onLayoutStart(t,e,i){var n;(n=this._layout)===null||n===void 0||n.onLayoutStart(t,e,i)}onLayoutEnd(t){var e;(e=this._layout)===null||e===void 0||e.onLayoutEnd(t),this.getMarks().forEach(i=>i.updateLayoutState(!0,!0))}onEvaluateEnd(t){}onDataUpdate(){}beforeRelease(){}release(){var t;this._releaseEvent(),this._spec=void 0,this.getMarks().forEach(e=>e.release()),(t=this._data)===null||t===void 0||t.release(),this._data=null,this._marks.clear(),super.release()}updateSpec(t){const e=this._compareSpec(t,this._spec);return this._spec=t,e}_compareSpec(t,e){return{change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1}}reInit(t){t&&(this._spec=t),this.setAttrFromSpec()}updateLayoutAttribute(){}setAttrFromSpec(){var t;(t=this._layout)===null||t===void 0||t.setAttrFromSpec(this._spec,this._option.getChartViewRect())}_convertMarkStyle(t){return Object.assign({},t)}setMarkStyle(t,e,i,n){R(t)&&R(e)&&t.setStyle(this._convertMarkStyle(e),i,n)}initMarkStyleWithSpec(t,e,i){if(!R(t)||!R(e))return;const{style:n,state:r}=e,a=Object.assign({},e);n&&(a.style=this._convertMarkStyle(n)),r&&(a.state={},Object.keys(r).forEach(o=>{a.state[o]=this._convertMarkStyle(r[o])})),t.initStyleWithSpec(a,i)}stateKeyToSignalName(t,e){let i=\`\${xt}_\${this.modelType}_\${this.type}_\${this.id}_\${t}\`;return e&&(i+=\`_\${e}\`),i}compileData(){var t;(t=this._data)===null||t===void 0||t.compile()}compileMarks(t){this.getMarks().forEach(e=>{e.compile({group:t})})}_createMark(t,e={},i){const{type:n,name:r}=t,a=et.createMark(n,r,Object.assign({model:this,map:this._option.map,getCompiler:this.getCompiler,globalScale:this._option.globalScale},e));return a&&(a.created(),i&&a.setMarkConfig(i)),a}_getDataIdKey(){}getColorScheme(){var t,e;return(e=(t=this._option).getTheme)===null||e===void 0?void 0:e.call(t).colorScheme}getSpecInfo(){var t,e,i;return((n,r,a)=>{if(!I(r))return vt(n,r,a)})((i=(e=(t=this._option).getSpecInfo)===null||e===void 0?void 0:e.call(t))!==null&&i!==void 0?i:{},this.getSpecInfoPath())}getSpecIndex(){const t=this.getSpecPath();if(!(t!=null&&t.length))return 0;const e=Number(t[t.length-1]);return isNaN(e)?0:e}}class qI{getSpec(){return this._spec||{}}getLayoutStartPoint(){return this._layoutStartPoint}get layoutRectLevelMap(){return this._layoutRectLevelMap}get minWidth(){return this._minWidth}set minWidth(t){this._minWidth=t}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth=t}get minHeight(){return this._minHeight}set minHeight(t){this._minHeight=t}get maxHeight(){return this._maxHeight}set maxHeight(t){this._maxHeight=t}getLastComputeOutBounds(){return this._lastComputeOutBounds}get layoutOrient(){return this._layoutOrient}set layoutOrient(t){this._layoutOrient=t}get model(){return this._model}get type(){return this._model.type}constructor(t,e){var i;this.layoutClip=!1,this.autoIndent=!1,this._layoutStartPoint={x:0,y:0},this._layoutRect={width:0,height:0},this._layoutRectLevelMap={width:0,height:0},this._minWidth=null,this._maxWidth=null,this._minHeight=null,this._maxHeight=null,this._lastComputeRect=null,this._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0},this.getLayoutRect=()=>this._layoutRect,this.layoutType="normal",this._layoutOrient="left",this.layoutPaddingLeft=0,this.layoutPaddingTop=0,this.layoutPaddingRight=0,this.layoutPaddingBottom=0,this.layoutOffsetX=0,this.layoutOffsetY=0,this.layoutLevel=Wo.Region,this._model=t,this._option=e,this.layoutLevel=e.layoutLevel,this.layoutType=e.layoutType,e.layoutOrient&&(this.layoutOrient=e.layoutOrient),this._spec=(i=t==null?void 0:t.getSpec)===null||i===void 0?void 0:i.call(t)}_setLayoutAttributeFromSpec(t,e){var i,n,r,a;if(this._spec&&this._spec.visible!==!1){const o=xb(Ro(t.padding),e,e);this.layoutPaddingLeft=o.left,this.layoutPaddingRight=o.right,this.layoutPaddingTop=o.top,this.layoutPaddingBottom=o.bottom,this._minHeight=I(t.minHeight)?(i=this._minHeight)!==null&&i!==void 0?i:null:Je(t.minHeight,e.height,e),this._maxHeight=I(t.maxHeight)?(n=this._maxHeight)!==null&&n!==void 0?n:null:Je(t.maxHeight,e.height,e),this._minWidth=I(t.minWidth)?(r=this._minWidth)!==null&&r!==void 0?r:null:Je(t.minWidth,e.width,e),this._maxWidth=I(t.maxWidth)?(a=this._maxWidth)!==null&&a!==void 0?a:null:Je(t.maxWidth,e.width,e),t.width&&this.setLayoutRect({width:Je(t.width,e.width,e)},{width:9}),t.height&&this.setLayoutRect({height:Je(t.height,e.height,e)},{height:9}),I(t.offsetX)||(this.layoutOffsetX=Je(t.offsetX,e.width,e)),I(t.offsetY)||(this.layoutOffsetY=Je(t.offsetY,e.height,e)),t.alignSelf&&(this.alignSelf=t.alignSelf)}}setAttrFromSpec(t,e){var i,n,r,a;this._spec=t,this.layoutType=(i=t.layoutType)!==null&&i!==void 0?i:this.layoutType,this.layoutLevel=(n=t.layoutLevel)!==null&&n!==void 0?n:this.layoutLevel,this.layoutOrient=(r=t.orient)!==null&&r!==void 0?r:this.layoutOrient,this._setLayoutAttributeFromSpec(t,e),this.layoutClip=(a=t.clip)!==null&&a!==void 0?a:this.layoutClip}onLayoutStart(t,e,i){this._setLayoutAttributeFromSpec(this._spec,e)}onLayoutEnd(t){}_getAbsoluteSpecValue(t){const e={top:null,bottom:null,left:null,right:null};return["top","bottom","left","right"].forEach(i=>{I(this._spec[i])||(e[i]=Je(this._spec[i],i==="top"||i==="bottom"?t.height:t.width,t))}),e}absoluteLayoutInRect(t){const{top:e,bottom:i,left:n,right:r}=this._getAbsoluteSpecValue(t),a={width:t.width-this.layoutPaddingLeft-this.layoutPaddingRight,height:t.height-this.layoutPaddingTop-this.layoutPaddingBottom};I(n)||(a.width-=n),I(r)||(a.width-=r),I(e)||(a.height-=e),I(i)||(a.height-=i),this.setLayoutRect(a);const{width:o,height:l}=this.computeBoundsInRect(this.getLayoutRect());this.setLayoutRect({width:o,height:l});const h={x:t.x,y:t.y};this._spec.center===!0?(h.x=t.x+.5*t.width-.5*o,h.y=t.y+.5*t.height-.5*l):(I(n)?I(r)||(h.x=t.x+t.width-this.layoutPaddingRight-r-o):h.x=t.x+n+this.layoutPaddingLeft,I(e)?I(i)||(h.y=t.y+t.height-this.layoutPaddingBottom-i-l):h.y=t.y+e+this.layoutPaddingTop),this.setLayoutStartPosition(h)}setLayoutStartPosition(t){var e,i;this._option.transformLayoutPosition&&(t=this._option.transformLayoutPosition(t)),q(t.x)&&(this._layoutStartPoint.x=t.x),q(t.y)&&(this._layoutStartPoint.y=t.y),(i=(e=this._model).afterSetLayoutStartPoint)===null||i===void 0||i.call(e,this._layoutStartPoint)}setLayoutRect({width:t,height:e},i){var n,r,a,o;q(t)&&((n=i==null?void 0:i.width)!==null&&n!==void 0?n:0)>=this._layoutRectLevelMap.width&&(this._layoutRect.width=t,this._layoutRectLevelMap.width=(r=i==null?void 0:i.width)!==null&&r!==void 0?r:0),q(e)&&((a=i==null?void 0:i.height)!==null&&a!==void 0?a:0)>=this._layoutRectLevelMap.height&&(this._layoutRect.height=e,this._layoutRectLevelMap.height=(o=i==null?void 0:i.height)!==null&&o!==void 0?o:0),this.setRectInSpec(this._layoutRect)}getLayout(){return{x:this._layoutStartPoint.x,y:this._layoutStartPoint.y,width:this._layoutRect.width,height:this._layoutRect.height}}mergeLayoutRect({width:t,height:e}){const i={width:t,height:e};return this._layoutRectLevelMap.width>0&&(i.width=this._layoutRect.width),this._layoutRectLevelMap.height>0&&(i.height=this._layoutRect.height),i}getOrientPosAttribute(){return this._layoutOrient==="bottom"||this._layoutOrient==="top"?"x":"y"}getOrientSizeAttribute(){return this._layoutOrient==="bottom"||this._layoutOrient==="top"?"width":"height"}changeBoundsBySetting(t){return this._layoutRectLevelMap.width>0&&(t.x2=t.x1+this._layoutRect.width),this._layoutRectLevelMap.height>0&&(t.y2=t.y1+this._layoutRect.height),t.x1-=this._layoutStartPoint.x,t.x2-=this._layoutStartPoint.x,t.y1-=this._layoutStartPoint.y,t.y2-=this._layoutStartPoint.y,t}setRectInSpec(t){const e=Object.assign({},t);return this._layoutRectLevelMap.width<9?(I(this._minWidth)||(e.width=Math.max(e.width,this._minWidth)),I(this._maxWidth)||(e.width=Math.min(e.width,this._maxWidth))):e.width=this._layoutRect.width,this._layoutRectLevelMap.height<9?(I(this._minHeight)||(e.height=Math.max(e.height,this._minHeight)),I(this._maxHeight)||(e.height=Math.min(e.height,this._maxHeight))):e.height=this._layoutRect.height,e}computeBoundsInRect(t){if(this._lastComputeRect=t,!(this.layoutType!=="region-relative"&&this.layoutType!=="region-relative-overlap"||(this._layoutRectLevelMap.width!==9||this.layoutOrient!=="left"&&this.layoutOrient!=="right")&&(this._layoutRectLevelMap.height!==9||this.layoutOrient!=="bottom"&&this.layoutOrient!=="top")))return this._layoutRect;const e=Object.assign({},this._model.getBoundsInRect(this.setRectInSpec(t),t));this.changeBoundsBySetting(e),this.autoIndent&&e.x2-e.x1>0&&e.y2-e.y1>0&&(this._lastComputeOutBounds.x1=Math.ceil(-e.x1),this._lastComputeOutBounds.x2=Math.ceil(e.x2-t.width),this._lastComputeOutBounds.y1=Math.ceil(-e.y1),this._lastComputeOutBounds.y2=Math.ceil(e.y2-t.height));let i=this.setRectInSpec(function(n,r){return n?{width:Math.ceil(Math.min(n.x2-n.x1,r.width)),height:Math.ceil(Math.min(n.y2-n.y1,r.height))}:{width:0,height:0}}(e,t));return this._option.transformLayoutRect&&(i=this._option.transformLayoutRect(i)),i}getModelId(){return this._model.id}getModelVisible(){return this._model.getVisible()}}class iS extends Wg{constructor(){super(...arguments),this.layoutType="normal",this.layoutLevel=0,this.layoutZIndex=0,this._forceLayoutTag=!1,this._layout=null,this._orient=null,this._layoutRect={width:0,height:0},this._layoutStartPos={x:0,y:0},this._isLayout=!0,this.getGraphicBounds=()=>this._layout?{x1:this._layout.getLayoutStartPoint().x,y1:this._layout.getLayoutStartPoint().y,x2:this._layout.getLayoutStartPoint().x+this._layout.getLayoutRect().width,y2:this._layout.getLayoutStartPoint().y+this._layout.getLayoutRect().height}:{x1:0,x2:0,y1:0,y2:0},this._transformLayoutRect=null,this._transformLayoutPosition=null}get layoutOrient(){return this._orient}set layoutOrient(t){this._orient=t,this._layout&&(this._layout.layoutOrient=t)}initLayout(){this.layoutType!=="none"&&(this._layout=new qI(this,{layoutType:this.layoutType,layoutLevel:this.layoutLevel,layoutOrient:this._orient,transformLayoutRect:this._transformLayoutRect,transformLayoutPosition:this._transformLayoutPosition}),this._orient&&this._orient!=="radius"&&this._orient!=="angle"&&this._layout&&(this._layout.layoutOrient=this._orient))}onLayoutStart(t,e,i){this._isLayout=!0,super.onLayoutStart(t,e,i)}onLayoutEnd(t){super.onLayoutEnd(t),this.updateLayoutAttribute();const e=this.getLayoutRect();!this._forceLayoutTag&&Xt(this._lastLayoutRect,e)||(this._lastLayoutRect=Object.assign({},e)),this._forceLayoutTag=!1,this._isLayout=!1}afterSetLayoutStartPoint(t){}_forceLayout(){var t;this._isLayout||(this._forceLayoutTag=!0,(t=this._option.globalInstance.getChart())===null||t===void 0||t.setLayoutTag(!0))}getLayoutStartPoint(){return this._layout?this._layout.getLayoutStartPoint():this._layoutStartPos}setLayoutStartPosition(t){return this._layout?this._layout.setLayoutStartPosition(t):this._layoutStartPos=rt(this._layoutStartPos,t)}getLayoutRect(){return this._layout?this._layout.getLayoutRect():this._layoutRect}setLayoutRect(t,e){return this._layout?this._layout.setLayoutRect(t):this._lastLayoutRect=rt(this._layoutRect,t)}getLastComputeOutBounds(){var t;return(t=this._layout)===null||t===void 0?void 0:t.getLastComputeOutBounds()}setAttrFromSpec(){var t,e,i,n,r;super.setAttrFromSpec(),this.layoutClip=(t=this._spec.clip)!==null&&t!==void 0?t:this.layoutClip,this.layoutZIndex=(e=this._spec.zIndex)!==null&&e!==void 0?e:this.layoutZIndex,this.layoutType=(i=this._spec.layoutType)!==null&&i!==void 0?i:this.layoutType,this._orient=(n=this._spec.orient)!==null&&n!==void 0?n:this._orient,this.layoutLevel=(r=this._spec.layoutLevel)!==null&&r!==void 0?r:this.layoutLevel}}class sS extends fu{_initTheme(t,e){return{spec:t,theme:this._theme}}}class na extends iS{getMaxWidth(){return this._layout.maxWidth}setMaxWidth(t){this._layout.maxWidth=t}getMaxHeight(){return this._layout.maxHeight}setMaxHeight(t){this._layout.maxHeight=t}getGroupMark(){return this._groupMark}getInteractionMark(){return this._interactionMark}getStackInverse(){return this._spec.stackInverse===!0}getStackSort(){return this._spec.stackSort===!0}constructor(t,e){var i;super(t,e),this.transformerConstructor=sS,this.modelType="region",this.specKey="region",this.type=na.type,this._series=[],this.layoutType="region",this.layoutZIndex=Qe.Region,this.interaction=new $I,this.seriesDataFilterOver=()=>{this.event.emit(pt.regionSeriesDataFilterOver,{model:this,chart:this.getChart()}),this._series.forEach(n=>{n.getViewDataFilter()&&n.reTransformViewData()})},this.getBoundsInRect=()=>({x1:this._layout.getLayoutStartPoint().x,y1:this._layout.getLayoutStartPoint().y,x2:this._layout.getLayoutStartPoint().x+this._layout.getLayoutRect().width,y2:this._layout.getLayoutStartPoint().y+this._layout.getLayoutRect().height}),this.userId=t.id,this.coordinate=(i=t.coordinate)!==null&&i!==void 0?i:"cartesian",this._option.animation&&(this.animate=new eS({getCompiler:e.getCompiler})),this.interaction.setDisableActiveEffect(this._option.disableTriggerEvent)}_getClipDefaultValue(){var t,e,i,n;const r=this._option.getChart().getSpec(),a=(e=(t=r.dataZoom)===null||t===void 0?void 0:t.some)===null||e===void 0?void 0:e.call(t,l=>{var h;return((h=l.filterMode)!==null&&h!==void 0?h:"filter")==="axis"}),o=(n=(i=r.scrollBar)===null||i===void 0?void 0:i.some)===null||n===void 0?void 0:n.call(i,l=>{var h;return((h=l.filterMode)!==null&&h!==void 0?h:"axis")==="axis"});return!(!a&&!o)||this._layout.layoutClip}created(){var t,e;this.initLayout(),super.created();const i=(t=this._spec.clip)!==null&&t!==void 0?t:this._getClipDefaultValue();this._groupMark=this._createGroupMark("regionGroup",this.userId,this.layoutZIndex),this._spec.roam&&this._groupMark.setMarkConfig({interactive:!0}),this._interactionMark=this._createGroupMark("regionInteractionGroup",((e=this.userId)!==null&&e!==void 0?e:this.type)+"_interaction",Qe.Interaction),ht(this._spec.style)||(this._backgroundMark=this._createMark({type:"rect",name:"regionBackground"}),i&&(this._foregroundMark=this._createMark({type:"rect",name:"regionForeground"})),[this._backgroundMark,this._foregroundMark].forEach(n=>{n&&(n.created(),this.setMarkStyle(n,{width:()=>this.getLayoutRect().width,height:()=>this.getLayoutRect().height},"normal",St.Built_In),this._groupMark.addMark(n))}),this._backgroundMark&&this._backgroundMark.setMarkConfig({zIndex:Qe.SeriesGroup-1}),this._foregroundMark&&this._foregroundMark.setMarkConfig({zIndex:Qe.Mark+1})),this.createTrigger()}_createGroupMark(t,e,i){var n,r;const a=this._createMark({type:"group",name:t});a.setUserId(e),a.setMarkConfig({zIndex:i});const o=(n=this._spec.clip)!==null&&n!==void 0?n:this._getClipDefaultValue();return this.setMarkStyle(a,{x:()=>this.getLayoutStartPoint().x,y:()=>this.getLayoutStartPoint().y,width:()=>this.getLayoutRect().width,height:()=>this.getLayoutRect().height,clip:o},"normal",St.Built_In),this.setMarkStyle(a,{cornerRadius:(r=this._spec.style)===null||r===void 0?void 0:r.cornerRadius},"normal",St.User_Mark),this._marks.addMark(a),a}init(t){super.init(t),this.initMark(),this.initSeriesDataflow(),this.initInteraction(),this.initTrigger()}initMark(){this._initBackgroundMarkStyle(),this._initForegroundMarkStyle()}_initBackgroundMarkStyle(){var t,e;this._backgroundMark&&(this.setMarkStyle(this._backgroundMark,Object.assign({fillOpacity:!((t=this._spec.style)===null||t===void 0)&&t.fill?1:0},this._spec.style),"normal",St.User_Mark),((e=this._spec.clip)!==null&&e!==void 0?e:this._getClipDefaultValue())&&this.setMarkStyle(this._backgroundMark,{strokeOpacity:0},"normal",St.Built_In))}_initForegroundMarkStyle(){this._foregroundMark&&this.setMarkStyle(this._foregroundMark,Object.assign(Object.assign({},this._spec.style),{fillOpacity:0,pickable:!1}),"normal",St.User_Mark)}_compareSpec(t,e){const i=super._compareSpec(t,e);return Xt(e==null?void 0:e.style,t==null?void 0:t.style)||(i.reMake=!0),i}reInit(t){super.reInit(t),this._initBackgroundMarkStyle(),this._initForegroundMarkStyle()}addSeries(t){t&&(this._series.includes(t)||this._series.push(t))}removeSeries(t){if(!t)return;const e=this._series.findIndex(i=>i===t);e>=0&&this._series.splice(e,1)}getSeries(t={}){return this._series.filter(e=>{var i,n;return(!t.name||(e==null?void 0:e.name)===t.name)&&(!t.userId||Y(t.userId).includes(e.userId))&&(!R(t.specIndex)||Y(t.specIndex).includes(e.getSpecIndex()))&&(!t.id||e.id===t.id)&&(!t.type||e.type===t.type)&&(!t.coordinateType||e.coordinate===t.coordinateType)&&(!t.dataName||((n=(i=e.getRawData)===null||i===void 0?void 0:i.call(e))===null||n===void 0?void 0:n.name)===t.dataName)})}getSeriesInName(t){return this.getSeries({name:t})[0]}getSeriesInUserId(t){return this.getSeries({userId:t})[0]}getSeriesInId(t){return this.getSeries({id:t})[0]}getSeriesInType(t){return this.getSeries({type:t})}getSeriesInCoordinateType(t){return this.getSeries({coordinateType:t})}getSeriesInDataName(t){return this.getSeries({dataName:t})}onRender(t){}initSeriesDataflow(){const t=this._series.map(e=>{var i;return(i=e.getViewDataFilter())!==null&&i!==void 0?i:e.getViewData()}).filter(e=>!!e);this._option.dataSet.multipleDataViewAddListener(t,"change",this.seriesDataFilterOver)}release(){super.release(),this._series=[]}createTrigger(){const t=Object.assign(Object.assign({},this._option),{model:this,interaction:this.interaction});this._trigger=new GI(t)}initTrigger(){this._series.forEach(t=>{t.getMarksWithoutRoot().forEach(e=>{this._trigger.registerMark(e)})}),this._trigger.init()}initInteraction(){this._option.disableTriggerEvent||this._series.forEach(t=>{t.getMarksWithoutRoot().forEach(e=>{for(const i in Vo)ht(e.stateStyle[Vo[i]])||this.interaction.registerMark(Vo[i],e)})})}compileMarks(t){this.getMarks().forEach(e=>{var i;e.compile({group:t,context:{model:this}}),(i=e.getProduct())===null||i===void 0||i.layout((n,r,a,o)=>{})})}compile(){var t;(t=this.animate)===null||t===void 0||t.compile(),this.compileMarks()}onLayoutEnd(t){this._series.forEach(e=>e.onLayoutEnd(t)),super.onLayoutEnd(t)}}function mu(s){const t=[],e=[],i=[];return s.forEach(n=>{I(n.getSpec().position)||n.getSpec().position==="start"?t.push(n):n.getSpec().position==="middle"?e.push(n):n.getSpec().position==="end"&&i.push(n)}),{startItems:t,endItems:i,middleItems:e}}function nS(s,t,e){t?s.forEach(i=>{const n=Wt(i),r=n.getLayoutStartPoint().y+n.getLayoutRect().height-i[0].getLayoutStartPoint().y,a=(e-r)/2;i.forEach(o=>{o.setLayoutStartPosition({x:o.getLayoutStartPoint().x,y:o.getLayoutStartPoint().y+a})})}):s.forEach(i=>{const n=Wt(i),r=n.getLayoutStartPoint().x+n.getLayoutRect().width-i[0].getLayoutStartPoint().x,a=(e-r)/2;i.forEach(o=>{o.setLayoutStartPosition({x:o.getLayoutStartPoint().x+a,y:o.getLayoutStartPoint().y})})})}function vu(s,t,e,i){let n;s.forEach((r,a)=>{r.length>1&&(n=e[a],r.forEach(o=>{if(!o.alignSelf||o.alignSelf==="start")return;const l=o.getLayoutStartPoint(),h=o.alignSelf==="middle"?.5:1,c=t?n-(o.getLayoutRect().width+o.layoutPaddingLeft+o.layoutPaddingRight):n-(o.getLayoutRect().height+o.layoutPaddingTop+o.layoutPaddingBottom);t?o.setLayoutStartPosition({x:l.x+i*c*h,y:l.y}):o.setLayoutStartPosition({x:l.x,y:l.y+i*c*h})}))})}function yu(s,t,e,i,n){if(s.length){let r=0;const a=n==="right",o=a?-1:1;let l=a?t.rightCurrent:t.leftCurrent,h=t.topCurrent;const c=[];let u=[];const d=[];s.forEach(p=>{const g=t.getItemComputeLayoutRect(p),f=p.computeBoundsInRect(g);p.setLayoutRect(f);const m=f.height+p.layoutPaddingTop+p.layoutPaddingBottom,v=f.width+p.layoutPaddingLeft+p.layoutPaddingRight,y=a?-f.width-p.layoutPaddingRight:p.layoutPaddingLeft;p.setLayoutStartPosition({x:l+p.layoutOffsetX+y,y:h+p.layoutOffsetY+p.layoutPaddingTop}),h+=m,h>e&&u.length?(d.push(r),l+=o*r,r=v,h=t.topCurrent+m,p.setLayoutStartPosition({x:l+p.layoutOffsetX+y,y:t.topCurrent+p.layoutOffsetY+p.layoutPaddingTop}),c.push(u),u=[p]):(r=Math.max(r,v),u.push(p))}),d.push(r),c.push(u),vu(c,!0,d,o),i&&nS(c,!0,e),a?t.rightCurrent=l+o*r:t.leftCurrent=l+o*r}}function rS(s,t,e,i){if(s.length){let n=0;const r=i==="right",a=r?-1:1;let o=r?t.rightCurrent:t.leftCurrent,l=t.bottomCurrent;const h=[];let c=[];const u=[];s.forEach(d=>{const p=t.getItemComputeLayoutRect(d),g=d.computeBoundsInRect(p);d.setLayoutRect(g);const f=g.height+d.layoutPaddingTop+d.layoutPaddingBottom,m=g.width+d.layoutPaddingLeft+d.layoutPaddingRight,v=r?-g.width-d.layoutPaddingRight:d.layoutPaddingLeft;l<f&&c.length?(u.push(n),o+=a*n,n=m,l=t.bottomCurrent,d.setLayoutStartPosition({x:o+d.layoutOffsetX+v,y:l+d.layoutOffsetY-g.height-d.layoutPaddingBottom}),h.push(c),c=[d]):(d.setLayoutStartPosition({x:o+d.layoutOffsetX+v,y:l+d.layoutOffsetY-g.height-d.layoutPaddingBottom}),n=Math.max(n,m),l-=f,c.push(d))}),u.push(n),h.push(c),vu(h,!0,u,a),r?t.rightCurrent=o+a*n:t.leftCurrent=o+a*n}}function _u(s,t,e,i,n){if(s.length){const r=n==="top",a=r?1:-1;let o=0,l=t.leftCurrent,h=r?t.topCurrent:t.bottomCurrent;const c=[];let u=[];const d=[];s.forEach(p=>{const g=t.getItemComputeLayoutRect(p),f=p.computeBoundsInRect(g);p.setLayoutRect(f);const m=f.height+p.layoutPaddingTop+p.layoutPaddingBottom,v=f.width+p.layoutPaddingLeft+p.layoutPaddingRight,y=r?p.layoutPaddingTop:-f.height-p.layoutPaddingBottom;p.setLayoutStartPosition({x:l+p.layoutOffsetX+p.layoutPaddingLeft,y:h+p.layoutOffsetY+y}),l+=v,l>e&&u.length?(d.push(o),l=t.leftCurrent+v,h+=a*o,o=m,p.setLayoutStartPosition({x:t.leftCurrent+p.layoutOffsetX+p.layoutPaddingLeft,y:h+p.layoutOffsetY+y}),c.push(u),u=[p]):(o=Math.max(o,m),u.push(p))}),d.push(o),c.push(u),vu(c,!1,d,a),i&&nS(c,!1,e),r?t.topCurrent=h+a*o:t.bottomCurrent=h+a*o}}function aS(s,t,e,i){if(s.length){const n=i==="top",r=n?1:-1;let a=0,o=t.rightCurrent,l=n?t.topCurrent:t.bottomCurrent;const h=[];let c=[];const u=[];s.forEach(d=>{const p=t.getItemComputeLayoutRect(d),g=d.computeBoundsInRect(p);d.setLayoutRect(g);const f=g.height+d.layoutPaddingTop+d.layoutPaddingBottom,m=g.width+d.layoutPaddingLeft+d.layoutPaddingRight,v=n?d.layoutPaddingTop:-g.height-d.layoutPaddingBottom;o<m&&c.length?(o=t.rightCurrent,l+=r*a,a=f,d.setLayoutStartPosition({x:t.rightCurrent+d.layoutOffsetX-g.width-d.layoutPaddingRight,y:l+d.layoutOffsetY+v}),h.push(c),c=[d]):(c.push(d),d.setLayoutStartPosition({x:o+d.layoutOffsetX-g.width-d.layoutPaddingRight,y:l+d.layoutOffsetY+v}),a=Math.max(a,f),o-=m)}),u.push(a),h.push(c),vu(h,!1,u,r),n?t.topCurrent=l+r*a:t.bottomCurrent=l+r*a}}na.type="region",na.transformerConstructor=sS,na.specKey="region";class oS{constructor(t,e){this.leftCurrent=0,this.topCurrent=0,this.rightCurrent=0,this.bottomCurrent=0,this._onError=e==null?void 0:e.onError}_layoutInit(t,e,i,n){this._chartLayoutRect=i,this._chartViewBox=n,this.leftCurrent=i.x,this.topCurrent=i.y,this.rightCurrent=i.x+i.width,this.bottomCurrent=i.height+i.y,e.sort((r,a)=>a.layoutLevel-r.layoutLevel)}_layoutNormalItems(t){this.layoutNormalInlineItems(t.filter(e=>e.layoutType==="normal-inline")),this.layoutNormalItems(t.filter(e=>e.layoutType==="normal"))}_groupItems(t){const e=t.filter(o=>o.layoutType==="region"),i=t.filter(o=>o.layoutType==="region-relative"),n=t.filter(o=>o.layoutType==="region-relative-overlap"),r=i.concat(n),a={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}};return n.forEach(o=>{a[o.layoutOrient].items.push(o)}),{regionItems:e,relativeItems:i,relativeOverlapItems:n,allRelatives:r,overlapItems:a}}layoutItems(t,e,i,n){this._layoutInit(t,e,i,n),this._layoutNormalItems(e);const r={left:this.leftCurrent,top:this.topCurrent,right:this.rightCurrent,bottom:this.bottomCurrent},{regionItems:a,relativeItems:o,relativeOverlapItems:l,allRelatives:h,overlapItems:c}=this._groupItems(e);this.layoutRegionItems(a,o,l,c),this._processAutoIndent(a,o,l,c,h,r),this.layoutAbsoluteItems(e.filter(u=>u.layoutType==="absolute"))}_processAutoIndent(t,e,i,n={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}},r,a){if(r.some(o=>o.autoIndent)){const{top:o,bottom:l,left:h,right:c}=this._checkAutoIndent(r,a);(o||l||h||c)&&(this.topCurrent=a.top+o,this.bottomCurrent=a.bottom-l,this.leftCurrent=a.left+h,this.rightCurrent=a.right-c,this.layoutRegionItems(t,e,i,n))}}layoutNormalItems(t){t.forEach(e=>{const i=this.getItemComputeLayoutRect(e),n=e.computeBoundsInRect(i);e.setLayoutRect(n),e.layoutOrient==="left"?(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.leftCurrent+=n.width+e.layoutPaddingLeft+e.layoutPaddingRight):e.layoutOrient==="top"?(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.topCurrent+=n.height+e.layoutPaddingTop+e.layoutPaddingBottom):e.layoutOrient==="right"?(e.setLayoutStartPosition({x:this.rightCurrent+e.layoutOffsetX-n.width-e.layoutPaddingRight,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.rightCurrent-=n.width+e.layoutPaddingLeft+e.layoutPaddingRight):e.layoutOrient==="bottom"&&(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingRight,y:this.bottomCurrent+e.layoutOffsetY-n.height-e.layoutPaddingBottom}),this.bottomCurrent-=n.height+e.layoutPaddingTop+e.layoutPaddingBottom)})}layoutNormalInlineItems(t){const e=t.filter(l=>l.layoutOrient==="left"),i=t.filter(l=>l.layoutOrient==="right"),n=t.filter(l=>l.layoutOrient==="top"),r=t.filter(l=>l.layoutOrient==="bottom"),a=this._chartLayoutRect.width+this._chartLayoutRect.x,o=this._chartLayoutRect.height+this._chartLayoutRect.y;e.length&&function(l,h,c){const{startItems:u,middleItems:d,endItems:p}=mu(l);u.length&&yu(u,h,c,!1,"left"),d.length&&yu(d,h,c,!0,"left"),p.length&&rS(p,h,0,"left")}(e,this,o),n.length&&function(l,h,c){const{startItems:u,middleItems:d,endItems:p}=mu(l);u.length&&_u(u,h,c,!1,"top"),d.length&&_u(d,h,c,!0,"top"),p.length&&aS(p,h,0,"top")}(n,this,a),i.length&&function(l,h,c){const{startItems:u,middleItems:d,endItems:p}=mu(l);u.length&&yu(u,h,c,!1,"right"),d.length&&yu(d,h,c,!0,"right"),p.length&&rS(p,h,0,"right")}(i,this,o),r.length&&function(l,h,c){const{startItems:u,middleItems:d,endItems:p}=mu(l);u.length&&_u(u,h,c,!1,"bottom"),d.length&&_u(d,h,c,!0,"bottom"),p.length&&aS(p,h,0,"bottom")}(r,this,a)}_layoutRelativeOverlap(t,e){e.items.forEach(i=>{const n=this.getItemComputeLayoutRect(i),r=i.computeBoundsInRect(n);e.rect.width=Math.max(r.width+i.layoutPaddingLeft+i.layoutPaddingRight,e.rect.width),e.rect.height=Math.max(r.height+i.layoutPaddingTop+i.layoutPaddingBottom,e.rect.height)}),e.items.forEach(i=>{i.setLayoutRect(e.rect),t==="left"?i.setLayoutStartPosition({x:this.leftCurrent+i.layoutOffsetX}):t==="right"?i.setLayoutStartPosition({x:this.rightCurrent-e.rect.width+i.layoutOffsetX}):t==="top"?i.setLayoutStartPosition({x:this.topCurrent+i.layoutOffsetY}):i.setLayoutStartPosition({x:this.bottomCurrent-e.rect.height+i.layoutOffsetY})}),t==="left"?this.leftCurrent+=e.rect.width:t==="right"?this.rightCurrent-=e.rect.width:t==="top"?this.topCurrent+=e.rect.height:this.bottomCurrent-=e.rect.height}_layoutRelativeItem(t,e){const i=t.computeBoundsInRect(e);t.layoutOrient==="left"||t.layoutOrient==="right"?t.setLayoutRect({width:i.width}):t.setLayoutRect({height:i.height}),t.layoutOrient==="left"?(t.setLayoutStartPosition({x:this.leftCurrent+t.layoutOffsetX+t.layoutPaddingLeft}),this.leftCurrent+=i.width+t.layoutPaddingLeft+t.layoutPaddingRight):t.layoutOrient==="right"?(this.rightCurrent-=i.width+t.layoutPaddingLeft+t.layoutPaddingRight,t.setLayoutStartPosition({x:this.rightCurrent+t.layoutOffsetX+t.layoutPaddingLeft})):t.layoutOrient==="top"?(t.setLayoutStartPosition({y:this.topCurrent+t.layoutOffsetY+t.layoutPaddingTop}),this.topCurrent+=i.height+t.layoutPaddingTop+t.layoutPaddingBottom):t.layoutOrient==="bottom"&&(this.bottomCurrent-=i.height+t.layoutPaddingTop+t.layoutPaddingBottom,t.setLayoutStartPosition({y:this.bottomCurrent+t.layoutOffsetY+t.layoutPaddingTop}))}_layoutRegionItem(t,e,i){const n=Math.max(Math.min(e,...t.map(a=>{var o;return(o=a.maxWidth)!==null&&o!==void 0?o:Number.MAX_VALUE})),0),r=Math.max(Math.min(i,...t.map(a=>{var o;return(o=a.maxHeight)!==null&&o!==void 0?o:Number.MAX_VALUE})),0);return t.forEach(a=>{const o=n-a.layoutPaddingLeft-a.layoutPaddingRight,l=r-a.layoutPaddingTop-a.layoutPaddingBottom;a.setLayoutRect({width:o,height:l}),a.setLayoutStartPosition({x:this.leftCurrent+a.layoutOffsetX+a.layoutPaddingLeft,y:this.topCurrent+a.layoutOffsetY+a.layoutPaddingTop})}),{regionHeight:r,regionWidth:n}}layoutRegionItems(t,e,i,n={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}}){let r=this.rightCurrent-this.leftCurrent,a=this.bottomCurrent-this.topCurrent;e.filter(h=>h.layoutOrient==="left"||h.layoutOrient==="right").forEach(h=>{this._layoutRelativeItem(h,this.getItemComputeLayoutRect(h))}),this._layoutRelativeOverlap("left",n.left),this._layoutRelativeOverlap("right",n.right),r=this.rightCurrent-this.leftCurrent,e.filter(h=>h.layoutOrient==="top"||h.layoutOrient==="bottom").forEach(h=>{this._layoutRelativeItem(h,this.getItemComputeLayoutRect(h))}),this._layoutRelativeOverlap("top",n.top),this._layoutRelativeOverlap("bottom",n.bottom),a=this.bottomCurrent-this.topCurrent;const{regionWidth:o,regionHeight:l}=this._layoutRegionItem(t,r,a);e.concat(i).forEach(h=>{if(["left","right"].includes(h.layoutOrient)){const c=this.filterRegionsWithID(t,h.layoutBindRegionID[0]);h.setLayoutRect({height:c.getLayoutRect().height}),h.setLayoutStartPosition({y:c.getLayoutStartPoint().y+h.layoutOffsetY+h.layoutPaddingTop}),h.layoutOrient==="right"&&h.setLayoutStartPosition({x:h.getLayoutStartPoint().x+o-r})}else if(["top","bottom"].includes(h.layoutOrient)){const c=this.filterRegionsWithID(t,h.layoutBindRegionID[0]);h.setLayoutRect({width:c.getLayoutRect().width}),h.setLayoutStartPosition({x:c.getLayoutStartPoint().x+h.layoutOffsetX+h.layoutPaddingLeft}),h.layoutOrient==="bottom"&&h.setLayoutStartPosition({y:h.getLayoutStartPoint().y+l-a})}})}layoutAbsoluteItems(t){t.forEach(e=>{e.absoluteLayoutInRect(this._chartLayoutRect)})}filterRegionsWithID(t,e){var i;const n=t.find(r=>r.getModelId()===e);return n||((i=this._onError)!==null&&i!==void 0?i:co)("can not find target region item, invalid id"),n}getItemComputeLayoutRect(t){return{width:this.rightCurrent-this.leftCurrent-t.layoutPaddingLeft-t.layoutPaddingRight,height:this.bottomCurrent-this.topCurrent-t.layoutPaddingTop-t.layoutPaddingBottom}}_checkAutoIndent(t,e){const i={top:0,left:0,bottom:0,right:0};return t.forEach(n=>{if(!n.getModelVisible()||!n.autoIndent)return;const r=n.layoutOrient==="left"||n.layoutOrient==="right",a=n.getLastComputeOutBounds(),o=this._getOutInLayout(a,n,e);r?(i.top=Math.max(i.top,o.top),i.bottom=Math.max(i.bottom,o.bottom)):(i.left=Math.max(i.left,o.left),i.right=Math.max(i.right,o.right))}),i}_getOutInLayout(t,e,i){const{x:n,y:r}=e.getLayoutStartPoint(),{width:a,height:o}=e.getLayoutRect();return{left:i.left-(n-t.x1),right:n+a+t.x2-i.right,top:i.top-(r-t.y1),bottom:r+o+t.y2-i.bottom}}}oS.type="base";const lS=["linear","radial","conical"],ZI={linear:{x0:0,y0:0,x1:1,y1:1},radial:{x0:0,y0:0,x1:1,y1:1,r0:0,r1:1},conical:{x:.5,y:.5,startAngle:0,endAngle:2*Math.PI}},JI=["line","area","trail"];function Ug(s){return JI.includes(s)}class QI extends tS{getStateInfoList(){return this._stateInfoList}constructor(t,e){super(t),this._stateInfoList=[],this._mark=e}_getDefaultStateMap(){return{markUpdateRank:1}}getStateInfo(t){return this._stateInfoList.find(e=>e.stateValue===t)}addStateInfo(t){if(this.getStateInfo(t.stateValue))return;t.level=t.level||0;let e=!0;for(let i=0;i<this._stateInfoList.length;i++){const n=this._stateInfoList[i].level;if(n&&n>t.level){this._stateInfoList.splice(i,0,t),e=!1;break}}e&&this._stateInfoList.push(t)}_clearStateBeforeSet(t){t.datums=null,t.items=null,t.fields=null,t.filter=null}changeStateInfo(t){const e=this.getStateInfo(t.stateValue);if(e){if(t.datums!==void 0&&(this._clearStateBeforeSet(e),e.datums=t.datums,e.datumKeys=t.datumKeys),t.items!==void 0&&(this._clearStateBeforeSet(e),e.items=t.items),t.fields!==void 0)if(this._clearStateBeforeSet(e),t.fields===null)e.fields=t.fields;else{e.fields=e.fields||{};for(const i in t.fields){const n=t.fields[i];e.fields[i]=e.fields[i]||{};const r=e.fields[i];R(n.domain)&&(r.domain=n.domain),R(n.type)&&(r.type=n.type)}}t.filter&&(this._clearStateBeforeSet(e),e.filter=t.filter)}else this.addStateInfo(t)}clearStateInfo(t){t.forEach(e=>{this.getStateInfo(e)&&this.changeStateInfo({stateValue:e,datumKeys:null,datums:null,fields:null,items:null,filter:null,cache:{}})})}checkOneState(t,e,i,n){var r;n=pe(Ug)?n:!t.mark||Ug(t.mark.markType);let a=!1,o=!1;if(R(i.datums)&&i.datums.length>0)a=this.checkDatumState(i,e,n),o=!0;else if(i.items)a=(r=this.checkItemsState(i,t))!==null&&r!==void 0&&r,o=!0;else if(i.fields)a=this.checkFieldsState(i,e,t,n),o=!0;else if(!a&&i.filter){const l={mark:this._mark,renderNode:t,type:t.mark.markType};a=i.filter(e,l),o=!0}return o?a?"in":"out":"skip"}checkState(t,e){const i=t.getStates().filter(r=>!!Qx[r]).map(r=>[r,10]),n=!t.mark||Ug(t.mark.markType);for(let r=0;r<this._stateInfoList.length;r++){const a=this._stateInfoList[r],o=this.checkOneState(t,e,a,n);o!=="skip"&&o==="in"&&i.push([a.stateValue,a.level])}return i.map(r=>r[0])}checkDatumState(t,e,i){let n=!1;const r=i?e[0]:e;if(W(t.datums)){const a=t.datumKeys||Object.keys(t.datums[0]).filter(o=>!o.startsWith(xt));n=t.datums.some(o=>i&&W(o==null?void 0:o.items)?a.every(l=>{var h,c;return((c=(h=o==null?void 0:o.items)===null||h===void 0?void 0:h[0])===null||c===void 0?void 0:c[l])===(r==null?void 0:r[l])}):a.every(l=>(o==null?void 0:o[l])===(r==null?void 0:r[l])))}else _t(t.datums)?n=(t.datumKeys||Object.keys(t.datums).filter(o=>!o.startsWith(xt))).every(o=>{var l,h;return i?((l=t.datums.items)===null||l===void 0?void 0:l[0][o])===r[o]:((h=t.datums)===null||h===void 0?void 0:h[o])===r[o]}):n=e===t.datums;return n}checkItemsState(t,e){var i;return(i=t.items)===null||i===void 0?void 0:i.includes(e)}checkFieldsState(t,e,i,n){var r;let a=!0;for(const o in t.fields){const l=t.fields[o],h=l.type,c=l.domain,u=n?(r=e[0])===null||r===void 0?void 0:r[o]:e[o];if(he(h)&&c.length>1){if(this.checkLinearFieldState(c,o,e,i,n)){a=!1;break}a=!0}else{if(!c.some(d=>d===u)){a=!1;break}a=!0}}return a}checkLinearFieldState(t,e,i,n,r){var a;const o=r?(a=i[0])===null||a===void 0?void 0:a[e]:i[e];return o<t[0]||o>t[t.length-1]}updateLayoutState(t){return this._stateMap.markUpdateRank++,this.updateState({markUpdateRank:this._stateMap.markUpdateRank},t)}compileState(t,e){t.state({callback:(i,n)=>this.checkState(n,i)},e)}}class Vn extends Vg{getDataView(){return this._data}setDataView(t){this._data=t}getLatestData(){var t;return(t=this._data)===null||t===void 0?void 0:t.latestData}constructor(t,e){super(t),this.grammarType=rn.data,this._data=null,this._data=e}release(){super.release(),this._data=null}updateData(t){const e=this.getProduct(),i=this.getLatestData();if(e&&i&&(e.values(i),!t))return this.getCompiler().renderNextTick()}_compileProduct(){const t=this.getLatestData();I(t)||(I(this.getProduct())?this._initProduct(t):this._product.values(t))}_initProduct(t){var e,i;const n=this.getVGrammarView();if(!n||!t)return;const r=this.getProductId();this._product=(i=(e=n==null?void 0:n.data)===null||e===void 0?void 0:e.call(n,t))===null||i===void 0?void 0:i.id(r),this._compiledProductId=r}generateProductId(){var t;return\`\${(t=this.getDataView())===null||t===void 0?void 0:t.name}\`}_lookupGrammar(t){var e,i;return(i=(e=this.getCompiler().getVGrammarView())===null||e===void 0?void 0:e.getDataById)===null||i===void 0?void 0:i.call(e,t)}}class tO extends Vn{constructor(t){super(t),this._mark=t.mark}setCompiledProductId(t){this._compiledProductId=t}generateProductId(){const t=super.generateProductId();return R(t)?t:\`\${xt}_markData_\${this._mark.id}\`}_compileProduct(){var t;const e=(t=this._data)===null||t===void 0?void 0:t.latestData;I(e)||R(this.getProduct())||this._initProduct(e)}}class eO extends Vg{getMarkConfig(){return this._markConfig}setMarkConfig(t){Object.keys(t).forEach(e=>{this._markConfig[e]=t[e]})}getVisible(){return this._visible}setVisible(t){this._visible=t}getUserId(){return this._userId}setUserId(t){R(t)&&(this._userId=t)}getDataView(){var t;return(t=this._data)===null||t===void 0?void 0:t.getDataView()}setDataView(t,e){I(this._data)&&this.initMarkData(Object.assign(Object.assign({},this._option),{mark:this})),R(e)&&this._data.setCompiledProductId(e),this._data.setDataView(t)}getData(){return this._data}setData(t){this._data=t}hasState(t){return t in this.state.getStateMap()}getState(t){return this.state.getStateMap()[t]}getAnimationConfig(){return this._animationConfig}setAnimationConfig(t){this._animationConfig=t}setSkipBeforeLayouted(t){this._skipBeforeLayouted=t}getSkipBeforeLayouted(){return this._skipBeforeLayouted}getGroupKey(){return this._groupKey}setGroupKey(t){this._groupKey=t}setStateSortCallback(t){this._stateSort=t}constructor(t,e,i){super(t),this.grammarType=rn.mark,this.type=void 0,this.name="mark",this._markConfig={zIndex:Qe.Mark,morph:!1},this._visible=!0,this.stateStyle={},this._unCompileChannel={},this._skipBeforeLayouted=!1,this.name=e,this.model=i,this.key=t.key,this.state=new QI(Object.assign(Object.assign({},t),{stateKeyToSignalName:this.stateKeyToSignalName.bind(this)}),this),this._event=new cu(i.getOption().eventDispatcher,i.getOption().mode)}setTransform(t){this._transform=t}initMarkData(t){this._data=new tO(t)}stateKeyToSignalName(t){return\`\${xt}_\${this.type}_\${this.id}_\${t}\`}getAttribute(t,e,i,n){}_compileProduct(t){const e=this.getProduct();if(!this.getVisible())return void(R(e)&&this.removeProduct());R(e)||this.getCompiler().isInited&&(this._initProduct(t==null?void 0:t.group),I(this._product)||(this.compileSignal(),this.compileData(),this.compileState(),this.compileEncode(),this.compileAnimation(),this.compileContext(t==null?void 0:t.context),this.compileTransform()))}_initProduct(t){const e=this.getVGrammarView(),i=this.getProductId();this._product=e.mark(this.type,t??e.rootMark).id(i),this.name&&this._product&&this._product.name(this.name),this._compiledProductId=i}generateProductId(){return this._userId?\`\${this._userId}\`:\`\${this.name}_\${this.id}\`}compileData(){if(I(this._data))return;this._data.compile();const t=this._data.getProduct();R(this._product)&&R(t)&&this._product.join(t,this.key,void 0,this.getGroupKey())}updateStaticEncode(){if(!this._product)return;const{enterStyles:t,updateStyles:e}=this._separateStyle();this._product.encodeState("group",t,!0),this._product.encode(e,!0)}_separateStyle(){const t=this.stateStyle,e=Vt.STATE_NORMAL,i=t[e];ne(t,[typeof e=="symbol"?e:e+""]);const n=this._option.noSeparateStyle?null:{},r={};return Object.keys(i).forEach(a=>{this._unCompileChannel[a]||(this._option.noSeparateStyle||function(o,l,h){var c;const u=(c=l[o])===null||c===void 0?void 0:c.style;return!!function(p,g){return(p==="fill"||p==="stroke")&&(g==null?void 0:g.gradient)&&(g==null?void 0:g.stops)}(o,u)||!!U(u)||!(!(u!=null&&u.scale)||u.field===h)}(a,i,this.getGroupKey())?r[a]={callback:this.compileCommonAttributeCallback(a,"normal"),dependency:[this.stateKeyToSignalName("markUpdateRank")]}:n[a]=this.compileCommonAttributeCallback(a,"normal"))}),{enterStyles:n,updateStyles:r}}compileEncode(){const t=this.stateStyle,e=Vt.STATE_NORMAL;t[e];const i=ne(t,[typeof e=="symbol"?e:e+""]),{enterStyles:n,updateStyles:r}=this._separateStyle();this._product.encode(r,!0),this._product.encodeState("group",n,!0),Object.keys(i).forEach(a=>{const o={};Object.keys(i[a]).forEach(l=>{this._unCompileChannel[l]||(o[l]={callback:this.compileCommonAttributeCallback(l,a),dependency:[this.stateKeyToSignalName("markUpdateRank")]})}),this._product.encodeState(a,o,!0)}),this._skipBeforeLayouted&&this._product.layout({skipBeforeLayouted:this._skipBeforeLayouted})}compileState(){this.state.compileState(this._product,this._stateSort)}compileAnimation(){var t,e,i,n;if(this._animationConfig){let r;if(this.type==="component")r=(t=this.model.animate)===null||t===void 0?void 0:t.getAnimationStateSignalName();else{const a=(i=(e=this.model).getRegion)===null||i===void 0?void 0:i.call(e);r=(n=a==null?void 0:a.animate)===null||n===void 0?void 0:n.getAnimationStateSignalName()}this._product.animation(this._animationConfig),this._product.animationState({callback:(a,o,l)=>{var h;return(h=l[r])===null||h===void 0?void 0:h.callback(a,o)},dependency:r}),this._animationConfig.normal&&(this._animationConfig.appear?this._event.on(at.ANIMATION_END,({event:a})=>{a.mark===this.getProduct()&&a.animationState===ce.appear&&this.runAnimationByState(ce.normal)}):this._event.on(at.AFTER_DO_RENDER,()=>{this.runAnimationByState(ce.normal)}))}}compileContext(t){const e=Object.assign(Object.assign({},this._markConfig),{context:Object.assign({markId:this.id,modelId:this.model.id,markUserId:this._userId,modelUserId:this.model.userId},t)});this._product.configure(e)}compileSignal(){this.state.compile()}_computeAttribute(t,e){return(i,n)=>{}}compileCommonAttributeCallback(t,e){const i=this._computeAttribute(t,e),n={mark:null,parent:null,element:null};return(r,a)=>(n.mark=a.mark,n.parent=a.mark.group,n.element=a,i(r,n))}compileTransform(){var t;!((t=this._transform)===null||t===void 0)&&t.length&&this.getProduct().transform(this._transform)}_lookupGrammar(t){var e;return(e=this.getCompiler().getVGrammarView())===null||e===void 0?void 0:e.getMarkById(t)}updateState(t,e){return this.state.updateState(t,e)}updateLayoutState(t,e){return e&&this.getMarks().length>0&&this.getMarks().forEach(i=>i.state.updateLayoutState(!0)),this.state.updateLayoutState(t)}updateMarkState(t){if(!this._product)return;const e=this.state.getStateInfo(t);this._product.elements.forEach(i=>{this.state.checkOneState(i,i.getDatum(),e)==="in"?i.addState(t):i.removeState(t)})}getMarks(){return[]}runAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.runAnimationByState(t)}stopAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.stopAnimationByState(t)}pauseAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.pauseAnimationByState(t)}resumeAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.resumeAnimationByState(t)}getProductElements(){const t=this.getProduct();if(t)return t.elements}release(){super.release(),this.state.release()}}class Rs extends eO{constructor(t,e){var i;super(e,t,e.model),this._extensionChannel={},this._computeExChannel={},this._attributeContext=e.attributeContext,(i=e.map)===null||i===void 0||i.set(this.id,this)}created(){this._initStyle()}initStyleWithSpec(t,e){t&&(R(t.id)&&(this._userId=t.id),pe(t.interactive)&&(this._markConfig.interactive=t.interactive),R(t.zIndex)&&(this._markConfig.zIndex=t.zIndex),pe(t.visible)&&this.setVisible(t.visible),this._initSpecStyle(t,this.stateStyle,e))}_transformStyleValue(t,e){if(t.scale){const i=t.scale,n=i.range();return i.range(n.map(e)),t}return typeof t=="function"?(...i)=>e(t(...i)):e(t)}convertAngleToRadian(t){return this._transformStyleValue(t,ei)}isUserLevel(t){return[St.User_Mark,St.User_Series,St.User_Chart,St.User_SeriesStyle].includes(t)}setStyle(t,e="normal",i=0,n=this.stateStyle){if(I(t))return;n[e]===void 0&&(n[e]={});const r=this.isUserLevel(i);Object.keys(t).forEach(a=>{let o=t[a];I(o)||(o=this._filterAttribute(a,o,e,i,r,n),this.setAttribute(a,o,e,i,n))})}getStyle(t,e="normal"){var i;return(i=this.stateStyle[e][t])===null||i===void 0?void 0:i.style}_filterAttribute(t,e,i,n,r,a=this.stateStyle){let o=this._styleConvert(e);if(r)switch(t){case"angle":o=this.convertAngleToRadian(o);break;case"innerPadding":case"outerPadding":o=this._transformStyleValue(o,l=>-l);break;case"curveType":o=this._transformStyleValue(o,l=>{return h=l,c=this._option.model.direction,h==="monotone"?c==="horizontal"?"monotoneY":"monotoneX":h;var h,c})}return o}setReferer(t,e,i,n=this.stateStyle){var r;if(t)if(e&&i){const a=(r=n[i])!==null&&r!==void 0?r:{[e]:{}};n[i][e]=Object.assign(Object.assign({},a[e]),{referer:t})}else Object.entries(n).forEach(([a,o])=>{Object.entries(o).forEach(([l,h])=>{n[a][l].referer=t})})}setPostProcess(t,e,i="normal"){var n;!((n=this.stateStyle[i])===null||n===void 0)&&n[t]&&(this.stateStyle[i][t].postProcess=e)}getAttribute(t,e,i="normal",n){return this._computeAttribute(t,i)(e,n)}setAttribute(t,e,i="normal",n=0,r=this.stateStyle){var a;r[i]===void 0&&(r[i]={}),r[i][t]===void 0&&(r[i][t]={level:n,style:e,referer:void 0});const o=(a=r[i][t])===null||a===void 0?void 0:a.level;R(o)&&o<=n&&mt(r[i][t],{style:e,level:n}),i!=="normal"&&t in this._extensionChannel&&this._extensionChannel[t].forEach(l=>{r[i][l]===void 0&&(r[i][l]=r.normal[l])})}_getDefaultStyle(){return{visible:!0,x:0,y:0}}_styleConvert(t){if(!t)return t;if(Gp(t.type)||t.scale){const e=function(i,n){if("scale"in i&&i.scale)return Q(i.scale)&&(n!=null&&n.globalScale)?n.globalScale.registerMarkAttributeScale(i,n.seriesId):i.scale;const r=cg(i.type);return r&&function(a,o){a&&o&&(o.domain&&a.domain(o.domain),o.range&&a.range(o.range),o.specified&&a.specified&&a.specified(o.specified),o.clamp&&a.clamp&&a.clamp(o.clamp))}(r,i),r}(t,{globalScale:this._option.globalScale,seriesId:this._option.seriesId});if(e)return{scale:e,field:t.field,changeDomain:t.changeDomain}}return t}_computeAttribute(t,e){var i;let n=(i=this.stateStyle[e])===null||i===void 0?void 0:i[t];n||(n=this.stateStyle.normal[t]);const r=this._computeStateAttribute(n,t,e),a=U(n==null?void 0:n.postProcess),o=t in this._computeExChannel;if(a&&o){const l=this._computeExChannel[t];return(h,c)=>{let u=r(h,c);return u=n.postProcess(u,h,this._attributeContext,c,this.getDataView()),l(t,h,e,c,u)}}if(a)return(l,h)=>n.postProcess(r(l,h),l,this._attributeContext,h,this.getDataView());if(o){const l=this._computeExChannel[t];return(h,c)=>l(t,h,e,c,r(h,c))}return r}_computeStateAttribute(t,e,i){var n;return t?t.referer?t.referer._computeAttribute(e,i):t.style?typeof t.style=="function"?(r,a)=>t.style(r,this._attributeContext,a,this.getDataView()):lS.includes(t.style.gradient)?this._computeGradientAttr(t.style):["outerBorder","innerBorder"].includes(e)?this._computeBorderAttr(t.style):Gp((n=t.style.scale)===null||n===void 0?void 0:n.type)?(r,a)=>{let o=r;return this.model.modelType==="series"&&this.model.getMarkData&&(o=this.model.getMarkData(r)),t.style.scale.scale(o[t.style.field])}:(r,a)=>t.style:(r,a)=>t.style:(r,a)=>{}}_initStyle(){const t=this._getDefaultStyle();this.setStyle(t,"normal",0)}_initSpecStyle(t,e,i){t.style&&this.setStyle(t.style,"normal",St.User_Mark,e);const n=t.state;n&&Object.keys(n).forEach(r=>{const a=n[r];if("style"in a){const o=a.style;let l={stateValue:r};"level"in a&&(l.level=a.level),"filter"in a&&(l=U(a.filter)?Object.assign({filter:a.filter},l):Object.assign(Object.assign({},a.filter),l)),this.state.addStateInfo(l),this.setStyle(o,r,St.User_Mark,e)}else this.setStyle(a,r,St.User_Mark,e)})}_computeGradientAttr(t){var e,i;const{gradient:n,scale:r,field:a}=t,o=ne(t,["gradient","scale","field"]);let l=r,h=a;if(!(r&&a||this.model.modelType!=="series")){const{scale:d,field:p}=this.model.getColorAttribute();r||(l=d),h||(h=p)}const c=Uc(Gr(this.model.getColorScheme(),this.model.modelType==="series"?(i=(e=this.model).getSpec)===null||i===void 0?void 0:i.call(e):void 0),this.model.getDefaultColorDomain()),u=Object.assign(Object.assign({},ZI[n]),o);return(d,p)=>{const g={},f=this.getDataView();return Object.keys(u).forEach(m=>{const v=u[m];m==="stops"?g.stops=v.map(y=>{const{opacity:_,color:b,offset:x}=y;let S=b??(l==null?void 0:l.scale(d[h]));return U(b)&&(S=b(d,this._attributeContext,p,f)),R(_)&&(S=re.SetOpacity(S,_)),{offset:U(x)?x(d,this._attributeContext,p,f):x,color:S||c[0]}}):U(v)?g[m]=v(d,this._attributeContext,p,f):g[m]=v}),g.gradient=n,g}}_computeBorderAttr(t){const{scale:e,field:i}=t,n=ne(t,["scale","field"]);return(r,a)=>{var o,l,h;const c={};if(Object.keys(n).forEach(u=>{const d=n[u];U(d)?c[u]=d(r,this._attributeContext,a,this.getDataView()):c[u]=d}),"stroke"in c)lS.includes((h=n.stroke)===null||h===void 0?void 0:h.gradient)&&(c.stroke=this._computeGradientAttr(n.stroke)(r,a));else{const u=Uc(Gr(this.model.getColorScheme(),this.model.modelType==="series"?(l=(o=this.model).getSpec)===null||l===void 0?void 0:l.call(o):void 0),this.model.getDefaultColorDomain());let d=e,p=i;if(!(e&&i||this.model.modelType!=="series")){const{scale:g,field:f}=this.model.getColorAttribute();e||(d=g),p||(p=f),c.stroke=(d==null?void 0:d.scale(r[p]))||u[0]}}return c}}}class Uo extends Rs{constructor(){super(...arguments),this.type=Uo.type,this._marks=[]}getMarks(){return this._marks}_getDefaultStyle(){return Object.assign({},super._getDefaultStyle())}isMarkExist(t){return this._marks.find(e=>e.id===t.id)!==void 0}addMark(t){return this.isMarkExist(t)?(os("Mark already exists, add mark failed."),!1):(this._marks.push(t),!0)}removeMark(t){const e=this._marks.findIndex(i=>i.id===t.id||i.name===t.name);return e===-1?(os("Mark does not exists, removeMark failed."),!1):(this._marks.splice(e,1),!0)}getMarkInType(t){return this._marks.filter(e=>e.type===t)}getMarkInId(t){return this._marks.find(e=>e.id===t)}getMarkInUserId(t){let e;if(this._marks.forEach(i=>{i.getUserId()===t&&(e=i)}),!e)for(let i=0;i<this._marks.length;i++){const n=this._marks[i];if(n.type==="group"&&(e=n.getMarkInUserId(t)),e)break}return e}getMarkInName(t){return this._marks.filter(e=>e.name===t)}_compileProduct(t){super._compileProduct(t),this._product.configure({zIndex:this._markConfig.zIndex}),t!=null&&t.ignoreChildren||this.getMarks().forEach(e=>{e.getProduct()&&e.removeProduct(),e.compile({group:this._product})})}}Uo.type="group";const iO=()=>{En(),Ii(),V.registerGraphic(Z.group,Rd),et.registerMark(Uo.type,Uo)},sO={measureText:(s,t,e,i)=>((n,r,a)=>xo(n,r,a,{fontFamily:$r.fontFamily,fontSize:$r.fontSize}))(t,e,i).measure(s)};class mi{static instance(){return mi.instance_||(mi.instance_=new mi),mi.instance_}constructor(){this.functions={}}registerFunction(t,e){t&&e&&(this.functions[t]=e)}unregisterFunction(t){t&&delete this.functions[t]}getFunction(t){return this.functions[t]||null}getFunctionNameList(){return Object.keys(this.functions)}}class hS{constructor(){this.id=Tn(),this._plugins=[]}add(t){if(!t||t.length===0)return null;const e=[];return t.forEach(i=>{this._plugins.find(n=>n.id===i.id)?os("不要重复添加相同的plugin"):(this._plugins.push(i),e.push(i),i.onAdd&&i.onAdd(this))}),e}load(t){const e=this.add(t);e&&e.length&&this.activate(t)}activate(t){t.length&&t.forEach(e=>{e.init&&e.init()})}get(t){return this._plugins.find(e=>e.id===t)}getAll(){return this._plugins.slice()}release(t){const e=this.get(t);e&&(e.release(this),this._plugins=this._plugins.filter(i=>i!==e))}releaseAll(){this._plugins.forEach(t=>{t.release(this)}),this._plugins=[]}clear(t){const e=this.get(t);e&&e.clear(this)}clearAll(){this._plugins.forEach(t=>{var e;(e=t.clear)===null||e===void 0||e.call(t,this)})}}class nO extends hS{constructor(t){super(),this.globalInstance=t}onInit(t){this._plugins.forEach(e=>{e.onInit&&e.onInit(this,t)})}onBeforeResize(t,e){this._plugins.forEach(i=>{i.onBeforeResize&&i.onBeforeResize(this,t,e)})}onAfterChartSpecTransform(t,e){this._plugins.forEach(i=>{i.onAfterChartSpecTransform&&i.onAfterChartSpecTransform(this,t,e)})}onAfterModelSpecTransform(t,e,i){this._plugins.forEach(n=>{n.onAfterModelSpecTransform&&n.onAfterModelSpecTransform(this,t,e,i)})}onBeforeInitChart(t,e){this._plugins.forEach(i=>{i.onBeforeInitChart&&i.onBeforeInitChart(this,t,e)})}releaseAll(){super.releaseAll(),this.globalInstance=null}}const rO=new Map;class Be{static useRegisters(t){t.forEach(e=>{typeof e=="function"?e():console.error("Invalid function:",e)})}static useChart(t){t.forEach(e=>et.registerChart(e.type,e))}static useSeries(t){t.forEach(e=>et.registerSeries(e.type,e))}static useComponent(t){t.forEach(e=>et.registerComponent(e.type,e))}static useMark(t){t.forEach(e=>{var i;return et.registerMark((i=e.constructorType)!==null&&i!==void 0?i:e.type,e)})}static useLayout(t){t.forEach(e=>et.registerLayout(e.type,e))}static registerDataSetTransform(t,e){et.registerTransform(t,e)}static registerFunction(t,e){t&&e&&mi.instance().registerFunction(t,e)}static unregisterFunction(t){t&&mi.instance().unregisterFunction(t)}static getFunction(t){return t?mi.instance().getFunction(t):null}static getFunctionList(){return mi.instance().getFunctionNameList()}static registerMap(t,e,i){const n=et.getImplementInKey("registerMap");n&&n(t,e,i)}static unregisterMap(t){const e=et.getImplementInKey("unregisterMap");e&&e(t)}static getMap(t){return e=t,HI.get(e);var e}static registerSVG(t,e,i){const n=et.getImplementInKey("registerSVG");n&&n(t,e,i)}static unregisterSVG(t){const e=et.getImplementInKey("unregisterSVG");e&&e(t)}static getSVG(t){return e=t,rO.get(e);var e}static hideTooltip(t=[]){Pi.forEach(e=>{var i;return(i=e==null?void 0:e.hideTooltip)===null||i===void 0?void 0:i.call(e)},t)}static getLogger(){return Tt.getInstance()}getSpec(){return this._spec}getSpecInfo(){return this._specInfo}getDataSet(){return this._dataSet}constructor(t,e){var i,n,r,a,o,l,h,c;this.id=Tn(),this._userEvents=[],this._autoSize=!0,this._option={mode:K.RenderModeEnum["desktop-browser"],onError:x=>{throw new Error(x)},optimize:{disableCheckGraphicWidthOutRange:!0}},this._observer=null,this._context={},this._doResize=()=>{const{width:x,height:S}=this.getCurrentSize();this._currentSize.width===x&&this._currentSize.height===S||(this._currentSize={width:x,height:S},this.resizeSync(x,S))},this._renderSync=(x={})=>{var S;const A=this;return this._beforeRender(x)&&((S=this._compiler)===null||S===void 0||S.render(x.morphConfig),this._afterRender()),A},this._updateSpec=(x,S=!1,A)=>{var w,k;const T=this._spec,C={changeBackground:!1,reTransformSpec:!1,change:!1,reMake:!1,reCompile:!1,reSize:!1,changeTheme:!1};if(!this._setNewSpec(x,S))return;Xt(T.theme,this._spec.theme)?Xt(this._spec.background,T.background)||(C.reMake=!0,C.changeBackground=!0):C.changeTheme=!0;const M=this._shouldChartResize(T);if(C.reSize=M,this._spec.type!==T.type)return(k=(w=this._compiler)===null||w===void 0?void 0:w.getVGrammarView())===null||k===void 0||k.updateLayoutTag(),C.reMake=!0,C.reTransformSpec=!0,C.change=!0,C.changeTheme=!0,C;this._initChartSpec(this._spec,"updateSpec");const B=ia(this._chart.updateSpec(this._spec),C);return A?Object.assign(Object.assign({},B),A):B},this._option=Object.assign(Object.assign(Object.assign({},this._option),{animation:t.animation!==!1}),e),e!=null&&e.optimize&&(this._option.optimize=Object.assign(Object.assign({},this._option.optimize),e.optimize)),this._onError=(i=this._option)===null||i===void 0?void 0:i.onError;const u=this._option,{dom:d,renderCanvas:p,mode:g,stage:f,poptip:m}=u,v=ne(u,["dom","renderCanvas","mode","stage","poptip"]),y=ks(g);if(y?rc(kt):g==="node"&&cc(kt),y&&d&&(this._container=Q(d)?Me.getElementById(d):d),p&&(this._canvas=p),f&&(this._stage=f),g!=="node"&&!this._container&&!this._canvas&&!this._stage)return void((n=this._option)===null||n===void 0||n.onError("please specify container or renderCanvas!"));this._viewBox=this._option.viewBox,this._currentThemeName=Gs.getCurrentThemeName(),this._setNewSpec(t),this._updateCurrentTheme(),this._currentSize=this.getCurrentSize();const _=[];!m&&_.push("poptipForText"),t.type==="sankey"&&_.push("scrollbar");const b=Object.assign({},v.performanceHook||{});Object.keys(b).forEach(x=>{v.performanceHook[x]=(...S)=>{b[x](...S,this)}}),this._compiler=new WI({dom:(r=this._container)!==null&&r!==void 0?r:"none",canvas:p},Object.assign(Object.assign({mode:this._option.mode,stage:f,pluginList:_},v),{background:this._getBackground(),onError:this._onError})),this._compiler.setSize(this._currentSize.width,this._currentSize.height),this._eventDispatcher=new zI(this,this._compiler),this._event=new cu(this._eventDispatcher,g),this._compiler.initView(),this._setFontFamilyTheme((a=this._currentTheme)===null||a===void 0?void 0:a.fontFamily),this._initDataSet(this._option.dataSet),this._autoSize=!!y&&((l=(o=t.autoFit)!==null&&o!==void 0?o:this._option.autoFit)===null||l===void 0||l),this._bindResizeEvent(),this._bindVGrammarViewEvent(),this._initChartPlugin(),Pi.registerInstance(this),(c=(h=this._option.performanceHook)===null||h===void 0?void 0:h.afterCreateVChart)===null||c===void 0||c.call(h,this)}_setNewSpec(t,e){return!!t&&(Q(t)&&(t=JSON.parse(t)),e&&this._originalSpec&&(t=mt({},this._originalSpec,t)),this._originalSpec=t,this._spec=this._getSpecFromOriginalSpec(),!0)}_getSpecFromOriginalSpec(){var t;const e=yg(this._originalSpec);return e.data=(t=e.data)!==null&&t!==void 0?t:[],e}_initChartSpec(t,e){var i,n;Be.getFunctionList()&&Be.getFunctionList().length&&(t=_g(t,Be)),this._spec=t,this._chartSpecTransformer||(this._chartSpecTransformer=et.createChartSpecTransformer(this._spec.type,this._getChartOption(this._spec.type))),(i=this._chartSpecTransformer)===null||i===void 0||i.transformSpec(this._spec),this._chartPluginApply("onAfterChartSpecTransform",this._spec,e),this._specInfo=(n=this._chartSpecTransformer)===null||n===void 0?void 0:n.transformModelSpec(this._spec),this._chartPluginApply("onAfterModelSpecTransform",this._spec,this._specInfo,e)}_updateSpecInfo(){var t;this._chartSpecTransformer||(this._chartSpecTransformer=et.createChartSpecTransformer(this._spec.type,this._getChartOption(this._spec.type))),this._specInfo=(t=this._chartSpecTransformer)===null||t===void 0?void 0:t.createSpecInfo(this._spec)}_initChart(t){var e,i,n;if(!this._compiler)return void((e=this._option)===null||e===void 0||e.onError("compiler is not initialized"));if(this._chart)return void((i=this._option)===null||i===void 0||i.onError("chart is already initialized"));const r=et.createChart(t.type,t,this._getChartOption(t.type));r?(this._chart=r,this._chart.setCanvasRect(this._currentSize.width,this._currentSize.height),this._chart.created(this._chartSpecTransformer),this._chart.init(),this._event.emit(pt.initialized,{chart:r,vchart:this})):(n=this._option)===null||n===void 0||n.onError("init chart fail")}_releaseData(){this._dataSet&&(this._dataSet.dataViewMap={},this._dataSet=null)}_bindVGrammarViewEvent(){if(!this._compiler)return;const t=this._compiler.getVGrammarView();t.addEventListener(at.ALL_ANIMATION_END,()=>{this._event.emit(pt.animationFinished,{chart:this._chart,vchart:this})}),t.addEventListener(at.AFTER_VRENDER_NEXT_RENDER,()=>{this._event.emit(pt.renderFinished,{chart:this._chart,vchart:this})})}_bindResizeEvent(){var t,e;if(this._autoSize){if(this._onResize=tr(this._doResize,(t=this._option.resizeDelay)!==null&&t!==void 0?t:100),this._container){const i=window.ResizeObserver;i&&(this._observer=new i(this._onResize),(e=this._observer)===null||e===void 0||e.observe(this._container))}window.addEventListener("resize",this._onResize)}}_unBindResizeEvent(){this._autoSize&&(window.removeEventListener("resize",this._onResize),this._observer&&(this._observer.disconnect(),this._observer=null))}getCurrentSize(){var t,e,i,n;return Zx(this._spec,{container:this._container,canvas:this._canvas,mode:this._getMode(),modeParams:this._option.modeParams},{width:(e=(t=this._currentSize)===null||t===void 0?void 0:t.width)!==null&&e!==void 0?e:On,height:(n=(i=this._currentSize)===null||i===void 0?void 0:i.height)!==null&&n!==void 0?n:Pn})}_initDataSet(t){this._dataSet=t instanceof Tl?t:new Tl,uu(this._dataSet,"dataview",yA),uu(this._dataSet,"array",H1),Se(this._dataSet,"copyDataView",Kx);for(const e in et.transforms)Se(this._dataSet,e,et.transforms[e]);for(const e in et.dataParser)uu(this._dataSet,e,et.dataParser[e])}updateCustomConfigAndRerender(t,e,i={}){if(!this._isReleased&&t)return U(t)&&(t=t()),t.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._reCompile(t),e?this._renderSync(i):this._renderAsync(i)}_updateCustomConfigAndRecompile(t,e={}){return!!t&&(this._reCompile(t),this._beforeRender(e))}_reCompile(t,e){var i,n,r,a,o,l,h,c,u,d;if(t.reMake&&(this._releaseData(),this._initDataSet(),(i=this._chart)===null||i===void 0||i.release(),this._chart=null),t.reTransformSpec&&(this._chartSpecTransformer=null),t.changeTheme?(this._setCurrentTheme(),this._setFontFamilyTheme((n=this._currentTheme)===null||n===void 0?void 0:n.fontFamily)):t.changeBackground&&((r=this._compiler)===null||r===void 0||r.setBackground(this._getBackground())),t.reMake)(a=this._compiler)===null||a===void 0||a.releaseGrammar(((o=this._option)===null||o===void 0?void 0:o.animation)===!1||((l=this._spec)===null||l===void 0?void 0:l.animation)===!1),this._userEvents.forEach(p=>{var g;return(g=this._event)===null||g===void 0?void 0:g.on(p.eType,p.query,p.handler)}),t.reSize&&this._doResize();else if(t.reCompile&&((h=this._compiler)===null||h===void 0||h.clear({chart:this._chart,vChart:this},((c=this._option)===null||c===void 0?void 0:c.animation)===!1||((u=this._spec)===null||u===void 0?void 0:u.animation)===!1),(d=this._compiler)===null||d===void 0||d.compile({chart:this._chart,vChart:this},{})),t.reSize){const{width:p,height:g}=this.getCurrentSize();this._chart.onResize(p,g,!1),this._compiler.resize(p,g,!1)}}_beforeRender(t={}){var e,i,n,r,a,o,l,h;if(this._isReleased)return!1;if(this._chart)return!0;const{transformSpec:c,actionSource:u}=t;return c&&this._initChartSpec(this._spec,"render"),this._chartPluginApply("onBeforeInitChart",this._spec,u),(i=(e=this._option.performanceHook)===null||e===void 0?void 0:e.beforeInitializeChart)===null||i===void 0||i.call(e,this),this._initChart(this._spec),(r=(n=this._option.performanceHook)===null||n===void 0?void 0:n.afterInitializeChart)===null||r===void 0||r.call(n,this),!(!this._chart||!this._compiler)&&((o=(a=this._option.performanceHook)===null||a===void 0?void 0:a.beforeCompileToVGrammar)===null||o===void 0||o.call(a),this._compiler.compile({chart:this._chart,vChart:this},{performanceHook:this._option.performanceHook}),(h=(l=this._option.performanceHook)===null||l===void 0?void 0:l.afterCompileToVGrammar)===null||h===void 0||h.call(l),!0)}_afterRender(){return!this._isReleased&&(this._updateAnimateState(),this._event.emit(pt.rendered,{chart:this._chart,vchart:this}),!0)}renderSync(t){return this._renderSync({morphConfig:t,transformSpec:!0,actionSource:"render"})}renderAsync(t){return Ie(this,void 0,void 0,function*(){return this._renderAsync({morphConfig:t,transformSpec:!0,actionSource:"render"})})}_renderAsync(t={}){return Ie(this,void 0,void 0,function*(){return this._renderSync(t)})}_updateAnimateState(t){var e,i;if(this._option.animation){const n=t?ce.appear:ce.update;(e=this._chart)===null||e===void 0||e.getAllRegions().forEach(r=>{var a;(a=r.animate)===null||a===void 0||a.updateAnimateState(n,!0)}),(i=this._chart)===null||i===void 0||i.getAllComponents().forEach(r=>{var a;(a=r.animate)===null||a===void 0||a.updateAnimateState(n,!0)})}}release(){var t,e,i,n;!((t=this._onResize)===null||t===void 0)&&t.cancel&&this._onResize.cancel(),this._chartPluginApply("releaseAll"),this._chartPlugin=null,this._chartSpecTransformer=null,(e=this._chart)===null||e===void 0||e.release(),(i=this._eventDispatcher)===null||i===void 0||i.release(),(n=this._compiler)===null||n===void 0||n.release(),this._unBindResizeEvent(),this._releaseData(),this._onError=null,this._onResize=null,this._container=null,this._currentTheme=null,this._option=null,this._chart=null,this._compiler=null,this._spec=null,this._specInfo=null,this._originalSpec=null,this._userEvents=null,this._event=null,this._eventDispatcher=null,this._isReleased=!0,Pi.unregisterInstance(this)}updateData(t,e,i,n){return Ie(this,void 0,void 0,function*(){return this.updateDataSync(t,e,i,n)})}_updateDataById(t,e,i){const n=this._spec.data.find(r=>r.name===t||r.id===t);n?n.id===t?n.values=e:n.name===t&&n.parse(e,i):W(e)?this._spec.data.push({id:t,values:e}):this._spec.data.push(e)}updateDataInBatches(t){return Ie(this,void 0,void 0,function*(){return this._chart?(this._chart.updateFullData(t.map(({id:e,data:i,options:n})=>({id:e,values:i,parser:n}))),this._chart.updateGlobalScaleDomain(),this._compiler.render(),this):(this._spec.data=Y(this._spec.data),t.forEach(({id:e,data:i,options:n})=>{this._updateDataById(e,i,n)}),this)})}updateDataSync(t,e,i,n){return I(this._dataSet)?this:this._chart?(n!=null&&n.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._chart.updateData(t,e,!0,i),this._compiler.render(),this):(this._spec.data=Y(this._spec.data),this._updateDataById(t,e,i),this)}updateFullDataSync(t,e=!0,i){if(this._chart)return i!=null&&i.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._chart.updateFullData(t),e&&this._compiler.render(),this;const n=Y(this._spec.data);return Y(t).forEach(r=>{const{id:a,values:o,parser:l,fields:h}=r,c=n.find(u=>u.name===a);if(c)c instanceof _e?(c.setFields(Fi(h)),c.parse(o,Fi(l))):(c.values=o,R(l)&&(c.parser=l),R(h)&&(c.fields=h));else{const u=Ng(r,this._dataSet,n);W(this._spec.data)&&this._spec.data.push(u)}}),this}updateFullData(t,e=!0){return Ie(this,void 0,void 0,function*(){return this.updateFullDataSync(t,e)})}updateSpec(t,e=!1,i,n){return Ie(this,void 0,void 0,function*(){const r=this._updateSpec(t,e,n);return r?(yield this.updateCustomConfigAndRerender(r,!1,{morphConfig:i,transformSpec:r.reTransformSpec,actionSource:"updateSpec"}),this):this})}updateSpecSync(t,e=!1,i,n){const r=this._updateSpec(t,e,n);return r?(this.updateCustomConfigAndRerender(r,!0,{morphConfig:i,transformSpec:r.reTransformSpec,actionSource:"updateSpec"}),this):this}updateSpecAndRecompile(t,e=!1,i={}){const n=this._updateSpec(t,e);return this._updateCustomConfigAndRecompile(n,Object.assign({actionSource:"updateSpecAndRecompile"},i))}updateModelSpec(t,e,i=!1,n){return Ie(this,void 0,void 0,function*(){return this.updateModelSpecSync(t,e,i,n)})}updateModelSpecSync(t,e,i=!1,n){if(!e||!this._spec)return this;if(Q(e)&&(e=JSON.parse(e)),U(t)||function(r,a,o,l){Object.keys(r).forEach(h=>{if(_t(a))a.type===h&&(W(r[h])?r[h].length>=a.index&&(r[h][a.index]=l?mt({},r[h][a.index],o):o):r[h]=l?mt({},r[h],o):o);else if(W(r[h])){const c=r[h].findIndex(u=>u.id===a);c>=0&&(r[h][c]=l?mt({},r[h][c],o):o)}else r.id===a&&(r[h]=l?mt({},r[h],o):o)})}(this._spec,t,e,i),this._chart){const r=this._chart.getModelInFilter(t);if(r)return this._updateModelSpec(r,e,!0,i,n)}return this}_updateModelSpec(t,e,i=!1,n=!1,r){n&&(e=mt({},t.getSpec(),e));const a=t.updateSpec(e);return t.reInit(e),(a.change||a.reCompile||a.reMake||a.reSize||a.reRender)&&this._chart.reDataFlow(),this.updateCustomConfigAndRerender(a,i,{morphConfig:r,transformSpec:!1,actionSource:"updateModelSpec"})}resize(t,e){return Ie(this,void 0,void 0,function*(){return this.resizeSync(t,e)})}resizeSync(t,e){var i,n;return this._beforeResize(t,e)?((n=(i=this._compiler).resize)===null||n===void 0||n.call(i,t,e),this._afterResize()):this}_beforeResize(t,e){var i,n,r,a;if(!this._chart||!this._compiler)return!1;const o=this._chart.getCanvasRect();return(!o||o.width!==t||o.height!==e)&&(this._chartPluginApply("onBeforeResize",t,e),(n=(i=this._option.performanceHook)===null||i===void 0?void 0:i.beforeResizeWithUpdate)===null||n===void 0||n.call(i),this._chart.onResize(t,e,!1),(a=(r=this._option.performanceHook)===null||r===void 0?void 0:r.afterResizeWithUpdate)===null||a===void 0||a.call(r),!0)}_afterResize(){return this._isReleased||this._event.emit(pt.afterResize,{chart:this._chart}),this}updateViewBox(t,e=!0,i=!0){return this._chart&&this._compiler?(this._viewBox=t,this._chart.updateViewBox(t,i),i&&(this._compiler.render(),this._chart.onEvaluateEnd()),this._compiler.updateViewBox(t,e),this):this}on(t,e,i){var n;this._userEvents&&(this._userEvents.push({eType:t,query:typeof e=="function"?null:e,handler:typeof e=="function"?e:i}),(n=this._event)===null||n===void 0||n.on(t,e,i))}off(t,e){var i;if(this._userEvents&&this._userEvents.length!==0)if(e){const n=this._userEvents.findIndex(r=>r.eType===t&&r.handler===e);n>=0&&(this._userEvents.splice(n,1),(i=this._event)===null||i===void 0||i.off(t,e))}else this._userEvents.forEach(n=>{var r;n.eType===t&&((r=this._event)===null||r===void 0||r.off(t,n.handler))}),this._userEvents=this._userEvents.filter(n=>n.eType!==t)}updateState(t,e){this._chart&&this._chart.updateState(t,e)}setSelected(t,e,i){this._chart&&this._chart.setSelected(t,e,i)}setHovered(t,e,i){this._chart&&this._chart.setHovered(t,e,i)}clearState(t){this._chart&&this._chart.clearState(t)}clearAllStates(){this._chart&&this._chart.clearAllStates()}clearSelected(){this._chart&&this._chart.clearSelected()}clearHovered(){this._chart&&this._chart.clearHovered()}_updateCurrentTheme(t){var e,i,n;const r=this._option.theme,a=(e=this._spec)===null||e===void 0?void 0:e.theme,o=(i=this._spec)===null||i===void 0?void 0:i.type;t&&(this._currentThemeName=t);const l=(u,d)=>{var p;return!((p=d.chart)===null||p===void 0)&&p[u]&&(d=Kc({},d,d.chart[u])),d};let h;if(ht(r)&&ht(a))h=Ys(this._currentThemeName,!0),this._currentTheme=l(o,h);else if(Q(r)&&(!a||Q(a))||Q(a)&&(!r||Q(r))){const u=Kc({},Ys(this._currentThemeName,!0),Ys(r,!0),Ys(a,!0));this._currentTheme=l(o,u)}else{const u=Kc({},Ys(this._currentThemeName),Ys(r),Ys(a));this._currentTheme=qc(l(o,u))}var c;c=vt(this._currentTheme,"component.poptip"),rt(qE.poptip,h_,c),(n=this._compiler)===null||n===void 0||n.setBackground(this._getBackground())}_shouldChartResize(t){var e,i;let n=!1;I(this._spec.width)?!I(t.width)&&(this._spec.width=t.width):this._spec.width!==t.width&&(n=!0),I(this._spec.height)?!I(t.height)&&(this._spec.height=t.height):this._spec.height!==t.height&&(n=!0);const r=this._autoSize;return this._autoSize=!!ks(this._option.mode)&&((i=(e=this._spec.autoFit)!==null&&e!==void 0?e:this._option.autoFit)===null||i===void 0||i),this._autoSize!==r&&(n=!0),n}_getBackground(){return(typeof this._spec.background=="string"||_t(this._spec.background)&&this._spec.background.gradient?this._spec.background:null)||this._currentTheme.background||this._option.background}getCurrentTheme(){return Ys(this._currentThemeName)}getCurrentThemeName(){return this._currentThemeName}setCurrentTheme(t){return Ie(this,void 0,void 0,function*(){return this.setCurrentThemeSync(t)})}setCurrentThemeSync(t){var e;if(!Gs.themeExist(t))return this;const i=this._setCurrentTheme(t);return this._setFontFamilyTheme((e=this._currentTheme)===null||e===void 0?void 0:e.fontFamily),this.updateCustomConfigAndRerender(i,!0,{transformSpec:!1,actionSource:"setCurrentTheme"}),this}_setCurrentTheme(t){var e;return this._updateCurrentTheme(t),this._initChartSpec(this._getSpecFromOriginalSpec(),"setCurrentTheme"),(e=this._chart)===null||e===void 0||e.setCurrentTheme(),{change:!0,reMake:!1}}_setFontFamilyTheme(t){var e;t&&((e=this.getStage())===null||e===void 0||e.setTheme({text:{fontFamily:t},richtext:{fontFamily:t}}))}_getTooltipComponent(){var t;return(t=this._chart)===null||t===void 0?void 0:t.getComponentsByType(st.tooltip)[0]}setTooltipHandler(t){var e,i;this._context.tooltipHandler=t;const n=this._getTooltipComponent();n&&((i=(e=n.tooltipHandler)===null||e===void 0?void 0:e.release)===null||i===void 0||i.call(e),n.tooltipHandler=t)}getTooltipHandlerByUser(){var t;return(t=this._context)===null||t===void 0?void 0:t.tooltipHandler}getTooltipHandler(){const t=this._getTooltipComponent();return t?t.tooltipHandler:this._context.tooltipHandler}showTooltip(t,e){var i;const n=this._getTooltipComponent();return(i=R(t)&&(n==null?void 0:n.showTooltip(t,e))!=="none")!==null&&i!==void 0&&i}hideTooltip(){var t;const e=this._getTooltipComponent();return(t=e==null?void 0:e.hideTooltip())!==null&&t!==void 0&&t}getLegendDataById(t){var e;const i=(e=this._chart)===null||e===void 0?void 0:e.getComponentByUserId(t);return i?i.getLegendData():[]}getLegendDataByIndex(t=0){var e;const i=(e=this._chart)===null||e===void 0?void 0:e.getComponentsByType(st.discreteLegend);return i&&i[t]?i[t].getLegendData():[]}getLegendSelectedDataById(t){var e;const i=(e=this._chart)===null||e===void 0?void 0:e.getComponentByUserId(t);return i?i.getSelectedData():[]}getLegendSelectedDataByIndex(t=0){var e;const i=(e=this._chart)===null||e===void 0?void 0:e.getComponentsByType(st.discreteLegend);return i&&i[t]?i[t].getSelectedData():[]}setLegendSelectedDataById(t,e){var i;const n=(i=this._chart)===null||i===void 0?void 0:i.getComponentByUserId(t);n&&n.setSelectedData(e)}setLegendSelectedDataByIndex(t=0,e){var i;const n=(i=this._chart)===null||i===void 0?void 0:i.getComponentsByType(st.discreteLegend);n&&n[t]&&n[t].setSelectedData(e)}getDataURL(){var t;return Ie(this,void 0,void 0,function*(){const e=this.getStage();if(this._chart&&e){e.render();const i=this._chart.getCanvas();return yield UI(i,{onError:this._onError})}return(t=this._option)===null||t===void 0||t.onError(new ReferenceError("render is not defined")),null})}exportImg(t){var e,i;return Ie(this,void 0,void 0,function*(){if(!ks(this._option.mode))return void((e=this._option)===null||e===void 0||e.onError(new TypeError("non-browser environment can not export img")));const n=yield this.getDataURL();n?function(r="vchart",a){const o=document.createElement("a");o.setAttribute("href",a),o.setAttribute("target","_blank"),o.setAttribute("download",\`\${r}.png\`),o.dispatchEvent(new MouseEvent("click"))}(t,n):(i=this._option)===null||i===void 0||i.onError(new ReferenceError("render is not defined"))})}exportCanvas(){var t;const e=this.getStage();if(this._chart&&e)return e.toCanvas();(t=this._option)===null||t===void 0||t.onError(new ReferenceError("render is not defined"))}getImageBuffer(){var t,e;if(this._option.mode!=="node")return void((t=this._option)===null||t===void 0||t.onError(new TypeError("getImageBuffer() now only support node environment.")));const i=this.getStage();return i?(i.render(),i.window.getImageBuffer()):((e=this._option)===null||e===void 0||e.onError(new ReferenceError("render is not defined")),null)}setLayout(t){var e;this._option.layout=t,(e=this._chart)===null||e===void 0||e.setLayout(t)}reLayout(){var t;(t=this._chart)===null||t===void 0||t.setLayoutTag(!0)}getCompiler(){return this._compiler}getChart(){return this._chart}getStage(){return this._compiler.getStage()}getCanvas(){var t;return(t=this._compiler)===null||t===void 0?void 0:t.getCanvas()}getContainer(){var t;if(R(this._container))return this._container;let e;return e=Q(this._canvas)?Me.getElementById(this._canvas):this._canvas,R(e)?e.parentElement:(t=this.getCanvas())===null||t===void 0?void 0:t.parentElement}getComponents(){return this._chart.getAllComponents()}getScale(t){var e;const i=(e=this._chart)===null||e===void 0?void 0:e.getGlobalScale();return i==null?void 0:i.getScale(t)}setDimensionIndex(t,e={}){var i;return(i=this._chart)===null||i===void 0?void 0:i.setDimensionIndex(t,e)}stopAnimation(){var t,e,i;(i=(e=(t=this._compiler)===null||t===void 0?void 0:t.getVGrammarView())===null||e===void 0?void 0:e.animate)===null||i===void 0||i.stop()}pauseAnimation(){var t,e,i;(i=(e=(t=this._compiler)===null||t===void 0?void 0:t.getVGrammarView())===null||e===void 0?void 0:e.animate)===null||i===void 0||i.pause()}resumeAnimation(){var t,e,i;(i=(e=(t=this._compiler)===null||t===void 0?void 0:t.getVGrammarView())===null||e===void 0?void 0:e.animate)===null||i===void 0||i.resume()}convertDatumToPosition(t,e={},i=!1,n){var r;if(!this._chart||ht(t))return null;const{seriesId:a,seriesIndex:o=0}=e;let l;if(R(a)?l=this._chart.getSeriesInUserId(a):R(o)&&(l=(r=this._chart.getSeriesInIndex([o]))===null||r===void 0?void 0:r[0]),l){const h=Object.keys(t),c=l.getViewData().latestData.find(p=>h.every(g=>p[g]==t[g])),u=l.getRegion().getLayoutStartPoint();let d;return d=c?l.dataToPosition(c,n):l.dataToPosition(t,n),d?Sb(d,u,i):null}return null}convertValueToPosition(t,e,i=!1){var n,r;if(!this._chart||I(t)||ht(e))return null;if(!W(t)){const{axisId:h,axisIndex:c}=e;let u;if(R(h)?u=this._chart.getComponentsByKey("axes").find(p=>p.userId===h):R(c)&&(u=(n=this._chart.getComponentsByKey("axes"))===null||n===void 0?void 0:n[c]),!u)return os("Please check whether the \`axisId\` or \`axisIndex\` is set!"),null;const d=u==null?void 0:u.valueToPosition(t);if(i){const p=u.getLayoutStartPoint(),g=u.getOrient();return d+(g==="bottom"||g==="top"?p.x:p.y)}return d}const{seriesId:a,seriesIndex:o}=e;let l;return R(a)?l=this._chart.getSeriesInUserId(a):R(o)&&(l=(r=this._chart.getSeriesInIndex([o]))===null||r===void 0?void 0:r[0]),l?Sb(l.valueToPosition(t[0],t[1]),l.getRegion().getLayoutStartPoint(),i):(os("Please check whether the \`seriesId\` or \`seriesIndex\` is set!"),null)}getFunction(t){return mi.instance().getFunction(t)}registerFunction(t,e){t&&e&&mi.instance().registerFunction(t,e)}unregisterFunction(t){t&&mi.instance().unregisterFunction(t)}getFunctionList(){return mi.instance().getFunctionNameList()}setRuntimeSpec(t){this._spec=t,this._updateSpecInfo()}updateIndicatorDataById(t,e){var i;const n=(i=this._chart)===null||i===void 0?void 0:i.getComponentByUserId(t);n&&n.updateDatum(e)}updateIndicatorDataByIndex(t=0,e){var i;const n=(i=this._chart)===null||i===void 0?void 0:i.getComponentsByType(st.indicator);n&&n[t]&&n[t].updateDatum(e)}geoZoomByIndex(t=0,e,i){this._geoZoomByQuery({regionIndex:t},e,i)}geoZoomById(t,e,i){this._geoZoomByQuery({regionId:t},e,i)}_geoZoomByQuery(t,e,i){var n,r;const a=(n=this._chart)===null||n===void 0?void 0:n.getRegionsInQuerier(t)[0],o=(r=this._chart)===null||r===void 0?void 0:r.getComponentsByType(st.geoCoordinate),l=o==null?void 0:o.find(h=>{var c;return(c=h.getRegions())===null||c===void 0?void 0:c.includes(a)});l&&l.dispatchZoom(e,i)}_initChartPlugin(){const t=et.getChartPlugins();t.length>0&&(this._chartPlugin=new nO(this),this._chartPlugin.load(t.map(e=>new e)),this._chartPluginApply("onInit",this._spec))}_chartPluginApply(t,...e){this._chartPlugin&&this._chartPlugin[t]&&this._chartPlugin[t].apply(this._chartPlugin,e)}_getMode(){return this._option.mode||K.RenderModeEnum["desktop-browser"]}_getChartOption(t){return{type:t,globalInstance:this,eventDispatcher:this._eventDispatcher,dataSet:this._dataSet,container:this._container,canvas:this._canvas,map:new Map,mode:this._getMode(),modeParams:this._option.modeParams,getCompiler:()=>this._compiler,performanceHook:this._option.performanceHook,viewBox:this._viewBox,animation:this._option.animation,getTheme:()=>{var e;return(e=this._currentTheme)!==null&&e!==void 0?e:{}},getSpecInfo:()=>{var e;return(e=this._specInfo)!==null&&e!==void 0?e:{}},layout:this._option.layout,onError:this._onError,disableTriggerEvent:this._option.disableTriggerEvent===!0}}}Be.InstanceManager=Pi,Be.ThemeManager=Gs,Be.globalConfig={uniqueTooltip:!0},Be.Utils=sO,Be.vglobal=Me,et.registerRegion("region",na),et.registerLayout("base",oS),iO(),Ho.useRegisters([PI]),dx(),ux(),Zc(gg.name,gg),Tt.getInstance(ci.Error);const cS=(s,t)=>{const e=t.beforeCall();return s&&s.forEach((i,n)=>t.call(i,n,e)),e.keyMap&&(e.keyMap.clear(),e.keyMap=null),s};function hi(s,t){return vt(t,\`component.\${s}\`)}function ra(s,t,e,i){if(s)return{formatFunc:s,args:[e,i]};const n=et.getFormatter();return t&&n?{formatFunc:n,args:[e,i,t]}:{}}const bu=(s,t,e,i)=>{if(I(s[t]))return;const n=W(s[t]),r=n?s[t]:[s[t]],a=[];return r.forEach((o,l)=>{!o||i&&!i(o)||a.push({spec:o,specPath:n?[t,l]:[t],specInfoPath:["component",t,l],type:e})}),a},Wn=(s,t,e,i)=>{let n;if(n=U(s)?s(t,e):Ji(s)&&R(s.field)?vt(t,s.field):s,i){const{formatFunc:r,args:a}=ra(void 0,i,s,t);r&&a&&(n=r(...a))}return n},uS=(s,t,e)=>I(s)?s:U(s)?s(t,e):s,Gg=(s,t)=>!t||t.visible!==!1&&(!t[s]||t[s].visible!==!1)&&!(t.activeType&&!(W(t.activeType)?t.activeType.includes(s):t.activeType===s));function Yg(s,t,e,i,n,r){const a=o=>{if(o){const l={datum:n},h=I(o.key)&&I(o.value)&&!ht(o)?Object.assign(Object.assign(Object.assign({},i),e),o):Object.assign(Object.assign({},i),o),{key:c,keyFormatter:u,keyTimeFormat:d,keyTimeFormatMode:p,value:g,valueFormatter:f,valueTimeFormat:m,valueTimeFormatMode:v}=h,y=ne(h,["key","keyFormatter","keyTimeFormat","keyTimeFormatMode","value","valueFormatter","valueTimeFormat","valueTimeFormatMode"]);l.key=$g(Wn(c,n,r,u),d,p),l.value=$g(Wn(g,n,r,f),m,v),Object.keys(y).forEach(_=>{l[_]=Wn(h[_],n,r)}),l.visible!==!1&&(R(l.key)||R(l.value))&&s.push(l)}};W(t)?t.forEach(o=>{a(o)}):a(t)}function dS(s,t,e,i,n,r,a){U(t)?Yg(s,t(n,a),e,i,r,a):t&&Yg(s,t,e,i,r,a)}const $g=(s,t,e)=>{if(!t&&!e)return typeof s!="object"?s==null?void 0:s.toString():s;const i=ps.getInstance();return t=t||"%Y%m%d",((e=e||"local")==="local"?i.timeFormat:i.timeUTCFormat)(t,s)};class pS{constructor(t){this.activeTriggerSet={mark:new Set,group:new Set},this.ignoreTriggerSet={mark:new Set},this._getSeriesCacheInfo=()=>{var e,i,n;const{series:r}=this,a=r.getSeriesField();return{seriesFields:R(a)?Y(a):(e=r.getSeriesKeys())!==null&&e!==void 0?e:[],dimensionFields:(i=r.getDimensionField())!==null&&i!==void 0?i:[],measureFields:(n=r.getMeasureField())!==null&&n!==void 0?n:[],type:r.type}},this._getDimensionData=e=>{const{dimensionFields:i}=this._seriesCacheInfo;return i[0]&&(e==null?void 0:e[i[0]])},this._getMeasureData=e=>{const{measureFields:i}=this._seriesCacheInfo;return i[0]&&(e==null?void 0:e[i[0]])},this._getSeriesFieldData=e=>{const{dimensionFields:i,seriesFields:n}=this._seriesCacheInfo;if(R(n[0])&&(e!=null&&e[n[0]]))return e==null?void 0:e[n[0]];const r=i[i.length-1];return i.length>1&&(n.length===0||this.series.getSeriesKeys().length),e==null?void 0:e[r]},this._getSeriesStyle=(e,i,n)=>{var r;for(const a of Y(i)){const o=(r=this.series.getSeriesStyle(e))===null||r===void 0?void 0:r(a);if(R(o))return o}return n},this.markTooltipKeyCallback=(e,i)=>this._getSeriesFieldData(e),this.markTooltipValueCallback=(e,i)=>this._getMeasureData(e),this.shapeTypeCallback=(e,i)=>{var n;return(n=this._getSeriesStyle(e,"shape",null))!==null&&n!==void 0?n:this._getSeriesStyle(e,"symbolType",this.series.getDefaultShapeType())},this.shapeColorCallback=(e,i)=>this._getSeriesStyle(e,["fill","stroke"]),this.shapeStrokeCallback=(e,i)=>this._getSeriesStyle(e,["stroke","fill"]),this.dimensionTooltipTitleCallback=(e,i)=>this._getDimensionData(e),this.groupTooltipTitleCallback=(e,i)=>this._getSeriesFieldData(e),this.groupTooltipKeyCallback=(e,i)=>{const{seriesFields:n}=this._seriesCacheInfo;let r=this._seriesCacheInfo.dimensionFields;return n[0]&&(r=r.filter(a=>a!==n[0])),r.map(a=>e==null?void 0:e[a]).join("-")},this.getHasShape=e=>!!e,this.series=t,this.updateTooltipSpec()}updateTooltipSpec(){var t;const e=(t=this.series.getSpec())===null||t===void 0?void 0:t.tooltip;this.spec=e,this._seriesCacheInfo=this._getSeriesCacheInfo()}getShapeAttrs(t,e,i){var n,r,a,o,l,h,c,u,d,p,g,f;const m=e?"content":"title",v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},(n=i==null?void 0:i.style)===null||n===void 0?void 0:n.shape),i==null?void 0:i[t]),(r=i==null?void 0:i[t])===null||r===void 0?void 0:r[m]),(a=this.spec)===null||a===void 0?void 0:a[t]),(l=(o=this.spec)===null||o===void 0?void 0:o[t])===null||l===void 0?void 0:l[m]);return{shapeType:(h=v.shapeType)!==null&&h!==void 0?h:this.shapeTypeCallback,shapeFill:(u=(c=v.shapeFill)!==null&&c!==void 0?c:v.shapeColor)!==null&&u!==void 0?u:this.shapeColorCallback,shapeStroke:(d=v.shapeStroke)!==null&&d!==void 0?d:this.shapeStrokeCallback,shapeHollow:(p=v.shapeHollow)!==null&&p!==void 0&&p,shapeLineWidth:v.shapeLineWidth,shapeSize:(g=v.shapeSize)!==null&&g!==void 0?g:v.size,hasShape:(f=v.hasShape)!==null&&f!==void 0?f:this.getHasShape(e)}}enableByType(t){return!0}getDefaultContentList(t){return[this.getDefaultContentPattern(t)]}getContentList(t,e,i,n,r,a){var o;return function(l,h,c,u,d,p){if(d&&d.length){const g=[];return d.forEach(f=>{W(l)?l.forEach(m=>{dS(g,m,h,c,u,f,p)}):U(l)?dS(g,l,h,c,u,f,p):l&&Yg(g,l,h,c,f,p)}),g}return null}((o=e==null?void 0:e.content)!==null&&o!==void 0?o:this.getDefaultContentList(t),this.getDefaultContentPattern(t),i,n,r,a)}getTitleResult(t,e,i,n,r){let a=U(e)?e(n,r):e;if(a?I(a.value)&&(a=Object.assign(Object.assign({},this.getDefaultTitlePattern(t)),a)):a=this.getDefaultTitlePattern(t),a&&a.visible!==!1){const o=function(h){var c;const u=!((c=h[0])===null||c===void 0)&&c.series?[{data:h,value:""}]:h;for(const{data:d}of u)for(const{datum:p}of d)for(const g of p??[])if(g)return g}(n),l={visible:Wn(a.visible,o,r),value:$g(Wn(a.value,o,r,a.valueFormatter),a.valueTimeFormat,a.valueTimeFormatMode),valueStyle:Wn(a.valueStyle,o,r),hasShape:a.hasShape};return Object.keys(i).forEach(h=>{l[h]=Wn(i[h],o,r)}),l}return{hasShape:!1,visible:!1}}getTooltipData(t,e,i,n,r){var a,o;if(!(this.enableByType(t)&&Gg(t,this.spec)&&(t!=="dimension"||n&&n.length)))return null;const l=(o=(a=this.spec)===null||a===void 0?void 0:a[t])!==null&&o!==void 0?o:e==null?void 0:e[t],h=this.getShapeAttrs(t,!0,e),c=this.getShapeAttrs(t,!1,e);let u;return t==="dimension"?(u=[],this.getContentList(t,l,h,i,n,r).forEach(d=>{u.push(d)})):u=this.getContentList(t,l,h,i,n,r),{visible:!0,activeType:t,data:i,title:this.getTitleResult(t,l==null?void 0:l.title,c,i,r),content:u}}getDefaultTitlePattern(t){return{key:void 0,value:t==="group"?this.groupTooltipTitleCallback:this.dimensionTooltipTitleCallback}}getDefaultContentPattern(t){return{seriesId:this.series.id,key:t==="group"?this.groupTooltipKeyCallback:this.markTooltipKeyCallback,value:this.markTooltipValueCallback}}}const aO={min:s=>s.length?ji(s.map(t=>1*t)):0,max:s=>s.length?Ge(s.map(t=>1*t)):0,"array-min":s=>s.length?ji(s.map(t=>1*t)):0,"array-max":s=>s.length?Ge(s.map(t=>1*t)):0,values:s=>{const t={},e=[];for(const i of s)t[i]||(e.push(i),t[i]=1);return e}},gS=(s,t)=>{var e,i;let n=t.fields;if(U(n)&&(n=n()),!(n!=null&&n.length)||!(s!=null&&s.length))return{};n=qr([],n);const r=t.target==="parser"?"parserData":"latestData",a=s[0][r]?s[0][r]:s||[],o=(i=(e=s[0]).getFields)===null||i===void 0?void 0:i.call(e);return fS(a,n,o)},fS=(s,t,e)=>{const i={};let n=[],r=[];return t.forEach(a=>{const o=a.key;i[o]={};const l=e==null?void 0:e[o],h=a.operations,c=h.some(p=>p==="min"||p==="max"||p==="allValid");let u=!0;n.length=0,s&&s.forEach(p=>{p&&n.push(p[o])});const d=n.length;if(c){r.length=0,n.forEach((g,f)=>{wr(g)&&r.push(g)});const p=n;n=r,r=p,u=n.length===d}else n=h.some(p=>p==="array-min"||p==="array-max")?n.reduce((p,g)=>(g&&g.forEach(f=>{wr(f)&&p.push(f)}),p),[]):n.filter(p=>p!==void 0);a.filter&&(n=n.filter(a.filter)),h.forEach(p=>{if(a.customize)i[o][p]=a.customize;else{if(l&&l.lockStatisticsByDomain===!0&&!I(l.domain)){if(p==="values")return void(i[o][p]=l.domain.slice())}else if(p==="allValid")return;i[o][p]=aO[p](n),p==="array-max"&&(i[o].max=i[o][p]),p==="array-min"&&(i[o].min=i[o][p])}}),c&&(i[o].allValid=u)}),i},oO=(s,t)=>{const{config:e}=t;if(!e)return s;const{invalidType:i,checkField:n}=e();return i!=="zero"||n&&n.length&&s.forEach(r=>{n.forEach(a=>{wr(r[a])||(r[a]=0)})}),s};class Xg extends Vn{_compileProduct(){var t;const e=(t=this._data)===null||t===void 0?void 0:t.latestData;I(e)||R(this.getProduct())||this._initProduct([])}generateProductId(){var t;return(t=this._data)===null||t===void 0?void 0:t.name}}function Kg(){return{keyMap:new Map,needDefaultSeriesField:!this._seriesField,defaultSeriesField:this._seriesField?null:this.getSeriesKeys()[0],getKey:this.generateDefaultDataKey(this._spec.dataKey)}}function qg(s,t,e){s&&(e.needDefaultSeriesField&&(s[$s]=e.defaultSeriesField),s[Dn]=t,s[Oo]=e.getKey(s,t,e))}const Un={label:{name:"label",type:"text"}},mS=\`\${xt}_rect_x\`,vS=\`\${xt}_rect_x1\`,yS=\`\${xt}_rect_y\`,_S=\`\${xt}_rect_y1\`,lO={data:!0},bS={invalidType:!0,animation:!0,animationAppear:!0,animationEnter:!0,animationUpdate:!0,animationExit:!0,animationNormal:!0},hO={type:"fadeIn"};function cO(s,t){switch(t){case"grow":return(e=>({type:e.direction==="horizontal"?"growPointsXIn":"growPointsYIn",options:{orient:e.direction==="horizontal"?"positive":"negative"}}))(s);case"fadeIn":return hO;default:return(e=>({type:"clipIn",options:{clipDimension:e.direction==="horizontal"?"y":"x"}}))(s)}}const Go={appear:{duration:1e3,easing:"cubicOut"},update:{type:"update",duration:300,easing:"linear"},enter:{duration:300,easing:"linear"},exit:{duration:300,easing:"linear"},disappear:{duration:500,easing:"cubicIn"},state:{duration:300,easing:"linear"}},uO={appear:{type:"scaleIn"},enter:{type:"scaleIn"},exit:{type:"scaleOut"},disappear:{type:"scaleOut"}},xS=()=>{et.registerAnimation("scaleInOut",()=>uO)},SS=(s,t)=>({appear:cO(s,t),enter:{type:"fadeIn"},exit:{type:"fadeOut"},update:[{type:"update",options:{excludeChannels:["points","defined","segments"]}},{channel:["points","segments"],custom:jk,duration:Go.update.duration,easing:Go.update.easing,customParameters:{clipRangeByDimension:s.direction==="horizontal"?"y":"x"}}],disappear:{type:"clipOut"}}),AS=()=>{et.registerAnimation("line",SS)},kS=()=>{Ho.useRegisters([kI,wI,TI,CI,MI,EI,mI,vI])},wS=[...Object.keys(Go),"normal"];function cs(s={},t,e){const i={};for(let n=0;n<wS.length;n++){const r=wS[n],a=t?t[r]:void 0;if(a===!1)continue;if(r==="normal"){a&&(i.normal=a);continue}if(r==="state"){a!==!1&&(i.state=a??Go.state);continue}if(r!=="update"&&!a&&!s[r])continue;let o,l;o=W(s[r])?s[r]:[Object.assign(Object.assign({},Go[r]),s[r])],r==="exit"&&o.forEach(h=>{h.controlOptions={stopWhenStateChange:!0}}),a?(l=W(a)?a.map((h,c)=>{var u;let d=h;return MS(d)&&delete d.type,d.oneByOne&&(d=TS(d,(u=e==null?void 0:e.dataIndex)!==null&&u!==void 0?u:CS,e==null?void 0:e.dataCount)),d}):o.map((h,c)=>{var u;let d=mt({},o[c],a);return MS(d)&&delete d.type,d.oneByOne&&(d=TS(d,(u=e==null?void 0:e.dataIndex)!==null&&u!==void 0?u:CS,e==null?void 0:e.dataCount)),d}),i[r]=l):i[r]=o}return i}function an(s,t,e){var i,n,r,a,o,l;const h={};return R(t.animationAppear)&&(h.appear=(i=t.animationAppear[s])!==null&&i!==void 0?i:t.animationAppear),R(t.animationDisappear)&&(h.disappear=(n=t.animationDisappear[s])!==null&&n!==void 0?n:t.animationDisappear),R(t.animationEnter)&&(h.enter=(r=t.animationEnter[s])!==null&&r!==void 0?r:t.animationEnter),R(t.animationExit)&&(h.exit=(a=t.animationExit[s])!==null&&a!==void 0?a:t.animationExit),R(t.animationUpdate)&&(h.update=(o=t.animationUpdate[s])!==null&&o!==void 0?o:t.animationUpdate),R(t.animationState)&&(h.state=(l=t.animationState[s])!==null&&l!==void 0?l:t.animationState),t.animationNormal&&t.animationNormal[s]&&(h.normal=t.animationNormal[s]),function(c,u){if(!c)return c;const d=["custom","customParameters"];return c=Fi(c,null,d),Jg(c,p=>{var g;return U(p)&&((g=p.prototype)===null||g===void 0?void 0:g.constructor)!==p?(...f)=>p(...f,u):p},d),c}(h,e)}function TS(s,t,e){const{oneByOne:i,duration:n,delay:r,delayAfter:a}=s;return s.delay=(o,l,h)=>{const c=t(o,h),u=U(n)?n(o,l,h):q(n)?n:0,d=U(r)?r(o,l,h):q(r)?r:0;let p=U(i)?i(o,l,h):i;return p===!1?d:(p=p===!0?0:p,d+c*(u+p))},s.delayAfter=(o,l,h)=>{const c=t(o,h),u=U(n)?n(o,l,h):q(n)?n:0,d=U(a)?a(o,l,h):q(a)?a:0;let p=U(i)?i(o,l,h):i;return p===!1?d:(p=p===!0?0:p,d+((e?e():l.mark.elements.length)-c)*(u+p))},delete s.oneByOne,s}function CS(s,t){var e,i;return(e=s==null?void 0:s[Dn])!==null&&e!==void 0?e:(i=t==null?void 0:t.VGRAMMAR_ANIMATION_PARAMETERS)===null||i===void 0?void 0:i.elementIndex}function Zg(s,t){var e,i,n,r,a;if(s.animation===!1||((e=s.morph)===null||e===void 0?void 0:e.enable)===!1)return!1;const o=((n=(i=s.animationAppear)===null||i===void 0?void 0:i[t])!==null&&n!==void 0?n:s.animationAppear)!==!1,l=((a=(r=s.animationUpdate)===null||r===void 0?void 0:r[t])!==null&&a!==void 0?a:s.animationUpdate)!==!1;return!(!o||!l)}function MS(s){return!function(t){return R(t.timeSlices)}(s)&&R(s.channel)}function Jg(s,t,e=[]){if(W(s))s.forEach((i,n)=>{s[n]=t(s[n],n),Jg(s[n],t,e)});else if(_t(s))for(const i in s)e.includes(i)||(s[i]=t(s[i],i),Jg(s[i],t,e))}function ES(s){var t,e,i,n;const r=s.getSpec();if(r.animation===!1||!R(s.getRegion().animate))return!1;let a=(t=r.animationThreshold)!==null&&t!==void 0?t:Number.MAX_SAFE_INTEGER;return(e=s.getMarks())===null||e===void 0||e.forEach(o=>{const l=o.getMarkConfig();l&&(l.large&&l.largeThreshold&&(a=Math.min(a,l.largeThreshold)),l.progressiveThreshold&&(a=Math.min(a,l.progressiveThreshold)))}),!(((n=(i=s.getRawData())===null||i===void 0?void 0:i.latestData)===null||n===void 0?void 0:n.length)>=a)}class Yo extends fu{constructor(){super(...arguments),this.markLabelSpec={}}getLabelSpec(t){return this.markLabelSpec[t]}setLabelSpec(t,e){this.markLabelSpec[t]=Y(e)}addLabelSpec(t,e,i=!1){this.markLabelSpec[t]||(this.markLabelSpec[t]=[]),i?this.markLabelSpec[t].unshift(e):this.markLabelSpec[t].push(e)}getTheme(t,e){var i,n,r;const a=fb(t),o=(i=this._option)===null||i===void 0?void 0:i.getTheme(),{markByName:l,mark:h}=o,c=this._option.type,u=et.getSeriesMarkMap(c)?function(p,g,f,m){const v=et.getSeriesMarkMap(g);if(!v)return p;const y={};return Object.values(v).forEach(({type:_,name:b})=>{y[b]=mt({},f==null?void 0:f[Y(_)[0]],m==null?void 0:m[b],p==null?void 0:p[b])}),Object.assign(Object.assign({},p),y)}(vt(o,\`series.\${c}\`),c,h,l):{},d=vt(o,\`series.\${c}_\${a}\`);return mt({},u,d,((r=(n=this.stack)!==null&&n!==void 0?n:d==null?void 0:d.stack)!==null&&r!==void 0?r:u!=null&&u.stack)?vt(o,\`series.\${c}_stack\`):void 0)}transformSpec(t,e,i){this._transformStack(t);const n=super.transformSpec(t,e,i);return this._transformLabelSpec(n.spec),Object.assign(Object.assign({},n),{markLabelSpec:this.markLabelSpec,stack:this.stack})}_transformLabelSpec(t){}_transformStack(t){pe(t.stack)&&(this.stack=t.stack),pe(t.percent)&&(this.stack=t.percent||this.stack),I(this.stack)&&this._supportStack&&t.seriesField&&(this.stack=!0)}_addMarkLabelSpec(t,e,i="label",n="initLabelMarkStyle",r=!0,a){t&&Y(t[i]).forEach(o=>{var l,h,c;if(o&&o.visible){const{animation:u=!0,animationUpdate:d=!0,animationEnter:p=!0,animationExit:g=!0}=o,{animationUpdate:f=!0,animationEnter:m=!0,animationExit:v=!0}=t,y=!!((c=(h=(l=this._option)===null||l===void 0?void 0:l.animation)!==null&&h!==void 0?h:t.animation)!==null&&c!==void 0?c:o.animation)&&!!r;this.addLabelSpec(U(e)?e(o):e,Object.assign(Object.assign({},o),{animation:!!y&&u,animationUpdate:!!(y&&f&&d)&&f,animationEnter:!!(y&&m&&p)&&m,animationExit:!!(y&&m&&g)&&v,getStyleHandler:_=>{var b;return(b=_[n])===null||b===void 0?void 0:b.bind(_)}}),a)}})}_getDefaultSpecFromChart(t){var e;const i=(e=super._getDefaultSpecFromChart(t))!==null&&e!==void 0?e:{},{outerRadius:n,innerRadius:r,direction:a}=t;return R(n)&&(i.outerRadius=n),R(r)&&(i.innerRadius=r),R(a)&&(i.direction=a),Object.keys(i).length>0?i:void 0}_mergeThemeToSpec(t,e){const i=this._theme;if(this._shouldMergeThemeToSpec()){const n=this._getDefaultSpecFromChart(e),r=a=>{const o=mt({},i,n,a),l=i.label;return l&&_t(l)&&W(o.label)&&(o.label=o.label.map(h=>mt({},l,h))),o};return W(t)?{spec:t.map(a=>r(a)),theme:i}:{spec:r(t),theme:i}}return{spec:t,theme:i}}}class xu extends Wg{getRegion(){return this._region}getLayoutStartPoint(){return this._region.getLayoutStartPoint()}getRootMark(){return this._rootMark}getSeriesMark(){return this._seriesMark}getRawData(){return this._rawData}getViewDataFilter(){return this._viewDataFilter}getViewData(){var t;return(t=this._data)===null||t===void 0?void 0:t.getDataView()}getViewDataProductId(){var t;return(t=this._data)===null||t===void 0?void 0:t.getProductId()}getViewDataStatistics(){return this._viewDataStatistics}getViewStackData(){return this._viewStackData}getSeriesField(){return this._seriesField}setSeriesField(t){R(t)&&(this._seriesField=t)}getGroups(){return this._groups}getStack(){var t;return(t=this.getSpecInfo())===null||t===void 0?void 0:t.stack}getStackValue(){var t;return(t=this._spec.stackValue)!==null&&t!==void 0?t:\`\${xt}_series_\${this.type}\`}getPercent(){return this._spec.percent}getStackOffsetSilhouette(){return this._spec.stackOffsetSilhouette}get tooltipHelper(){return this._tooltipHelper||this.initTooltip(),this._tooltipHelper}getInvalidType(){return this._invalidType}setInvalidType(t){var e;this._invalidType=t,(e=this.getViewData())===null||e===void 0||e.reRunAllTransform()}getMarkAttributeContext(){return this._markAttributeContext}constructor(t,e){var i;super(t,e),this.specKey="series",this.type="series",this.layoutType="absolute",this.modelType="series",this.name=void 0,this.transformerConstructor=Yo,this.coordinate="none",this._region=null,this._layoutStartPoint={x:0,y:0},this._layoutRect={width:null,height:null},this.getLayoutRect=()=>{var n,r;return{width:(n=this._layoutRect.width)!==null&&n!==void 0?n:this._region.getLayoutRect().width,height:(r=this._layoutRect.height)!==null&&r!==void 0?r:this._region.getLayoutRect().height}},this._rootMark=null,this._seriesMark=null,this._viewDataMap=new Map,this._viewDataFilter=null,this._data=null,this.layoutZIndex=Qe.SeriesGroup,this._invalidType="break",this._region=e.region,this._dataSet=e.dataSet,!((i=this._spec)===null||i===void 0)&&i.name&&(this.name=this._spec.name)}created(){super.created(),this._buildMarkAttributeContext(),this.initData(),this.initGroups(),this.initStatisticalData(),this.event.emit(pt.afterInitData,{model:this}),this.initRootMark(),this.initMark();const t=ES(this);this._initExtensionMark({hasAnimation:t}),this.initMarkStyle(),this.initMarkState(),t&&this.initAnimation(),this._option.disableTriggerEvent||this.initInteraction(),this.afterInitMark(),this.initEvent(),this.event.emit(pt.afterInitEvent,{model:this})}_buildMarkAttributeContext(){this._markAttributeContext={vchart:this._option.globalInstance,globalScale:(t,e)=>{var i;return(i=this._option.globalScale.getScale(t))===null||i===void 0?void 0:i.scale(e)},seriesColor:t=>{var e;return I(t)&&(t=this.getSeriesKeys()[0]),(e=this._option.globalScale.getScale("color"))===null||e===void 0?void 0:e.scale(t)},getRegion:()=>this._region}}setAttrFromSpec(){super.setAttrFromSpec(),this.setSeriesField(this._spec.seriesField),R(this._spec.invalidType)&&(this._invalidType=this._spec.invalidType)}getInvalidCheckFields(){return[this.getStackValueField()]}initInvalidDataTransform(){var t,e;this._invalidType==="zero"&&(!((t=this._rawData)===null||t===void 0)&&t.dataSet)&&(Se(this._rawData.dataSet,"invalidTravel",oO),(e=this._rawData)===null||e===void 0||e.transform({type:"invalidTravel",options:{config:()=>({invalidType:this._invalidType,checkField:this.getInvalidCheckFields()})}},!1))}initData(){var t,e,i;const n=(t=this._spec.data)!==null&&t!==void 0?t:this._option.getSeriesData(this._spec.dataId,this._spec.dataIndex);if(n&&(this._rawData=Ng(n,this._dataSet,this._option.sourceDataList)),(i=(e=this._rawData)===null||e===void 0?void 0:e.target)===null||i===void 0||i.addListener("change",this.rawDataUpdate.bind(this)),this._addDataIndexAndKey(),this._rawData){this.getStack()&&(this._viewDataFilter=qx(this._rawData,this._dataSet,{name:\`\${this.type}_\${this.id}_viewDataFilter\`}));const r=qx(this.getStack()?this._viewDataFilter:this._rawData,this._dataSet,{name:\`\${this.type}_\${this.id}_viewData\`});this._data=new Xg(this._option,r),this.getStack()&&this._viewDataFilter.target.removeListener("change",r.reRunAllTransform)}this.initInvalidDataTransform()}initGroups(){const t=this.getGroupFields();t&&t.length&&(this._groups={fields:t})}initStatisticalData(){this._data&&this._statisticViewData()}getRawDataStatisticsByField(t,e){var i,n,r;if(this._rawStatisticsCache||(this._rawStatisticsCache={}),!this._rawStatisticsCache[t]||e&&(I(this._rawStatisticsCache[t].min)||I(this._rawStatisticsCache[t].max))||!e&&I(this._rawStatisticsCache[t].values)){if(this._viewDataStatistics&&(!this._viewDataFilter||this._viewDataFilter.transformsArr.length<=1)&&this.getViewData().transformsArr.length<=1&&(!((i=this._viewDataStatistics.latestData)===null||i===void 0)&&i[t]))this._rawStatisticsCache[t]=this._viewDataStatistics.latestData[t];else if(this._rawData){const a=(n=this._rawData.getFields())===null||n===void 0?void 0:n[t];if(a&&a.lockStatisticsByDomain&&a.domain)this._rawStatisticsCache[t]={},e?(this._rawStatisticsCache[t].min=ji(a.domain),this._rawStatisticsCache[t].max=Ge(a.domain)):this._rawStatisticsCache[t].values=a.domain;else{const o=fS(this._rawData.latestData,[{key:t,operations:e?["min","max"]:["values"]}])[t];this._rawStatisticsCache[t]=rt((r=this._rawStatisticsCache[t])!==null&&r!==void 0?r:{},o)}}}return this._rawStatisticsCache[t]}_statisticViewData(){Se(this._dataSet,"dimensionStatistics",gS);const t=\`\${this.type}_\${this.id}_viewDataStatic\`;this._viewDataStatistics=new _e(this._dataSet,{name:t}),this._viewDataStatistics.parse([this._data.getDataView()],{type:"dataview"}),this._viewDataStatistics.transform({type:"dimensionStatistics",options:{fields:()=>{const e=this.getStatisticFields();return this._seriesField&&qr(e,[{key:this._seriesField,operations:["values"]}]),e},target:"latest"}},!1),this._data.getDataView().target.removeListener("change",this._viewDataStatistics.reRunAllTransform),this.getStack()&&this.createdStackData()}createStatisticalData(t,e,i){Se(this._dataSet,"dimensionStatistics",gS);const n=new _e(this._dataSet,{name:t});return n.parse([e],{type:"dataview"}),n.transform({type:"dimensionStatistics",options:{operations:["max","min","values"],fields:()=>{var r;const a=qr(this.getStatisticFields(),(r=i==null?void 0:i(e.name))!==null&&r!==void 0?r:[]);return this._seriesField&&qr(a,[{key:this._seriesField,operations:["values"]}]),a},target:"latest"}},!1),n}createdStackData(){const t=\`\${this.type}_\${this.id}_viewStackData\`;this._viewStackData=new _e(this._dataSet,{name:t}),this._viewStackData.parse([this._viewDataFilter],{type:"dataview"}),this._viewStackData.transform({type:"stackSplit",options:{fields:this.getStackGroupFields()}},!1)}_noAnimationDataKey(t,e){return e}generateDefaultDataKey(t){var e;return I(t)?(i,n,r)=>{if(this._spec.animation===!1){const l=this._noAnimationDataKey(i,n);if(l!==void 0)return l}const{keyMap:a}=r,o=this._getSeriesDataKey(i);return a.get(o)===void 0?(a.set(o,0),o):(a.set(o,a.get(o)+1),\`\${o}_\${a.get(o)}\`)}:Q(t)?i=>i[t]:W(t)&&t.every(i=>Q(i))?i=>t.map(n=>i[n]).join("-"):U(t)?(i,n)=>t(i,n):((e=this._option)===null||e===void 0||e.onError(\`invalid dataKey: \${t}\`),(i,n)=>{})}_addDataIndexAndKey(){var t;!((t=this._rawData)===null||t===void 0)&&t.dataSet&&(Se(this._rawData.dataSet,"addVChartProperty",cS),this._rawData.transform({type:"addVChartProperty",options:{beforeCall:Kg.bind(this),call:qg}},!1))}updateRawData(t){this._rawData&&this._rawData.updateRawData(t)}rawDataUpdate(t){var e;(e=this._rawDataStatistics)===null||e===void 0||e.reRunAllTransform(),this._rawStatisticsCache=null,this.event.emit(pt.rawDataUpdate,{model:this})}viewDataFilterOver(t){this.event.emit(pt.viewDataFilterOver,{model:this})}viewDataUpdate(t){var e;this.event.emit(pt.viewDataUpdate,{model:this}),(e=this._data)===null||e===void 0||e.updateData(),this._viewDataStatistics&&this._viewDataStatistics.reRunAllTransform()}viewDataStatisticsUpdate(t){this.event.emit(pt.viewDataStatisticsUpdate,{model:this})}getDatumPositionValue(t,e){return!t||I(e)?null:t[e]}getDatumPositionValues(t,e){return!t||I(e)?[]:Q(e)?[t[e]]:e.map(i=>t[i])}setValueFieldToStack(){}setValueFieldToPercent(){}setValueFieldToStackOffsetSilhouette(){}initRootMark(){var t,e,i;this._rootMark=this._createMark({type:"group",name:\`seriesGroup_\${this.type}_\${this.id}\`},{parent:(e=(t=this._region).getGroupMark)===null||e===void 0?void 0:e.call(t),dataView:!1}),this._rootMark.setMarkConfig({zIndex:(i=this._spec.zIndex)!==null&&i!==void 0?i:this.layoutZIndex})}_getExtensionMarkNamePrefix(){return\`\${this.type}_\${this.id}_extensionMark\`}_initExtensionMark(t){var e;if(!this._spec.extensionMark)return;const i=this.getMarksWithoutRoot();t.depend=i,(e=this._spec.extensionMark)===null||e===void 0||e.forEach((n,r)=>{this._createExtensionMark(n,null,this._getExtensionMarkNamePrefix(),r,t)})}_createExtensionMark(t,e,i,n,r){var a;const o=this._createMark({type:t.type,name:R(t.name)?\`\${t.name}\`:\`\${i}_\${n}\`},{skipBeforeLayouted:!0,markSpec:t,parent:e,dataView:!1,componentType:t.componentType,depend:r.depend,key:t.dataKey},{setCustomizedShape:t==null?void 0:t.customShape});if(o){if(R(t.id)&&o.setUserId(t.id),r.hasAnimation){const l=cs({},an(t.type,t,this._markAttributeContext));o.setAnimationConfig(l)}if(t.type==="group")i=\`\${i}_\${n}\`,(a=t.children)===null||a===void 0||a.forEach((l,h)=>{this._createExtensionMark(l,o,i,h,r)});else if(!(e||I(t.dataId)&&I(t.dataIndex))){const l=this._option.getSeriesData(t.dataId,t.dataIndex);l===this._rawData?o.setDataView(this.getViewData(),this.getViewDataProductId()):(o.setDataView(l),l.target.addListener("change",()=>{o.getData().updateData()}))}}}_updateExtensionMarkSpec(){var t;(t=this._spec.extensionMark)===null||t===void 0||t.forEach((e,i)=>{const n=this._marks.getMarkWithInfo({name:R(e.name)?\`\${e.name}\`:\`\${this._getExtensionMarkNamePrefix()}_\${i}\`});n&&(this.initMarkStyleWithSpec(n,e),n.updateStaticEncode(),n.updateLayoutState())})}getStackData(){var t;return(t=this._viewStackData)===null||t===void 0?void 0:t.latestData}_parseSelectorOfInteraction(t,e){if(!e||!e.length)return[];const i=[];return t.markIds?e.filter(n=>{t.markIds.includes(n.getProductId())&&i.push(\`#\${n.getProductId()}\`)}):t.markNames?e.forEach(n=>{t.markNames.includes(n.name)&&i.push(\`#\${n.getProductId()}\`)}):e.forEach(n=>{i.push(\`#\${n.getProductId()}\`)}),i}_parseDefaultInteractionConfig(t){if(!(t!=null&&t.length))return[];const e=(i=this._option.mode)===K.RenderModeEnum["desktop-browser"]||i===K.RenderModeEnum["desktop-miniApp"]?{hover:{enable:!0,trigger:"pointermove",triggerOff:"view:pointerleave"},select:{enable:!0,trigger:"pointertap"}}:Ar(i)||kr(i)?{hover:{enable:!0,trigger:["pointerdown","pointermove"],triggerOff:"view:pointerleave"},select:{enable:!0,trigger:"tap"}}:null;var i;let n=Object.assign({},e==null?void 0:e.hover),r=Object.assign({},e==null?void 0:e.select);const a=this._spec.hover;pe(a)?n.enable=a:_t(a)&&(n.enable=!0,n=mt(n,a));const o=this._spec.select;pe(o)?r.enable=o:_t(o)&&(r.enable=!0,r=mt(r,o));const l=[];if(n.enable){const h=this._parseSelectorOfInteraction(n,t);h.length&&l.push(this._defaultHoverConfig(h,n))}if(r.enable){const h=this._parseSelectorOfInteraction(r,t);h.length&&l.push(this._defaultSelectConfig(h,r))}return l}_defaultHoverConfig(t,e){return{seriesId:this.id,regionId:this._region.id,selector:t,type:"element-highlight",trigger:e.trigger,triggerOff:e.triggerOff,blurState:Vt.STATE_HOVER_REVERSE,highlightState:Vt.STATE_HOVER}}_defaultSelectConfig(t,e){const i=e.mode==="multiple",n=R(e.triggerOff)?e.triggerOff:i?["empty"]:["empty",e.trigger];return{type:"element-select",seriesId:this.id,regionId:this._region.id,selector:t,trigger:e.trigger,triggerOff:n,reverseState:Vt.STATE_SELECTED_REVERSE,state:Vt.STATE_SELECTED,isMultiple:i}}_parseInteractionConfig(t){const e=this.getCompiler();if(!e)return;const{interactions:i}=this._spec,n=this._parseDefaultInteractionConfig(t);n&&n.length&&n.forEach(r=>{e.addInteraction(r)}),i&&i.length&&i.forEach(r=>{const a=this._parseSelectorOfInteraction(r,this.getMarks());a.length&&e.addInteraction(Object.assign(Object.assign({},r),{selector:a,seriesId:this.id,regionId:this._region.id}))})}initInteraction(){const t=this.getMarksWithoutRoot();this._parseInteractionConfig(t)}initAnimation(){}initMarkState(){this.initSeriesStyleState()}initSeriesStyleState(){var t;const e=this._spec.seriesStyle;if(!e||!e.length)return;const i=(t=this._seriesField)!==null&&t!==void 0?t:$s;this.getMarksWithoutRoot().forEach(n=>{const r={},a={},o={};e.forEach(h=>{var c;const u=(c=h[n.name])===null||c===void 0?void 0:c.style;u&&(r[h.name]=!0,o[h.name]=o[h.name]||{},Object.keys(u).forEach(d=>{a[d]=!0,o[h.name][d]=u[d]}))}),n.state.addStateInfo({stateValue:bg,level:-1,filter:h=>Array.isArray(h)?h.length!==0&&r[h[0][i]]===!0:r[h[i]]===!0});const l={};Object.keys(a).forEach(h=>{l[h]=c=>{var u,d;let p;if(Array.isArray(c)){if(c.length===0)return;p=(u=o[c[0][i]])===null||u===void 0?void 0:u[h]}return p=(d=o[c[i]])===null||d===void 0?void 0:d[h],R(p)?p:n.getAttribute(h,c)}}),this.setMarkStyle(n,l,bg,St.User_SeriesStyle)})}afterInitMark(){this.event.emit(pt.afterInitMark,{model:this}),this.setSeriesField(this._spec.seriesField),this.getMarks().forEach(t=>{var e,i;!((i=(e=t.stateStyle)===null||e===void 0?void 0:e.normal)===null||i===void 0)&&i.lineWidth&&t.setAttribute("stroke",this.getColorAttribute(),"normal",St.Base_Series)})}getMarksWithoutRoot(){return this.getMarks().filter(t=>{var e;return!(!((e=t.name)===null||e===void 0)&&e.includes("seriesGroup"))})}getMarksInType(t){return this._marks.getMarksInType(t)}getMarkInName(t){return this._marks.get(t)}getMarkInId(t){return this.getMarks().find(e=>e.id===t)}initEvent(){var t,e,i;(e=(t=this._data)===null||t===void 0?void 0:t.getDataView())===null||e===void 0||e.target.addListener("change",this.viewDataUpdate.bind(this)),(i=this._viewDataStatistics)===null||i===void 0||i.target.addListener("change",this.viewDataStatisticsUpdate.bind(this))}_releaseEvent(){super._releaseEvent(),this.getCompiler().removeInteraction(this.id)}initTooltip(){this._tooltipHelper=new pS(this)}_compareExtensionMarksSpec(t,e,i){t.length!==e.length||e.some((n,r)=>n.type!==t[r].type||n.id!==t[r].id||n.name!==t[r].name)?i.reMake=!0:e.some((n,r)=>n.visible!==t[r].visible)&&(i.reCompile=!0)}_compareLabelSpec(t,e,i){t.length!==e.length||e.some((n,r)=>n.labelLayout!==t[r].labelLayout||n.visible!==t[r].visible)?i.reMake=!0:!i.reCompile&&e.some((n,r)=>!Xt(n,t[r]))&&(i.reCompile=!0)}_compareSpec(t,e,i){const n=super._compareSpec(t,e),r=Object.keys(e||{}).sort();if(!Xt(r,Object.keys(t||{}).sort()))return n.reMake=!0,n;const a=Object.assign(Object.assign(Object.assign(Object.assign({},lO),bS),i),{extensionMark:!0,label:!0,totalLabel:!0});return this._compareExtensionMarksSpec(Y(t.extensionMark),Y(e.extensionMark),n),!n.reMake&&this._compareLabelSpec(Y(t.label),Y(e.label),n),!n.reMake&&this._compareLabelSpec(Y(t.totalLabel),Y(e.totalLabel),n),n.reMake?n:(!n.reCompile&&this._marks.getMarks().some(o=>{var l,h;return a[o.name]=!0,((l=e[o.name])===null||l===void 0?void 0:l.visible)!==((h=t[o.name])===null||h===void 0?void 0:h.visible)})&&(n.reCompile=!0),!n.reCompile&&r.some(o=>bS[o]&&!Xt(t[o],e[o]))&&(n.reCompile=!0),r.some(o=>!a[o]&&!Xt(t[o],e[o]))&&(n.reMake=!0),n)}_updateSpecData(){!this._rawData||!this._spec.data||this._spec.data instanceof _e||zg(this._rawData,this._spec.data,!0)}reInit(t){super.reInit(t);const e=this.getMarksWithoutRoot();e.forEach(i=>{this._spec[i.name]&&this.initMarkStyleWithSpec(i,this._spec[i.name])}),this.initMarkStyle(),e.forEach(i=>{i.updateStaticEncode(),i.updateLayoutState(!0)}),this._updateExtensionMarkSpec(),this._updateSpecData(),this._tooltipHelper&&this._tooltipHelper.updateTooltipSpec(),ES(this)&&this.initAnimation()}onEvaluateEnd(t){this._data.updateData()}onRender(t){}release(){var t,e,i;super.release(),this._viewDataMap.clear();const n=(e=(t=this._rawData)===null||t===void 0?void 0:t.transformsArr)===null||e===void 0?void 0:e.findIndex(r=>r.type==="addVChartProperty");n>=0&&this._rawData.transformsArr.splice(n,1),(i=this._data)===null||i===void 0||i.release(),this._dataSet=this._data=this._rawData=this._rawDataStatistics=this._spec=this._region=this._viewDataStatistics=this._viewStackData=null}setLayoutStartPosition(t){q(t.x)&&(this._layoutStartPoint.x=t.x),q(t.y)&&(this._layoutStartPoint.y=t.y)}setLayoutRect({width:t,height:e},i){q(t)&&(this._layoutRect.width=t),q(e)&&(this._layoutRect.height=e)}getSeriesKeys(){var t,e;return this._seriesField?(e=(t=this.getRawDataStatisticsByField(this._seriesField))===null||t===void 0?void 0:t.values)!==null&&e!==void 0?e:[]:this.name?[this.name]:this.userId?[\`\${this.userId}\`]:[\`\${this.type}_\${this.id}\`]}getSeriesStyle(t){return e=>{var i,n;return(n=(i=this._seriesMark)===null||i===void 0?void 0:i.getAttribute(e,t))!==null&&n!==void 0?n:void 0}}_getSeriesInfo(t,e){const i=this.getDefaultShapeType();return e.map(n=>({key:n,originalKey:n,style:this.getSeriesStyle({[t]:n}),shapeType:i}))}getSeriesInfoInField(t){var e,i;return this._getSeriesInfo(t,(i=(e=this.getRawDataStatisticsByField(t))===null||e===void 0?void 0:e.values)!==null&&i!==void 0?i:[])}getSeriesInfoList(){var t;return this._getSeriesInfo((t=this._seriesField)!==null&&t!==void 0?t:$s,this.getSeriesKeys())}_getDefaultColorScale(){var t,e;const i=this.getDefaultColorDomain(),n=this._getDataScheme();return(e=(t=new yb().domain(i)).range)===null||e===void 0?void 0:e.call(t,n)}_getDataScheme(){return Gr(this.getColorScheme(),this.type)}getDefaultColorDomain(){var t,e;return this._seriesField?(e=(t=this.getViewDataStatistics())===null||t===void 0?void 0:t.latestData[this._seriesField])===null||e===void 0?void 0:e.values:[]}getColorAttribute(){var t,e;return{scale:(t=this._option.globalScale.getScale("color"))!==null&&t!==void 0?t:this._getDefaultColorScale(),field:(e=this._seriesField)!==null&&e!==void 0?e:$s}}getDimensionField(){return[]}getMeasureField(){return[]}onMarkPositionUpdate(){this.onMarkTreePositionUpdate(this.getMarksWithoutRoot())}onMarkTreePositionUpdate(t){}_createMark(t,e={},i={}){var n,r,a,o,l,h;const{key:c,groupKey:u,skipBeforeLayouted:d,themeSpec:p={},markSpec:g,dataView:f,dataProductId:m,parent:v,isSeriesMark:y,depend:_,stateSort:b,noSeparateStyle:x=!1}=e,S=super._createMark(t,{key:c??this._getDataIdKey(),seriesId:this.id,attributeContext:this._markAttributeContext,componentType:e.componentType,noSeparateStyle:x});if(R(S)){const w=this.getSpec()||{};this._marks.addMark(S,{name:t.name}),y&&(this._seriesMark=S),I(v)?(n=this._rootMark)===null||n===void 0||n.addMark(S):v!==!1&&v.addMark(S),I(f)?(S.setDataView(this.getViewData(),this.getViewDataProductId()),S.setSkipBeforeLayouted(!0)):f!==!1&&S.setDataView(f,m),pe(d)&&S.setSkipBeforeLayouted(d),R(_)&&S.setDepend(...Y(_)),I(u)||S.setGroupKey(u),b&&S.setStateSortCallback(b);const k=Object.assign(Object.assign({},i),{morph:(r=i.morph)!==null&&r!==void 0&&r,support3d:(A=t.type,["arc3d","rect3d","pyramid3d"].includes(A)||((a=i.support3d)!==null&&a!==void 0?a:w.support3d||!!w.zField)),morphKey:((o=w.morph)===null||o===void 0?void 0:o.morphKey)||\`\${this.getSpecIndex()}_\${this.getMarks().length}\`,morphElementKey:(h=(l=w.morph)===null||l===void 0?void 0:l.morphElementKey)!==null&&h!==void 0?h:i.morphElementKey});S.setMarkConfig(k),this.initMarkStyleWithSpec(S,mt({},p,g||w[S.name]))}var A;return S}_getDataIdKey(){var t;return(t=super._getDataIdKey())!==null&&t!==void 0?t:Oo}_getSeriesDataKey(t){let e="";if(!t)return e;const i=this.getDimensionField();e=i.map(r=>t[r]).join("_");const n=this.getSeriesField();return n&&!i.includes(n)&&(e+=\`_\${t[n]}\`),e}addViewDataFilter(t){var e,i;(i=(e=this._viewDataFilter)!==null&&e!==void 0?e:this.getViewData())===null||i===void 0||i.transform(t,!1)}reFilterViewData(){var t,e;(e=(t=this._viewDataFilter)!==null&&t!==void 0?t:this.getViewData())===null||e===void 0||e.reRunAllTransform()}reTransformViewData(){var t,e;(e=(t=this._data)===null||t===void 0?void 0:t.getDataView())===null||e===void 0||e.reRunAllTransform()}fillData(){var t;(t=this.getRawData())===null||t===void 0||t.reRunAllTransform()}compile(){this.compileData()}getDefaultShapeType(){return"circle"}getFieldAlias(t){var e;return t!==Xi&&t!==Ks&&t!==Xs&&t!==Fn||(t=this.getStackValueField()),(e=Gb(this.getRawData(),t))!==null&&e!==void 0?e:t}_getInvalidConnectType(){return this._invalidType==="zero"?"zero":this._invalidType==="link"?"connect":"none"}_getInvalidDefined(t){const e=this.getInvalidCheckFields();return!e.length||e.every(i=>wr(t[i]))}_getRelatedComponentSpecInfo(t){var e;const i=this.getSpecIndex(),n=(e=this._option.getSpecInfo().component[t])===null||e===void 0?void 0:e.filter(r=>r.seriesIndexes.includes(i));return n??[]}_forEachStackGroup(t,e){var i,n;(e=e??((i=this._viewStackData)===null||i===void 0?void 0:i.latestData))&&(!((n=e.values)===null||n===void 0)&&n.length?t(e):e.nodes&&Object.values(e.nodes).forEach(r=>{this._forEachStackGroup(t,r)}))}isDatumInViewData(t){if(!t)return!1;const e=this.getViewData().latestData;return!!e&&(!!e.includes(t)||e.some(i=>Object.keys(t).every(n=>t[n]===i[n])))}getSeriesFieldValue(t,e){var i;return t[(i=e??this.getSeriesField())!==null&&i!==void 0?i:$s]}}function BS(s,t,e){const i=s.getScale(0),n="isInverse"in s&&s.isInverse();he(i.type)?e.sort((r,a)=>(r[t]-a[t])*(n?-1:1)):e.sort((r,a)=>(i.index(r[t])-i.index(a[t]))*(n?-1:1))}function Qg(s){return{dataIndex:t=>{var e,i;const n=s.direction==="horizontal"?s.fieldY[0]:s.fieldX[0],r=t==null?void 0:t[n],a=s.direction==="horizontal"?s.scaleY:s.scaleX;return((i=(e=a==null?void 0:a.domain)===null||e===void 0?void 0:e.call(a))!==null&&i!==void 0?i:[]).indexOf(r)||0},dataCount:()=>{var t,e,i;const n=s.direction==="horizontal"?s.scaleY:s.scaleX;return(i=((e=(t=n==null?void 0:n.domain)===null||t===void 0?void 0:t.call(n))!==null&&e!==void 0?e:[]).length)!==null&&i!==void 0?i:0}}}xu.mark=Un,xu.transformerConstructor=Yo;class tf extends xu{constructor(){super(...arguments),this.coordinate="cartesian",this._bandPosition=.5,this._scaleConfig={bandPosition:this._bandPosition},this._direction="vertical",this._sortDataByAxis=!1,this._getPositionXEncoder=()=>{var t;return(t=this._positionXEncoder)===null||t===void 0?void 0:t.bind(this)},this._setPositionXEncoder=t=>{this._positionXEncoder=t.bind(this)},this._getPositionYEncoder=()=>{var t;return(t=this._positionYEncoder)===null||t===void 0?void 0:t.bind(this)},this._setPositionYEncoder=t=>{this._positionYEncoder=t.bind(this)}}_buildScaleConfig(){this._scaleConfig={bandPosition:this._bandPosition}}get fieldX(){return this._fieldX}setFieldX(t){this._fieldX=Y(t)}get fieldY(){return this._fieldY}setFieldY(t){this._fieldY=Y(t)}get fieldZ(){return this._fieldZ}setFieldZ(t){this._fieldZ=t&&Y(t)}get fieldX2(){return this._fieldX2}setFieldX2(t){this._fieldX2=t}get fieldY2(){return this._fieldY2}setFieldY2(t){this._fieldY2=t}get direction(){return this._direction}get scaleX(){return this._scaleX}setScaleX(t){this._scaleX=t}get scaleY(){return this._scaleY}setScaleY(t){this._scaleY=t}get scaleZ(){return this._scaleZ}setScaleZ(t){this._scaleZ=t}getXAxisHelper(){return this._xAxisHelper}setXAxisHelper(t){this._xAxisHelper=t,this.onXAxisHelperUpdate()}getYAxisHelper(){return this._yAxisHelper}setYAxisHelper(t){this._yAxisHelper=t,this.onYAxisHelperUpdate()}getZAxisHelper(){return this._zAxisHelper}setZAxisHelper(t){this._zAxisHelper=t,this.onYAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}getStatisticFields(){const t=[];return[{axisHelper:this.getXAxisHelper(),fields:this._fieldX2?[...this._fieldX,this._fieldX2]:this._fieldX},{axisHelper:this.getYAxisHelper(),fields:this._fieldY2?[...this._fieldY,this._fieldY2]:this._fieldY},{axisHelper:this.getZAxisHelper(),fields:this._fieldZ}].forEach(e=>{e.axisHelper&&e.axisHelper.getScale&&e.fields&&e.fields.forEach(i=>{const n={key:i,operations:[]},r=e.axisHelper.getScale(0);he(r.type)?(n.operations=["max","min"],r.type==="log"&&(n.filter=a=>a>0)):n.operations=["values"],t.push(n)})}),this.getStack()&&t.push({key:this.getStackValueField(),operations:["allValid"]}),t}getGroupFields(){return this.direction==="vertical"?this._fieldX:this._fieldY}getStackGroupFields(){return this.getGroupFields()}getStackValue(){var t,e;const i=(t=this.direction==="horizontal"?this.getXAxisHelper():this.getYAxisHelper())===null||t===void 0?void 0:t.getAxisId();return(e=this._spec.stackValue)!==null&&e!==void 0?e:\`\${xt}_series_\${this.type}_\${i}\`}getStackValueField(){return this.direction==="horizontal"?Y(this._spec.xField)[0]:Y(this._spec.yField)[0]}setValueFieldToStack(){this.direction==="horizontal"?(this.setFieldX(Xi),this.setFieldX2(Xs)):(this.setFieldY(Xi),this.setFieldY2(Xs))}setValueFieldToPercent(){this.direction==="horizontal"?(this.setFieldX(Ks),this.setFieldX2(Fn)):(this.setFieldY(Ks),this.setFieldY2(Fn))}setValueFieldToStackOffsetSilhouette(){this.direction==="horizontal"?(this.setFieldX(Qc),this.setFieldX2(Jc)):(this.setFieldY(Qc),this.setFieldY2(Jc))}onXAxisHelperUpdate(){this.onMarkPositionUpdate()}onYAxisHelperUpdate(){this.onMarkPositionUpdate()}onZAxisHelperUpdate(){this.onMarkPositionUpdate()}setAttrFromSpec(){var t,e;super.setAttrFromSpec(),this.setFieldX(this._spec.xField),this.setFieldY(this._spec.yField),this.setFieldZ(this._spec.zField),this._specXField=Y(this._spec.xField),this._specYField=Y(this._spec.yField),R(this._spec.direction)&&(this._direction=this._spec.direction),this.setFieldX2((t=this._spec)===null||t===void 0?void 0:t.x2Field),this.setFieldY2((e=this._spec)===null||e===void 0?void 0:e.y2Field),this.getStack()&&this.setValueFieldToStack(),this.getPercent()&&this.setValueFieldToPercent(),this.getStackOffsetSilhouette()&&this.setValueFieldToStackOffsetSilhouette(),R(this._spec.sortDataByAxis)&&(this._sortDataByAxis=this._spec.sortDataByAxis===!0)}dataToPosition(t,e){return t?e&&!this.isDatumInViewData(t)?null:{x:this.dataToPositionX(t),y:this.dataToPositionY(t)}:null}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToX=this.valueToPositionX.bind(this),this._markAttributeContext.valueToY=this.valueToPositionY.bind(this),this._markAttributeContext.xBandwidth=(t=0)=>{var e,i,n;return(n=(i=(e=this.getXAxisHelper()).getBandwidth)===null||i===void 0?void 0:i.call(e,t))!==null&&n!==void 0?n:0},this._markAttributeContext.yBandwidth=(t=0)=>{var e,i,n;return(n=(i=(e=this.getYAxisHelper()).getBandwidth)===null||i===void 0?void 0:i.call(e,t))!==null&&n!==void 0?n:0},this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this)}valueToPosition(t,e){return{x:this.valueToPositionX(t),y:this.valueToPositionY(e)}}_axisPosition(t,e,i){return this._scaleConfig.datum=i,t.isContinuous?t.valueToPosition(e,this._scaleConfig):t.dataToPosition(Y(e),this._scaleConfig)}valueToPositionX(t,e){return this._axisPosition(this._xAxisHelper,t,e)}valueToPositionY(t,e){return this._axisPosition(this._yAxisHelper,t,e)}_dataToPosition(t,e,i,n,r,a){const o=r();if(o)return o(t);if(!e)return a(h=>Number.NaN),Number.NaN;const l=(e.getFields?e.getFields():i).slice(0,n);return l&&l.length!==0?(e.isContinuous?a(h=>(this._scaleConfig.datum=h,e.valueToPosition(this.getDatumPositionValue(h,l[0]),this._scaleConfig))):a(h=>(this._scaleConfig.datum=h,e.dataToPosition(Y(this.getDatumPositionValues(h,l)),this._scaleConfig))),r()(t)):(a(h=>null),null)}dataToPositionX(t){return this._dataToPosition(t,this._xAxisHelper,this.fieldX,void 0,this._getPositionXEncoder,this._setPositionXEncoder)}dataToPositionY(t){return this._dataToPosition(t,this._yAxisHelper,this.fieldY,void 0,this._getPositionYEncoder,this._setPositionYEncoder)}dataToPositionZ(t){if(!this._zAxisHelper)return Number.NaN;const{dataToPosition:e}=this._zAxisHelper;return e(this.getDatumPositionValues(t,this._fieldZ),{bandPosition:this._bandPosition})}dataToPositionX1(t){return this._xAxisHelper?this._fieldX2&&this._fieldX2 in t?this.valueToPositionX(this.getDatumPositionValues(t,this._fieldX2)):this.valueToPositionX(0):Number.NaN}dataToPositionY1(t){return this._yAxisHelper?this._fieldY2&&this._fieldY2 in t?this.valueToPositionY(this.getDatumPositionValues(t,this._fieldY2)):this.valueToPositionY(0):Number.NaN}positionToData(t){return t?{x:this.positionToDataX(t.x),y:this.positionToDataY(t.y)}:null}positionToDataX(t){return this._scaleX?this._scaleX.invert(t):null}positionToDataY(t){return this._scaleY?this._scaleY.invert(t):null}getRegionRectLeft(){if(!this._xAxisHelper)return Number.NaN;const{getScale:t}=this._xAxisHelper;return t(0).range()[0]}getRegionRectRight(){if(!this._xAxisHelper)return Number.NaN;const{getScale:t}=this._xAxisHelper;return t(0).range()[1]}afterInitMark(){super.afterInitMark(),this.setFieldX(this._fieldX),this.setFieldY(this._fieldY),this._buildScaleConfig()}getDimensionField(){return this._direction==="horizontal"?this._specYField:this._specXField}getDimensionContinuousField(){return this._direction==="horizontal"?[this.fieldY[0],this.fieldY2]:[this.fieldX[0],this.fieldX2]}getMeasureField(){return this._direction==="horizontal"?this._specXField:this._specYField}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(pt.scaleDomainUpdate,{filter:t=>{var e;return t.model.id===((e=this._direction==="horizontal"?this._yAxisHelper:this._xAxisHelper)===null||e===void 0?void 0:e.getAxisId())}},()=>{this._sortDataInAxisDomain()})}_sortDataInAxisDomain(){var t,e,i;!((e=(t=this.getViewData())===null||t===void 0?void 0:t.latestData)===null||e===void 0)&&e.length&&(BS(this._direction==="horizontal"?this._yAxisHelper:this._xAxisHelper,this._direction==="horizontal"?this._fieldY[0]:this._fieldX[0],this.getViewData().latestData),(i=this._data)===null||i===void 0||i.updateData(!0))}getInvalidCheckFields(){const t=[];return this._xAxisHelper&&this._xAxisHelper.isContinuous&&this._xAxisHelper.getAxisType()!==st.geoCoordinate&&(this._xAxisHelper.getFields?this._xAxisHelper.getFields():this._specXField).forEach(e=>{t.push(e)}),this._yAxisHelper&&this._yAxisHelper.isContinuous&&this._yAxisHelper.getAxisType()!==st.geoCoordinate&&(this._yAxisHelper.getFields?this._yAxisHelper.getFields():this._specYField).forEach(e=>{t.push(e)}),t}reInit(t){this._positionXEncoder&&(this._positionXEncoder=null),this._positionYEncoder&&(this._positionYEncoder=null),super.reInit(t)}}const RS="monotone",Gn={point:{name:"point",type:"symbol"},line:{name:"line",type:"line"}};class IS{addSamplingCompile(){if(this._spec.sampling){const{width:t,height:e}=this._region.getLayoutRect(),i=[],n=this._fieldY,r=this._fieldX;i.push({type:"sampling",size:this._direction==="horizontal"?e:t,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?r[0]:n[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(i)}}addOverlapCompile(){var t;if(this._spec.markOverlap){const e=[];e.push({type:"markoverlap",direction:this._direction==="horizontal"&&this.coordinate==="cartesian"?2:1,delta:this._spec.pointDis,deltaMul:this._spec.pointDisMul,groupBy:this._seriesField}),(t=this._symbolMark)===null||t===void 0||t.getProduct().transform(e)}}reCompileSampling(){this._spec.sampling&&this.compile()}initLineMark(t,e){var i,n;return this._lineMark=this._createMark(Gn.line,{groupKey:this._seriesField,isSeriesMark:e==null||e,stateSort:(i=this._spec.line)===null||i===void 0?void 0:i.stateSort},Object.assign(Object.assign({},t),{setCustomizedShape:(n=this._spec.line)===null||n===void 0?void 0:n.customShape,morphElementKey:this.getDimensionField()[0]})),this._lineMark}initLineMarkStyle(t,e){var i,n;const r=this._lineMark;if(r){if(this.setMarkStyle(r,{stroke:this.getColorAttribute()},"normal",St.Series),this._invalidType!=="zero"&&this.setMarkStyle(r,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",St.Series),this.event.on(pt.viewDataStatisticsUpdate,{filter:a=>a.model===this},()=>{this.encodeDefined(r,"defined")}),this.coordinate==="polar")this.setMarkStyle(r,{lineJoin:"bevel",curveType:"linear",closePath:!0},"normal",St.Series);else{const a=e??((n=(i=this.getSpec().line)===null||i===void 0?void 0:i.style)===null||n===void 0?void 0:n.curveType),o=a===RS?t==="horizontal"?"monotoneY":"monotoneX":a;this.setMarkStyle(r,{curveType:o},"normal",St.Built_In)}this.setMarkStyle(r,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",St.Series)}return r}_getEventElement(t,e=!1){let i=[];return t.dimensionInfo.some(n=>(n.data.some(r=>r.series===this&&(i=r.datum,!0)),!i.length)),i}_dimensionTrigger(t){const e=this._getEventElement(t);switch(t.action){case"enter":this._symbolActiveMark.getDataView().parse(e),this._symbolActiveMark.getData().updateData(!1);break;case"leave":this._symbolActiveMark.getDataView().parse([]),this._symbolActiveMark.getData().updateData(!1)}}initSymbolMark(t,e){const i=this._spec.point||{};if(i.visible!==!1&&(this._symbolMark=this._createMark(Gn.point,{groupKey:this._seriesField,isSeriesMark:!!e,stateSort:i.stateSort},Object.assign(Object.assign({},t),{setCustomizedShape:i.customShape,morph:Zg(this._spec,Gn.point.name),morphElementKey:this.getDimensionField()[0]}))),this._spec.activePoint===!0){const n=new _e(this._option.dataSet,{name:\`\${xt}_series_\${this.id}_active_point\`});n.parse([]),this._symbolActiveMark=this._createMark({name:\`active_point_\${this.id}\`,type:"symbol"},{groupKey:this._seriesField,isSeriesMark:!1,dataView:n,parent:this._region.getInteractionMark(),stateSort:i.stateSort},{setCustomizedShape:i.customShape,morph:!1}),this._symbolActiveMark.setVisible(!1)}return this._symbolMark}initSymbolMarkStyle(){const t=this._symbolMark;if(!t)return this._initSymbolActiveMarkAlone(),t;if(this._initSymbolMark(t),this._symbolActiveMark&&this._symbolMark.stateStyle.dimension_hover){this._symbolActiveMark.setVisible(!0),this.event.on(Bs.dimensionHover,this._dimensionTrigger.bind(this));for(const e in this._symbolMark.stateStyle){this._symbolActiveMark.stateStyle[e]={};for(const i in this._symbolMark.stateStyle[e])i!=="visible"&&(this._symbolActiveMark.stateStyle[e][i]={style:null,level:St.Series,referer:t})}this._symbolActiveMark.state.changeStateInfo({stateValue:Vt.STATE_DIMENSION_HOVER,filter:()=>!0})}return t}_initSymbolMark(t){t&&(this.setMarkStyle(t,{fill:this.getColorAttribute()},"normal",St.Series),this.setMarkStyle(t,{x:e=>this._invalidType==="zero"||this._getInvalidDefined(e)?this.dataToPositionX(e):Number.NaN,y:e=>this._invalidType==="zero"||this._getInvalidDefined(e)?this.dataToPositionY(e):Number.NaN,z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",St.Series))}_initSymbolActiveMarkAlone(){var t,e;const i=this._symbolActiveMark;i&&(this._initSymbolMark(i),i&&(!((e=(t=this._spec[Gn.point.name])===null||t===void 0?void 0:t.state)===null||e===void 0)&&e.dimension_hover)&&(i.setVisible(!0),this.event.on(Bs.dimensionHover,this._dimensionTrigger.bind(this)),this.initMarkStyleWithSpec(i,mt({},this._spec[Gn.point.name],{visible:!0})),this._symbolActiveMark.state.changeStateInfo({stateValue:Vt.STATE_DIMENSION_HOVER,filter:()=>!0})))}initLabelMarkStyle(t){var e;t&&(((e=t.getTarget())===null||e===void 0?void 0:e.type)!=="symbol"&&t.setRule("line-data"),this.setMarkStyle(t,{fill:this.getColorAttribute(),text:i=>i[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null}),this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)},"normal",St.Series),this.event.on(pt.viewDataStatisticsUpdate,{filter:i=>i.model===this},()=>{this.encodeDefined(t,"visible")}))}initLineLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>{var i;return(i=e[this.getSeriesField()])!==null&&i!==void 0?i:this.getSeriesKeys()[0]},z:this._fieldZ?this.dataToPositionZ.bind(this):null})}encodeDefined(t,e){var i,n,r,a;if(!t)return;const o=this._isFieldAllValid();if(this._invalidType==="zero"||o){if(((n=(i=t.stateStyle.normal)===null||i===void 0?void 0:i[e])===null||n===void 0?void 0:n.style)===!0)return;this.setMarkStyle(t,{[e]:!0},"normal",St.Series)}else{if(((a=(r=t.stateStyle.normal)===null||r===void 0?void 0:r[e])===null||a===void 0?void 0:a.style)!==!0)return;this.setMarkStyle(t,{[e]:this._getInvalidDefined.bind(this)},"normal",St.Series)}t.getProduct()&&t.compileEncode()}_isFieldAllValid(){const t=this.getViewDataStatistics(),e=this.getStackValueField();return!!(t&&t.latestData&&e)&&t.latestData[e]&&t.latestData[e].allValid}}const dO=Object.assign(Object.assign({},Un),Gn);class OS extends Rs{setStyle(t,e="normal",i=0,n=this.stateStyle){if(I(t))return;n[e]===void 0&&(n[e]={});const r=this._getIgnoreAttributes(),a=["strokeWidth","lineWidth","lineDash","strokeDash","lineJoin","stroke","strokeOpacity","opacity","fill","fillOpacity","texture","texturePadding","textureSize","textureColor"],o=this.isUserLevel(i);let l=!1;Object.keys(t).forEach(h=>{const c=t[h];if(I(c)||r.includes(h))return;o&&a.includes(h)&&(Gp(c==null?void 0:c.type)||c!=null&&c.scale||U(c))&&(l=!0);const u=this._filterAttribute(h,c,e,i,o,n);this.setAttribute(h,u,e,i,n)}),l&&this.setMarkConfig({enableSegments:!0})}}class $o extends OS{constructor(){super(...arguments),this.type=$o.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:1})}_getIgnoreAttributes(){var t,e;return((t=this.model)===null||t===void 0?void 0:t.type)===te.radar&&((e=this.model)===null||e===void 0?void 0:e.coordinate)==="polar"?[]:["fill","fillOpacity"]}}$o.type="line";const PS=()=>{et.registerMark($o.type,$o),En(),mo(),nb(),ng(),V.registerGraphic(Z.line,Gd),kS()};class pO extends Rs{_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{size:1,symbolType:"circle",fill:void 0,lineWidth:0})}}class Xo extends pO{constructor(){super(...arguments),this.type=Xo.type}}Xo.type="symbol";const LS=()=>{et.registerMark(Xo.type,Xo),En(),yo(),ng(),V.registerGraphic(Z.symbol,gh)};class ef extends Yo{_transformLabelSpec(t){var e,i,n;((e=t.point)===null||e===void 0?void 0:e.visible)!==!1&&((n=(i=t.point)===null||i===void 0?void 0:i.style)===null||n===void 0?void 0:n.visible)!==!1?this._addMarkLabelSpec(t,"point"):this._addMarkLabelSpec(t,"line"),this._addMarkLabelSpec(t,"line","lineLabel","initLineLabelMarkStyle",void 0,!0)}}function DS(s){return s.length>=2&&q(s[0])&&q(Wt(s))&&Wt(s)>=s[0]}function FS(s,t){var e;const i=Wt(t)-t[0],n=Wt(t)*t[0]<0;let r=t[0]<=0?0-t[0]:0,a=Wt(t)>0?Wt(t)-0:0;i===0?t[0]<0?(r=1,a=0):t[0]>0&&(r=0,a=1):(r/=i,a/=i);const o=s.getDomainSpec(),l={total:i,negative:r,positive:a,includeZero:n,domain:t,extendable_min:!q(o.min),extendable_max:!q(o.max)};if(!((e=s._break)===null||e===void 0)&&e.scope){const h=t.findIndex(d=>d>=0);let c,u;h===0?(c=s._break.scope[h],u=[t[0],t[1]],l.positive=1,l.negative=0):Wt(t)<=0?(l.positive=0,l.negative=1,u=[t[t.length-2],t[t.length-1]]):(c=s._break.scope[h-1],u=[t[h-1],t[h]],l.negative=c[0]+(0-u[0])/(u[1]-u[0])*(c[1]-c[0]),l.positive=1-l.negative),l.break=!0,l.extendable_max=!1,l.extendable_min=!1,l.domain=u}return l}function jS(s,t){const{positive:e,negative:i,extendable_min:n,extendable_max:r,domain:a}=s,{positive:o,negative:l,extendable_min:h,extendable_max:c,domain:u}=t;if(o>0){if(!h)return!1;let d=i/e;r&&(d=i/Math.max(e,o),a[1]=-a[0]/d),u[0]=-u[1]*d}else if(l>0){if(!c)return!1;let d=e/i;n&&(d=e/Math.max(i,i),a[0]=-a[1]/d),u[1]=-u[0]*d}return!0}function NS(s,t){const{extendable_min:e,extendable_max:i,domain:n}=s,{positive:r,negative:a,domain:o}=t;return(r!==0||a!==0)&&!(r>0&&!i)&&!(a>0&&!e)&&(n[0]=o[0],n[1]=o[1],!0)}function zS(s,t){const{positive:e,negative:i,extendable_max:n,domain:r}=s,{positive:a,negative:o,extendable_min:l,domain:h}=t;if(n&&l){const c=Math.max(i,o)/Math.max(e,a);r[1]=-r[0]/c,h[0]=-h[1]*c}else if(l){const c=i/e;h[0]=-h[1]*c}else{if(!n)return!1;{const c=o/a;r[1]=-r[0]/c}}return!0}function HS(s,t){const{extendable_min:e,domain:i}=s,{extendable_max:n,domain:r}=t;return!(!e||!n)&&(i[0]=-i[1],r[1]=-r[0],!0)}const gO=(s,t)=>{var e,i,n,r,a;if(!s)return s;const o=(e=t==null?void 0:t.targetAxis)===null||e===void 0?void 0:e.call(t);if(!o)return s;const l=(i=t==null?void 0:t.currentAxis)===null||i===void 0?void 0:i.call(t);if(!l)return s;const h=(n=l.getTickData())===null||n===void 0?void 0:n.getDataView();if(!h||!h.transformsArr.find(y=>y.type.includes("ticks")))return s;const c=l.getScale();if(!c)return s;const u=(a=(r=o.getTickData())===null||r===void 0?void 0:r.getDataView())===null||a===void 0?void 0:a.latestData;if(!(u!=null&&u.length))return s;const d=o.getScale();if(!d)return s;const p=d.domain(),g=Wt(p)-p[0];if(g===0)return s;const f=c.domain(),m=Wt(f)-f[0];if(g===0)return s;const v=u.map(y=>function(_,b,x,S,A){const w=rA(_,b),k=Math.max(ir(x),ir(w));return A*(Math.round(w*10**k)/Math.round(x*10**k))+S}(y.value,p[0],g,f[0],m));return Rn(v)};class sf{constructor(t){this.id=Tn(),this.name=\`\${t}_\${this.id}\`}onAdd(t){this.service=t}release(){this.service=null}}class Ko extends sf{constructor(){super(Ko.type),this.type="AxisSyncPlugin"}_checkEnableSync(t){if(!he(t.getScale().type))return!1;const e=t.getSpec().sync;return!!(e!=null&&e.axisId)&&e}_getTargetAxis(t,e){const i=t.getOption().getChart().getComponentByUserId(e.axisId);return i!=null&&i.type.startsWith("cartesianAxis")?i:null}onInit(t,e){const i=this._checkEnableSync(e);if(!i||!i.zeroAlign)return;const n=this._getTargetAxis(e,i);n&&e.event.on(pt.scaleDomainUpdate,{filter:({model:r})=>r.id===e.id||r.id===n.id},()=>{((r,a)=>{var o,l,h,c,u,d;const p=r.getScale(),g=a.getScale();if(!p||!g)return;const f=(h=(l=(o=r).getDomainAfterSpec)===null||l===void 0?void 0:l.call(o))!==null&&h!==void 0?h:[0,1],m=(d=(u=(c=a).getDomainAfterSpec)===null||u===void 0?void 0:u.call(c))!==null&&d!==void 0?d:[0,1];if(!(f&&m&&DS(f)&&DS(m)))return;const v=FS(r,f),y=FS(a,m);if(v.break===!0&&y.break===!0)return;const{positive:_,negative:b,extendable_min:x,extendable_max:S,includeZero:A}=v,{positive:w,negative:k,extendable_min:T,extendable_max:C,includeZero:M}=y;if(_===0&&b===0){if(!NS(v,y))return}else if(w===0&&k===0){if(!NS(y,v))return}else if(A||M)if(A&&!M){if(!jS(v,y))return}else if(M&&!A){if(!jS(y,v))return}else{if(b===k)return;if(b>k){if(!zS(v,y))return}else if(!zS(y,v))return}else{if(b===0&&w===0){if(!HS(v,y))return}else if(k===0&&_===0&&!HS(y,v))return;if(b===0&&k===0)if(f[0]===0&&m[0]>0){if(!T)return;m[0]=0}else{if(!(m[0]===0&&f[0]>0)||!x)return;f[0]=0}if(_===0&&w===0)if(f[1]===0&&m[1]>0){if(!C)return;m[1]=0}else{if(!(m[1]===0&&f[1]>0)||!S)return;f[1]=0}}p.domain(f),g.domain(m)})(n,e)})}onDidCompile(t,e){const i=this._checkEnableSync(e);if(!i)return;const n=this._getTargetAxis(e,i);if(n&&i.tickAlign){Se(e.getOption().dataSet,"tickAlign",gO);const r={targetAxis:()=>n,currentAxis:()=>e};e.addTransformToTickData({type:"tickAlign",options:r,level:Number.MAX_SAFE_INTEGER},!1)}}}Ko.pluginType="component",Ko.type="AxisSyncPlugin";const fO={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}};function VS(s,t){var e,i,n,r,a,o;return{min:(n=(e=s.min)!==null&&e!==void 0?e:(i=s.range)===null||i===void 0?void 0:i.min)!==null&&n!==void 0?n:t==null?void 0:t.min,max:(o=(r=s.max)!==null&&r!==void 0?r:(a=s.range)===null||a===void 0?void 0:a.max)!==null&&o!==void 0?o:t==null?void 0:t.max}}function WS(s){const t=s==null?void 0:s.orient;return t==="top"||t==="bottom"||t==="left"||t==="right"||t==="z"}const qo=(s,t,e)=>{var i;const n=(i=t==="band"?hi("axisBand",e):["linear","log","symlog"].includes(t)?hi("axisLinear",e):{})!==null&&i!==void 0?i:{},r=Yt(s)?hi("axisX",e):Ms(s)?hi("axisY",e):hi("axisZ",e);return mt({},hi("axis",e),n,r)},nf=(s,t,e)=>{var i;const n=(i=t==="band"?hi("axisBand",e):t==="linear"?hi("axisLinear",e):{})!==null&&i!==void 0?i:{},r=hi(s==="angle"?"axisAngle":"axisRadius",e);return mt({},hi("axis",e),n,r)},US=s=>s==="band"||s==="ordinal"||s==="point";function Zo(s,t){return{id:s,label:s,value:t,rawValue:s}}function on(s,t,e){return e||!s||s.getAxisId()===t.getAxisId()}class mO extends hS{constructor(t){super(),this.component=t}releaseAll(){super.releaseAll(),this.component=null}}function vO(s,t,e,i){switch(s){case st.cartesianBandAxis:return qo(ea(e,["z"]),"band",t);case st.cartesianLinearAxis:return qo(ea(e,["z"]),"linear",t);case st.cartesianLogAxis:return qo(ea(e,["z"]),"log",t);case st.cartesianSymlogAxis:return qo(ea(e,["z"]),"symlog",t);case st.cartesianAxis:case st.cartesianTimeAxis:return qo(ea(e),void 0,t);case st.polarBandAxis:return nf(e.orient,"band",t);case st.polarLinearAxis:return nf(e.orient,"linear",t);case st.polarAxis:return nf(e.orient,void 0,t);case st.cartesianCrosshair:return((n,r)=>{var a,o;const l=Y((a=r.axes)!==null&&a!==void 0?a:[]),{bandField:h,linearField:c,xField:u,yField:d}=(o=hi(st.crosshair,n))!==null&&o!==void 0?o:{},p=l.find(v=>Yt(v.orient));let g;g=R(p)?mt({},US(p.type)?h:c,u):u;const f=l.find(v=>Ms(v.orient));let m;return m=R(f)?mt({},fi(f.type)?h:c,d):d,{xField:g,yField:m}})(t,i);case st.polarCrosshair:return((n,r)=>{var a,o;const l=Y((a=r.axes)!==null&&a!==void 0?a:[]),{bandField:h,linearField:c,categoryField:u,valueField:d}=(o=hi(st.crosshair,n))!==null&&o!==void 0?o:{},p=l.find(v=>v.orient==="angle");let g;g=R(p)?mt({},US(p.type)?h:c,u):u;const f=l.find(v=>v.orient==="radius");let m;return m=R(f)?mt({},fi(f.type)?h:c,d):d,{categoryField:g,valueField:m}})(t,i);case st.colorLegend:case st.sizeLegend:case st.discreteLegend:case st.dataZoom:case st.scrollBar:return yO(e,hi(s,t));default:return hi(s,t)}}const yO=(s,t)=>{var e;const i=t[function(r){return r==="top"||r==="bottom"?"horizontal":"vertical"}((e=s.orient)!==null&&e!==void 0?e:t.orient)],n=mt({},t,i);return delete n.horizontal,delete n.vertical,n};class Su extends fu{getTheme(t,e){return vO(this.type,this._option.getTheme(),t,e)}_mergeThemeToSpec(t,e){const{spec:i,theme:n}=super._mergeThemeToSpec(t,e);return this._adjustPadding(i),{spec:i,theme:n}}_adjustPadding(t){const{padding:e,noOuterPadding:i=!0,orient:n}=t;i&&e&&n&&(t.padding=Object.assign(Object.assign({},Ro(e)),{[n]:0}))}}class aa extends iS{static createComponent(t,e){const{spec:i}=t,n=ne(t,["spec"]);return new this(i,Object.assign(Object.assign({},e),n))}getRegions(){return this._regions}created(){super.created(),this.initLayout(),this.pluginService=new mO(this)}constructor(t,e){super(t,e),this.name="component",this.modelType="component",this.transformerConstructor=Su,this._delegateEvent=(i,n,r,a=null,o=null)=>{var l,h;n instanceof $l||this.event.emit(r,{model:this,node:i,event:n,item:a,datum:o,source:It.chart,chart:(h=(l=this._option)===null||l===void 0?void 0:l.globalInstance)===null||h===void 0?void 0:h.getChart()},"model")},this._option.animation&&(this.animate=new eS({getCompiler:e.getCompiler}))}initLayout(){var t;super.initLayout(),this._regions=(t=this._regions)!==null&&t!==void 0?t:this._option.getRegionsInIndex(),this._layout&&(this._layout.layoutBindRegionID=this._regions.map(e=>e==null?void 0:e.id))}changeRegions(t){throw new Error("Method not implemented.")}_getNeedClearVRenderComponents(){throw new Error("Method not implemented.")}onRender(t){throw new Error("Method not implemented.")}getVRenderComponents(){return this._getNeedClearVRenderComponents()}callPlugin(t){this.pluginService&&this.pluginService.getAll().forEach(e=>t(e))}getContainer(){var t;return this._container||(this._container=(t=this._option)===null||t===void 0?void 0:t.globalInstance.getStage().find(e=>e.name==="root",!0)),this._container}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake||(i.reMake=["seriesId","seriesIndex","regionId","regionIndex"].some(n=>!Xt(e==null?void 0:e[n],t[n]))),(e==null?void 0:e.visible)!==t.visible&&(i.reCompile=!0),i}release(){var t;super.release(),this.clear(),(t=this.pluginService)===null||t===void 0||t.releaseAll(),this.pluginService=null}clear(){var t;const e=this._getNeedClearVRenderComponents();e&&e.length&&e.forEach(i=>{var n;i&&((n=this.getContainer())===null||n===void 0||n.removeChild(i),i=null)}),this._container=null,(t=this.pluginService)===null||t===void 0||t.clearAll()}compile(){this.compileMarks(),this.reAppendComponents()}compileMarks(t){this.getMarks().forEach(e=>{e.compile({group:t,context:{model:this}})})}reAppendComponents(){const t=this._getNeedClearVRenderComponents();t&&t.length&&t.forEach(e=>{var i;e&&!e.stage&&((i=this.getContainer())===null||i===void 0||i.appendChild(e))})}getBoundsInRect(t,e){return{x1:0,x2:0,y1:0,y2:0}}getDatum(t){}}aa.transformerConstructor=Su;class rf extends Rs{constructor(t,e){super(t,e),this.type="component",this._componentType=e.componentType,this._mode=e.mode}_initProduct(t){const e=this.getVGrammarView(),i=this.getProductId();this._product=e.mark(Z.component,t??e.rootMark,{componentType:this._componentType,mode:this._mode}).id(i),this._compiledProductId=i}}rf.type="component";const GS=()=>{et.registerMark(rf.type,rf)},_O=s=>s;class YS extends aa{getOrient(){return this._orient}getScale(){return this._scale}getScales(){return this._scales}getTickData(t=0){return this._tickData[t]}get visible(){return this._visible}getInverse(){return this._inverse}getCoordinateType(){return this._coordinateType}constructor(t,e){var i;super(t,e),this.specKey="axes",this._scales=[],this._tickData=[],this._visible=!0,this._tick=void 0,this._visible=(i=t.visible)===null||i===void 0||i,this._coordinateType="none"}_getNeedClearVRenderComponents(){return[]}getVRenderComponents(){var t,e,i,n;return[(e=(t=this._axisMark)===null||t===void 0?void 0:t.getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem(),(n=(i=this._gridMark)===null||i===void 0?void 0:i.getProduct())===null||n===void 0?void 0:n.getGroupGraphicItem()].filter(R)}created(){var t,e,i,n,r,a,o,l,h,c,u,d,p,g,f,m,v,y;if(super.created(),this.setSeriesAndRegionsFromSpec(),this.initEvent(),this.initScales(),this.updateSeriesScale(),this._shouldComputeTickData()&&this._initData(),this._visible){const _=this._createMark({type:"component",name:\`axis-\${this.getOrient()}\`},{componentType:this.getOrient()==="angle"?"circleAxis":"axis",mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});if(this._axisMark=_,_.setMarkConfig({zIndex:this.layoutZIndex}),R(this._spec.id)&&_.setUserId(this._spec.id),_.setMarkConfig({interactive:(t=this._spec.interactive)!==null&&t!==void 0?t:this.getDefaultInteractive()}),this._marks.addMark(_),(e=this._spec.grid)===null||e===void 0?void 0:e.visible){const b=this._createMark({type:"component",name:\`axis-\${this.getOrient()}-grid\`},{componentType:this.getOrient()==="angle"?Fe.circleAxisGrid:Fe.lineAxisGrid,mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});b.setMarkConfig({zIndex:(o=(r=(n=(i=this._spec.grid)===null||i===void 0?void 0:i.style)===null||n===void 0?void 0:n.zIndex)!==null&&r!==void 0?r:(a=this._spec.grid)===null||a===void 0?void 0:a.zIndex)!==null&&o!==void 0?o:Qe.Axis_Grid,interactive:!1}),this._marks.addMark(b),this._gridMark=b}if(this._option.animation!==!1&&vt(this._option.getChart().getSpec(),"animation")!==!1&&this._spec.animation===!0){const b=cs((l=et.getAnimationInKey("axis"))===null||l===void 0?void 0:l(),{appear:(c=(h=this._spec.animationAppear)!==null&&h!==void 0?h:vt(this._option.getChart().getSpec(),"animationAppear.axis"))!==null&&c!==void 0?c:vt(this._option.getChart().getSpec(),"animationAppear"),disappear:(d=(u=this._spec.animationDisappear)!==null&&u!==void 0?u:vt(this._option.getChart().getSpec(),"animationDisappear.axis"))!==null&&d!==void 0?d:vt(this._option.getChart().getSpec(),"animationDisappear"),enter:(g=(p=this._spec.animationEnter)!==null&&p!==void 0?p:vt(this._option.getChart().getSpec(),"animationEnter.axis"))!==null&&g!==void 0?g:vt(this._option.getChart().getSpec(),"animationEnter"),exit:(m=(f=this._spec.animationExit)!==null&&f!==void 0?f:vt(this._option.getChart().getSpec(),"animationExit.axis"))!==null&&m!==void 0?m:vt(this._option.getChart().getSpec(),"animationExit"),update:(y=(v=this._spec.animationUpdate)!==null&&v!==void 0?v:vt(this._option.getChart().getSpec(),"animationUpdate.axis"))!==null&&y!==void 0?y:vt(this._option.getChart().getSpec(),"animationUpdate")});b.enter&&(b.update[0].customParameters={enter:b.enter[0]}),this._marks.forEach(x=>x.setAnimationConfig(b))}}}_shouldComputeTickData(){return this.getVisible()||this._spec.forceInitTick}_initData(){const t=this._initTickDataSet(this._tickTransformOption());t.target.addListener("change",this._forceLayout.bind(this)),this._tickData=[new Vn(this._option,t)]}collectData(t,e){const i=[];return qe(this._regions,n=>{var r;let a=this.collectSeriesField(t,n);if(a=W(a)?he(this._scale.type)?a:[a[0]]:[a],t||(this._dataFieldText=n.getFieldAlias(a[0])),a){const o=n.getViewData();if(e)a.forEach(l=>{i.push(n.getRawDataStatisticsByField(l,!1))});else if(o&&o.latestData&&o.latestData.length){const l=(r=n.getViewDataStatistics)===null||r===void 0?void 0:r.call(n),h=this.type===st.cartesianLinearAxis&&this._spec.breaks&&this._spec.breaks.length;a.forEach(c=>{var u;!((u=l==null?void 0:l.latestData)===null||u===void 0)&&u[c]&&(h?i.push(Object.assign(Object.assign({},l.latestData[c]),{values:o.latestData.map(d=>d[c])})):i.push(l.latestData[c]))})}}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),i}isSeriesDataEnable(){let t=!0;return qe(this._regions,e=>{var i;W((i=e.getViewDataStatistics())===null||i===void 0?void 0:i.latestData)&&(t=!1)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t}setSeriesAndRegionsFromSpec(){const{seriesId:t,seriesIndex:e,regionId:i,regionIndex:n}=this._spec;R(t)&&(this._seriesUserId=Y(t)),R(i)&&(this._regionUserId=Y(i)),R(e)&&(this._seriesIndex=Y(e)),R(n)&&(this._regionIndex=Y(n)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionIndex),this.layout.layoutBindRegionID=this._regions.map(r=>r.id)}getBindSeriesFilter(){return{userId:this._seriesUserId,specIndex:this._seriesIndex}}initEvent(){this.event.on(pt.scaleUpdate,{filter:({model:e})=>(e==null?void 0:e.id)===this.id},this.effect.scaleUpdate.bind(this));const t=function(e,i){const n=[];for(const r of e)for(const a of r.getSeries(i))n.push(a);return n}(this._regions,{userId:this._seriesUserId,specIndex:this._seriesIndex}).map(e=>e.getViewDataStatistics()).filter(e=>!!e);t.length>1?this._option.dataSet.multipleDataViewAddListener(t,"change",()=>{this.updateScaleDomain()}):t.length===1&&t[0].target.addListener("change",()=>{this.updateScaleDomain()}),qe(this._regions,e=>{e.event.on(pt.rawDataUpdate,{filter:({model:i})=>(i==null?void 0:i.id)===e.id},()=>{this._clearRawDomain()})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}updateScaleDomain(){}_clearRawDomain(){}onLayoutEnd(t){this.updateScaleRange(),this.event.emit(pt.scaleUpdate,{model:this,value:"range"}),super.onLayoutEnd(t)}computeData(t){t!=="force"||this._tickData&&this._tickData.length?!this._tickData||!this._tickData.length||t!=="force"&&Xt(this._scale.range(),[0,1])||this._tickData.forEach(e=>{e.getDataView().reRunAllTransform(),e.updateData()}):qe(this._regions,e=>{var i;(i=e.getViewData())===null||i===void 0||i.reRunAllTransform()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}initScales(){this._scales=[this._scale];const t=[];if(qe(this._regions,e=>{const i=e.getGroups();i&&t.push(i)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t.length!==0){const e=Ge(t.map(i=>i.fields.length));for(let i=1;i<e;i++){const n=this._scale.clone();this._scales.push(n)}}}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake?i:(i.reRender=!0,(e==null?void 0:e.type)!==(t==null?void 0:t.type)||(e==null?void 0:e.visible)!==(t==null?void 0:t.visible)?(i.reMake=!0,i):(i.reMake=["grid","subGrid","tick","subTick","label","domainLine","title"].some(n=>{var r,a;return((r=e==null?void 0:e[n])===null||r===void 0?void 0:r.visible)!==((a=t==null?void 0:t[n])===null||a===void 0?void 0:a.visible)}),i))}_getAxisAttributes(){const t=this._spec,e={orient:this.getOrient(),select:this._option.disableTriggerEvent!==!0&&t.select,hover:this._option.disableTriggerEvent!==!0&&t.hover};var i;if(t.domainLine&&t.domainLine.visible?e.line=((i=qs(i=t.domainLine)).startSymbol=qs(i.startSymbol),i.endSymbol=qs(i.endSymbol),i):e.line={visible:!1},t.label&&t.label.visible){const n=ju(t.label,["style","formatMethod","state"]);e.label=n,t.label.style&&(e.label.style=U(t.label.style)?(r,a,o,l)=>{var h;const c=t.label.style(r.rawValue,a,r,o,l);return Ht(mt({},(h=this._theme.label)===null||h===void 0?void 0:h.style,c))}:Ht(t.label.style)),(t.label.formatMethod||t.label.formatter)&&(e.label.formatMethod=this._getLabelFormatMethod()),t.label.state&&(e.label.state=function(r){if(ht(r))return null;const a={};return Object.keys(r).forEach(o=>{U(r[o])?a[o]=(l,h,c,u)=>Ht(r[o](l.rawValue,h,l,c,u)):ht(r[o])||(a[o]=Ht(r[o]))}),a}(t.label.state))}else e.label={visible:!1};if(t.tick&&t.tick.visible?(e.tick={visible:t.tick.visible,length:t.tick.tickSize,inside:t.tick.inside,alignWithLabel:t.tick.alignWithLabel,dataFilter:t.tick.dataFilter},t.tick.style&&(e.tick.style=U(t.tick.style)?(n,r,a,o)=>{var l;const h=t.tick.style(n,r,a,o);return Ht(mt({},(l=this._theme.tick)===null||l===void 0?void 0:l.style,h))}:Ht(t.tick.style)),t.tick.state&&(e.tick.state=Zr(t.tick.state))):e.tick={visible:!1},t.subTick&&t.subTick.visible?(e.subTick={visible:t.subTick.visible,length:t.subTick.tickSize,inside:t.subTick.inside,count:t.subTick.tickCount},t.subTick.style&&(e.subTick.style=U(t.subTick.style)?(n,r,a,o)=>{var l;const h=t.subTick.style(n,r,a,o);return Ht(mt({},(l=this._theme.subTick)===null||l===void 0?void 0:l.style,h))}:Ht(t.subTick.style)),t.subTick.state&&(e.subTick.state=Zr(t.subTick.state))):e.subTick={visible:!1},t.title&&t.title.visible){const n=t.title,{autoRotate:r,angle:a,style:o={},background:l,state:h,shape:c}=n,u=ne(n,["autoRotate","angle","style","background","state","shape"]);let d,p=a;t.orient!=="left"&&t.orient!=="right"||r&&I(p)&&(p=t.orient==="left"?-90:90,d=fO[t.orient]),e.title=Object.assign(Object.assign({},u),{autoRotate:!1,angle:p?ei(p):null,textStyle:mt({},d,Ht(o)),pickable:o.pickable!==!1,childrenPickable:o.pickable!==!1,state:{}}),c&&c.visible?(e.title.shape=Object.assign(Object.assign({},c),{style:Ht(c.style)}),c.state&&(e.title.state.shape=Zr(c.state))):e.title.shape={visible:!1},l&&l.visible?(e.title.background=Object.assign(Object.assign({},l),{style:Ht(l.style)}),l.state&&(e.title.state.background=Zr(l.state))):e.title.background={visible:!1},h&&(e.title.state.text=Zr(h))}else e.title={visible:!1};return t.background&&t.background.visible?(e.panel={visible:!0},t.background.style&&(e.panel.style=Ht(t.background.style)),t.background.state&&(e.panel.state=Zr(t.background.state))):e.panel={visible:!1},e}_getGridAttributes(){const t=this._spec;return{alternateColor:t.grid.alternateColor,alignWithLabel:t.grid.alignWithLabel,style:U(t.grid.style)?()=>(e,i)=>{var n,r;const a=t.grid.style((n=e.datum)===null||n===void 0?void 0:n.rawValue,i,e.datum);return Ht(mt({},(r=this._theme.grid)===null||r===void 0?void 0:r.style,a))}:Ht(t.grid.style),subGrid:t.subGrid.visible===!1?{visible:!1}:{type:"line",visible:t.subGrid.visible,alternateColor:t.subGrid.alternateColor,style:Ht(t.subGrid.style)}}}_getLabelFormatMethod(){const{formatMethod:t,formatter:e}=this._spec.label,{formatFunc:i}=ra(t,e);return i?(n,r,a)=>i(r.rawValue,r,e):null}_initTickDataSet(t,e=0){uu(this._option.dataSet,"scale",_O);const i=this.registerTicksTransform();return new _e(this._option.dataSet,{name:\`\${this.type}_\${this.id}_ticks_\${e}\`}).parse(this._scales[e],{type:"scale"}).transform({type:i,options:t},!1)}_tickTransformOption(){const t=this._tick||{},e=this._spec.label||{},{tickCount:i,forceTickCount:n,tickStep:r,tickMode:a}=t,{style:o,formatMethod:l,minGap:h}=e;return{sampling:this._spec.sampling!==!1,tickCount:i,forceTickCount:n,tickStep:r,tickMode:a,axisOrientType:this._orient,coordinateType:this._coordinateType,labelStyle:o,labelFormatter:l,labelGap:h}}addTransformToTickData(t,e){this._tickData.forEach(i=>{var n;(n=i==null?void 0:i.getDataView())===null||n===void 0||n.transform(t,e)})}dataToPosition(t){return this._scale.scale(t)}getDatum(t){var e,i;return t&&t.name===xe.label?t.data:this._axisMark?(i=(e=this._axisMark.getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem())===null||i===void 0?void 0:i.attribute.items:void 0}}YS.specKey="axes";const $S=()=>{GS(),et.registerAnimation("axis",()=>({appear:{custom:Nk},update:{custom:iB},exit:{custom:zk}}))},bO=[Ko];class Au extends YS{getOrient(){return this._orient}getDefaultInteractive(){return!0}set autoIndentOnce(t){this._autoIndentOnce=t}getScales(){return this._scales}constructor(t,e){super(t,e),this.type=st.cartesianAxis,this.name=st.cartesianAxis,this._defaultBandPosition=.5,this._defaultBandInnerPadding=.1,this._defaultBandOuterPadding=.3,this.layoutType="region-relative",this.layoutZIndex=Qe.Axis,this.layoutLevel=Wo.Axis,this._orient="left",this._autoIndentOnce=!1,this._hasAutoIndent=!1,this._scales=[],this._tick=void 0,this._layoutCache={width:0,height:0,_lastComputeOutBounds:{x1:0,x2:0,y1:0,y2:0}},this._innerOffset={top:0,bottom:0,left:0,right:0},this.effect={scaleUpdate:i=>{this.computeData(i==null?void 0:i.value),qe(this._regions,n=>{const r=this.getOrient();Yt(r)?on(n.getXAxisHelper(),this.axisHelper(),R(this._seriesUserId)||R(this._seriesIndex))&&n.setXAxisHelper(this.axisHelper()):Ms(r)?on(n.getYAxisHelper(),this.axisHelper(),R(this._seriesUserId)||R(this._seriesIndex))&&n.setYAxisHelper(this.axisHelper()):Es(r)&&on(n.getZAxisHelper(),this.axisHelper(),R(this._seriesUserId)||R(this._seriesIndex))&&n.setZAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._transformLayoutPosition=i=>{let{x:n,y:r}=i;return q(n)&&(n+=+(this._orient==="left")*this.getLayoutRect().width),q(r)&&(r+=+(this._orient==="top")*this.getLayoutRect().height),{x:n,y:r}},this._transformLayoutRect=i=>{if(!this._visible)return i;const n=this._latestBounds.clone().translate(-this.getLayoutStartPoint().x,-this.getLayoutStartPoint().y);switch(this._layout.layoutOrient){case"left":this._layout.layoutRectLevelMap.width===0&&(i.width=n.x1<0?-n.x1:0);break;case"right":this._layout.layoutRectLevelMap.width===0&&(i.width=n.x2>0?n.x2:0);break;case"top":this._layout.layoutRectLevelMap.height===0&&(i.height=n.y1<0?-n.y1:0);break;case"bottom":this._layout.layoutRectLevelMap.height===0&&(i.height=n.y2>0?n.y2:0)}return i.width=Math.ceil(i.width),i.height=Math.ceil(i.height),this._layout.setRectInSpec(this._layoutCacheProcessing(i))},this._updateAxisLayout=()=>{const i=this.getLayoutStartPoint(),n=this._getUpdateAttribute(!1),{grid:r}=n,a=ne(n,["grid"]),o=this._axisMark.getProduct(),l=mt({x:i.x,y:i.y},this._axisStyle,a);o.encode(l),this._gridMark&&this._gridMark.getProduct().encode(mt({x:i.x,y:i.y},this._getGridAttributes(),r))},this._fixAxisOnZero=()=>{const{onZero:i,visible:n}=this._spec.domainLine;if(this.visible&&i&&n!==!1){const{onZeroAxisId:r,onZeroAxisIndex:a}=this._spec.domainLine,o=this._option.getComponentsByKey("axes"),l=Yt(this.getOrient()),h=u=>{var d;return(l?!Yt(u.getOrient()):Yt(u.getOrient()))&&he(u.getScale().type)&&(u.getTickData()?(d=u.getTickData().getLatestData())===null||d===void 0?void 0:d.find(p=>p.value===0):u.getScale().domain()[0]<=0&&Wt(u.getScale().domain())>=0)},c=o.filter(u=>h(u));if(c.length){let u;if(R(r))u=c.find(d=>d.id===r);else if(R(a)){const d=o[a];h(d)&&(u=d)}else u=c[0];if(u){const d=this._axisMark.getProduct(),p=u.valueToPosition(0);l?d.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dy:this._orient==="bottom"?-((u.getInverse()?u.getScale().range()[1]:u.getScale().range()[0])-p):p})}):d.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dx:this._orient==="left"?p:-((u.getInverse()?u.getScale().range()[0]:u.getScale().range()[1])-p)})})}}}},this._orient=ea(t,["z"]),Es(this._orient)&&(this.layoutType="absolute"),this._dataSet=e.dataSet,this._coordinateType="cartesian"}static getSpecInfo(t){const e=t[this.specKey];if(!e)return null;const i=t.direction==="horizontal";if(!W(e)){if(!WS(e))return null;const{axisType:l,componentName:h}=Nx(e,i);return e.type=l,[{spec:e,specPath:[this.specKey],specInfoPath:["component",this.specKey,0],type:h}]}const n=e.filter(l=>l.orient==="z")[0];let r=!0;if(n){const l=e.filter(c=>c.orient==="bottom")[0],h=e.filter(c=>Ms(c.orient))[0];r=e.length===3&&l&&h}let a=e.map((l,h)=>({spec:l,index:h}));r||(a=a.filter(({spec:l})=>l.orient!=="z"));const o=[];return a.forEach(({spec:l,index:h})=>{if(!WS(l))return;const{axisType:c,componentName:u}=Nx(l,i);l.type=c,o.push({spec:l,specPath:[this.specKey,h],specInfoPath:["component",this.specKey,h],type:u})}),o}static createComponent(t,e){const{spec:i}=t,n=ne(t,["spec"]),r=et.getComponentInKey(n.type);return r?new r(i,Object.assign(Object.assign({},e),n)):(e.onError(\`Component \${n.type} not found\`),null)}initLayout(){super.initLayout(),this._layout.autoIndent=this._spec.autoIndent!==!1,this._layout.layoutOrient=this._orient}setLayout3dBox(t){this.layout3dBox=t}getNewScaleRange(){const{width:t,height:e}=this.getLayoutRect(),{left:i,right:n,top:r,bottom:a}=this._innerOffset;let o=[];return Yt(this.getOrient())?q(t)&&(o=this._inverse?[t-n,i]:[i,t-n]):Es(this.getOrient())?q(t)&&(o=this._inverse?[t-n,i]:[i,t-n],this._scale.range(o)):q(e)&&(o=this._inverse?[r,e-a]:[e-a,r]),o}updateScaleRange(){let t=!1;const e=this.getNewScaleRange(),i=this._scale.range();return e.length===i.length&&e.every((n,r)=>n===i[r])?t=!1:(t=!0,this._scale.range(e)),t}init(t){var e;super.init(t),(e=this.pluginService)===null||e===void 0||e.load(bO.map(i=>new i)),this.callPlugin(i=>{this.pluginService&&i.onInit&&i.onInit(this.pluginService,this)})}setAttrFromSpec(){var t;if(super.setAttrFromSpec(),this.visible){Yt(this.getOrient())?$t(this._spec.maxHeight)&&(this._spec.maxHeight="30%"):$t(this._spec.maxWidth)&&(this._spec.maxWidth="30%");const i=this._getAxisAttributes();i.label.formatMethod=this._getLabelFormatMethod(),i.verticalFactor=this.getOrient()==="top"||this.getOrient()==="right"?-1:1,this._axisStyle=i}this._tick=this._spec.tick;const e=(t=this._option.getChart())===null||t===void 0?void 0:t.getSpec();this._inverse=function(i,n){let r=i.inverse;return n&&!Yt(i.orient)&&(r=!R(i.inverse)||!i.inverse),r}(this._spec,(e==null?void 0:e.direction)==="horizontal")}onLayoutStart(t,e,i){if(super.onLayoutStart(t,e,i),!Es(this.getOrient())&&this._spec.innerOffset){const n=this._spec;Ms(this.getOrient())?["top","bottom"].forEach(r=>{this._innerOffset[r]=Je(n.innerOffset[r],e.height,e)}):["left","right"].forEach(r=>{this._innerOffset[r]=Je(n.innerOffset[r],e.width,e)})}}getSeriesStatisticsField(t){let e;return e=Yt(this.getOrient())?t.fieldX:Es(this.getOrient())?t.fieldZ:t.fieldY,he(this._scale.type)?e:[e[0]]}_tickTransformOption(){var t,e,i,n;return Object.assign(Object.assign({},super._tickTransformOption()),{noDecimals:(t=this._tick)===null||t===void 0?void 0:t.noDecimals,labelLastVisible:(e=this._spec.label)===null||e===void 0?void 0:e.lastVisible,labelFirstVisible:(i=this._spec.label)===null||i===void 0?void 0:i.firstVisible,labelFlush:(n=this._spec.label)===null||n===void 0?void 0:n.flush})}axisHelper(){return{isContinuous:he(this._scale.type),dataToPosition:this.dataToPosition.bind(this),getScale:(t=0)=>this._scales[t],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse===!0,getSpec:()=>this._spec}}afterCompile(){var t;const e=(t=this._axisMark)===null||t===void 0?void 0:t.getProduct();e&&e.addEventListener(at.AFTER_ELEMENT_ENCODE,()=>{if(this._isLayout===!1&&(Yt(this.getOrient())?this.callPlugin(i=>{this.pluginService&&i.onDidLayoutHorizontal&&i.onDidLayoutHorizontal(this.pluginService,this)}):this.callPlugin(i=>{this.pluginService&&i.onDidLayoutVertical&&i.onDidLayoutVertical(this.pluginService,this)}),this._unitText)){const{x:i,y:n}=this.getLayoutStartPoint(),r=Yt(this._orient)?{x:Ge(this._scale.range())+i,y:n}:{x:i,y:ji(this._scale.range())+n};this._unitText.setAttributes(r)}}),this.callPlugin(i=>{this.pluginService&&i.onDidCompile&&i.onDidCompile(this.pluginService,this)})}onRender(t){}changeRegions(t){}update(t){}resize(t){}collectScale(){const t=[];return qe(this._regions,e=>{t.push(this.getOrient()==="left"||this.getOrient()==="right"?e.scaleY:e.scaleX)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t}collectSeriesField(t,e){var i,n;let r;return r=t>0?(n=(i=e.getGroups())===null||i===void 0?void 0:i.fields)===null||n===void 0?void 0:n[t]:Yt(this.getOrient())?e.getSpec().x2Field?[...e.fieldX,e.fieldX2]:e.fieldX:Es(this.getOrient())?e.fieldZ:e.getSpec().y2Field?[...e.fieldY,e.fieldY2]:e.fieldY,r}updateSeriesScale(){const t=this.getOrient();qe(this._regions,e=>{Yt(t)?on(e.getXAxisHelper(),this.axisHelper(),R(this._seriesUserId)||R(this._seriesIndex))&&(e.setScaleX(this._scale),e.setXAxisHelper(this.axisHelper())):Ms(t)?on(e.getYAxisHelper(),this.axisHelper(),R(this._seriesUserId)||R(this._seriesIndex))&&(e.setScaleY(this._scale),e.setYAxisHelper(this.axisHelper())):Es(t)&&on(e.getZAxisHelper(),this.axisHelper(),R(this._seriesUserId)||R(this._seriesIndex))&&(e.setScaleZ(this._scale),e.setZAxisHelper(this.axisHelper()))},{userId:this._seriesUserId,specIndex:this._seriesIndex})}getBoundsInRect(t){var e;let i={x1:0,y1:0,x2:0,y2:0};if(!this._visible)return i;this._verticalLimitSize=Yt(this.getOrient())?t.height:t.width,this.setLayoutRect(t),!this.updateScaleRange()&&W((e=this.getTickData())===null||e===void 0?void 0:e.getLatestData())||this.computeData("range");const n={skipLayout:!1},r=Yt(this.getOrient());this.pluginService&&(r?this.callPlugin(o=>{o.onWillLayoutHorizontal&&o.onWillLayoutHorizontal(this.pluginService,n,this)}):this.callPlugin(o=>{o.onWillLayoutVertical&&o.onWillLayoutVertical(this.pluginService,n,this)}));const a=this._axisMark.getProduct();{const o=this._getUpdateAttribute(!0),l=a.getGroupGraphicItem(),h=mt(Object.assign({},this.getLayoutStartPoint()),this._axisStyle,o,{line:{visible:!1}});let c=l.getBoundsWithoutRender(h);c.empty()&&(c=new es().set(h.x,h.y,h.x,h.y)),this._latestBounds=c,i=this._appendAxisUnit(c,r)}return i}positionToData(t,e){const i=Yt(this.getOrient());e&&(t-=i?this.getLayoutStartPoint().x:this.getLayoutStartPoint().y),this._innerOffset&&(t=i?ui(t,this._innerOffset.left,this.getLayoutRect().width-this._innerOffset.right):ui(t,this._innerOffset.top,this.getLayoutRect().height-this._innerOffset.bottom));const n=this._scale.range();return(t-n[0])*(t-Wt(n))>0?null:this._scale.invert(t)}_getTitleLimit(t){var e,i,n,r,a;const o=this._spec.title;if(o.visible&&I((e=o.style)===null||e===void 0?void 0:e.maxLineWidth)){const l=(a=(n=(i=this._axisStyle.title)===null||i===void 0?void 0:i.angle)!==null&&n!==void 0?n:(r=o.style)===null||r===void 0?void 0:r.angle)!==null&&a!==void 0?a:0;if(t){const u=this.getLayoutRect().width,d=Math.abs(Math.cos(l));return d<1e-6?1/0:u/d}const h=this.getLayoutRect().height,c=Math.abs(Math.sin(l));return c<1e-6?1/0:h/c}return null}_getUpdateAttribute(t){var e;let i=0,n=0;if(!t){const m=this.getRegions();let{x:v,y}=m[0].getLayoutStartPoint(),_=v+m[0].getLayoutRect().width,b=y+m[0].getLayoutRect().height;for(let x=1;x<m.length;x++){const S=m[x],{x:A,y:w}=S.getLayoutStartPoint(),{width:k,height:T}=S.getLayoutRect();v=Math.min(v,A),_=Math.max(_,k+A),y=Math.min(y,w),b=Math.max(b,T+w)}i=Math.abs(b-y),n=Math.abs(_-v)}const{width:r,height:a}=this.getLayoutRect(),o=Yt(this._orient),l=Ms(this._orient),h=Es(this._orient),c=this.layout3dBox?this.layout3dBox.length:0;let u={x:0,y:0},d=i,p=r;o?u={x:r,y:0}:l?(u={x:0,y:a},d=n,p=a):h&&(u={x:c,y:0});const g=this.getLabelItems(p),f={start:{x:0,y:0},end:u,title:{text:this._spec.title.text||this._dataFieldText,maxWidth:this._getTitleLimit(o)},items:g};if(t||(f.grid={type:"line",start:{x:0,y:0},end:u,items:g[0],verticalFactor:this._axisStyle.verticalFactor,depth:c,length:d}),h){const m=(e=this.directionStr)!==null&&e!==void 0?e:"r2l",v=this.layout3dBox?this.layout3dBox.width:0;let y=[0,0],_=-Math.PI/2,b=0;m==="l2r"&&(b=this.layout3dBox.length,y=[0,0,0],_=Math.PI/2),f.z=b,f.alpha=_,f.anchor3d=y,t||(f.grid.depth=v)}else{let m=o?this.layout.minHeight:this.layout.minWidth;(o&&this._layout.layoutRectLevelMap.height===9||l&&this._layout.layoutRectLevelMap.width===9)&&(m=this._verticalLimitSize),f.verticalLimitSize=this._verticalLimitSize,f.verticalMinSize=m,f.label={overflowLimitLength:this._getLabelOverflowLimit(o)}}return f}getLabelItems(t){var e;const i=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();return i&&i.length?[i.map(n=>{const r=this._getNormalizedValue([n.value],t);return Zo(n.value,r)}).filter(n=>{const{value:r,rawValue:a}=n,o=this._scale.domain();return this.getSpec().type==="log"?r>=0&&r<=1:he(this._scale.type)?a>=o[0]&&a<=Wt(o):o.includes(a)})]:[]}initEvent(){super.initEvent(),this.visible&&(this.event.on(pt.layoutEnd,this._updateAxisLayout),this.event.on(pt.layoutEnd,this._fixAxisOnZero),this.event.on(pt.layoutRectUpdate,()=>{this._clearLayoutCache()}))}_getNormalizedValue(t,e){return e===0?0:this.dataToPosition(t)/e}_layoutCacheProcessing(t){return["width","height"].forEach(e=>{t[e]<this._layoutCache[e]?t[e]=this._layoutCache[e]:this._layoutCache[e]=t[e]}),this._autoIndentOnce&&this._hasAutoIndent?["x1","x2","y1","y2"].forEach(e=>{this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]}):(this._hasAutoIndent=!0,["x1","x2","y1","y2"].forEach(e=>{this.layout.getLastComputeOutBounds()[e]<this._layoutCache._lastComputeOutBounds[e]?this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]:this._layoutCache._lastComputeOutBounds[e]=this.layout.getLastComputeOutBounds()[e]})),t}_clearLayoutCache(){this._hasAutoIndent=!1,this._layoutCache.width=0,this._layoutCache.height=0,this._layoutCache._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0}}onDataUpdate(){this._clearLayoutCache()}_appendAxisUnit(t,e){var i;if(this._spec.unit&&this._spec.unit.visible){const{text:n,style:r}=this._spec.unit;let a,o;const{x:l,y:h}=this.getLayoutStartPoint();e?(a={x:Ge(this._scale.range())+l,y:h},o={textAlign:"left",textBaseline:"middle"}):(a={x:l,y:ji(this._scale.range())+h},o={textAlign:this._orient==="left"?"left":"right",textBaseline:"bottom"}),o=Object.assign(Object.assign(Object.assign({},o),r),{x:a.x,y:a.y,text:n}),this._unitText?this._unitText.setAttributes(o):(this._unitText=Ka(o),this._unitText.name="axis-unit",(i=this.getContainer())===null||i===void 0||i.add(this._unitText));const c=this._unitText.AABBBounds;e?(t.x2+=c.x2>t.x2?c.x2-t.x2:0,t.y2+=c.y2>t.y2?c.y2-t.y2:0):(t.x1+=c.x1<t.x1?c.x1-t.x1:0,t.y1+=c.y1<t.y1?c.y1-t.y1:0)}return t}_getNeedClearVRenderComponents(){return this._unitText?[this._unitText]:[]}_getLabelOverflowLimit(t){var e,i;if(t&&((e=this._spec.label)===null||e===void 0?void 0:e.visible)!==!1&&((i=this._spec.label)===null||i===void 0?void 0:i.autoLimit)===!0){const n=this._option.getComponentsByKey("axes"),r=this.getRegions(),a=n.filter(u=>{const d=u.getOrient();return(d==="left"||d==="right")&&u.getRegions().some(p=>r.includes(p))});let o=0,l=0;const h=this.getLayoutStartPoint().x,c=h+this.getLayoutRect().width;return a.forEach(u=>{const d=u.getLayoutStartPoint().x;if(u.getOrient()==="left"&&d===h){const p=u.getLayoutRect().width;o=Math.max(o,p)}else if(d===c){const p=u.getLayoutRect().width;l=Math.max(l,p)}}),{left:o,right:l}}}}Au.type=st.cartesianAxis,Au.specKey="axes";const xO=(s,t,e)=>e.reduce((i,n,r)=>(i.push([n,e.length===r+1?t:e[r+1]]),i),[[s,e[0]]]);function SO(s,t){const e=s[0],i=s[s.length-1],n=t.filter(r=>r>e&&r<i);return n.length===0?[[e,i]]:xO(e,i,n)}const XS=(s,t)=>s-t,AO=(s,t)=>{const e=[{count:0,sub:[],max:t[0],min:t[0]}];let i=0,n=0;for(;i<t.length;)s[n]<=t[i]?(e[i].count+=1,e[i].sub.push(s[n]),n+=1):(i+=1,e[i]={count:0,sub:[],max:t[i],min:t[i]});e.forEach(a=>{a.count&&(a.min=Math.min.apply(null,a.sub))});const r=s.slice(n);return e[i]={count:r.length,sub:r,min:t[t.length-1],max:Math.max.apply(null,r)},e};function kO(s,t,e="count"){const i=AO(s,t),n=e==="count"?s.length:i.reduce((l,h,c)=>h.count>0?l+h.max-h.min:l,0),r=[];let a=0,o=0;return i.forEach((l,h)=>{if(n===0)r.push([0,h/i.length-1]);else{const c=e==="count"?l.count:l.max-l.min,u=r[o-1]?r[o-1][1]:0,d=h===i.length-1?1:Math.min((a+c)/n,1);(u!==d||u!==0&&u!==1)&&(o+=1,r.push([u,d]),a+=c)}}),r}const wO=Math.sqrt(50),TO=Math.sqrt(10),CO=Math.sqrt(2);class af{constructor(){this._extend={},this.niceLabelFormatter=null}setExtraAttrFromSpec(){R(this._spec.nice)&&(this._nice=this._spec.nice),R(this._spec.zero)&&(this._zero=this._spec.zero),this._expand=this._spec.expand,this._domain=VS(this._spec)}transformScaleDomain(){this.setScaleNice()}setLinearScaleNice(){var t;if(!this._nice)return!1;let e=5;const i=this._spec.tick||{};if(q(i.forceTickCount))e=i.forceTickCount;else if(U(i.tickCount)){const a=this._scale.range();let o=Math.abs(Wt(a)-a[0]);o===1&&this._option&&(o=Yt(this._orient)?this._option.getChartViewRect().width:this._option.getChartViewRect().height),e=i.tickCount({axisLength:o,labelStyle:this._spec.label&&this._spec.label.style})}else e=q(i.tickCount)?i.tickCount:5;this._spec.niceType==="accurateFirst"&&(e=Math.max(5,e));const{min:n,max:r}=(t=this._domain)!==null&&t!==void 0?t:{};return I(n)&&I(r)&&I(this._softMaxValue)&&I(this._softMinValue)?this._scale.nice(e):(R(n)||R(this._softMinValue))&&I(r)&&I(this._softMaxValue)?this._scale.niceMax(e):!(!I(n)||!I(this._softMinValue)||!R(r)&&!R(this._softMaxValue))&&this._scale.niceMin(e)}setLogScaleNice(){var t;if(!this._nice)return!1;const{min:e,max:i}=(t=this._domain)!==null&&t!==void 0?t:{};return I(e)&&I(i)&&I(this._softMaxValue)&&I(this._softMinValue)?this._scale.nice():(R(e)||R(this._softMinValue))&&I(i)&&I(this._softMaxValue)?this._scale.niceMax():!(!I(e)||!I(this._softMinValue)||!R(i)&&!R(this._softMaxValue))&&this._scale.niceMin()}setScaleNice(){return this._spec.type==="log"?this.setLogScaleNice():this.setLinearScaleNice()}dataToPosition(t,e){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){let e=[];if(t.length){const i=this._spec.breaks&&this._spec.breaks.length;let n,r,a=[];if(t.forEach(o=>{const{min:l,max:h}=o;n=n===void 0?l:Math.min(n,l),r=r===void 0?h:Math.max(r,h),i&&(a=a.concat(o.values))}),i){const o=[],l=[],h=I(this._domain.max)?r:this._domain.max;for(let c=0;c<this._spec.breaks.length;c++){const{range:u}=this._spec.breaks[c];u[0]<=u[1]&&u[1]<=h&&(o.push(u),l.push(this._spec.breaks[c]))}if(o.sort((c,u)=>c[0]-u[0]),o.length){const{domain:c,scope:u}=function(d,p,g){return d.sort(XS),p.sort(XS),{domain:SO(d,p),scope:kO(d,p,g)}}(a,gp(o),this._spec.breaks[0].scopeType);e=gp(c),this._break={domain:c,scope:u,breakDomains:o,breaks:l}}else e=[n,r]}else e=[n,r]}else e[0]=0,e[1]=0;return this.setSoftDomainMinMax(e),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this._expand)return;let e=t[0],i=Wt(t);e===i&&(i===0?i=1:i>0?e=0:i<0&&(i=0)),R(this._expand.min)&&(t[0]=e-(i-e)*this._expand.min),R(this._expand.max)&&(t[t.length-1]=i+(i-e)*this._expand.max)}niceDomain(t){const{min:e,max:i}=VS(this._spec);if(R(e)||R(i)||this._spec.type!=="linear")return t;if(Math.abs(ji(t)-Ge(t))<=1e-12){let n=t[0];const r=n>=0?1:-1;if(n=Math.abs(n),n<1)t[0]=0,t[t.length-1]=1;else{let a=n/5;const o=Math.floor(Math.log(a)/Math.LN10),l=a/Math.pow(10,o);a=(l>=wO?10:l>=TO?5:l>=CO?2:1)*Math.pow(10,o),t[0]=0,t[t.length-1]=10*a}r<0&&(t.reverse(),t[0]*=-1,t[t.length-1]*=-1)}return t}includeZero(t){this._zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(Wt(t),0))}setExtendDomain(t,e){if(e===void 0)return void delete this._extend[t];this._extend[t]=e;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this.event.emit(pt.scaleUpdate,{model:this,value:"domain"})}extendDomain(t){let e;const i=t.length-1,n=t[0]-t[i]>0,r=n?i:0,a=n?0:i;for(const o in this._extend)e=this._extend[o],e>t[a]&&(t[a]=e),e<t[r]&&(t[r]=e)}getDomainSpec(){return this._domain}setDomainMinMax(t){if(!this._domain)return;const{min:e,max:i}=this._domain;R(e)&&(t[0]=e),R(i)&&(t[t.length-1]=i)}setSoftDomainMinMax(t){const{softMin:e,softMax:i}=this._spec;if(R(e)){let n=U(e)?e(t):e;I(n)&&(n=t[0]),n<=t[0]&&(t[0]=n,this._softMinValue=n)}if(R(i)){let n=U(i)?i(t):i;I(n)&&(n=Wt(t)),n>=Wt(t)&&(t[t.length-1]=n),this._softMaxValue=n}}setZero(t){this._zero!==t&&(this._zero=t,this.updateScaleDomain())}updateScaleDomain(){if(!this.isSeriesDataEnable())return;const t=this.collectData(),e=this.computeLinearDomain(t);this.updateScaleDomainByModel(e)}updateScaleDomainByModel(t){t=t??this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this._updateNiceLabelFormatter(t),this._domainAfterSpec=this._scale.domain(),this.event.emit(pt.scaleDomainUpdate,{model:this}),this.event.emit(pt.scaleUpdate,{model:this,value:"domain"})}getDomainAfterSpec(){return this._domainAfterSpec}_updateNiceLabelFormatter(t){const e=Math.abs(Wt(t)-t[0]),i=Math.max(-Math.floor(Math.log10(e)),0)+2,n=Math.pow(10,i);this.niceLabelFormatter=r=>q(+r)?Math.round(+r*n)/n:r}}class ln extends Au{constructor(){super(...arguments),this.type=st.cartesianLinearAxis,this._zero=!0,this._nice=!0,this._extend={},this._scale=new wo}setAttrFromSpec(){var t,e;super.setAttrFromSpec(),this.setExtraAttrFromSpec();const i=(e=(t=this._tickData)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.getDataView().transformsArr.find(n=>n.type===this.registerTicksTransform());i&&(i.options=this._tickTransformOption())}initScales(){var t,e;super.initScales();const i=[0,1];R((t=this._domain)===null||t===void 0?void 0:t.min)&&(i[0]=this._domain.min),R((e=this._domain)===null||e===void 0?void 0:e.max)&&(i[1]=this._domain.max),this._scale.domain(i)}_tickTransformOption(){var t;return Object.assign(Object.assign({},super._tickTransformOption()),{breakData:!((t=this._spec.breaks)===null||t===void 0)&&t.length?()=>this._break:null})}_getUpdateAttribute(t){var e,i;const n=super._getUpdateAttribute(t);if(!Es(this._orient)&&(!((i=(e=this._break)===null||e===void 0?void 0:e.breaks)===null||i===void 0)&&i.length)){const{width:r,height:a}=this.getLayoutRect(),o=Yt(this._orient),l=o?r:a;n.breaks=this._break.breaks.map(h=>{const{range:c,breakSymbol:u,gap:d=6}=h,p=this.valueToPosition((c[0]+c[1])/2)/l;let g;g=Yr(d)?Number(d.substring(0,d.length-1))/100:d/l;const f=q(u==null?void 0:u.angle)?u.angle:o?60:15;return{range:[p-g/2,p+g/2],breakSymbol:Object.assign(Object.assign({visible:!0},u),{angle:f*Math.PI/180}),rawRange:c}})}return n}getNewScaleRange(){var t,e;let i=super.getNewScaleRange();return!((t=this._spec.breaks)===null||t===void 0)&&t.length&&(!((e=this._break)===null||e===void 0)&&e.scope)&&(i=gp(this._break.scope).map(n=>i[0]+(Wt(i)-i[0])*n)),i}computeDomain(t){return this.computeLinearDomain(t)}axisHelper(){const t=super.axisHelper();return t.setExtendDomain=this.setExtendDomain.bind(this),t.valueToPosition=this.valueToPosition.bind(this),t}registerTicksTransform(){const t=\`\${this.type}-ticks\`;return Se(this._option.dataSet,t,jc),t}}ln.type=st.cartesianLinearAxis,ln.specKey="axes",Ue(ln,af);const ku=()=>{Mx(),Rx(),$S(),et.registerComponent(ln.type,ln)};class Jo extends Au{constructor(){super(...arguments),this.type=st.cartesianBandAxis,this._scale=new ko}computeDomain(t){return this.computeBandDomain(t)}updateScaleRange(){const t=super.updateScaleRange();return this.updateGroupScaleRange(),t}initScales(){super.initScales(),this.calcScales(this._defaultBandInnerPadding,this._defaultBandOuterPadding)}axisHelper(){const t=(e=0)=>this._scales[e];return{isContinuous:!1,dataToPosition:this.dataToPosition.bind(this),getScale:t,getBandwidth:(e=0)=>t(e).bandwidth(),getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse,getSpec:()=>this._spec}}registerTicksTransform(){const t=\`\${this.type}-ticks\`;return Se(this._option.dataSet,t,dB),t}transformScaleDomain(){this.updateFixedWholeLength()}updateFixedWholeLength(){if(this._scale){const{bandSize:t,maxBandSize:e,minBandSize:i}=this._getOuterBandSizeFromSpec();if(t&&this._scale.bandwidth(t),e&&this._scale.maxBandwidth(e),i&&this._scale.minBandwidth(i),this._scale.isBandwidthFixed()&&this._spec.autoRegionSize&&(t||e)){const n=Xp(this._scale.domain().length,t??e,this._scale.paddingInner(),this._scale.paddingOuter());["bottom","top"].includes(this._orient)?this._regions.forEach(r=>r.setMaxWidth(n)):["left","right"].includes(this._orient)&&this._regions.forEach(r=>r.setMaxHeight(n))}}}_getOuterBandSizeFromSpec(){var t;let{bandSize:e,maxBandSize:i,minBandSize:n,bandSizeLevel:r=0}=this._spec;const{gap:a,extend:o=0}=(t=this._spec.bandSizeExtend)!==null&&t!==void 0?t:{};r=Math.min(r,this._scales.length-1);for(let l=r;l>0;l--){const h=this._scales[l],c=h.domain(),u=h.paddingInner(),d=h.paddingOuter(),p=g=>{const f=l===r?o:0;return I(a)||l<r?Xp(c.length,g,u,d)+f:(g+(Q(a)?g*(Number(a.substring(0,a.length-1))/100):a))*c.length/(this._scales[l-1].paddingInner()+1)+f};R(e)&&(e=p(e)),R(i)&&(i=p(i)),R(n)&&(n=p(n))}return{bandSize:e,maxBandSize:i,minBandSize:n}}}Jo.type=st.cartesianBandAxis,Jo.specKey="axes",Ue(Jo,class{constructor(){this._rawDomainIndex=[]}_initData(){var s;if(this._spec.showAllGroupLayers&&this._scales.length>1)for(let t=0;t<this._scales.length;t++){const e=((s=this._spec.layers)!==null&&s!==void 0?s:[])[this._scales.length-1-t]||{};if(e.visible!==!1&&e.tickCount!==0&&e.forceTickCount!==0){const i=this._initTickDataSet(Object.assign(Object.assign({},this._tickTransformOption()),e),t);i.target.addListener("change",this._forceLayout.bind(this));const n=new Vn(this._option,i);this._tickData.push(n),this._tickDataMap||(this._tickDataMap={}),this._tickDataMap[t]=n}}else{const t=this._initTickDataSet(this._tickTransformOption());t.target.addListener("change",this._forceLayout.bind(this));const e=new Vn(this._option,t);this._tickData=[e],this._tickDataMap={0:e}}}dataToPosition(s,t={}){var e,i;if(s.length===0||this._scales.length===0)return 0;const{position:n,bandScale:r}=this.getPosition(s);return n+r.bandwidth()*((i=(e=t.bandPosition)!==null&&e!==void 0?e:this._spec.bandPosition)!==null&&i!==void 0?i:this._defaultBandPosition)}valueToPosition(s){return this._scale.scale(s)}updateGroupScaleRange(){let s=this._scale;this._scales.forEach((t,e)=>{e>0&&(t.range([0,s.bandwidth()]),s=t)})}getPosition(s){let t=0,e=this._scale;if(this._scales.length===1||s.length===1)t=this.valueToPosition(s[0]);else{const i=Math.min(s.length,this._scales.length);for(let n=0;n<i;n++)t+=this._scales[n].scale(s[n]);e=this._scales[i-1]}return{position:t,bandScale:e}}calcScales(s,t){var e,i;const{bandPadding:n,paddingInner:r,paddingOuter:a}=this._spec,o=W(n),l=W(r),h=W(a);for(let c=0;c<this._scales.length;c++){const u=o?n[c]:n,d=l?r[c]:r,p=h?a[c]:a;this._scales[c].paddingInner((e=d??u)!==null&&e!==void 0?e:s,!0).paddingOuter((i=p??u)!==null&&i!==void 0?i:t,!0)}}computeBandDomain(s){if(!s.length)return[];if(s.length===1)return s[0].values;const t=new Set;for(let e=0;e<s.length;e++)for(let i=0;i<s[e].values.length;i++)t.add(s[e].values[i]);return Array.from(t)}updateScaleDomain(){var s;if(!this.isSeriesDataEnable())return;!(!((s=this._rawDomainIndex)===null||s===void 0)&&s.length)&&this._scales.length&&this._updateRawDomain();const t=this._spec.domain;for(let e=0;e<this._scales.length;e++)if(t&&t.length&&e===0)this._scales[e].domain(t);else{const i=this.collectData(e),n=this.computeBandDomain(i);this._scales[e].domain(n.sort((r,a)=>this._rawDomainIndex[e][r]-this._rawDomainIndex[e][a]))}this.transformScaleDomain(),this.event.emit(pt.scaleDomainUpdate,{model:this}),this.event.emit(pt.scaleUpdate,{model:this,value:"domain"})}getLabelItems(s){const t=[];let e=[];return this._scales.forEach((i,n)=>{var r;const a=this._tickDataMap[n],o=(r=a==null?void 0:a.getLatestData())===null||r===void 0?void 0:r.length,l=o?a.getLatestData().map(h=>h.value):i.domain();if(l&&l.length)if(e&&e.length){const h=[],c=[];e.forEach(u=>{l.forEach(d=>{const p=Y(u).concat(d);if(c.push(p),o){const g=Zo(d,this._getNormalizedValue(p,s));h.push(g)}})}),o&&t.push(h.filter(u=>u.value>=0&&u.value<=1)),e=c}else l.forEach(h=>{e.push(h)}),o&&t.push(a.getLatestData().map(h=>Zo(h.value,this._getNormalizedValue([h.value],s))).filter(h=>h.value>=0&&h.value<=1))}),t.reverse()}_updateRawDomain(){this._rawDomainIndex=[];const s=this._spec.domain;for(let t=0;t<this._scales.length;t++)if(s&&s.length&&t===0)this._scales[t].domain(s);else{const e=this.collectData(t,!0),i=this.computeBandDomain(e);this._rawDomainIndex[t]={},i.forEach((n,r)=>this._rawDomainIndex[t][n]=r)}}_clearRawDomain(){this._rawDomainIndex=[]}});const wu=()=>{Mx(),Rx(),$S(),et.registerComponent(Jo.type,Jo)};class KS extends ln{constructor(){super(...arguments),this.type=st.cartesianTimeAxis,this._zero=!1,this.effect={scaleUpdate:t=>{this.computeData(t==null?void 0:t.value),qe(this._regions,e=>{Yt(this.getOrient())?on(e.getXAxisHelper(),this.axisHelper(),R(this._seriesUserId)||R(this._seriesIndex))&&e.setXAxisHelper(this.axisHelper()):on(e.getYAxisHelper(),this.axisHelper(),R(this._seriesUserId)||R(this._seriesIndex))&&e.setYAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._tick=mt({},this._spec.tick,(t=this._spec.layers)===null||t===void 0?void 0:t[0])}_initData(){var t;if(super._initData(),(t=this._spec.layers)===null||t===void 0?void 0:t[1]){const e=new _e(this._option.dataSet,{name:\`\${this.type}_\${this.id}_layer_1_ticks\`}).parse(this._scale,{type:"scale"}).transform({type:\`\${this.type}-ticks\`,options:Object.assign(Object.assign({},this._tickTransformOption()),{tickCount:this._spec.layers[1].tickCount,forceTickCount:this._spec.layers[1].forceTickCount,tickStep:this._spec.layers[1].tickStep})},!1);this._layerTickData=new Vn(this._option,e)}}computeData(t){super.computeData(t),this._layerTickData&&(this._layerTickData.getDataView().reRunAllTransform(),this._layerTickData.updateData())}_getLabelFormatMethod(){var t,e,i,n,r,a,o,l;const h=ps.getInstance(),c=((e=(t=this._spec.layers)===null||t===void 0?void 0:t[1])===null||e===void 0?void 0:e.timeFormat)||"%Y%m%d",u=(((n=(i=this._spec.layers)===null||i===void 0?void 0:i[1])===null||n===void 0?void 0:n.timeFormatMode)||"local")==="local"?h.timeFormat:h.timeUTCFormat,d=((a=(r=this._spec.layers)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.timeFormat)||"%Y%m%d",p=(((l=(o=this._spec.layers)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.timeFormatMode)||"local")==="local"?h.timeFormat:h.timeUTCFormat;return(g,f,m,v,y)=>{var _;let b;return b=y===0?p(d,g):u(c,g),!((_=this._spec.label)===null||_===void 0)&&_.formatMethod?this._spec.label.formatMethod(b,f):b}}getLabelItems(t){var e,i;const n=[],r=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();r&&r.length&&n.push(r.map(o=>Zo(o.value,this._getNormalizedValue([o.value],t))));const a=(i=this._layerTickData)===null||i===void 0?void 0:i.getLatestData();return a&&a.length&&n.push(a.map(o=>Zo(o.value,this._getNormalizedValue([o.value],t)))),n}registerTicksTransform(){const t=\`\${this.type}-ticks\`;return Se(this._option.dataSet,t,jc),t}transformScaleDomain(){}}KS.type=st.cartesianTimeAxis,KS.specKey="axes";class of extends ln{constructor(){super(...arguments),this.type=st.cartesianLogAxis,this._zero=!1,this._scale=new Dc}initScales(){var t;super.initScales(),this._scale.base((t=this._spec.base)!==null&&t!==void 0?t:10),this._scale.clamp(!0,null,!1)}registerTicksTransform(){const t=\`\${this.type}-ticks\`;return Se(this._option.dataSet,t,jc),t}transformScaleDomain(){}}of.type=st.cartesianLogAxis,of.specKey="axes",Ue(of,af);class lf extends ln{constructor(){super(...arguments),this.type=st.cartesianSymlogAxis,this._zero=!1,this._scale=new Fc}initScales(){var t;super.initScales(),this._scale.constant((t=this._spec.constant)!==null&&t!==void 0?t:10)}registerTicksTransform(){const t=\`\${this.type}-ticks\`;return Se(this._option.dataSet,t,jc),t}transformScaleDomain(){}}lf.type=st.cartesianSymlogAxis,lf.specKey="axes",Ue(lf,af);class oa extends tf{constructor(){super(...arguments),this.type=te.line,this.transformerConstructor=ef,this._sortDataByAxis=!1}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}initMark(){var t;const e={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},i=(t=this._spec.seriesMark)!==null&&t!==void 0?t:"line";this.initLineMark(e,i==="line"),this.initSymbolMark(e,i==="point")}initTooltip(){super.initTooltip();const{group:t,mark:e}=this._tooltipHelper.activeTriggerSet;this._lineMark&&t.add(this._lineMark),this._symbolMark&&(e.add(this._symbolMark),t.add(this._symbolMark))}initMarkStyle(){this.initLineMarkStyle(this._direction),this.initSymbolMarkStyle()}initAnimation(){var t,e,i,n;const r={direction:this.direction},a=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;if(this._lineMark.setAnimationConfig(cs((i=et.getAnimationInKey("line"))===null||i===void 0?void 0:i(r,a),an("line",this._spec,this._markAttributeContext))),this._symbolMark){const o=Qg(this);this._symbolMark.setAnimationConfig(cs((n=et.getAnimationInKey("scaleInOut"))===null||n===void 0?void 0:n(),an("point",this._spec,this._markAttributeContext),o))}}onLayoutEnd(t){super.onLayoutEnd(t),this.reCompileSampling()}getSeriesStyle(t){var e;const i=((e=this._spec)===null||e===void 0?void 0:e.seriesMark)!=="point";return n=>{var r,a;return i&&n==="fill"&&(n="stroke"),(a=(r=this._seriesMark)===null||r===void 0?void 0:r.getAttribute(n,t))!==null&&a!==void 0?a:void 0}}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._lineMark,this._symbolMark]}}oa.type=te.line,oa.mark=dO,oa.transformerConstructor=ef,Ue(oa,IS);class MO{get dataList(){return this._dataArr}constructor(t){this._dataArr=[],this._dataSet=t}parseData(t){this._dataArr=[];const e=Y(t);for(let i=0;i<e.length;i++)this._dataArr.push(Ng(e[i],this._dataSet,this._dataArr))}updateData(t,e=!1,i=!0){const n=Y(t);return(!e||n.length===this._dataArr.length)&&(this._dataValueForEach(n,(r,a)=>{a.markRunning()}),this._dataValueForEach(n,(r,a)=>{zg(a,r,i)}),!0)}_dataValueForEach(t,e){t.forEach((i,n)=>{if(i instanceof _e)return;const r=this.getSeriesData(i.id,n);r&&e(i,r,n)})}getSeriesData(t,e){if(!this._dataArr.length)return null;if(typeof t=="string"){const i=this._dataArr.filter(n=>n.name===t);if(i[0])return i[0];os(\`no data matches dataId \${t}!\`)}if(typeof e=="number"){if(this._dataArr[e])return this._dataArr[e];os(\`no data matches dataIndex \${e}!\`)}return this._dataArr[0]}}class EO{constructor(t,e){this._scaleSpecMap=new Map,this._scaleMap=new Map,this._modelScaleSpecMap=new Map,this._markAttributeScaleMap=new Map,this._spec=null,this._chart=null,this.getStatisticalFields=i=>{const n=[];return this._scaleSpecMap.forEach((r,a)=>{uo(r.domain)&&r.domain.forEach(o=>{o.dataId===i&&o.fields.forEach(l=>{qr(n,[{key:l,operations:he(r.type)?["max","min"]:["values"]}])})})}),this._markAttributeScaleMap.forEach((r,a)=>{const o=this.getScale(a);r.forEach(l=>{this._getSeriesBySeriesId(l.seriesId).getRawData().name===i&&l.field&&qr(n,[{key:l.field,operations:he(o.type)?["max","min"]:["values"]}])})}),n},this._spec=t,this._chart=e,this._setAttrFromSpec()}_createFromSpec(t){if(!t.id)return null;let e=this._scaleMap.get(t.id);return e||(e=t.type==="ordinal"&&t.id==="color"?cg("colorOrdinal"):cg(t.type)),e?(W(t.range)&&e.range(t.range),W(t.domain)&&(uo(t.domain)||e.domain(t.domain)),t.specified&&e.specified&&e.specified(t.specified),t.clamp&&e.clamp&&e.clamp(t.clamp),e):null}_setAttrFromSpec(){var t;if(!(!((t=this._spec)===null||t===void 0)&&t.length))return;const e=new Map,i=new Map;this._spec.forEach(n=>{const r=this._createFromSpec(n);r&&(e.set(n.id,r),i.set(n.id,n))}),this._modelScaleSpecMap.forEach(n=>{const r=this._createFromSpec(n);r&&(e.set(n.id,r),i.set(n.id,n))}),this._scaleSpecMap=i,this._scaleMap=e}updateSpec(t){const e={change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1};if(Xt(t,this._spec))return e;e.change=!0;for(let i=0;i<t.length;i++){const n=t[i],r=this._scaleMap.get(n.id);if(!r)return e.reMake=!0,e;const a=this._spec.find(o=>o.id===n.id);if(!a.id||a.type!==n.type||!Xt(a.specified,n.specified))return e.reMake=!0,e;n.range&&!Xt(n.range,r.range())&&(r.range(n.range),e.reRender=!0),uo(n.domain)?e.reRender=!0:Xt(n.domain,r.domain())||(r.domain(n.domain),e.reRender=!0),this._scaleSpecMap.set(n.id,n)}return this._spec=t,e}registerModelScale(t){const e=this._createFromSpec(t);e&&(this._modelScaleSpecMap.set(t.id,t),this._scaleSpecMap.set(t.id,t),this._scaleMap.set(t.id,e))}removeModelScale(t){this._modelScaleSpecMap.forEach(e=>{t(e)&&(this._modelScaleSpecMap.delete(e.id),this._scaleSpecMap.delete(e.id),this._scaleMap.delete(e.id))})}getScale(t){return this._scaleMap.get(t)}getScaleSpec(t){return this._scaleSpecMap.get(t)}_getSeriesByRawDataId(t){const e=this._chart.getAllSeries();for(let i=0;i<e.length;i++){const n=e[i];if(n.getRawData().name===t)return n}return null}_getSeriesBySeriesId(t){const e=this._chart.getAllSeries();for(let i=0;i<e.length;i++){const n=e[i];if(n.id===t)return n}return null}updateScaleDomain(t){this._scaleSpecMap.forEach((e,i)=>{const n=this._scaleMap.get(i);if(!n)return;if(!uo(e.domain))return e.domain&&e.domain.length!==0||n.domain(t),void this._updateMarkScale(i,n,n.domain().slice());let r;r=he(e.type)?[null,null]:new Set,e.domain.forEach(o=>{const l=this._getSeriesByRawDataId(o.dataId);if(!l)return;const h=he(e.type);o.fields.forEach(c=>{const u=l.getRawDataStatisticsByField(c,h);u&&(h?(I(r[0])?r[0]=u.min:r[0]=Math.min(u.min,r[0]),I(r[1])?r[1]=u.max:r[1]=Math.max(u.max,r[1])):u.values.forEach(d=>{r.add(d)}))})});const a=r;he(e.type)||(r=Array.from(r)),n.domain(r),this._updateMarkScale(i,n,a)})}_updateMarkScale(t,e,i){const n=this._markAttributeScaleMap.get(t);n&&n.length!==0&&n.forEach(r=>{if(!r.field||!r.markScale||r.markScale===e)return;if(I(r.changeDomain)||r.changeDomain==="none"||I(r.seriesId))return void(he(e.type)?r.markScale.domain(i):e.domain(Array.from(i)));const a=this._getSeriesBySeriesId(r.seriesId),o=he(e.type),l=a.getRawDataStatisticsByField(r.field,o);if(!ht(l))return r.changeDomain==="expand"?(o?(i[0]=Math.min(i[0],l.min),i[1]=Math.max(i[1],l.max)):(l.values.forEach(h=>{i.add(h)}),i=Array.from(i)),void r.markScale.domain(i)):void(r.changeDomain!=="replace"||(o?r.markScale.domain([l.min,l.max]):r.markScale.domain(l.values)));he(e.type)?r.markScale.domain(i):e.domain(Array.from(i))})}registerMarkAttributeScale(t,e){const i=this._scaleMap.get(t.scale);let n=this._markAttributeScaleMap.get(t.scale);n||(n=[],this._markAttributeScaleMap.set(t.scale,n));let r=i;return(I(t.field)||!I(t.changeDomain)&&t.changeDomain!=="none"&&!I(e))&&(r=i.clone()),n.push(Object.assign(Object.assign({},t),{seriesId:e,markScale:r})),r}}class Qo extends gu{getSpec(){return this._spec}setSpec(t){this._spec=t}getOption(){return this._option}getLayoutRect(){return this._layoutRect}getViewRect(){return this._viewRect}getLayoutTag(){return this._layoutTag}setLayoutTag(t,e,i=!0){this._layoutTag=t;const n=this.getCompiler();return n!=null&&n.getVGrammarView()&&(n.getVGrammarView().updateLayoutTag(),t&&i&&n.renderNextTick(e)),this._layoutTag}getGlobalScale(){return this._globalScale}getEvent(){return this._event}get chartData(){return this._chartData}constructor(t,e){var i,n,r;super(e),this.type="chart",this.id=Tn(),this._regions=[],this._series=[],this._components=[],this._layoutRect={x:0,y:0,width:On,height:Pn},this._viewRect={width:On,height:Pn},this._viewBox={x1:0,y1:0,x2:On,y2:Pn},this._layoutTag=!0,this._idMap=new Map,this.state={layoutUpdateRank:1},this.padding={top:0,left:0,right:0,bottom:0},this.getAllSeries=()=>{var a;return(a=this._series)!==null&&a!==void 0?a:[]},this.getRegionsInIndex=a=>a&&a.length!==0?this._regions.filter((o,l)=>a.includes(l)):[this._regions[0]],this.getAllRegions=()=>this._regions,this.getRegionsInIds=a=>a?this._regions.filter(o=>a.includes(o.id)):[],this.getRegionsInQuerier=a=>a?this._regions.filter((o,l)=>Y(a).some(h=>R(h.regionId)&&h.regionId===o.userId||h.regionIndex===l)):this._regions,this.getRegionsInUserId=a=>{if(a)return this._regions.find(o=>o.userId===a)},this.getRegionsInUserIdOrIndex=(a,o)=>this.getAllRegions().filter(l=>a!=null&&a.length?l.userId&&a.includes(l.userId):!(o!=null&&o.length)||o.includes(l.getSpecIndex())),this.getComponents=()=>this._components,this.getSeriesInIndex=a=>a&&a.length!==0?this._series.filter((o,l)=>a.includes(l)):[this._series[0]],this.getSeriesInIds=a=>a?this._series.filter(o=>a.includes(o.id)):[],this.getSeriesInUserId=a=>{if(a)return this._series.find(o=>o.userId===a)},this.getSeriesInUserIdOrIndex=(a,o)=>this.getAllSeries().filter(l=>a!=null&&a.length?l.userId&&a.includes(l.userId):!(o!=null&&o.length)||o.includes(l.getSpecIndex())),this.getComponentByIndex=(a,o)=>{const l=this._components.filter(h=>(h.specKey||h.type)===a);if(l&&l.length!==0)return l[o]},this.getComponentsByKey=a=>this._components.filter(o=>(o.specKey||o.type)===a),this.getComponentByUserId=a=>{const o=this._components.find(l=>l.userId===a);if(o)return o},this.getComponentsByType=a=>this._components.filter(o=>o.type===a),this._paddingSpec=Ro((i=t.padding)!==null&&i!==void 0?i:e.getTheme().padding),this._event=new cu(e.eventDispatcher,e.mode),this._dataSet=e.dataSet,this._chartData=new MO(this._dataSet),this._modelOption=Object.assign(Object.assign({},e),{mode:this._option.mode,map:this._idMap,getChartLayoutRect:()=>this._layoutRect,getChartViewRect:()=>this._viewRect,getChart:()=>this,globalScale:this._globalScale,onError:(n=this._option)===null||n===void 0?void 0:n.onError,disableTriggerEvent:((r=this._option)===null||r===void 0?void 0:r.disableTriggerEvent)===!0,getSeriesData:this._chartData.getSeriesData.bind(this._chartData)}),this._spec=t}created(t){this._chartData.parseData(this._spec.data),this._createGlobalScale(),this._createBackground(),this._createLayout(),t.forEachRegionInSpec(this._spec,this._createRegion.bind(this)),t.forEachSeriesInSpec(this._spec,this._createSeries.bind(this)),t.forEachComponentInSpec(this._spec,this._createComponent.bind(this),this._option.getSpecInfo())}init(){var t,e;(t=this._beforeInit)===null||t===void 0||t.call(this),this._regions.forEach(i=>i.init({})),this._series.forEach(i=>i.init({})),this._components.forEach(i=>i.init({dataSet:this._dataSet})),this._initEvent(),(e=this._initStack)===null||e===void 0||e.call(this),this.reDataFlow()}reDataFlow(){this._series.forEach(t=>{var e;return(e=t.getRawData())===null||e===void 0?void 0:e.markRunning()}),this._series.forEach(t=>t.fillData()),this.updateGlobalScaleDomain()}onResize(t,e,i=!0){const n={width:t,height:e};this._canvasRect=n,this._updateLayoutRect(this._option.viewBox),this.setLayoutTag(!0,null,i)}updateViewBox(t,e){this._option.viewBox=t,this._updateLayoutRect(t),this.setLayoutTag(!0,null,e)}_createBackground(){const t=this._spec.background;if(!t||typeof t!="object"||R(t.gradient))return;const e=ju(t,["x","y","width","height","x1","y1","image"]);e.background=t.image,this._backgroundMark=et.createMark("group","chart-background",{model:this,map:this._option.map,getCompiler:this.getCompiler,globalScale:this._globalScale}),this._backgroundMark.created(),this._backgroundMark.setStyle(Object.assign(Object.assign({},e),{x:()=>this._viewBox.x1,y:()=>this._viewBox.y1,width:()=>this._viewBox.x2-this._viewBox.x1,height:()=>this._viewBox.y2-this._viewBox.y1})),this._backgroundMark.setMarkConfig({zIndex:Qe.SeriesGroup-2})}_createRegion(t,e){if(!t)return;const{spec:i}=e,n=ne(e,["spec"]),r=new t(i,Object.assign(Object.assign({},this._modelOption),n));r&&(r.created(),this._regions.push(r))}_createSeries(t,e){if(!t)return;const{spec:i}=e,n=ne(e,["spec"]);let r;if(R(i.regionId)?r=this.getRegionsInUserId(i.regionId):R(i.regionIndex)&&(r=this.getRegionsInIndex([i.regionIndex])[0]),!r&&!(r=this._regions[0]))return;const a=new t(i,Object.assign(Object.assign(Object.assign({},this._modelOption),n),{type:i.type,region:r,globalScale:this._globalScale,sourceDataList:this._chartData.dataList}));a&&(a.created(),this._series.push(a),r.addSeries(a))}getSeriesById(t){return this._series.find(e=>e.id===t)}_createComponent(t,e){const i=t.createComponent(e,Object.assign(Object.assign({},this._modelOption),{type:t.type,getAllRegions:this.getAllRegions,getRegionsInIndex:this.getRegionsInIndex,getRegionsInIds:this.getRegionsInIds,getRegionsInUserIdOrIndex:this.getRegionsInUserIdOrIndex,getAllSeries:this.getAllSeries,getSeriesInIndex:this.getSeriesInIndex,getSeriesInIds:this.getSeriesInIds,getSeriesInUserIdOrIndex:this.getSeriesInUserIdOrIndex,getAllComponents:this.getComponents,getComponentByIndex:this.getComponentByIndex,getComponentByUserId:this.getComponentByUserId,getComponentsByKey:this.getComponentsByKey,getComponentsByType:this.getComponentsByType}));i&&(i.created(),this._components.push(i))}getAllComponents(){return this._components}getAllModels(){return[].concat(this.getAllSeries(),this.getAllComponents(),this.getAllRegions())}getModelInFilter(t){if(Q(t))return this.getAllModels().find(i=>i.userId===t);if(U(t))return this.getAllModels().find(i=>t(i));let e=0;return this.getAllModels().find(i=>{var n;if(((n=i.specKey)!==null&&n!==void 0?n:i.type)===t.type){if(e===t.index)return!0;e++}return!1})}_createLayout(){this._updateLayoutRect(this._option.viewBox),this._initLayoutFunc()}setLayout(t){this._option.layout=t,this._initLayoutFunc()}_initLayoutFunc(){var t,e,i;if(this._layoutFunc=this._option.layout,!this._layoutFunc){let n=!1;(this._spec.zField||this._spec.series&&this._spec.series.some(a=>a.zField))&&(n=!0);const r=et.getLayoutInKey((e=(t=this._spec.layout)===null||t===void 0?void 0:t.type)!==null&&e!==void 0?e:n?"layout3d":"base");if(r){const a=new r(this._spec.layout,{onError:(i=this._option)===null||i===void 0?void 0:i.onError});this._layoutFunc=a.layoutItems.bind(a)}}}layout(t){var e,i,n,r;if((i=(e=this._option.performanceHook)===null||e===void 0?void 0:e.beforeLayoutWithSceneGraph)===null||i===void 0||i.call(e),this.getLayoutTag()){this._event.emit(pt.layoutStart,{chart:this,vchart:this._option.globalInstance}),this.onLayoutStart(t);const a=this.getLayoutElements();this._layoutFunc(this,a,this._layoutRect,this._viewBox),this._event.emit(pt.afterLayout,{elements:a,chart:this}),this.setLayoutTag(!1),this.onLayoutEnd(t),this._event.emit(pt.layoutEnd,{chart:this,vchart:this._option.globalInstance})}(r=(n=this._option.performanceHook)===null||n===void 0?void 0:n.afterLayoutWithSceneGraph)===null||r===void 0||r.call(n)}onLayoutStart(t){this.getAllModels().forEach(e=>e.onLayoutStart(this._layoutRect,this._viewRect,t))}onLayoutEnd(t){this.getAllModels().forEach(e=>{e.modelType!=="series"&&e.onLayoutEnd(t)})}onEvaluateEnd(t){[...this._components,...this._regions,...this._series].forEach(e=>e.onEvaluateEnd(t))}getLayoutElements(){return this.getAllModels().map(t=>t.layout).filter(t=>!!t)}getModelById(t){const e=this._idMap.get(t);if(e&&e instanceof Wg)return e}getModelByUserId(t){const e=this.getSeriesInUserId(t);if(e)return e;const i=this.getRegionsInUserId(t);return i||this.getComponentByUserId(t)||void 0}getAllMarks(){return Array.from(this._idMap.values()).filter(t=>t&&t instanceof Rs)}getMarkById(t){const e=this._idMap.get(t);if(e&&e instanceof Rs)return e}getMarkByUserName(t){return this.getAllMarks().filter(e=>e.name&&e.name===t)}updateData(t,e,i=!0,n){const r=this._dataSet.getDataView(t);r&&(r.markRunning(),r.parseNewData(e,n)),i&&this.updateGlobalScaleDomain(),this.getAllModels().forEach(a=>a.onDataUpdate())}updateFullData(t,e=!0){Y(t).forEach(i=>{const n=this._dataSet.getDataView(i.id);n&&n.markRunning()}),Y(t).forEach(i=>{const n=this._dataSet.getDataView(i.id);n&&zg(n,i,!0)}),e&&this.updateGlobalScaleDomain(),this.getAllModels().forEach(i=>i.onDataUpdate())}onRender(t){}setCanvasRect(t,e){this._canvasRect={width:t,height:e}}getCanvasRect(){return this._canvasRect||(this._canvasRect=Zx(this._spec,this._option,{width:On,height:Pn})),this._canvasRect}getSeriesData(t,e){return this._chartData.getSeriesData(t,e)}_transformSpecScale(){var t;const e=this._spec.scales?[...this._spec.scales]:[];let i=e.find(r=>r.id==="color");const n=this.getColorScheme();if(!i&&(i={type:"ordinal",id:"color",domain:null,range:null},e.push(i),this._spec.color)){const r=this._spec.color;if(W(r))i.range=r;else{const a=r;Object.prototype.hasOwnProperty.call(a,"type")&&(i.type=a.type),Object.prototype.hasOwnProperty.call(a,"domain")&&(i.domain=a.domain),Object.prototype.hasOwnProperty.call(a,"range")&&(i.range=a.range),Object.prototype.hasOwnProperty.call(a,"specified")&&(i.specified=a.specified),Object.prototype.hasOwnProperty.call(a,"clamp")&&(i.clamp=a.clamp)}}return!((t=i.range)===null||t===void 0)&&t.length||(i.range=Gr(n),i.rangeTheme=!0),e}_createGlobalScale(){this._globalScale=new EO(this._transformSpecScale(),this),this._modelOption.globalScale=this._globalScale}updateGlobalScaleDomain(){const t=new Set;this._series.forEach(i=>{const n=i.getSeriesKeys();n&&n.forEach(r=>t.add(r))});const e=Array.from(t);this._globalScale.updateScaleDomain(e)}updateGlobalScale(t){ia(t,this._globalScale.updateSpec(this._transformSpecScale()))}updateGlobalScaleTheme(){const t=this._globalScale.getScaleSpec("color"),e=this.getColorScheme();t.rangeTheme&&(t.range=Gr(e),this._globalScale.getScale("color").range(t.range))}_getSpecKeys(t){const e={width:!0,height:!0};return Object.keys(t).filter(i=>!e[i]).sort()}updateSpec(t){const e={change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1};if(this.setLayoutTag(!0,null,!1),t.type!==this.type)return e.reMake=!0,e;const i=this._getSpecKeys(this._spec);if(!Xt(i,this._getSpecKeys(t)))return e.reMake=!0,e;for(let r=0;r<i.length;r++){const a=i[r];if(W(this._spec[a])&&this._spec[a].length!==Y(t[a]).length)return e.reMake=!0,e}const n=this._spec;return this._spec=t,this.updateChartConfig(e,n),e.reMake?e:(this.updateGlobalScale(e),e.reMake?e:(this.updateRegionSpec(e),e.reMake?e:(this.updateComponentSpec(e),e.reMake||(this.updateSeriesSpec(e),e.reMake||(this.reInit(),this.updateDataSpec(),this.updateGlobalScaleDomain())),e)))}updateChartConfig(t,e){var i,n;this._paddingSpec=Ro((i=this._spec.padding)!==null&&i!==void 0?i:(n=this._option)===null||n===void 0?void 0:n.getTheme().padding),this._updateLayoutRect(this._viewBox)}updateDataSpec(){this._spec.data&&this._chartData.updateData(this._spec.data,!1,!0)}updateRegionSpec(t){var e;!((e=this._spec)===null||e===void 0)&&e.region&&(this._spec.region.length===this._regions.length?this._regions.forEach(i=>{ia(t,i.updateSpec(this._spec.region[i.getSpecIndex()]))}):t.reMake=!0)}updateComponentSpec(t){const e={},i={[st.title]:!0,[st.brush]:!0,[st.mapLabel]:!0,[st.indicator]:!0};this._components.forEach(r=>{var a,o;if(r.type===st.label||r.type===st.totalLabel)return;i[r.type]&&(i[r.type]=!1);const l=r.specKey||r.type,h=(a=this._spec[l])!==null&&a!==void 0?a:{};W(h)?(e[l]=e[l]||{specCount:h.length,componentCount:0},e[l].componentCount++,ia(t,r.updateSpec((o=h[r.getSpecIndex()])!==null&&o!==void 0?o:{},h))):ia(t,r.updateSpec(h))});for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const a=e[r];a.componentCount!==a.specCount&&(t.reMake=!0)}const n=r=>r&&r.visible!==!1;Object.keys(i).forEach(r=>{if(i[r]){const a=this._spec[r];(W(a)?a.some(n):n(a))&&(t.reMake=!0)}})}updateSeriesSpec(t){this._spec.series.length===this._series.length?this._series.forEach(e=>{const i=this._spec.series[e.getSpecIndex()];ia(t,e.updateSpec(i))}):t.reMake=!0}getCanvas(){var t,e;return(e=(t=this.getCompiler())===null||t===void 0?void 0:t.getCanvas())!==null&&e!==void 0?e:null}_updateLayoutRect(t){let e=this.getCanvasRect();if(t){this._viewBox=t;const{x1:i=0,y1:n=0,x2:r,y2:a}=t;e={width:r-i,height:a-n}}else this._viewBox={x1:0,y1:0,x2:e.width,y2:e.height};this._viewRect=e,this.padding=xb(this._paddingSpec,e,e),this._layoutRect.width=e.width-this.padding.left-this.padding.right,this._layoutRect.height=e.height-this.padding.top-this.padding.bottom,this._layoutRect.x=this.padding.left,this._layoutRect.y=this.padding.top,this._event.emit(pt.layoutRectUpdate,{chart:this})}setCurrentTheme(){this.updateChartConfig({change:!0,reMake:!1},this._spec),this.setLayoutTag(!0,null,!1),this.updateGlobalScaleTheme(),this.reInit()}reInit(){[...this._regions,...this._series,...this._components].forEach(t=>{const e=t.getSpecInfo();e&&e.spec&&t.reInit(e.spec)})}clear(){this.getAllModels().forEach(t=>{var e;return(e=t.clear)===null||e===void 0?void 0:e.call(t)})}compile(){this.compileBackground(),this.compileLayout(),this.compileRegions(),this.compileSeries(),this.compileComponents()}afterCompile(){this.getAllRegions().forEach(t=>{var e;(e=t.afterCompile)===null||e===void 0||e.call(t)}),this.getAllSeries().forEach(t=>{var e;(e=t.afterCompile)===null||e===void 0||e.call(t)}),this.getAllComponents().forEach(t=>{var e;(e=t.afterCompile)===null||e===void 0||e.call(t)})}compileLayout(){const{width:t,height:e}=this.getCanvasRect();this.getCompiler().setSize(t,e)}compileBackground(){var t;this._backgroundMark&&(this._backgroundMark.compile({context:{model:this}}),(t=this._backgroundMark.getProduct())===null||t===void 0||t.layout(()=>{}))}compileRegions(){var t,e,i,n;(e=(t=this._option.performanceHook)===null||t===void 0?void 0:t.beforeRegionCompile)===null||e===void 0||e.call(t),this.getAllRegions().forEach(r=>{r.compile()}),(n=(i=this._option.performanceHook)===null||i===void 0?void 0:i.afterRegionCompile)===null||n===void 0||n.call(i)}compileSeries(){var t,e,i,n;(e=(t=this._option.performanceHook)===null||t===void 0?void 0:t.beforeSeriesCompile)===null||e===void 0||e.call(t),this.getAllSeries().forEach(r=>{r.compile()}),(n=(i=this._option.performanceHook)===null||i===void 0?void 0:i.afterSeriesCompile)===null||n===void 0||n.call(i)}compileComponents(){var t,e,i,n;(e=(t=this._option.performanceHook)===null||t===void 0?void 0:t.beforeComponentCompile)===null||e===void 0||e.call(t),this.getAllComponents().forEach(r=>{r.compile()}),(n=(i=this._option.performanceHook)===null||i===void 0?void 0:i.afterComponentCompile)===null||n===void 0||n.call(i)}release(){[...this._components,...this._regions,...this._series].forEach(t=>{t.beforeRelease()}),super.release(),this.clear(),[...this._components,...this._regions,...this._series].forEach(t=>{t.release()}),this._components=this._regions=this._series=[],this._spec={},this._dataSet=this._globalScale=this._layoutFunc=null,this._layoutTag=!1,this._idMap.clear()}onLayout(t){const e=t.rootMark;this.layout({group:e,srView:t})}updateState(t,e){const i=this.getAllSeries();for(const n in t){if(ht(t[n]))continue;const r=t[n];let a={stateValue:n};a=U(r.filter)?Object.assign({filter:r.filter},a):Object.assign(Object.assign({},r.filter),a),r.level&&(a.level=r.level),i.forEach(o=>{o.getMarks().forEach(l=>{l.stateStyle[n]&&(e&&!e(o,l,n)||(l.state.changeStateInfo(a),l.updateMarkState(n)))})})}}setSelected(t,e,i){this._setStateInDatum(Vt.STATE_SELECTED,!0,t,e,i)}setHovered(t,e,i){this._setStateInDatum(Vt.STATE_HOVER,!0,t,e,i)}clearState(t){this.getAllRegions().forEach(e=>{e.interaction.clearEventElement(t,!0),e.interaction.resetInteraction(t,null)})}clearAllStates(){this.getAllRegions().forEach(t=>{t.interaction.clearAllEventElement(),t.interaction.resetAllInteraction()})}clearSelected(){this.clearState(Vt.STATE_SELECTED)}clearHovered(){this.clearState(Vt.STATE_HOVER)}_initEvent(){[pt.dataZoomChange,pt.scrollBarChange].forEach(t=>{this._event.on(t,({value:e})=>{this._disableMarkAnimation(["exit","update"]);const i=()=>{this._enableMarkAnimation(["exit","update"]),this._event.off(at.AFTER_MARK_RENDER_END,i)};this._event.on(at.AFTER_MARK_RENDER_END,i)})})}_enableMarkAnimation(t){this.getAllMarks().forEach(e=>{const i=e.getProduct();i&&i.animate&&i.animate.enableAnimationState(t)})}_disableMarkAnimation(t){this.getAllMarks().forEach(e=>{const i=e.getProduct();i&&i.animate&&i.animate.disableAnimationState(t)})}_setStateInDatum(t,e,i,n,r){const a=(i=i?Y(i):null)?Object.keys(i[0]):null;this.getRegionsInQuerier(r).forEach(o=>{i?(o.getSeries().forEach(l=>{l.getMarks().forEach(h=>{if(h.getProduct()&&(!n||U(n)&&n(l,h))){const c=h.getProduct().isCollectionMark(),u=h.getProduct().elements;let d=[];if(c)d=u.filter(p=>{const g=p.getDatum();i.every((f,m)=>a.every(v=>f[v]==g[m][v]))});else if(i.length>1){const p=i.slice();d=u.filter(g=>{if(p.length===0)return!1;const f=g.getDatum(),m=p.findIndex(v=>a.every(y=>v[y]==f[y]));return m>=0&&(p.splice(m,1),!0)})}else{const p=u.find(g=>a.every(f=>i[0][f]==g.getDatum()[f]));p&&(d=[p])}d.forEach(p=>{o.interaction.startInteraction(t,p)})}})}),e&&o.interaction.reverseEventElement(t)):o.interaction.clearEventElement(t,!0)})}setDimensionIndex(t,e){var i,n;let r=null;Array.from(this._event.getComposedEventMap().values()).forEach(o=>{const{eventType:l,event:h}=o;if(l===Bs.dimensionHover||l===Bs.dimensionClick){const c=h.dispatch(t,e);c!=null&&c.length&&(r=c)}});const a=I(t)||!r||r.every(o=>fi(o.axis.getScale().type)&&I(o.index));if(e.tooltip!==!1){const o=this.getComponentsByType(st.tooltip)[0];if(o!=null&&o.getVisible())if(a)(n=(i=o).hideTooltip)===null||n===void 0||n.call(i);else{const l={};r.forEach(h=>{const{axis:c,value:u,data:d}=h,p=c.getOrient()==="left"||c.getOrient()==="right";d.forEach(g=>{var f,m,v;const y=p?g.series.fieldY[0]:g.series.fieldX[0];l[y]=(v=(m=(f=g.datum)===null||f===void 0?void 0:f[0])===null||m===void 0?void 0:m[y])!==null&&v!==void 0?v:u})}),o.showTooltip(l,e.showTooltipOption)}}if(e.crosshair!==!1){const o=this.getComponentsByType(st.cartesianCrosshair)[0];o&&o.clearAxisValue&&o.setAxisValue&&(a?o.hideCrosshair():o.showCrosshair(r))}}getColorScheme(){var t,e;return(e=(t=this._option).getTheme)===null||e===void 0?void 0:e.call(t).colorScheme}}const qS=(s,t)=>{var e;const i=s.spec,{regionId:n,regionIndex:r}=i;if(R(n)){const a=Y(n);return(e=t.region)===null||e===void 0?void 0:e.filter(({spec:o})=>a.includes(o.id))}if(R(r))return Y(r).map(a=>{var o;return(o=t.region)===null||o===void 0?void 0:o[a]}).filter(R)};class hf{constructor(t){this._option=t,this.type=t.type,this.seriesType=t.seriesType}initChartSpec(t){return this.transformSpec(t),this.transformModelSpec(t)}transformSpec(t){t.region&&t.region.length!==0||(t.region=[{}]),t.tooltip===void 0&&(t.tooltip={}),R(t.stackInverse)&&t.region.forEach(e=>{!R(e.stackInverse)&&(e.stackInverse=t.stackInverse)}),R(t.stackSort)&&t.region.forEach(e=>{!R(e.stackSort)&&(e.stackSort=t.stackSort)})}generateTransform(t,e){return(i,n,r)=>{const{spec:a,specPath:o,specInfoPath:l,type:h}=n,c=new i.transformerConstructor(Object.assign(Object.assign({},this._option),{type:h})),u=c.transformSpec(a,t,r),d=Object.assign(Object.assign({},n),u);e?d.theme=c.getTheme(a,t):fg(t,o,u.spec),fg(r,l??o,d)}}transformModelSpec(t){return this.createSpecInfo(t,this.generateTransform(t,!1))}createSpecInfo(t,e){var i,n;e||(e=this.generateTransform(t,!0));const r={};return this.forEachRegionInSpec(t,e,r),this.forEachSeriesInSpec(t,e,r),(i=r.series)===null||i===void 0||i.forEach((a,o)=>{var l,h;const c=((h=(l=qS(a,r))!==null&&l!==void 0?l:r.region)!==null&&h!==void 0?h:[])[0];c&&(c.seriesIndexes||(c.seriesIndexes=[]),c.seriesIndexes.push(o),a.regionIndexes=c.regionIndexes.slice())}),this.forEachComponentInSpec(t,e,r),Object.values((n=r.component)!==null&&n!==void 0?n:{}).forEach(a=>a.forEach((o,l)=>{var h,c,u;if(o){if(!o.regionIndexes){const d=(c=(h=qS(o,r))!==null&&h!==void 0?h:r.region)!==null&&c!==void 0?c:[];o.regionIndexes=d.map(p=>p.regionIndexes[0])}if(!o.seriesIndexes){const d=((p,g)=>{var f;const m=p.spec,{seriesId:v,seriesIndex:y}=m;if(R(v)){const _=Y(v);return(f=g.series)===null||f===void 0?void 0:f.filter(({spec:b})=>_.includes(b.id))}if(R(y))return Y(y).map(_=>{var b;return(b=g.series)===null||b===void 0?void 0:b[_]}).filter(R)})(o,r);if(d)o.seriesIndexes=d.map(({seriesIndexes:p})=>p[0]);else{const p=new Set;((u=o.regionIndexes)!==null&&u!==void 0?u:[]).forEach(g=>{var f,m;const v=(f=r.region)===null||f===void 0?void 0:f[g];(m=v==null?void 0:v.seriesIndexes)===null||m===void 0||m.forEach(y=>p.add(y))}),o.seriesIndexes=Array.from(p)}}}})),r}_isValidSeries(t){return!0}_getDefaultSeriesSpec(t,e,i){var n,r,a,o;const l={dataKey:t.dataKey,hover:t.hover,select:t.select,label:t.label,seriesStyle:t.seriesStyle,animation:(n=t.animation)!==null&&n!==void 0?n:this._option.animation,animationThreshold:(r=t.animationThreshold)!==null&&r!==void 0?r:(o=(a=this._option).getTheme)===null||o===void 0?void 0:o.call(a).animationThreshold,animationAppear:t.animationAppear,animationDisappear:t.animationDisappear,animationEnter:t.animationEnter,animationUpdate:t.animationUpdate,animationExit:t.animationExit,animationNormal:t.animationNormal,animationState:t.animationState,extensionMark:t.extensionMark,large:t.large,largeThreshold:t.largeThreshold,progressiveStep:t.progressiveStep,progressiveThreshold:t.progressiveThreshold,background:t.seriesBackground,invalidType:t.invalidType,seriesField:t.seriesField,morph:t.morph,interactions:t.interactions},h=this.seriesType;return h&&(l.type=h,l[h]=t[h]),e&&e.length&&e.forEach(c=>{l[c]=t[c]}),i&&i.length&&i.forEach(c=>{l[c]=t[c]}),l}forEachRegionInSpec(t,e,i){var n;return((n=t.region)!==null&&n!==void 0?n:[]).map((r,a)=>e(et.getRegionInType("region"),{spec:r,specPath:["region",a],type:"region",regionIndexes:[a]},i))}forEachSeriesInSpec(t,e,i){var n;return((n=t.series)!==null&&n!==void 0?n:[]).map((r,a)=>e(et.getSeriesInType(r.type),{spec:r,specPath:["series",a],type:r.type,seriesIndexes:[a]},i))}forEachComponentInSpec(t,e,i){var n,r,a;const o=[],l=et.getComponents();let h,c,u,d;const p=[];for(let f=0;f<l.length;f++){const{cmp:m,alwaysCheck:v}=l[f];m.type.startsWith(st.cartesianAxis)?h=m:m.type.startsWith(st.polarAxis)?c=m:m.type===st.geoCoordinate?u=m:(v||t[(n=m.specKey)!==null&&n!==void 0?n:m.type])&&(m.type===st.tooltip?d=m:p.push(m))}let g=!1;if(h){const f=h.getSpecInfo(t,i);(f==null?void 0:f.length)>0&&(g=!0,f.forEach(m=>{const v=et.getComponentInKey(m.type);o.push(e(v,m,i))}))}if(c&&!g){const f=c.getSpecInfo(t,i);(f==null?void 0:f.length)>0&&(g=!0,f.forEach(m=>{const v=et.getComponentInKey(m.type);o.push(e(v,m,i))}))}return u&&!g&&((r=u.getSpecInfo(t,i))===null||r===void 0||r.forEach(f=>{o.push(e(u,f,i))})),p.forEach(f=>{var m;(m=f.getSpecInfo?f.getSpecInfo(t,i):bu(t,f.specKey,f.type))===null||m===void 0||m.forEach(v=>{o.push(e(f,v,i))})}),d&&((a=bu(t,d.specKey,d.type))===null||a===void 0||a.forEach(f=>{o.push(e(d,f,i))})),o}transformSeriesSpec(t){const e=this._getDefaultSeriesSpec(t);t.series&&t.series.length!==0?t.series.forEach(i=>{this._isValidSeries(i.type)&&Object.keys(e).forEach(n=>{n in i||(i[n]=e[n])})}):t.series=[e]}_findBandAxisBySeries(t,e,i){const n=(t==null?void 0:t.direction)==="horizontal"?["left","right"]:["top","bottom"];return i.find(a=>{if(!n.includes(a.orient))return!1;if(R(a.seriesId)){if(Y(a.seriesId).includes(t==null?void 0:t.id))return!0}else if(R(a.seriesIndex)){if(Y(a.seriesIndex).includes(e))return!0}else if(a.type==="band")return!0;return!0})}_applyAxisBandSize(t,e,i){const{barMaxWidth:n,barMinWidth:r,barWidth:a,barGapInGroup:o}=i;let l=!1;it(r)?(t.minBandSize=r,l=!0):it(a)?(t.minBandSize=a,l=!0):it(n)&&(t.minBandSize=n,l=!0),l&&(t.bandSizeLevel=Number.MAX_VALUE,t.bandSizeExtend={extend:e,gap:W(o)?o[o.length-1]:o})}}class cf extends hf{needAxes(){return!0}_isValidSeries(t){return!this.seriesType||t===this.seriesType}_getDefaultSeriesSpec(t,e){return super._getDefaultSeriesSpec(t,["xField","yField","zField","direction","stack","percent","stackOffsetSilhouette","totalLabel","sortDataByAxis"],e)}transformSpec(t){super.transformSpec(t),super.transformSeriesSpec(t),this._transformAxisSpec(t)}_setDefaultXAxisSpec(t){return{orient:"bottom"}}_setDefaultYAxisSpec(t){return{orient:"left"}}_setDefaultZAxisSpec(t){return{orient:"z"}}_transformAxisSpec(t){if(this.needAxes()){t.axes||(t.axes=[]);const e={x:!1,y:!1,z:!1};t.axes.forEach(i=>{const{orient:n}=i;let r=null;n!=="top"&&n!=="bottom"||(e.x=!0,r=this._setDefaultXAxisSpec(t)),n!=="left"&&n!=="right"||(e.y=!0,r=this._setDefaultYAxisSpec(t)),n==="z"&&(e.z=!0,r=this._setDefaultZAxisSpec(t)),r&&Object.keys(r).forEach(a=>{I(i[a])&&(i[a]=r[a])}),vt(i,"trimPadding")&&mt(i,Jx(this.type,t))}),e.x||t.axes.push(this._setDefaultXAxisSpec(t)),e.y||t.axes.push(this._setDefaultYAxisSpec(t)),t.zField&&!e.z&&t.axes.push(this._setDefaultZAxisSpec(t))}}}class ZS extends cf{_getDefaultSeriesSpec(t){var e;const i=super._getDefaultSeriesSpec(t,["point","line","activePoint","sampling","samplingFactor","pointDis","pointDisMul","markOverlap","lineLabel"]);return i.seriesMark=(e=t.seriesMark)!==null&&e!==void 0?e:"line",i}transformSpec(t){super.transformSpec(t),Hg(t)}}const BO=(s,t)=>{const e={nodes:{}},{fields:i}=t;if(!(i!=null&&i.length))return e;const n=i.length-1;let r,a,o=e;return s.forEach(l=>{l.latestData&&l.latestData.forEach(h=>{o=e;for(let c=0;c<i.length;c++){const u=i[c],d=h[u];if(I(d))break;o.groupField=u,o.nodes[d]||(c===n?o.nodes[d]={values:[]}:(r={nodes:{}},o.nodes[d]=r)),c===n?(a=o.nodes[d],a.values.push(h)):o=o.nodes[d]}})}),e};class RO{constructor(t,e){this.stackRegion=({model:i})=>{var n;const r=i.getSeries();if(!r.some(u=>u.getStack()))return;const o=r.some(u=>{var d,p,g,f;return!!(!((p=(d=u.getSpec())===null||d===void 0?void 0:d.totalLabel)===null||p===void 0)&&p.alwayCalculateTotal)||((f=(g=u.getSpec())===null||g===void 0?void 0:g.totalLabel)===null||f===void 0?void 0:f.visible)}),l=o||r.some(u=>u.getPercent()),h=r.some(u=>u.getStackOffsetSilhouette()),c=Yb(i,!0);for(const u in c)for(const d in c[u].nodes)Kb(c[u].nodes[d],i.getStackInverse(),l,o);if(h)for(const u in c)for(const d in c[u].nodes)gR(c[u].nodes[d]);o&&i.getSeries().forEach(u=>{const d=u.getStackData(),p=u.getStackValue(),g=u.getStackValueField();d&&g&&Xb(c[p],g)}),!((n=this._options)===null||n===void 0)&&n.afterStackRegion&&this._options.afterStackRegion(i,c)},this._chart=t,this._options=e}init(){this._chart.getAllRegions().forEach(t=>{t.event.on(pt.regionSeriesDataFilterOver,{filter:({model:e})=>(e==null?void 0:e.id)===t.id},this.stackRegion)})}stackAll(){this._chart.getAllRegions().forEach(t=>{this.stackRegion({model:t})})}}class Tu{_beforeInit(){this._dataSet&&Se(this._dataSet,"stackSplit",BO)}_initStack(){this._stack=new RO(this),this._stack.init()}}class la extends Qo{constructor(){super(...arguments),this.transformerConstructor=ZS,this.type="line",this.seriesType=te.line}}la.type="line",la.seriesType=te.line,la.transformerConstructor=ZS,Ue(la,Tu);function JS(s,t=!0){return(e,i,n)=>{const r=s.direction==="vertical"?s.yField:s.xField,a=e==null?void 0:e[r];return s.direction==="vertical"?{overall:t&&s.growFrom(),orient:a>0?"negative":"positive"}:{overall:!!t&&s.growFrom(),orient:a>0?"positive":"negative"}}}const QS=(s,t=!0)=>({type:s.direction==="horizontal"?"growWidthIn":"growHeightIn",options:JS(s,t)}),t1=(s,t=!0)=>({type:s.direction==="horizontal"?"growWidthOut":"growHeightOut",options:JS(s,t)}),IO={type:"fadeIn"},OO={type:"growCenterIn"};function PO(s,t){if(t===!1)return{};switch(t){case"fadeIn":return IO;case"scaleIn":return OO;default:return QS(s)}}class tl extends Rs{constructor(){super(...arguments),this.type=tl.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{width:void 0,height:void 0,lineWidth:0})}}tl.type="rect";const LO=()=>{et.registerMark(tl.type,tl),VR(),Ho.useRegisters([bI,xI,SI,AI,yI,_I])},DO=Object.assign(Object.assign({},Un),{bar:{name:"bar",type:"rect"},barBackground:{name:"barBackground",type:"rect"}});function e1(s,t,e){var i,n;if(s.values.length>0){let r;if(s.sortDatums.length){let a=s.sortDatums;t&&(a=s.sortDatums.slice().reverse());for(let o=0;o<a.length;o++)r=i1(a[o].datum,r,a[o].series,e,(n=(i=a[o].series[e.axisHelper]).getScale)===null||n===void 0?void 0:n.call(i,0),o===0)}else{let a=s.series;t&&(a=a.slice().reverse()),a.forEach(({s:o,values:l},h)=>{var c,u;const d=(u=(c=o[e.axisHelper]).getScale)===null||u===void 0?void 0:u.call(c,0);for(let p=0;p<l.length;p++){const g=l[t?l.length-1-p:p];r=i1(g,r,o,e,d,p===0&&h===0)}})}}for(const r in s.nodes)e1(s.nodes[r],t,e)}function i1(s,t,e,i,n,r){const a=e.getSpec().barMinHeight,o=e[i.axisHelper].isInverse(),l=Ze(e[i.startMethod](s),n);let h=Ze(e[i.endMethod](s),n);r&&(t=l);let c=Math.abs(l-h);c<a&&(c=a);let u=1;return h<l?u=-1:h===l&&(u=i.isVertical?o?1:-1:o?-1:1),h=t+u*c,s[i.start]=t,s[i.end]=h,h}Object.assign(Object.assign({},Un),{bar3d:{name:"bar3d",type:"rect3d"}});class s1 extends Yo{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){this._addMarkLabelSpec(t,"bar")}}class hn extends tf{constructor(){super(...arguments),this.type=te.bar,this._barMarkName="bar",this._barMarkType="rect",this.transformerConstructor=s1,this._bandPosition=0,this._getBarXStart=(t,e,i)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),t[mS]):this._spec.barMinHeight?this._calculateRectPosition(t,!1,i):Ze(this._dataToPosX(t),e,i),this._getBarXEnd=(t,e,i)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),t[vS]):Ze(this._dataToPosX1(t),e,i),this._getBarYStart=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),t[yS]):this._spec.barMinHeight?this._calculateRectPosition(t,!0):Ze(this._dataToPosY(t),e),this._getBarYEnd=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),t[_S]):Ze(this._dataToPosY1(t),e),this._getBarBackgroundXStart=t=>{const e=t.range();return Math.min(e[0],e[e.length-1])},this._getBarBackgroundXEnd=t=>{const e=t.range();return Math.max(e[0],e[e.length-1])},this._getBarBackgroundYStart=t=>{const e=t.range();return Math.min(e[0],e[e.length-1])},this._getBarBackgroundYEnd=t=>{const e=t.range();return Math.max(e[0],e[e.length-1])},this._getBarBackgroundPositionXEncoder=()=>{var t;return(t=this._barBackgroundPositionXEncoder)===null||t===void 0?void 0:t.bind(this)},this._setBarBackgroundPositionXEncoder=t=>{this._barBackgroundPositionXEncoder=t.bind(this)},this._getBarBackgroundPositionYEncoder=()=>{var t;return(t=this._barBackgroundPositionYEncoder)===null||t===void 0?void 0:t.bind(this)},this._setBarBackgroundPositionYEncoder=t=>{this._barBackgroundPositionYEncoder=t.bind(this)}}initMark(){var t,e;this._initBarBackgroundMark(),this._barMark=this._createMark(Object.assign(Object.assign({},hn.mark.bar),{name:this._barMarkName,type:this._barMarkType}),{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(t=this._spec.bar)===null||t===void 0?void 0:t.stateSort},{progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold,morphElementKey:this.getDimensionField()[0],morph:Zg(this._spec,this._barMarkName),setCustomizedShape:(e=this._spec.bar)===null||e===void 0?void 0:e.customShape})}_initBarBackgroundMark(){this._spec.barBackground&&this._spec.barBackground.visible&&(this._barBackgroundMark=this._createMark(hn.mark.barBackground,{dataView:this._barBackgroundViewData.getDataView(),dataProductId:this._barBackgroundViewData.getProductId(),stateSort:this._spec.barBackground.stateSort},{setCustomizedShape:this._spec.barBackground.customShape,progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold}))}initMarkStyle(){this._barMark&&this.setMarkStyle(this._barMark,{fill:this.getColorAttribute()},"normal",St.Series)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null})}initTooltip(){super.initTooltip();const{mark:t,group:e}=this._tooltipHelper.activeTriggerSet;this._barMark&&(t.add(this._barMark),e.add(this._barMark))}_statisticViewData(){var t,e;super._statisticViewData();const i=(t=this._spec.barBackground)!==null&&t!==void 0?t:{};if(!i.visible)return;const n=this._getRelatedComponentSpecInfo("axes").some(a=>a.type===st.cartesianBandAxis);let r;if(Se(this._option.dataSet,"addVChartProperty",cS),n){const a=([o],{scaleDepth:l})=>{var h,c;let u=[{}];const d=this.getDimensionField(),p=I(l)?d.length:Math.min(d.length,l);for(let g=0;g<p;g++){const f=d[g],m=(h=o.latestData[f])===null||h===void 0?void 0:h.values;if(!(m!=null&&m.length))continue;const v=[],y=(c=this._spec.dataKey)!==null&&c!==void 0?c:Oo;for(let _=0;_<m.length;_++)for(let b=0;b<u.length;b++)v.push(Object.assign(Object.assign({},u[b]),{[f]:m[_],[y]:m[_]}));u=v}return u};Se(this._option.dataSet,"dimensionItems",a),r=new _e(this._option.dataSet).parse([this._viewDataStatistics],{type:"dataview"}).transform({type:"dimensionItems",options:{scaleDepth:I(i.fieldLevel)?void 0:i.fieldLevel+1}},!1).transform({type:"addVChartProperty",options:{beforeCall:Kg.bind(this),call:qg}},!1),(e=this._viewDataStatistics)===null||e===void 0||e.target.addListener("change",r.reRunAllTransform)}else{const a=([l])=>{const h=[],[c,u]=this.getDimensionContinuousField(),d={};return o.latestData.forEach(p=>{const g=\`\${p[c]}-\${p[u]}\`;d[g]||(d[g]={[c]:p[c],[u]:p[u]},h.push(d[g]))}),h};Se(this._option.dataSet,"dimensionItems",a);const o=this.getViewData();r=new _e(this._option.dataSet).parse([o],{type:"dataview"}).transform({type:"dimensionItems"},!1).transform({type:"addVChartProperty",options:{beforeCall:Kg.bind(this),call:qg}},!1),o==null||o.target.addListener("change",r.reRunAllTransform)}this._barBackgroundViewData=new Xg(this._option,r)}init(t){var e,i;super.init(t),this.direction==="vertical"?((e=this._xAxisHelper)===null||e===void 0?void 0:e.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle():((i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle()}_shouldDoPreCalculate(){const t=this.getRegion();return this.getStack()&&t.getSeries().filter(e=>e.type===this.type&&e.getSpec().barMinHeight).length}_calculateStackRectPosition(t){const e=this.getRegion();if(e._bar_series_position_calculated)return;let i,n,r,a,o;e._bar_series_position_calculated=!0,t?(i=_S,n=yS,r="_dataToPosY1",a="_dataToPosY",o="_yAxisHelper"):(i=vS,n=mS,r="_dataToPosX1",a="_dataToPosX",o="_xAxisHelper");const l=Yb(e,!1,h=>h.type===this.type);for(const h in l)for(const c in l[h].nodes)e1(l[h].nodes[c],e.getStackInverse(),{isVertical:t,start:i,end:n,startMethod:r,endMethod:a,axisHelper:o})}_calculateRectPosition(t,e,i){var n,r;let a,o,l;e?(a="_dataToPosY1",o="_dataToPosY",l="_yAxisHelper"):(a="_dataToPosX1",o="_dataToPosX",l="_xAxisHelper");const h=(r=(n=this[l]).getScale)===null||r===void 0?void 0:r.call(n,0),c=this[l].isInverse(),u=this._spec.barMinHeight,d=Ze(this[a](t),h,i),p=Ze(this[o](t),h,i);let g=Math.abs(d-p);g<u&&(g=u);let f=1;return p<d?f=-1:p===d&&(f=e?c?1:-1:c?-1:1),d+f*g}_dataToPosX(t){return this.dataToPositionX(t)}_dataToPosX1(t){return this.dataToPositionX1(t)}_dataToPosY(t){return this.dataToPositionY(t)}_dataToPosY1(t){return this.dataToPositionY1(t)}initBandRectMarkStyle(){var t,e,i,n;const r=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),a=(n=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||n===void 0?void 0:n.call(i,0);this.direction==="horizontal"?this.setMarkStyle(this._barMark,{x:o=>this._getBarXStart(o,r),x1:o=>this._getBarXEnd(o,r),y:o=>this._getPosition(this.direction,o),height:()=>this._getBarWidth(this._yAxisHelper),width:()=>{},y1:()=>{}},"normal",St.Series):this.setMarkStyle(this._barMark,{y:o=>this._getBarYStart(o,a),y1:o=>this._getBarYEnd(o,a),x:o=>this._getPosition(this.direction,o),width:()=>this._getBarWidth(this._xAxisHelper),x1:()=>{},height:()=>{}},"normal",St.Series),this._initStackBarMarkStyle(),this._initBandBarBackgroundMarkStyle()}_initStackBarMarkStyle(){var t,e,i,n;if(!this._spec.stackCornerRadius)return;const r=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),a=(n=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||n===void 0?void 0:n.call(i,0);this._barMark.setMarkConfig({clip:!0,clipPath:()=>{const o=[];return this._forEachStackGroup(l=>{let h=1/0,c=-1/0,u=!1,d=1/0,p=-1/0;l.values.forEach(m=>{const v=m[Xs],y=m[Xi],_=m[Fn],b=m[Ks];h=Math.min(h,v,y),c=Math.max(c,v,y),R(_)&&R(b)&&(u=!0,d=Math.min(d,_,b),p=Math.max(p,_,b))});const g=Object.assign(Object.assign(Object.assign({},l.values[0]),{[Xs]:h,[Xi]:c}),u?{[Fn]:d,[Ks]:p}:void 0),f=this.direction==="horizontal"?{x:this._getBarXStart(g,r),x1:this._getBarXEnd(g,r),y:this._getPosition(this.direction,g),height:this._getBarWidth(this._yAxisHelper)}:{y:this._getBarYStart(g,a),y1:this._getBarYEnd(g,a),x:this._getPosition(this.direction,g),width:this._getBarWidth(this._xAxisHelper)};o.push(fh(Object.assign(Object.assign({},f),{cornerRadius:U(this._spec.stackCornerRadius)?this._spec.stackCornerRadius(f,g,this._markAttributeContext):this._spec.stackCornerRadius,fill:!0})))}),o}})}initLinearRectMarkStyle(){var t,e,i,n;const r=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),a=(n=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||n===void 0?void 0:n.call(i,0);if(this.direction==="horizontal"){const o=R(this._fieldY2)?{y:l=>Ze(this._dataToPosY(l),a,!0),y1:l=>Ze(this._dataToPosY1(l),a,!0)}:{y:l=>Ze(this._dataToPosY(l)-this._getBarWidth(this._yAxisHelper)/2,a,!0),height:l=>this._getBarWidth(this._yAxisHelper)};this.setMarkStyle(this._barMark,Object.assign({x:l=>this._getBarXStart(l,r,!0),x1:l=>this._getBarXEnd(l,r,!0)},o),"normal",St.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign({x:()=>this._getBarBackgroundXStart(r),x1:()=>this._getBarBackgroundXEnd(r)},o),"normal",St.Series)}else{const o=R(this._fieldX2)?{x:l=>Ze(this._dataToPosX(l),r,!0),x1:l=>Ze(this._dataToPosX1(l),r,!0)}:{x:l=>Ze(this._dataToPosX(l)-this._getBarWidth(this._xAxisHelper)/2,r,!0),width:l=>this._getBarWidth(this._xAxisHelper)};this.setMarkStyle(this._barMark,Object.assign(Object.assign({},o),{y:l=>this._getBarYStart(l,a),y1:l=>this._getBarYEnd(l,a)}),"normal",St.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign(Object.assign({},o),{y:()=>this._getBarBackgroundYStart(a),y1:()=>this._getBarBackgroundYEnd(a)}),"normal",St.Series)}}_initBandBarBackgroundMarkStyle(){var t,e,i,n,r;if(!this._barBackgroundMark)return;const a=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),o=(n=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||n===void 0?void 0:n.call(i,0),l=(r=this._spec.barBackground)!==null&&r!==void 0?r:{},h=I(l.fieldLevel)?void 0:l.fieldLevel+1;this.direction==="horizontal"?this.setMarkStyle(this._barBackgroundMark,{x:()=>this._getBarBackgroundXStart(a),x1:()=>this._getBarBackgroundXEnd(a),y:c=>this._getPosition(this.direction,c,h,"barBackground"),height:()=>this._getBarWidth(this._yAxisHelper,h),width:()=>{},y1:()=>{}},"normal",St.Series):this.setMarkStyle(this._barBackgroundMark,{x:c=>this._getPosition(this.direction,c,h,"barBackground"),y:()=>this._getBarBackgroundYStart(o),y1:()=>this._getBarBackgroundYEnd(o),width:()=>this._getBarWidth(this._xAxisHelper,h),x1:()=>{},height:()=>{}},"normal",St.Series)}initAnimation(){var t,e;const i={yField:this._fieldY[0],xField:this._fieldX[0],direction:this.direction,growFrom:()=>{var a;const o=this.direction==="horizontal"?(a=this._xAxisHelper)===null||a===void 0?void 0:a.getScale(0):this._yAxisHelper.getScale(0);if(o){const l=o.domain(),h=ji(l),c=Ge(l);return c<0?o.scale(c):h>0?o.scale(h):o.scale(0)}}},n=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset,r=Qg(this);this._barMark.setAnimationConfig(cs((e=et.getAnimationInKey("bar"))===null||e===void 0?void 0:e(i,n),an(this._barMarkName,this._spec,this._markAttributeContext),r))}_getBarWidth(t,e){var i,n;const r=this._groups?this._groups.fields.length:1,a=I(e)?r:Math.min(r,e),o=(n=(i=t.getBandwidth)===null||i===void 0?void 0:i.call(t,a-1))!==null&&n!==void 0?n:6,l=R(this._spec.barWidth)&&a===r,h=R(this._spec.barMinWidth),c=R(this._spec.barMaxWidth);let u=o;return l&&(u=$c(this._spec.barWidth,o)),h&&(u=Math.max(u,$c(this._spec.barMinWidth,o))),c&&(u=Math.min(u,$c(this._spec.barMaxWidth,o))),u}_getPosition(t,e,i,n){var r,a,o,l,h;let c,u,d;t==="horizontal"?(c=this.getYAxisHelper(),u="height",d=n==="barBackground"?this.dataToBarBackgroundPositionY.bind(this):this.dataToPositionY.bind(this)):(c=this.getXAxisHelper(),u="width",d=n==="barBackground"?this.dataToBarBackgroundPositionX.bind(this):this.dataToPositionX.bind(this));const p=c.getScale(0),g=this._groups?this._groups.fields.length:1,f=I(i)?g:Math.min(g,i),m=(a=(r=c.getBandwidth)===null||r===void 0?void 0:r.call(c,f-1))!==null&&a!==void 0?a:6,v=f===g?this._barMark.getAttribute(u,e):m;if(f>1&&R(this._spec.barGapInGroup)){const _=this._groups.fields,b=Y(this._spec.barGapInGroup);let x=0,S=0;for(let A=_.length-1;A>=1;A--){const w=_[A],k=(l=(o=c.getScale(A))===null||o===void 0?void 0:o.domain())!==null&&l!==void 0?l:[],T=k.length,C=$c((h=b[A-1])!==null&&h!==void 0?h:Wt(b),m),M=k.indexOf(e[w]);A===_.length-1?(x+=T*v+(T-1)*C,S+=M*(v+C)):(S+=M*(x+C),x+=x+(T-1)*C)}return p.scale(e[_[0]])+c.getBandwidth(0)/2-x/2+S}const y=he(p.type||"band");return d(e,f)+.5*(m-v)+(y?-m/2:0)}dataToBarBackgroundPositionX(t,e){return this._dataToPosition(t,this._xAxisHelper,this.fieldX,e,this._getBarBackgroundPositionXEncoder,this._setBarBackgroundPositionXEncoder)}dataToBarBackgroundPositionY(t,e){return this._dataToPosition(t,this._yAxisHelper,this.fieldY,e,this._getBarBackgroundPositionYEncoder,this._setBarBackgroundPositionYEncoder)}onLayoutEnd(t){super.onLayoutEnd(t),this.getRegion()._bar_series_position_calculated=!1,this._spec.sampling&&this.compile()}compile(){if(super.compile(),this._spec.sampling){const{width:t,height:e}=this._region.getLayoutRect(),i=[],n=this._fieldY,r=this._fieldX;i.push({type:"sampling",size:this._direction==="horizontal"?e:t,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?r[0]:n[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(i)}}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._barMark]}compileData(){var t;super.compileData(),(t=this._barBackgroundViewData)===null||t===void 0||t.compile()}fillData(){var t,e;super.fillData(),(e=(t=this._barBackgroundViewData)===null||t===void 0?void 0:t.getDataView())===null||e===void 0||e.reRunAllTransform()}viewDataUpdate(t){var e,i,n;super.viewDataUpdate(t),(i=(e=this._barBackgroundViewData)===null||e===void 0?void 0:e.getDataView())===null||i===void 0||i.reRunAllTransform(),(n=this._barBackgroundViewData)===null||n===void 0||n.updateData()}release(){var t;super.release(),(t=this._barBackgroundViewData)===null||t===void 0||t.release(),this._barBackgroundViewData=null}}hn.type=te.bar,hn.mark=DO,hn.transformerConstructor=s1;const FO=()=>{Lg(),LO(),et.registerAnimation("bar",(s,t)=>({appear:PO(s,t),enter:QS(s,!1),exit:t1(s,!1),disappear:t1(s)})),wu(),ku(),et.registerSeries(hn.type,hn)};class n1 extends cf{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["barWidth","barMaxWidth","barMinWidth","barGapInGroup","barMinHeight","sampling","samplingFactor","barBackground","stackCornerRadius"])}transformSpec(t){super.transformSpec(t),Hg(t)}_transformAxisSpec(t){var e,i;if(super._transformAxisSpec(t),!t.axes)return;const n=t.series.some(a=>a.direction==="horizontal"),r=(e=t.axes.find(a=>a.type==="band"))!==null&&e!==void 0?e:t.axes.find(a=>(n?["left","right"]:["top","bottom"]).includes(a.orient));if(r&&!r.bandSize&&!r.maxBandSize&&!r.minBandSize&&t.autoBandSize){const a=_t(t.autoBandSize)&&(i=t.autoBandSize.extend)!==null&&i!==void 0?i:0,{barMaxWidth:o,barMinWidth:l,barWidth:h,barGapInGroup:c}=t.series.find(u=>u.type==="bar");this._applyAxisBandSize(r,a,{barMaxWidth:o,barMinWidth:l,barWidth:h,barGapInGroup:c})}}}class ha extends Qo{constructor(){super(...arguments),this.transformerConstructor=n1,this.type="bar",this.seriesType=te.bar}}ha.type="bar",ha.seriesType=te.bar,ha.transformerConstructor=n1,Ue(ha,Tu);class el extends OS{constructor(){super(...arguments),this.type=el.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:0})}_getIgnoreAttributes(){return[]}}el.type="area";const jO=()=>{et.registerMark(el.type,el),En(),VE(),V.registerGraphic(Z.area,$d),nb(),ng(),kS()};class NO extends pS{constructor(){super(...arguments),this._getSeriesStyle=(t,e,i)=>{var n,r,a,o;for(const l of Y(e)){let h=(n=this.series.getSeriesStyle(t))===null||n===void 0?void 0:n(l);if(h!==!1||l!=="fill"&&l!=="stroke"||(h=l==="fill"?(a=(r=this.series.getSeriesStyle(t))===null||r===void 0?void 0:r("stroke"))===null||a===void 0?void 0:a[0]:(o=this.series.getSeriesStyle(t))===null||o===void 0?void 0:o("fill")),R(h))return h}return i}}}const zO=Object.assign(Object.assign(Object.assign({},Un),Gn),{area:{name:"area",type:"area"}}),HO=()=>{et.registerAnimation("area",SS),AS(),xS()};class r1 extends ef{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){var e,i,n;const r=((e=t.point)===null||e===void 0?void 0:e.visible)!==!1&&((n=(i=t.point)===null||i===void 0?void 0:i.style)===null||n===void 0?void 0:n.visible)!==!1;this._addMarkLabelSpec(t,a=>{const o=a.position==="inside-middle";return!r||o?"area":"point"}),this._addMarkLabelSpec(t,"area","areaLabel","initLineLabelMarkStyle",void 0,!0)}_transformSpecAfterMergingTheme(t,e,i){var n,r,a,o,l;super._transformSpecAfterMergingTheme(t,e,i);const{area:h={},line:c={},seriesMark:u}=t,d=h.visible!==!1&&((n=h.style)===null||n===void 0?void 0:n.visible)!==!1,p=c.visible!==!1&&((r=c.style)===null||r===void 0?void 0:r.visible)!==!1;h.support3d=!(!h.support3d&&!c.support3d),h.zIndex=R(h.zIndex)||R(c.zIndex)?Math.max((a=h.zIndex)!==null&&a!==void 0?a:0,(o=c.zIndex)!==null&&o!==void 0?o:0):void 0,h.style&&delete h.style.stroke,h.state&&Object.keys(h.state).forEach(m=>{"style"in h.state[m]?delete h.state[m].style.stroke:delete h.state[m].stroke});let g=h,f=c;(u==="line"||p&&!d)&&(g=c,f=h),h.style=mt({},f.style,g.style),h.state=mt({},f.state,g.state),h.interactive===!1&&(h.style.fillPickable=!1),c.interactive===!1&&(c.style.strokePickable=!1),h.interactive=!(!h.interactive&&(l=c.interactive)!==null&&l!==void 0&&!l),t.area=h,t.line=c}}class cn extends tf{constructor(){super(...arguments),this.type=te.area,this.transformerConstructor=r1,this._sortDataByAxis=!1}initMark(){var t;const e={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},i=this._spec.area||{},n=(t=this._spec.seriesMark)!==null&&t!==void 0?t:"area",r=this._isAreaVisible()||this._isLineVisible();this._areaMark=this._createMark(cn.mark.area,{groupKey:this._seriesField,isSeriesMark:r&&n!=="point",stateSort:i.stateSort},Object.assign(Object.assign({},e),{morphElementKey:this.getDimensionField()[0],setCustomizedShape:i.customShape})),this.initSymbolMark(e,n==="point")}initMarkStyle(){this.initAreaMarkStyle(),this.initSymbolMarkStyle()}initAreaMarkStyle(){var t,e,i,n,r;const a=(i=(e=(t=this.getSpec().area)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.curveType)!==null&&i!==void 0?i:(r=(n=this.getSpec().line)===null||n===void 0?void 0:n.style)===null||r===void 0?void 0:r.curveType,o=a===RS?this._direction==="horizontal"?"monotoneY":"monotoneX":a,l=this._areaMark;if(l){const h=this._isAreaVisible(),c=this._isLineVisible();h||c?l.setVisible(!0):l.setVisible(!1),this._direction==="horizontal"?this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:u=>{var d,p;return Ze(this.dataToPositionX1(u),(p=(d=this._xAxisHelper)===null||d===void 0?void 0:d.getScale)===null||p===void 0?void 0:p.call(d,0))},y:this.dataToPositionY.bind(this),y1:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,orient:this._direction},"normal",St.Series):this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:this.dataToPositionX.bind(this),y1:u=>{var d,p;return Ze(this.dataToPositionY1(u),(p=(d=this._yAxisHelper)===null||d===void 0?void 0:d.getScale)===null||p===void 0?void 0:p.call(d,0))},y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",St.Series),this.setMarkStyle(l,{fill:!!h&&this.getColorAttribute(),stroke:!!c&&this.getColorAttribute()},"normal",St.Series),this._invalidType!=="zero"&&this.setMarkStyle(l,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",St.Series),this.getStack()&&this.setMarkStyle(l,{zIndex:u=>-u[Xi]},"normal",St.Series),this.setMarkStyle(l,{curveType:o},"normal",St.Built_In),Object.keys(l.stateStyle).forEach(u=>{l.stateStyle[u].stroke&&l.setPostProcess("stroke",d=>[d,!1,!1,!1],u)})}}initAnimation(){var t,e,i,n;const r={direction:this.direction},a=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;if(this._lineMark&&this._lineMark.setAnimationConfig(cs((e=et.getAnimationInKey("line"))===null||e===void 0?void 0:e(r,a),an("line",this._spec,this._markAttributeContext))),this._areaMark&&this._areaMark.setAnimationConfig(cs((i=et.getAnimationInKey("area"))===null||i===void 0?void 0:i(r,a),an("area",this._spec,this._markAttributeContext))),this._symbolMark){const o=Qg(this);this._symbolMark.setAnimationConfig(cs((n=et.getAnimationInKey("scaleInOut"))===null||n===void 0?void 0:n(),an("point",this._spec,this._markAttributeContext),o))}}_isAreaVisible(){var t;const e=this._spec.area||{};return e.visible!==!1&&((t=e.style)===null||t===void 0?void 0:t.visible)!==!1}_isLineVisible(){var t;const e=this._spec.line||{};return e.visible!==!1&&((t=e.style)===null||t===void 0?void 0:t.visible)!==!1}initTooltip(){this._tooltipHelper=new NO(this);const{group:t,mark:e}=this._tooltipHelper.activeTriggerSet;this._areaMark&&t.add(this._areaMark),this._lineMark&&t.add(this._lineMark),this._symbolMark&&(e.add(this._symbolMark),t.add(this._symbolMark))}viewDataStatisticsUpdate(t){super.viewDataStatisticsUpdate(t),this.encodeDefined(this._areaMark,"defined")}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._areaMark,this._symbolMark,this._lineMark]}onLayoutEnd(t){super.onLayoutEnd(t),this.reCompileSampling()}getSeriesStyle(t){return e=>{var i,n,r,a,o;const l=(i=this._spec.seriesMark)!==null&&i!==void 0?i:"area";let h=(r=(n=this._seriesMark)===null||n===void 0?void 0:n.getAttribute(e,t))!==null&&r!==void 0?r:void 0;return e!=="fill"||h&&l!=="line"||(e="stroke",h=(o=(a=this._seriesMark)===null||a===void 0?void 0:a.getAttribute(e,t))!==null&&o!==void 0?o:void 0),e==="stroke"&&W(h)?h[0]:h}}}cn.type=te.area,cn.mark=zO,cn.transformerConstructor=r1,Ue(cn,IS);class a1 extends cf{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["point","line","area","seriesMark","activePoint","sampling","samplingFactor","pointDis","pointDisMul","markOverlap","areaLabel"])}transformSpec(t){super.transformSpec(t),Hg(t)}}class ca extends Qo{constructor(){super(...arguments),this.transformerConstructor=a1,this.type="area",this.seriesType=te.area}}ca.type="area",ca.seriesType=te.area,ca.transformerConstructor=a1,Ue(ca,Tu);class VO extends xu{constructor(){super(...arguments),this.coordinate="polar",this._outerRadius=.6,this._innerRadius=0,this._angleField=[],this._radiusField=[],this._sortDataByAxis=!1}get outerRadius(){return this._outerRadius}get innerRadius(){return this._innerRadius}getAngleField(){return this._angleField}setAngleField(t){return this._angleField=R(t)?Y(t):[],this._angleField}getRadiusField(){return this._radiusField}setRadiusField(t){return this._radiusField=R(t)?Y(t):[],this._radiusField}get innerRadiusField(){return this._innerRadiusField}setInnerRadiusField(t){return this._innerRadiusField=Y(t),this._innerRadiusField}get radiusScale(){return this._radiusScale}setRadiusScale(t){return this._radiusScale=t,t}get angleScale(){return this._angleScale}setAngleScale(t){return this._angleScale=t,t}get angleAxisHelper(){return this._angleAxisHelper}set angleAxisHelper(t){this._angleAxisHelper=t,this.onAngleAxisHelperUpdate()}get radiusAxisHelper(){return this._radiusAxisHelper}set radiusAxisHelper(t){this._radiusAxisHelper=t,this.onRadiusAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this),this._markAttributeContext.getCenter=()=>this.angleAxisHelper.center(),this._markAttributeContext.getLayoutRadius=()=>this._computeLayoutRadius()}valueToPosition(t,e){if(I(t)||I(e)||!this.angleAxisHelper||!this.radiusAxisHelper)return{x:Number.NaN,y:Number.NaN};const i=this.radiusAxisHelper.dataToPosition(Y(e));if(i<0){if(this._invalidType==="break"||this._invalidType==="link")return{x:Number.NaN,y:Number.NaN};if(this._invalidType==="zero")return this.angleAxisHelper.center()}const n=this.angleAxisHelper.dataToPosition(Y(t));return this.angleAxisHelper.coordToPoint({angle:n,radius:i})}dataToPosition(t,e){return t&&this.angleAxisHelper&&this.radiusAxisHelper?e&&!this.isDatumInViewData(t)?null:this.valueToPosition(this.getDatumPositionValues(t,this._angleField),this.getDatumPositionValues(t,this._radiusField)):null}dataToPositionX(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.x}dataToPositionY(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.y}dataToPositionZ(t){return 0}positionToData(t){}radiusToData(t){}angleToData(t){}getStatisticFields(){var t,e;const i=[];return!((t=this.radiusAxisHelper)===null||t===void 0)&&t.getScale&&this._radiusField.forEach(n=>{const r={key:n,operations:[]};he(this.radiusAxisHelper.getScale(0).type)?r.operations=["max","min"]:r.operations=["values"],i.push(r)}),!((e=this.angleAxisHelper)===null||e===void 0)&&e.getScale&&this._angleField.forEach(n=>{const r={key:n,operations:[]};he(this.angleAxisHelper.getScale(0).type)?r.operations=["max","min"]:r.operations=["values"],i.push(r)}),i}setAttrFromSpec(){super.setAttrFromSpec(),R(this._spec.outerRadius)&&(this._outerRadius=this._spec.outerRadius),R(this._spec.radius)&&(this._outerRadius=this._spec.radius),R(this._spec.innerRadius)&&(this._innerRadius=this._spec.innerRadius),R(this._spec.sortDataByAxis)&&(this._sortDataByAxis=this._spec.sortDataByAxis===!0)}onRadiusAxisHelperUpdate(){this.onMarkPositionUpdate()}onAngleAxisHelperUpdate(){this.onMarkPositionUpdate()}afterInitMark(){super.afterInitMark()}_computeLayoutRadius(){const t=this._angleAxisHelper||this._radiusAxisHelper;if(t)return t.layoutRadius();const{width:e,height:i}=this._region.getLayoutRect();return Math.min(e/2,i/2)}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(pt.scaleDomainUpdate,{filter:t=>{var e;return t.model.id===((e=this._angleAxisHelper)===null||e===void 0?void 0:e.getAxisId())}},()=>{this._sortDataInAxisDomain()})}_sortDataInAxisDomain(){var t,e;!((e=(t=this.getViewData())===null||t===void 0?void 0:t.latestData)===null||e===void 0)&&e.length&&BS(this.angleAxisHelper,this._angleField[0],this.getViewData().latestData)}getInvalidCheckFields(){const t=[];return this.angleAxisHelper.isContinuous&&this._angleField.forEach(e=>{t.push(e)}),this.radiusAxisHelper.isContinuous&&this._radiusField.forEach(e=>{t.push(e)}),t}}function Cu(s){return wr(s)?Number.parseFloat(s):0}const WO=(s,t)=>{const{asStartAngle:e,asEndAngle:i,asMiddleAngle:n,asRadian:r,asRatio:a,asQuadrant:o,asK:l,showAllZero:h,supportNegative:c,showEmptyCircle:u}=t,d=t.angleField(),p=t.startAngle(),g=t.endAngle(),f=t.minAngle(),m=s.map(C=>Object.assign({},C));if(!m||m.length===0||!h&&u&&o1(m,d,c))return m;const v=(C,M,B)=>{C[e]=M,C[i]=M+B,C[n]=M+B/2,C[r]=B,C[o]=Pf(M+B/2)};let y=0,_=-1/0,b=!0;for(let C=0;C<m.length;C++){const M=c?Math.abs(Cu(m[C][d])):Cu(m[C][d]);y+=M,_=Math.max(M,_),b&&M!==0&&(b=!1),m[C][dg]=M}const x=m.map(C=>Number(C[d])),S=g-p;let A=p,w=S,k=0;const T=function(C,M=2){const B=C.reduce((D,N)=>D+(isNaN(N)?0:N),0);if(B===0)return 0;const O=Math.pow(10,M),E=C.map(D=>(isNaN(D)?0:D)/B*O*100),L=100*O,P=E.map(D=>Math.floor(D));let F=P.reduce((D,N)=>D+N,0);const j=E.map((D,N)=>D-P[N]);for(;F<L;){let D=Number.NEGATIVE_INFINITY,N=null;for(let J=0;J<j.length;J++)j[J]>D&&(D=j[J],N=J);++P[N],j[N]=0,++F}return P.map(D=>D/O)}(x);if(m.forEach((C,M)=>{const B=C[dg],O=y?B/y:0;let E=O*S;E<f?(E=f,w-=f):k+=B;const L=A,P=A+E;C[a]=O,C[l]=_?B/_:0,C._percent_=T[M],v(C,L,E),A=P}),w<S)if(w<=.001){const C=S/m.length;m.forEach((M,B)=>{v(M,p+B*C,C)})}else{const C=w/k;A=p,m.forEach(M=>{const B=M[r]===f?f:M[dg]*C;v(M,A,B),A+=B})}if(y!==0&&(m[m.length-1][i]=g),b&&h){const C=S/m.length;m.forEach((M,B)=>{v(M,p+B*C,C)})}return m},o1=(s,t,e)=>!!I(s)||s.length===0||!!s.every(i=>Cu(i[t])===0)||!e&&s.reduce((i,n)=>i+Cu(n[t]),0)===0;function Mu(s,t,e){return(i,n,r)=>t?s.growField==="radius"?{overall:0}:{overall:s.growFrom(i,n,e)}:{overall:!1}}const l1=s=>({type:s.growField==="radius"?"growRadiusIn":"growAngleIn",options:Mu(s,!0,ce.appear)}),UO={type:"fadeIn"},GO=s=>({type:s.growField==="radius"?"growRadiusIn":"growAngleIn",easing:"linear",options:Mu(s,!0,ce.enter)}),YO=s=>({type:s.growField==="radius"?"growRadiusOut":"growAngleOut",easing:"linear",options:Mu(s,!0,ce.exit)}),$O=s=>({type:s.growField==="radius"?"growRadiusOut":"growAngleOut",options:Mu(s,!0,ce.exit)});function h1(s,t){if(t===!1)return{};switch(t){case"fadeIn":return UO;case"growRadius":return l1(Object.assign(Object.assign({},s),{growField:"radius"}));default:return l1(Object.assign(Object.assign({},s),{growField:"angle"}))}}class XO extends Rs{constructor(t,e){super(t,e),this.type=ua.type,this._unCompileChannel={centerOffset:!0,radiusOffset:!0},this.computeOuterRadius=(i,n,r="normal",a,o)=>{var l;return o+((l=this.getAttribute("radiusOffset",n,r,a))!==null&&l!==void 0?l:0)},this.computeCenter=(i,n,r="normal",a,o)=>xi({x:0,y:0},this.getAttribute("centerOffset",n,r,a),n[Us])[i]+o,this._computeExChannel.x=this.computeCenter,this._computeExChannel.y=this.computeCenter,this._computeExChannel.outerRadius=this.computeOuterRadius,this._extensionChannel.centerOffset=["x","y"],this._extensionChannel.radiusOffset=["outerRadius"]}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{startAngle:0,endAngle:0,outerRadius:0,innerRadius:0,cornerRadius:0,lineWidth:0,innerPadding:0,outerPadding:0})}}class ua extends XO{constructor(){super(...arguments),this.type=ua.type}}ua.type="arc";const KO=()=>{HR(),Ho.useRegisters([II,OI,BI,RI]),et.registerMark(ua.type,ua)},qO=Object.assign(Object.assign({},Un),{pie:{name:"pie",type:"arc"},labelLine:{name:"labelLine",type:"path"}});Object.assign(Object.assign({},Un),{pie3d:{name:"pie3d",type:"arc3d"},labelLine:{name:"labelLine",type:"path"}});class c1 extends Yo{_transformLabelSpec(t){this._addMarkLabelSpec(t,"pie")}_mergeThemeToSpec(t,e){const i=this._theme;let n=t;if(this._shouldMergeThemeToSpec()){const r=this._getDefaultSpecFromChart(e);n=mt({},this._theme,r,t);const a=(o,l)=>mt({},o==="inside"||o==="inside-center"?this._theme.innerLabel:this._theme.outerLabel,l);W(n.label)?n.label=n.label.map(o=>a(o.position,o)):n.label=a(n.label.position,n.label)}return{spec:n,theme:i}}_getDefaultSpecFromChart(t){var e;const i=(e=super._getDefaultSpecFromChart(t))!==null&&e!==void 0?e:{},{centerX:n,centerY:r}=t;return R(n)&&(i.centerX=n),R(r)&&(i.centerY=r),Object.keys(i).length>0?i:void 0}}const ZO=\`\${xt}_LABEL_VISIBLE\`;class il extends VO{constructor(){super(...arguments),this.transformerConstructor=c1,this._pieMarkName="pie",this._pieMarkType="arc",this.getCenter=()=>{var t,e;const i=this._region.getLayoutRect();return{x:Je((t=this._spec)===null||t===void 0?void 0:t.centerX,i.width,i,i.width/2),y:Je((e=this._spec)===null||e===void 0?void 0:e.centerY,i.height,i,i.height/2)}},this._startAngle=$B,this._endAngle=XB,this._pieMark=null,this._labelMark=null,this._labelLineMark=null,this._emptyArcMark=null,this.dataToCentralPosition=t=>{const e=t[Us];if(I(e))return null;const i=this.computeDatumRadius(t),n=this.computeDatumInnerRadius(t);return xi(this.computeCenter(t),(i+n)/2,e)}}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getCenter=()=>({x:()=>this.getCenter().x,y:()=>this.getCenter().y}),this._markAttributeContext.startAngleScale=t=>this.startAngleScale(t),this._markAttributeContext.endAngleScale=t=>this.endAngleScale(t)}setAttrFromSpec(){var t,e,i,n,r,a;super.setAttrFromSpec(),this._centerOffset=(t=this._spec.centerOffset)!==null&&t!==void 0?t:0,this._cornerRadius=(e=this._spec.cornerRadius)!==null&&e!==void 0?e:0;const o=function(l,h){let c=0,u=2*Math.PI;const d=R(l),p=R(h);for(d||p?p?d?(c=l,u=h):(c=h-2*Math.PI,u=h):(c=l,u=l+2*Math.PI):(c=0,u=2*Math.PI);u<=c;)u+=2*Math.PI;for(;c>2*Math.PI;)c-=2*Math.PI,u-=2*Math.PI;for(;u<0;)c+=2*Math.PI,u+=2*Math.PI;return{startAngle:c,endAngle:u}}(R(this._spec.startAngle)?ei(this._spec.startAngle):this._startAngle,R(this._spec.endAngle)?ei(this._spec.endAngle):this._endAngle);this._startAngle=o.startAngle,this._endAngle=o.endAngle,this._padAngle=R(this._spec.padAngle)?ei(this._spec.padAngle):0,this.setAngleField(this._spec.valueField||this._spec.angleField),this._spec.categoryField&&this.setSeriesField(this._spec.categoryField),this._radiusField=[],this._specAngleField=this._angleField.slice(),this._specRadiusField=[],this._showEmptyCircle=(n=(i=this._spec.emptyPlaceholder)===null||i===void 0?void 0:i.showEmptyCircle)!==null&&n!==void 0&&n,this._showAllZero=(r=this._spec.showAllZero)!==null&&r!==void 0&&r,this._supportNegative=(a=this._spec.supportNegative)!==null&&a!==void 0&&a}initData(){super.initData();const t=this.getViewData();if(!t)return;Se(this._dataSet,"pie",WO),t.transform({type:"pie",options:{angleField:()=>this._angleField[0],startAngle:()=>this._startAngle,endAngle:()=>this._endAngle,minAngle:()=>R(this._spec.minAngle)?ei(this._spec.minAngle):0,asStartAngle:wb,asEndAngle:Tb,asRatio:WB,asMiddleAngle:Us,asRadian:YB,asQuadrant:GB,asK:UB,showAllZero:this._showAllZero,supportNegative:this._supportNegative,showEmptyCircle:this._showEmptyCircle}},!1);const e=new _e(this._dataSet,{name:\`\${xt}_series_\${this.id}_viewDataLabel\`});e.parse([this.getViewData()],{type:"dataview"}),this._viewDataLabel=new Xg(this._option,e)}compileData(){var t;super.compileData(),(t=this._viewDataLabel)===null||t===void 0||t.compile()}initMark(){var t,e;this._pieMark=this._createMark(Object.assign(Object.assign({},il.mark.pie),{name:this._pieMarkName,type:this._pieMarkType}),{key:Oo,groupKey:this._seriesField,skipBeforeLayouted:!0,isSeriesMark:!0,stateSort:(t=this._spec.pie)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.pie)===null||e===void 0?void 0:e.customShape,morph:Zg(this._spec,this._pieMarkName),morphElementKey:this._seriesField}),this._showEmptyCircle&&(this._emptyArcMark=this._createMark({name:"emptyCircle",type:"arc"},{dataView:!1}))}startAngleScale(t){return lg(wb)(t)}endAngleScale(t){return lg(Tb)(t)}_computeLayoutRadius(){return((t,e,i,n)=>{const r=t();if(it(r))return r;if(U(r))return r(e(),i());const a=e();if(r==="auto"&&a.width>0&&a.height>0){const{startAngle:o=0,endAngle:l=2*Math.PI}=n();return oA(a,i(),o,l)}return Math.min(a.width/2,a.height/2)})(()=>this._spec.layoutRadius,this.getLayoutRect,this.getCenter,()=>({startAngle:this._startAngle,endAngle:this._endAngle}))}initMarkStyle(){const t={x:()=>this.getCenter().x,y:()=>this.getCenter().y,fill:this.getColorAttribute(),outerRadius:_b(this._outerRadius)?this._outerRadius:()=>this._computeLayoutRadius()*this._outerRadius,innerRadius:_b(this._innerRadius)?this._innerRadius:()=>this._computeLayoutRadius()*this._innerRadius,cornerRadius:()=>this._computeLayoutRadius()*this._cornerRadius,startAngle:n=>this.startAngleScale(n),endAngle:n=>this.endAngleScale(n),padAngle:this._padAngle,centerOffset:this._centerOffset},e=this._pieMark;e&&this.setMarkStyle(e,t,"normal",St.Series);const i=this._emptyArcMark;i&&this.setMarkStyle(i,Object.assign(Object.assign({},t),{visible:()=>{const n=this.getAngleField()[0];return o1(this.getViewData().latestData,n,this._supportNegative)}}),"normal",St.Series)}initInteraction(){this._parseInteractionConfig(this._pieMark?[this._pieMark]:[])}initTooltip(){super.initTooltip(),this._pieMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pieMark)}initMarkStyleWithSpec(t,e,i){if(super.initMarkStyleWithSpec(t,e,i),t.name===this._pieMarkName){const n=this.getSpec()[t.name];if(n)for(const r in n.state||{})this.setMarkStyle(t,this.generateRadiusStyle(n.state[r]),r,St.User_Mark)}t.name==="emptyCircle"&&this.setMarkStyle(t,this.generateRadiusStyle(e.style),"normal",St.User_Mark)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{visible:lg(ZO).bind(this),text:e=>e[this.getDimensionField()[0]],fill:this.getColorAttribute(),z:this.dataToPositionZ.bind(this)})}afterInitMark(){super.afterInitMark()}initEvent(){var t;super.initEvent(),(t=this._viewDataLabel.getDataView())===null||t===void 0||t.target.addListener("change",this.viewDataLabelUpdate.bind(this))}initGroups(){}onLayoutEnd(t){this._viewDataLabel.getDataView().reRunAllTransform(),this.onMarkPositionUpdate(),super.onLayoutEnd(t)}getDimensionField(){return this._seriesField?[this._seriesField]:[]}getMeasureField(){return this._specAngleField}viewDataLabelUpdate(){this.event.emit(pt.viewDataLabelUpdate,{model:this}),this._viewDataLabel.updateData()}generateRadiusStyle(t){if(!t)return;const e={};return t.outerRadius&&(e.outerRadius=()=>this._computeLayoutRadius()*t.outerRadius),t.innerRadius&&(e.innerRadius=()=>this._computeLayoutRadius()*t.innerRadius),t.cornerRadius&&(e.cornerRadius=()=>this._computeLayoutRadius()*t.cornerRadius),e}computeCenter(t){return{x:this._pieMark.getAttribute("x",t,"normal"),y:this._pieMark.getAttribute("y",t,"normal")}}getRadius(t="normal"){var e,i,n,r,a,o,l;const h=t==="normal"?(n=(i=this.getSpec()[((e=this._pieMark)===null||e===void 0?void 0:e.name)||"pie"])===null||i===void 0?void 0:i.style)===null||n===void 0?void 0:n.outerRadius:(l=(o=(a=this.getSpec()[((r=this._pieMark)===null||r===void 0?void 0:r.name)||"pie"])===null||a===void 0?void 0:a.state)===null||o===void 0?void 0:o[t])===null||l===void 0?void 0:l.outerRadius;return h??this._outerRadius}getInnerRadius(t="normal"){var e,i,n,r,a,o,l;const h=t==="normal"?(n=(i=this.getSpec()[((e=this._pieMark)===null||e===void 0?void 0:e.name)||"pie"])===null||i===void 0?void 0:i.style)===null||n===void 0?void 0:n.innerRadius:(l=(o=(a=this.getSpec()[((r=this._pieMark)===null||r===void 0?void 0:r.name)||"pie"])===null||a===void 0?void 0:a.state)===null||o===void 0?void 0:o[t])===null||l===void 0?void 0:l.innerRadius;return h??this._innerRadius}computeRadius(t,e){return this._computeLayoutRadius()*t*(I(e)?1:e)+this._centerOffset}computeDatumRadius(t,e){return this._computeLayoutRadius()*this.getRadius(e)+this._centerOffset}_compareSpec(t,e,i){i=i??{data:!0};const n=["centerX","centerY","centerOffset","radius","innerRadius","cornerRadius","startAngle","endAngle","padAngle"];n.forEach(a=>{i[a]=!0});const r=super._compareSpec(t,e,i);return t=t??{},n.some(a=>t[a]!==e[a])&&(r.reRender=!0,r.change=!0),r}computeDatumInnerRadius(t,e){return this._computeLayoutRadius()*this.getInnerRadius(e)+this._centerOffset}dataToPosition(t,e){const i=t[Us];if(I(i)||e&&!this.isDatumInViewData(t))return null;const n=this.computeDatumRadius(t);return xi(this.computeCenter(t),n,i)}initAnimation(){var t,e,i;const n={growFrom:(a,o,l)=>{var h;if(l===ce.appear)return this._startAngle;if(l===ce.disappear)return this._endAngle;const c=[ce.disappear,ce.exit],u=o.mark.elements,d=a,p=d==null?void 0:d[Dn];if(u.find(f=>{var m;return((m=f.data[0])===null||m===void 0?void 0:m[Dn])<p})===void 0)return this._startAngle;if(u.find(f=>{var m;return((m=f.data[0])===null||m===void 0?void 0:m[Dn])>p})===void 0)return this._endAngle;const g=[...u].reverse().find(f=>{var m;return((m=f.data[0])===null||m===void 0?void 0:m[Dn])<p});return c.includes(l)?(h=g==null?void 0:g.getNextGraphicAttributes())===null||h===void 0?void 0:h.endAngle:g==null?void 0:g.getGraphicAttribute("endAngle",!0)}},r=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;if(this._pieMark){const a=cs((e=et.getAnimationInKey("pie"))===null||e===void 0?void 0:e(n,r),an("pie",this._spec,this._markAttributeContext));a.normal&&a.normal.type&&(a.normal=function(o,l){var h,c,u,d;const p=(c=(h=l.options)===null||h===void 0?void 0:h.distance)!==null&&c!==void 0?c:10,g=q(l.duration)?l.duration/2:1e3,f=(u=l.options.easing)!==null&&u!==void 0?u:"cubicOut";return{oneByOne:l.oneByOne,loop:(d=l.loop)!==null&&d!==void 0&&d,timeSlices:[{duration:g,effects:{easing:f,channel:{x:{from:m=>o.getAttribute("x",m),to:m=>o.getAttribute("x",m)+xi({x:0,y:0},p,m[Us]).x},y:{from:m=>o.getAttribute("y",m),to:m=>o.getAttribute("y",m)+xi({x:0,y:0},p,m[Us]).y}}}},{duration:g,effects:{easing:f,channel:{x:{to:m=>o.getAttribute("x",m),from:m=>o.getAttribute("x",m)+xi({x:0,y:0},p,m[Us]).x},y:{to:m=>o.getAttribute("y",m),from:m=>o.getAttribute("y",m)+xi({x:0,y:0},p,m[Us]).y}}}}]}}(this._pieMark,a.normal)),this._pieMark.setAnimationConfig(a)}if(this._emptyArcMark){const a=cs((i=et.getAnimationInKey("emptyCircle"))===null||i===void 0?void 0:i(n,r??"fadeIn"));this._emptyArcMark.setAnimationConfig(a)}}getDefaultShapeType(){return"circle"}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}_noAnimationDataKey(t,e){return e}getActiveMarks(){return[this._pieMark]}}il.transformerConstructor=c1,il.mark=qO;class uf extends il{constructor(){super(...arguments),this.type=te.pie}}uf.type=te.pie;const JO=()=>{KO(),et.registerAnimation("pie",(s,t)=>({appear:h1(s,t),enter:GO(s),exit:YO(s),disappear:$O(s)})),et.registerAnimation("emptyCircle",(s,t)=>({appear:h1(s,t)})),et.registerSeries(uf.type,uf)};class QO extends hf{_isValidSeries(t){return!this.seriesType||t===this.seriesType}getIndicatorSpec(t){var e,i,n;const r=Y(t.indicator),a=(e=t.innerRadius)!==null&&e!==void 0?e:(n=(i=t.series)===null||i===void 0?void 0:i[0])===null||n===void 0?void 0:n.innerRadius;return R(a)&&r.forEach(o=>{I(o.limitRatio)&&(o.limitRatio=a)}),r}_getDefaultSeriesSpec(t,e){return super._getDefaultSeriesSpec(t,["radius","outerRadius","innerRadius","startAngle","endAngle","sortDataByAxis"],e)}transformSpec(t){super.transformSpec(t),W(t.dataZoom)&&t.dataZoom.length>0&&t.dataZoom.forEach(e=>{e.filterMode==="axis"&&(e.filterMode="filter")}),this.transformSeriesSpec(t),R(t.indicator)&&(t.indicator=this.getIndicatorSpec(t))}}class Eu extends QO{needAxes(){return!1}_getDefaultSeriesSpec(t){var e;const i=super._getDefaultSeriesSpec(t,["center","centerOffset","cornerRadius","padAngle","minAngle","emptyPlaceholder","showAllZero","supportNegative","layoutRadius"]);return i.categoryField=t.categoryField||t.seriesField,i.valueField=t.valueField||t.angleField,i.emptyCircle=(e=t.emptyPlaceholder)===null||e===void 0?void 0:e.emptyCircle,i}}class u1 extends Qo{constructor(){super(...arguments),this.transformerConstructor=Eu}}u1.transformerConstructor=Eu;class sl extends u1{constructor(){super(...arguments),this.transformerConstructor=Eu,this.type="pie",this.seriesType=te.pie}}sl.type="pie",sl.seriesType=te.pie,sl.transformerConstructor=Eu;class d1 extends hf{_getDefaultSeriesSpec(t){const e=super._getDefaultSeriesSpec(t);return delete e.data,e}_transformAxisSpec(t){t.axes&&t.autoBandSize&&t.series.forEach((e,i)=>{var n;if(e.type==="bar"){const r=this._findBandAxisBySeries(e,i,t.axes);if(r&&!r.bandSize&&!r.maxBandSize&&!r.minBandSize){const a=_t(e.autoBandSize)&&(n=e.autoBandSize.extend)!==null&&n!==void 0?n:0,{barMaxWidth:o,barMinWidth:l,barWidth:h,barGapInGroup:c}=e;this._applyAxisBandSize(r,a,{barMaxWidth:o,barMinWidth:l,barWidth:h,barGapInGroup:c})}}})}transformSpec(t){if(super.transformSpec(t),t.series&&t.series.length){const e=this._getDefaultSeriesSpec(t);t.series.forEach(i=>{this._isValidSeries(i.type)&&Object.keys(e).forEach(n=>{n in i||(i[n]=e[n])})})}t.axes&&t.axes.length&&t.axes.forEach(e=>{vt(e,"trimPadding")&&mt(e,Jx(this.type,t))}),this._transformAxisSpec(t)}}class nl extends Qo{constructor(){super(...arguments),this.transformerConstructor=d1,this.type="common"}}nl.type="common",nl.transformerConstructor=d1,Ue(nl,Tu);const p1={rect:m1,symbol:f1,arc:v1,point:function(s){const{labelSpec:t}=s;let e;return e=t.overlap!==!1&&{avoidBaseMark:!1},{position:"center",overlap:e}},"line-data":function(s){const t=f1(s);return pe(t.overlap)||(t.overlap.avoidBaseMark=!1),t},stackLabel:function(s,t,e){const i=s.series,n=s.labelSpec||{},r=i.getTotalData();return{customLayoutFunc:a=>a.map(o=>{const l=n.position||"withChange",h=n.offset||0,c=t?t(o.data):o.data,u=g1(s,c,n.formatMethod);return u.x=function(d,p,g,f){return p.direction==="horizontal"?g==="middle"?.5*(p.totalPositionX(d,"end")+p.totalPositionY(d,"start")):g==="max"?p.totalPositionX(d,d.end>=d.start?"end":"start")+f:g==="min"?p.totalPositionX(d,d.end>=d.start?"start":"end")-f:p.totalPositionX(d,"end")+(d.end>=d.start?f:-f):p.totalPositionX(d,"index",.5)}(c,i,l,h),u.y=function(d,p,g,f){return p.direction==="horizontal"?p.totalPositionY(d,"index",.5):g==="middle"?.5*(p.totalPositionY(d,"end")+p.totalPositionY(d,"start")):g==="max"?p.totalPositionY(d,d.end>=d.start?"end":"start")-f:g==="min"?p.totalPositionY(d,d.end>=d.start?"start":"end")+f:p.totalPositionY(d,"end")+(d.end>=d.start?-f:f)}(c,i,l,h),i.direction==="horizontal"?u.textAlign=l==="middle"?"center":l==="withChange"&&c.end-c.start>=0||l==="max"?"left":"right":u.textBaseline=l==="middle"?l:l==="withChange"&&c.end-c.start>=0||l==="max"?"bottom":"top",e==null||e(o,c,u),Ka(Object.assign(Object.assign({},u),{id:o.id}))}),dataFilter:a=>{const o=[];return r.forEach(l=>{const h=a.find(c=>{var u;return l.index===((u=c.data)===null||u===void 0?void 0:u[i.getDimensionField()[0]])});h&&(h.data=l,o.push(h))}),o},overlap:{strategy:[]}}},line:y1,area:y1,rect3d:m1,arc3d:v1,treemap:function(s){return{customLayoutFunc:(t,e)=>e,overlap:!1}},venn:function(s){return{customLayoutFunc:(t,e)=>e,smartInvert:!0}}};function tP(s,t){var e;const{labelSpec:i}=t;i.overlap&&!_t(i.overlap)&&(i.overlap={});const n=(e=p1[s])!==null&&e!==void 0?e:p1.point;return t.series.type===te.sankey?function(r){var a,o,l;const{series:h,labelSpec:c={}}=r,u=(a=Bu(c.position))!==null&&a!==void 0?a:"outside",d=h.direction;let p,g=u;return Q(u)&&(d==="vertical"?g=u==="inside-start"?f=>"inside-left":u==="inside-middle"?f=>"center":u==="inside-end"?f=>"inside-right":f=>"bottom":u==="inside-start"?g=f=>"inside-left":u==="inside-middle"?g=f=>"center":u==="inside-end"?g=f=>"inside-right":u==="outside"&&(g=f=>"right")),p=c.overlap!==!1&&(!Q(u)||!u.includes("inside"))&&{strategy:(l=(o=c.overlap)===null||o===void 0?void 0:o.strategy)!==null&&l!==void 0?l:sP(h)},{position:g,overlap:p,smartInvert:!1,offset:0,syncState:!0}}(t):n(t)}function g1(s,t,e,i){var n;const{labelMark:r,series:a}=s,o={text:t[a.getMeasureField()[0]],data:t,textType:(n=s.labelSpec.textType)!==null&&n!==void 0?n:"text"},l=Object.keys(r.stateStyle.normal);for(const h of l){const c=r.getAttribute(h,t);o[h]=c}if(a.type!==te.sankey){const{formatFunc:h,args:c}=ra(e,i,o.text,t);h&&(o._originText=o.text,o.text=h(...c,{series:a}))}return o}function Bu(s){return U(s)?t=>s(t.data):s}function f1(s){var t,e,i;const{series:n,labelSpec:r}=s,a=n.direction==="horizontal"?"right":"top",o=(t=Bu(r.position))!==null&&t!==void 0?t:a;let l;return l=r.overlap!==!1&&{strategy:(i=(e=r.overlap)===null||e===void 0?void 0:e.strategy)!==null&&i!==void 0?i:eP(),avoidBaseMark:o!=="center"},{position:o,overlap:l}}function eP(){return[{type:"position",position:["top","bottom","right","left","top-right","top-left","bottom-left","bottom-right"]}]}function m1(s){var t,e,i,n,r,a;const{series:o,labelSpec:l={}}=s,h=(t=Bu(l.position))!==null&&t!==void 0?t:"outside",c=(e=o.direction)!==null&&e!==void 0?e:"vertical",u=o.direction==="horizontal"?(i=o.getXAxisHelper())===null||i===void 0?void 0:i.isInverse():(n=o.getYAxisHelper())===null||n===void 0?void 0:n.isInverse();let d,p=h;p=f=>{var m;const{data:v}=f,y=(m=typeof l.position=="function"?l.position(v):l.position)!==null&&m!==void 0?m:"outside";if(y==="outside"){const _=o.getMeasureField()[0],b={vertical:["top","bottom"],horizontal:["right","left"]},x=(v==null?void 0:v[_])>=0&&u||(v==null?void 0:v[_])<0&&!u?1:0;return b[c][x]}return y},d=l.overlap!==!1&&{strategy:(a=(r=l.overlap)===null||r===void 0?void 0:r.strategy)!==null&&a!==void 0?a:iP(o)};let g=!1;return Q(h)&&h.includes("inside")&&(g=!0),{position:p,overlap:d,smartInvert:g}}function iP(s){return[{type:"position",position:t=>{var e,i;const{data:n}=t,r=s.getMeasureField()[0];return(s.direction==="horizontal"?!((e=s.getXAxisHelper())===null||e===void 0)&&e.isInverse():!((i=s.getYAxisHelper())===null||i===void 0)&&i.isInverse())?(n==null?void 0:n[r])>=0?s.direction==="horizontal"?["left","inside-left"]:["bottom","inside-bottom"]:s.direction==="horizontal"?["right","inside-right"]:["top","inside-top"]:(n==null?void 0:n[r])>=0?s.direction==="horizontal"?["right","inside-right"]:["top","inside-top"]:s.direction==="horizontal"?["left","inside-left"]:["bottom","inside-bottom"]}}]}function v1(s){var t;const{labelSpec:e}=s,i=(t=Bu(e.position))!==null&&t!==void 0?t:"outside",n=i;let r;return r=e.smartInvert?e.smartInvert:Q(i)&&i.includes("inside"),{position:n,smartInvert:r}}function y1(s){var t,e,i,n;const{labelSpec:r,series:a}=s,o=(i=(e=(t=a.getViewDataStatistics)===null||t===void 0?void 0:t.call(a).latestData)===null||e===void 0?void 0:e[a.getSeriesField()])===null||i===void 0?void 0:i.values,l=o?o.map((h,c)=>({[a.getSeriesField()]:h,index:c})):[{index:0,[$s]:a.getSeriesKeys()[0]}];return{position:(n=r.position)!==null&&n!==void 0?n:"end",data:l}}function sP(s){return[{type:"position",position:t=>s.direction==="horizontal"?["right","left"]:["bottom","top"]}]}class _1 extends aa{constructor(t,e){super(t,e),this.type=st.label,this.name=st.label,this.layoutType="none",this.layoutZIndex=Qe.Label,this._regions=e.getRegionsInIndex(e.regionIndexes)}_interactiveConfig(t){const{interactive:e}=t,i={hover:!1,select:!1,state:t.state};if(e!==!0)return i;const{hover:n,select:r}=this._option.getChart().getSpec();return n===!1&&n.enable===!1||(i.hover=!0),r===!1&&r.enable===!1||(i.select=!0),i}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reRender=!0,Xt(e,t)||(i.reMake=!0),i}onRender(t){}changeRegions(t){}_getNeedClearVRenderComponents(){return[]}}_1.type=st.label;class Ru extends Rs{getTextType(){return this._textType}constructor(t,e){super(t,e),this.type=Ru.type,this._textType="text"}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{angle:0,textAlign:"center",lineWidth:0,textConfig:[]})}initStyleWithSpec(t,e){super.initStyleWithSpec(t,e),t.textType&&(this._textType=t.textType)}compileEncode(){super.compileEncode(),this._textType==="rich"&&this._product.encodeState("group",{textType:this._textType})}}Ru.type="text";class Iu extends Ru{constructor(){super(...arguments),this.skipEncode=!1}getRule(){return this._rule}setRule(t){this._rule=t}getTarget(){return this._target}setTarget(t){this._target=t,this._rule||this.setRule(t.type)}getComponent(){return this._component}setComponent(t){this._component=t}}Iu.type="text",Iu.constructorType="label";const nP=()=>{et.registerMark(Iu.constructorType,Iu),En(),Dr(),vo(),V.registerGraphic(Z.text,Ka)};class b1 extends Su{_initTheme(t,e){return{spec:t,theme:this._theme}}}class rl extends _1{constructor(t,e){super(t,e),this.type=st.label,this.name=st.label,this.specKey="label",this.transformerConstructor=b1,this.layoutZIndex=Qe.Label,this._layoutRule=t.labelLayout||"series"}static getSpecInfo(t,e){const i=[];return((e==null?void 0:e.region)||[]).forEach((r,a)=>{(r.seriesIndexes||[]).some(o=>{const l=e.series[o],{markLabelSpec:h={}}=l;return Object.values(h).some(c=>Array.isArray(c)&&(u=>u.some(d=>d.visible))(c))})&&i.push({spec:t,type:st.label,specInfoPath:["component",this.specKey,a],regionIndexes:[a]})}),i}init(t){super.init(t),this.initEvent(),this._initTextMark(),this._initLabelComponent(),this._initTextMarkStyle()}reInit(t){super.reInit(t),this._labelInfoMap&&this._labelInfoMap.clear(),this._initTextMark(),this._initTextMarkStyle()}initEvent(){this.event.on(pt.dataZoomChange,()=>{this._labelComponentMap.forEach((e,i)=>{const n=i.getProduct().getGroupGraphicItem();n&&n.disableAnimation()}),this.event.on(at.AFTER_MARK_RENDER_END,t)});const t=()=>{this._labelComponentMap.forEach((e,i)=>{const n=i.getProduct().getGroupGraphicItem();n&&n.enableAnimation()}),this.event.off(at.AFTER_MARK_RENDER_END,t)}}_initTextMark(){this._labelInfoMap||(this._labelInfoMap=new Map),this._labelComponentMap||(this._labelComponentMap=new Map),qe(this._regions,t=>{const{markLabelSpec:e={}}=t.getSpecInfo(),i=Object.keys(e),n=t.getRegion();this._labelInfoMap.get(n)||this._labelInfoMap.set(n,[]);for(let r=0;r<i.length;r++){const a=i[r],o=t.getMarkInName(a);o&&e[a].forEach((l,h)=>{var c,u;if(l.visible){const d=this._labelInfoMap.get(n),p=this._createMark({type:"label",name:\`\${a}-label-\${h}\`},{noSeparateStyle:!0,attributeContext:t.getMarkAttributeContext()});l.showRelatedMarkTooltip&&((u=(c=t.tooltipHelper)===null||c===void 0?void 0:c.activeTriggerSet.mark)===null||u===void 0||u.add(p)),p.setTarget(o),d.push({labelMark:p,baseMark:o,series:t,labelSpec:l})}})}})}_initLabelComponent(){this._labelInfoMap.forEach((t,e)=>{if(this._layoutRule==="region"){const i=this._createMark({type:"component",name:\`\${e.getGroupMark().name}-label-component\`},{componentType:"label",noSeparateStyle:!0},{support3d:this._spec.support3d});i&&(i.setSkipBeforeLayouted(!0),t[0]&&R(t[0].labelSpec.zIndex)&&i.setMarkConfig({zIndex:t[0].labelSpec.zIndex}),this._marks.addMark(i),this._labelComponentMap.set(i,()=>this._labelInfoMap.get(e)))}else t.forEach((i,n)=>{const r=this._createMark({type:"component",name:\`\${i.labelMark.name}-component\`},{componentType:"label",noSeparateStyle:!0},{support3d:i.baseMark.getMarkConfig().support3d});r&&(R(i.labelSpec.zIndex)&&r.setMarkConfig({zIndex:i.labelSpec.zIndex}),r.setSkipBeforeLayouted(!0),this._marks.addMark(r),this._labelComponentMap.set(r,()=>this._labelInfoMap.get(e)[n]))})})}_initTextMarkStyle(){this._labelComponentMap.forEach((t,e)=>{Y(t()).forEach(({labelMark:i})=>{i.setComponent(e)})}),this._labelInfoMap.forEach(t=>{t.forEach(e=>{var i,n;const{labelMark:r,labelSpec:a,series:o}=e;if(this.initMarkStyleWithSpec(r,a,void 0),U(a==null?void 0:a.getStyleHandler)){const l=a.getStyleHandler(o);l==null||l.call(o,r,a)}!((n=(i=r.stateStyle)===null||i===void 0?void 0:i.normal)===null||n===void 0)&&n.lineWidth&&r.setAttribute("stroke",o.getColorAttribute(),"normal",St.Base_Series)})})}updateLayoutAttribute(){super.updateLayoutAttribute(),this._labelComponentMap.forEach((t,e)=>{const i=t();W(i)?this._updateMultiLabelAttribute(i,e):this._updateSingleLabelAttribute(i,e)})}_updateMultiLabelAttribute(t,e){this._updateLabelComponentAttribute(e.getProduct(),t.map(({baseMark:i})=>i.getProduct()),t)}_updateSingleLabelAttribute(t,e){const{baseMark:i}=t;this._updateLabelComponentAttribute(e.getProduct(),i.getProduct(),[t])}_updateLabelComponentAttribute(t,e,i){const n=this._option.getComponentsByType("totalLabel");t.target(e).configure({interactive:!1}).depend(n.map(r=>r.getMarks()[0].getProduct())).labelStyle((r,a)=>{var o,l;const h=i[a.labelIndex];if(h){const{labelSpec:c,labelMark:u,series:d}=h,p=u.getRule(),g=this._interactiveConfig(c),f=(l=(o=this._spec)===null||o===void 0?void 0:o.centerOffset)!==null&&l!==void 0?l:0;let m=mt({textStyle:Object.assign({pickable:c.interactive===!0},c.style),overlap:{avoidMarks:n.map(v=>v.getMarks()[0].getProductId())}},tP(p,h),Object.assign(Object.assign(Object.assign({},ju(c,["position","style","state","type","stackDataFilterType","getStyleHandler"])),g),{centerOffset:f}),c.stackDataFilterType?{dataFilter:c.stackDataFilterType==="min"?v=>v.filter(y=>y.data[Sg]):v=>v.filter(y=>y.data[xg])}:{});return d&&d.parseLabelStyle&&(m=d.parseLabelStyle(m,c,u)),p!=="line"&&p!=="area"||(m.type=p),m}}).encode((r,a,o)=>{if(i[o.labelIndex]){const{labelSpec:l,labelMark:h}=i[o.labelIndex];return h.skipEncode?{data:r}:g1(i[o.labelIndex],r,l.formatMethod,l.formatter)}}).size(()=>{var r;return Object.assign({padding:(r=i[0].labelSpec.overlap)===null||r===void 0?void 0:r.padding},i[0].series.getRegion().getLayoutRect())})}compileMarks(){this.getMarks().forEach(t=>{const e=this._labelComponentMap.get(t)();let i;i=W(e)?e[0].series.getRegion().getGroupMark().getProduct():e.series.getRegion().getGroupMark().getProduct(),t.compile({group:i,context:{model:this,labelInfo:e}})})}getVRenderComponents(){const t=[];return this._labelComponentMap.forEach((e,i)=>{const n=i.getProduct().getGroupGraphicItem();n&&t.push(n)}),t}getLabelInfoByTextGraphic(t){let e;const i=t==null?void 0:t.parent,n=i==null?void 0:i.parent;if(n){const r=n.getChildren().indexOf(i);this._labelComponentMap.forEach((a,o)=>{o.getProduct().getGroupGraphicItem()===n&&(e=Y(a())[r])})}return e}}rl.type=st.label,rl.specKey="label",rl.transformerConstructor=b1;var x1;(function(s){s[s.ALL=3]="ALL",s[s.HORIZONTAL=2]="HORIZONTAL",s[s.VERTICAL=1]="VERTICAL"})(x1||(x1={}));const rP={x:["top","bottom"],y:["left","right"],category:["angle"],value:["radius"]};class S1 extends aa{get enableRemain(){return this.triggerOff==="none"}constructor(t,e){super(t,e),this.specKey="crosshair",this.layoutType="none",this.gridZIndex=Qe.CrossHair_Grid,this.labelZIndex=Qe.CrossHair,this.trigger="hover",this._handleIn=i=>{if(!this._option)return;const{x:n,y:r}=this.calculateTriggerPoint(i);this.showDefault=!1,this._layoutCrosshair(n,r);const a=this._getNeedClearVRenderComponents();this._hasActive=a.some(o=>o&&o.attribute.visible!==!1)},this._handleClickInEvent=i=>{if(!this._hasActive||!this._spec.lockAfterClick||this._clickLock)return this._clickLock?(this._clickLock=!1,void this._handleOutEvent()):void(this._onlyLockClick||(this._handleIn(i),it(this.triggerOff)&&(this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{this._handleOutEvent()},this.triggerOff))));this._clickLock=!0},this._handleHoverInEvent=tr(i=>{this._clickLock||this._handleIn(i)},10),this._handleOutEvent=()=>{this.enableRemain||this._clickLock||!this._hasActive||(this.clearOutEvent(),this.hide())},this._handleTooltipShow=i=>{const n=i.tooltipData;if(i.isEmptyTooltip||!n||!n.length)return void this._handleTooltipHideOrRelease();if(_t(this._spec.followTooltip)&&this._spec.followTooltip[i.activeType]===!1)return void this._handleTooltipHideOrRelease();const{x:r,y:a}=this.calculateTriggerPoint(i);this.showDefault=!1,this._layoutCrosshair(r,a,n,i.activeType);const o=this._getNeedClearVRenderComponents();this._hasActive=o.some(l=>l&&l.attribute.visible!==!1)},this._handleTooltipHideOrRelease=()=>{this.clearOutEvent(),this.hide()},this.enable=!0,this.showDefault=!0}_setAllAxisValues(t,e,i){let n=!1;if(t.forEach(a=>{fi(a.axis.getScale().type)&&(n?this.enable=!1:n=!0)}),!this.enable)return!1;const{currentValue:r}=this._stateByField[i];return t.forEach((a,o)=>{const l=a.axis;r.set(o,{datum:this._getDatumAtPoint(l,e),axis:l})}),!0}clearAxisValue(){Object.keys(this._stateByField).forEach(t=>{this._stateByField[t].currentValue.clear()})}hideCrosshair(){this.clearAxisValue(),this.hide()}showCrosshair(t){t&&t.length&&(this.showDefault=!1,this.clearAxisValue(),t.forEach(e=>{const{axis:i,value:n}=e;this.setAxisValue(n,i)}),this.layoutByValue(!1))}_getLimitBounds(){var t,e;if(!this._limitBounds){const{width:i,height:n}=(e=(t=this._option.globalInstance.getChart())===null||t===void 0?void 0:t.getViewRect())!==null&&e!==void 0?e:{width:0,height:0};this._limitBounds={x1:0,y1:0,x2:i,y2:n}}return this._limitBounds}_showDefaultCrosshairBySpec(){Object.keys(this._stateByField).forEach(t=>{const e=this._spec[t];if(e&&e.visible&&e.defaultSelect){const{axisIndex:i,datum:n}=e.defaultSelect,r=this._option.getComponentsByKey("axes").find(a=>a.getSpecIndex()===i);r&&(this._stateByField[t].currentValue.clear(),this._stateByField[t].currentValue.set(i,{axis:r,datum:n}))}})}_updateVisibleCrosshair(){let t=!1;Object.keys(this._stateByField).forEach(e=>{const i=this._spec[e];i&&i.visible&&this._stateByField[e].currentValue.size?t=!0:this._hideByField(e)}),t&&this.layoutByValue(!1)}_showDefaultCrosshair(){this.showDefault?(this._showDefaultCrosshairBySpec(),this.layoutByValue(!1)):this._updateVisibleCrosshair()}setAttrFromSpec(){super.setAttrFromSpec(),this._parseCrosshairSpec()}created(){super.created(),this._initEvent()}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake||Xt(e,t)||(i.reRender=!0,i.reMake=!0),i}_initEvent(){if(!this._option.disableTriggerEvent)if(this._spec.followTooltip)this._registerTooltipEvent();else{const t=this._getTriggerEvent();t&&t.forEach(e=>{this._registerEvent(e.in,!1,e.click),e.out&&this._registerEvent(e.out,!0)})}}_registerEvent(t,e,i){const n=e?this._handleOutEvent:i?this._handleClickInEvent:this._handleHoverInEvent,r=e?{level:We.chart}:{source:It.chart};W(t)?t.forEach(a=>{this.event.on(a,r,n)}):this.event.on(t,r,n)}_eventOff(t,e,i){const n=e?this._handleOutEvent:i?this._handleClickInEvent:this._handleHoverInEvent;W(t)?t.forEach(r=>{this.event.off(r,n)}):this.event.off(t,n)}updateLayoutAttribute(){this._limitBounds=null,this._showDefaultCrosshair()}calculateTriggerPoint(t){const{event:e}=t,i=this._option.getCompiler().getStage().getLayer(void 0),n={x:e.viewX,y:e.viewY};return i.globalTransMatrix.transformPoint({x:e.viewX,y:e.viewY},n),{x:n.x-this.getLayoutStartPoint().x,y:n.y-this.getLayoutStartPoint().y}}_getTriggerEvent(){const{mode:t=K.RenderModeEnum["desktop-browser"]}=this._option,e=function(i){return i===K.RenderModeEnum["desktop-browser"]||i===K.RenderModeEnum["desktop-miniApp"]?{click:"pointertap",hover:"pointermove",hoverOut:"pointerleave",clickOut:"pointerleave"}:Ar(i)||kr(i)?{click:"tap",hover:["pointerdown","pointermove"],hoverOut:"pointerleave",clickOut:"pointerleave"}:null}(t);if(e){const i=Y(this.trigger||"hover"),n=a=>a==="click"?this.triggerOff==="none"?null:e.clickOut:e.hoverOut;this._spec.lockAfterClick&&!i.includes("click")?(i.push("click"),this._onlyLockClick=!0):this._onlyLockClick=!1;const r=[];return i.forEach(a=>{r.push({click:a==="click",in:e[a],out:n(a)})}),r}return null}_registerTooltipEvent(){this.event.on(pt.tooltipHide,{source:It.chart},this._handleTooltipHideOrRelease),this.event.on(pt.tooltipShow,{source:It.chart},this._handleTooltipShow),this.event.on(pt.tooltipRelease,{source:It.chart},this._handleTooltipHideOrRelease)}_getAxisInfoByField(t){var e,i;const n=(i=(e=this._option).getComponentsByKey)===null||i===void 0?void 0:i.call(e,"axes");if(!(n!=null&&n.length))return null;let r=vt(this._spec,\`\${t}Field.bindingAxesIndex\`);if(r||(r=[],n.forEach((p,g)=>{rP[t].includes(p.getOrient())&&r.push(g)})),!r.length)return null;const a=new Map;let o=1/0,l=1/0,h=-1/0,c=-1/0;const{x:u,y:d}=this.getLayoutStartPoint();return r.forEach(p=>{o=1/0,l=1/0,h=-1/0,c=-1/0;const g=n.find(f=>f.getSpecIndex()===p);g&&(g.getRegions().forEach(f=>{const{x:m,y:v}=f.getLayoutStartPoint();o=Math.min(o,m-u),l=Math.min(l,v-d),h=Math.max(h,m+f.getLayoutRect().width-u),c=Math.max(c,v+f.getLayoutRect().height-d)}),a.set(p,{x1:o,y1:l,x2:h,y2:c,axis:g}))}),a}changeRegions(t){}onLayoutEnd(t){const e=this._regions[0];this.setLayoutRect(e.getLayoutRect()),this.setLayoutStartPosition(e.getLayoutStartPoint()),super.onLayoutEnd(t)}onRender(t){}_releaseEvent(){this.clearOutEvent();const t=this._getTriggerEvent();t&&t.forEach(e=>{this._eventOff(e.in,!1,e.click),e.out&&this._eventOff(e.out,!0)})}_parseFieldInfo(){Object.keys(this._stateByField).forEach(t=>{const e=this._spec[t],{crosshairComp:i}=this._stateByField[t];if(e&&e.visible){if(this._stateByField[t].attributes=this._parseField(e,t),i){const{style:n,type:r}=this._stateByField[t].attributes,a=r==="rect"?"rectStyle":"lineStyle";i.setAttributes({[a]:n})}}else i&&i.parent&&i.parent.removeChild(i)})}_parseCrosshairSpec(){this._parseFieldInfo();const{trigger:t,triggerOff:e,labelZIndex:i,gridZIndex:n}=this._spec;t&&(this.trigger=t),(e==="none"||it(e)&&e>0)&&(this.triggerOff=e),i!==void 0&&(this.labelZIndex=i),n!==void 0&&(this.gridZIndex=n)}_parseField(t,e){var i,n;const r={},{line:a={},label:o={},visible:l}=t;if(r.visible=l,r.type=a.type||"line",a.visible===!1)r.style={visible:!1};else{const h=a.style||{},{stroke:c,fill:u,lineWidth:d}=h,p=h,{strokeOpacity:g,fillOpacity:f,opacity:m}=p,v=ne(p,["strokeOpacity","fillOpacity","opacity"]),y=r.type==="line";let _=y?g:f;if(it(m)&&(_=(_??1)*m),r.style=Object.assign({opacity:_,pickable:!1,visible:!0},v),y)r.style.stroke=c||u,r.style.lineWidth=vt(a,"width",d||2);else{r.style.fill=u||c,!((n=(i=t==null?void 0:t.line)===null||i===void 0?void 0:i.style)===null||n===void 0)&&n.stroke&&(r.style.stroke=t.line.style.stroke);const b=vt(a,"width");if(typeof b=="string"){const x=parseInt(b.substring(0,b.length-1),10)/100;r.style.sizePercent=x}else typeof b!="number"&&typeof b!="function"||(r.style.size=b)}}if(o.visible){const h=o.labelBackground||{},c=o.style||{},u=h.style||{},{fill:d="rgba(47, 59, 82, 0.9)",stroke:p,outerBorder:g}=u,f=ne(u,["fill","stroke","outerBorder"]);r.label={visible:!0,formatMethod:o.formatMethod,formatter:o.formatter,minWidth:h.minWidth,maxWidth:h.maxWidth,padding:h.padding,textStyle:Object.assign(Object.assign({fontSize:14,pickable:!1},c),{fill:c.fill||"#fff",stroke:vt(c,"stroke")}),panel:(pe(h.visible)?h.visible:h)?Object.assign({visible:!0,pickable:!1,fill:d,stroke:p,outerBorder:Object.assign({stroke:d,distance:0,lineWidth:3},g)},f):{visible:!1},zIndex:this.labelZIndex,childrenPickable:!1,pickable:!1}}else r.label={visible:!1};return r}_filterAxisByPoint(t,e,i){return t&&t.forEach(n=>{const r=n.axis;var a,o,l;if(o=e,l=i,((a=n).x1>o||a.x2<o||a.y1>l||a.y2<l)&&t.delete(r.getSpecIndex()),r.type.startsWith("polarAxis")){const h=r.getCenter(),c=r.getInnerRadius(),u=r.getOuterRadius(),d=Ne.distancePP({x:e,y:i},h);(d>u||d<c)&&t.delete(r.getSpecIndex())}}),t}_updateCrosshairLabel(t,e,i){const n=this.getContainer();t?t.setAttributes(e):(t=new Bn(e),n==null||n.add(t),i(t)),function(r,a){const{x1:o,y1:l,x2:h,y2:c}=a,{x1:u,y1:d,x2:p,y2:g}=r.AABBBounds,{dx:f=0,dy:m=0}=r.attribute;let v=0,y=0;u<o&&(v=o-u),d<l&&(y=l-d),p>h&&(v=h-p),g>c&&(y=c-g),v&&r.setAttribute("dx",v+f),y&&r.setAttribute("dy",y+m)}(t,this._getLimitBounds())}clearOutEvent(){this._timer&&(clearTimeout(this._timer),this._timer=null),this._clickLock&&(this._clickLock=null),this._hasActive&&(this._hasActive=null)}_hideByField(t){const{crosshairComp:e,labelsComp:i}=this._stateByField[t];e&&e.hideAll(),i&&Object.keys(i).forEach(n=>{i[n]&&i[n].hideAll()})}hide(){Object.keys(this._stateByField).forEach(t=>{this._hideByField(t)})}_getNeedClearVRenderComponents(){return Object.keys(this._stateByField).reduce((t,e)=>{const{crosshairComp:i,labelsComp:n}=this._stateByField[e];return i&&t.push(i),n&&Object.keys(n).forEach(r=>{n[r]&&t.push(n[r])}),t},[])}}S1.specKey="crosshair";const A1=(s,t,e,i=!1)=>(e||(e={x:0,y:0}),Object.keys(s).forEach(n=>{const{currentValue:r,cacheInfo:a,labelsComp:o,attributes:l,coordKey:h}=s[n];let c=null,u=0;if(r.size){const v=Array.from(r.values())[0];u=v.axis.getScale().scale(v.datum)+v.axis.getLayoutStartPoint()[h]-e[h],c=v.axis}const d=!!r.size&&Number.isFinite(u)&&!Number.isNaN(u),p=i&&!d&&R(a),g=p?a:{coordRange:[0,0],sizeRange:[0,0],coord:u,labelsTextStyle:{},labels:o?Object.keys(o).reduce((v,y)=>(v[y]={visible:!1,text:"",dx:0,dy:0},v),{}):null,visible:d,axis:c};let f;g&&(g._isCache=p);let m=0;if(l&&r.forEach(({axis:v,datum:y=""})=>{var _;let b=null;const x=v.getScale();if(fi(x.type))f=x.bandwidth(),f===0&&x.step&&(m=x.step());else if(he(x.type)){const S=n==="xField"?t.fieldX[0]:t.fieldY[0],A=n==="xField"?t.fieldX2:t.fieldY2,w=function(k,T,C,M){for(let B=0,O=k.length;B<O;B++){const E=k[B];if(E){const L=E[C],P=E[M||C];if(L<=T&&P>=T)return E}}return null}(t.getViewData().latestData,+y,S,A);if(w){const k=n==="xField"?t.dataToPositionX(w):t.dataToPositionY(w);A?(f=Math.abs(k-(n==="xField"?t.dataToPositionX1(w):t.dataToPositionY1(w))),y=\`\${w[S]} ~ \${w[A]}\`):f=1,u=k}b=v.niceLabelFormatter}if(g&&(!((_=l.label)===null||_===void 0)&&_.visible)&&!p){const S=function(w){let k=0;return vt(w,"tick.visible")&&(k+=vt(w,"tick.tickSize")),vt(w,"label.visible")&&(k+=vt(w,"label.space")),k}(v.getSpec()),A=v.getOrient();g.labels[A]&&(g.labels[A].visible=!0,g.labels[A].text=y,A==="left"?(g.labels[A].dx=-S,g.labelsTextStyle[A]={textAlign:"right",textBaseline:"middle"}):A==="right"?(g.labels[A].dx=S,g.labelsTextStyle[A]={textAlign:"left",textBaseline:"middle"}):A==="top"?(g.labels[A].y=0,g.labels[A].dy=-S,g.labelsTextStyle[A]={textAlign:"center",textBaseline:"bottom"}):A==="bottom"&&(g.labels[A].dy=S,g.labelsTextStyle[A]={textAlign:"center",textBaseline:"top"}),g.labels[A].defaultFormatter=b)}}),g&&!p){const v={x1:1/0,y1:1/0,x2:-1/0,y2:-1/0};oP(v,r),n==="xField"?(g.coordRange=[v.x1,v.x2],g.sizeRange=[v.y1,v.y2],g.coord=u+e.x,g.labels&&(g.labels.top.y=v.y1,g.labels.bottom.y=v.y2)):(g.coordRange=[v.y1,v.y2],g.sizeRange=[v.x1,v.x2],g.coord=u+e.y,g.labels&&(g.labels.left.x=v.x1,g.labels.right.x=v.x2)),(g.coord<g.coordRange[0]||g.coord>g.coordRange[1])&&(g.visible=!1),l&&l.label&&Object.keys(g.labels).forEach(y=>{g.labels[y].visible&&aP(g.labels[y],y,l.label)})}s[n].bandSize=f??0,s[n].offsetSize=m,s[n].cacheInfo=g}),s),aP=(s,t,e)=>{const{formatMethod:i,formatter:n}=e,{formatFunc:r,args:a}=ra(i,n,s.text,{label:s.text,position:t});r?s.text=r(...a):s.defaultFormatter&&(s.text=s.defaultFormatter(s.text))},oP=(s,t)=>{t.forEach(({axis:e})=>{e.getRegions().forEach(i=>{const{x:n,y:r}=i.getLayoutStartPoint(),{width:a,height:o}=i.getLayoutRect();s.x1=Math.min(s.x1,n),s.y1=Math.min(s.y1,r),s.x2=Math.max(s.x2,n+a),s.y2=Math.max(s.y2,r+o)})})},df=s=>{const{cacheInfo:t,attributes:e,bandSize:i,offsetSize:n,coordKey:r,anotherAxisKey:a}=s,{coord:o,sizeRange:l}=t,h=e.type;let c;if(h==="line"){const u=o+i/2;c={visible:!0,start:{[r]:u,[a]:l[0]},end:{[r]:u,[a]:l[1]}}}else if(h==="rect"){const u=lP(e,i,t.axis),{coordRange:d}=t;c={visible:!0,start:{[r]:Math.max(o-u/2-n/2,d[0]),[a]:l[0]},end:{[r]:Math.min(o+i+u/2+n/2,d[1]),[a]:l[1]}}}return c},lP=(s,t,e)=>{var i,n,r;let a=0;if(!((i=s.style)===null||i===void 0)&&i.sizePercent)a=(s.style.sizePercent-1)*t;else if(typeof((n=s.style)===null||n===void 0?void 0:n.size)=="number")a=s.style.size-t;else if(typeof((r=s.style)===null||r===void 0?void 0:r.size)=="function"){const o=e.getLayoutRect();a=s.style.size(o,e)-t}return a};class Ou extends S1{static getSpecInfo(t){return bu(t,this.specKey,this.type,e=>e.xField&&e.xField.visible!==!1||e.yField&&e.yField.visible!==!1)}constructor(t,e){super(t,e),this.type=st.cartesianCrosshair,this.name=st.cartesianCrosshair,this._stateByField={xField:{coordKey:"x",anotherAxisKey:"y",currentValue:new Map,labelsComp:{top:null,bottom:null}},yField:{coordKey:"y",anotherAxisKey:"x",currentValue:new Map,labelsComp:{left:null,right:null}}}}_findAllAxisContains(t,e){const i=this._getAxisInfoByField("x"),n=this._getAxisInfoByField("y");return{xAxisMap:this._filterAxisByPoint(i,t,e),yAxisMap:this._filterAxisByPoint(n,t,e)}}_getDatumAtPoint(t,e){const i=Yt(t.getOrient())?"x":"y",n=e[i]-(t.getLayoutStartPoint()[i]-this.getLayoutStartPoint()[i]);return t.getScale().invert(n)}setAxisValue(t,e){Yt(e.getOrient())?this._stateByField.xField.currentValue.set(e.getSpecIndex(),{datum:t,axis:e}):this._stateByField.yField.currentValue.set(e.getSpecIndex(),{datum:t,axis:e})}_layoutCrosshair(t,e,i,n){var r;let a=t,o=e;if(i&&i.length){if(n==="dimension"){const c=i[0],u=c.data.findIndex(p=>p.datum.length>0);let d;if(u>-1){const p=c.data[u];d=p.series.dataToPosition(p.datum[0])}(R(c.dimType)?c.dimType==="y":Ms((r=c==null?void 0:c.axis)===null||r===void 0?void 0:r.getOrient()))?o=d==null?void 0:d.y:a=d==null?void 0:d.x}else if(n==="mark"){const c=i[0],u=c.series.dataToPosition(c.datum[0]);a=u==null?void 0:u.x,o=u==null?void 0:u.y}}this.clearAxisValue();const{xAxisMap:l,yAxisMap:h}=this._findAllAxisContains(a,o);if(l&&l.size===0||h&&h.size===0){if(this.enableRemain)return;this.hide()}else l&&l.size&&this._setAllAxisValues(l,{x:a,y:o},"xField"),h&&h.size&&this._setAllAxisValues(h,{x:a,y:o},"yField"),this.layoutByValue()}layoutByValue(t){if(!this.enable)return;const e=((i,n)=>{for(let r=0;r<i.length;r++){const a=i[r].getSeries();for(let o=0;o<a.length;o++){const l=a[o];if(l&&l.coordinate===n)return l}}return null})(this._regions,"cartesian");e&&(A1(this._stateByField,e,this.getLayoutStartPoint(),t??this.enableRemain),Object.keys(this._stateByField).forEach(i=>{this._layoutByField(i)}))}_layoutByField(t){const{cacheInfo:e,attributes:i,labelsComp:n,bandSize:r,coordKey:a}=this._stateByField[t];if(!i||!e||e._isCache&&this.enableRemain)return;const{coord:o,labels:l,visible:h,labelsTextStyle:c}=e;if(h){const u=df(this._stateByField[t]);this._updateCrosshairByField(t,u),Object.keys(l).forEach(d=>{var p;if(l[d].visible){const g=Object.assign(Object.assign(Object.assign({[a]:o+r/2},l[d]),i.label),{textStyle:Object.assign(Object.assign({},(p=i.label)===null||p===void 0?void 0:p.textStyle),c[d]),zIndex:this.labelZIndex,visible:!0});this._updateCrosshairLabel(n[d],g,f=>{f.name=\`crosshair-\${t.replace("Field","")}-\${d}-label\`,n[d]=f})}else n[d]&&n[d].hideAll()})}else this._hideByField(t)}_updateCrosshairByField(t,e){const i=this.getContainer(),{attributes:n}=this._stateByField[t];let{crosshairComp:r}=this._stateByField[t];if(r)r.setAttributes(e);else{const a=n.style;n.type==="line"?r=new Cc(Object.assign(Object.assign({},e),{lineStyle:a,zIndex:this.gridZIndex+1,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1})):n.type==="rect"&&(r=new Mc(Object.assign(Object.assign({},e),{rectStyle:a,zIndex:this.gridZIndex,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1}))),i==null||i.add(r),this._stateByField[t].crosshairComp=r}}}Ou.specKey="crosshair",Ou.type=st.cartesianCrosshair;const da=(s,t)=>R(t)?s.map(e=>t[e]):void 0,Yn=(s,t)=>e=>s.every((i,n)=>e[i]===(t==null?void 0:t[n])),al=s=>!I(s)&&(W(s)?s.length>0&&s.every(R):Object.keys(s).length>0);function hP(s,t,e){var i,n,r;const a=Object.assign({regionIndex:0},t),o=e.getOption(),l=o.getRegionsInUserIdOrIndex(R(a.regionId)?[a.regionId]:void 0,R(a.regionIndex)?[a.regionIndex]:void 0)[0];if(!l)return"none";const h=cP(s,l),c=(i=a.activeType)!==null&&i!==void 0?i:h.length>1?"dimension":"mark",u=l.getLayoutStartPoint(),d=l.getLayoutRect(),p=o.globalInstance.getContainer(),g=Object.assign({x:0,y:0},p?function(v){const{x:y,y:_}=v.getBoundingClientRect();return{x:y,y:_}}(p):{}),f=v=>{var y;const{dimensionFields:_,dimensionData:b,measureFields:x,measureData:S,groupField:A,groupData:w}=v.data;return(y=v.series.getViewData())===null||y===void 0?void 0:y.latestData.find(T=>Yn(_,b)(T)&&Yn(x,S)(T)&&(I(A)||Yn([A],[w])(T)))},m=v=>{var y,_;const b=(A=>({x:Math.min(Math.max(A.x,0),d.width),y:Math.min(Math.max(A.y,0),d.height)}))(v),x=(y=a.x)!==null&&y!==void 0?y:u.x+b.x,S=(_=a.y)!==null&&_!==void 0?_:u.y+b.y;return{canvasX:x,canvasY:S,clientX:g.x+x,clientY:g.y+S}};if(c==="dimension"){const v=h[0];if(!v)return"none";const y=new Map;h.forEach(S=>{var A;y.has(S.series)||y.set(S.series,[]),(A=y.get(S.series))===null||A===void 0||A.push(S)});const _=[{value:s[v.data.dimensionFields[0]],data:[...y.keys()].map(S=>{var A,w;return{series:S,datum:(w=(A=y.get(S))===null||A===void 0?void 0:A.map(k=>f(k)))!==null&&w!==void 0?w:[]}})}];R(v.dimType)&&(_[0].position=v.pos[v.dimType],_[0].dimType=v.dimType);const b={changePositionOnly:!1,action:"enter",tooltip:null,dimensionInfo:_,chart:(n=o.globalInstance.getChart())!==null&&n!==void 0?n:void 0,datum:void 0,model:void 0,source:It.chart,event:m({x:h.reduce((S,A)=>S+A.pos.x,0)/h.length,y:h.reduce((S,A)=>S+A.pos.y,0)/h.length}),item:void 0,itemMap:new Map};e.processor.dimension.showTooltip(_,b,!1);const x=o.globalInstance;return Be.globalConfig.uniqueTooltip&&Be.hideTooltip(x.id),c}if(c==="mark"){const v=h[0];if(!v)return"none";const y=Object.assign(Object.assign({},f(v)),s),_=[{datum:[y],series:v.series}],b={changePositionOnly:!1,tooltip:null,dimensionInfo:[{value:y[v.data.dimensionFields[0]],data:_}],chart:(r=o.globalInstance.getChart())!==null&&r!==void 0?r:void 0,datum:y,model:v.series,source:It.chart,event:m(v.pos),item:void 0,itemMap:new Map};e.processor.mark.showTooltip({datum:y,mark:null,series:v.series},b,!1);const x=o.globalInstance;return Be.globalConfig.uniqueTooltip&&Be.hideTooltip(x.id),c}return"none"}const cP=(s,t)=>{const e=t.getSeries(),i=[];return e.forEach(n=>{var r,a,o,l,h,c,u;const d=n.getDimensionField(),p=n.getMeasureField(),g=n.getSeriesField(),f=R(g)?s[g]:void 0,m=R(g)&&(l=(o=(a=(r=n.getViewDataStatistics)===null||r===void 0?void 0:r.call(n))===null||a===void 0?void 0:a.latestData[g])===null||o===void 0?void 0:o.values)!==null&&l!==void 0?l:[],v=da(d,s);let y=da(p,s);const _=al(y),b=!_&&R(g)&&I(f)&&m.length>0,x=()=>{var S;const A=(S=n.getViewData())===null||S===void 0?void 0:S.latestData.find(Yn(d,v));if(!_&&(y=da(p,A),!al(y)))return;const w=n.type===te.pie?n.dataToCentralPosition(A):n.dataToPosition(A);I(w)||isNaN(w.x)||isNaN(w.y)||i.push({pos:w,data:{dimensionFields:d,dimensionData:v,measureFields:p,measureData:y,hasMeasureData:_,groupField:g,groupData:f},series:n})};if(n.coordinate==="cartesian"){const S=n,A=fi((c=(h=n.getYAxisHelper())===null||h===void 0?void 0:h.getScale(0))===null||c===void 0?void 0:c.type)?"y":"x",w=d.map((T,C)=>[T,C]).filter(([,T])=>I(v==null?void 0:v[T]));let k=[v??[]];w.length>0&&w.forEach(([T,C])=>{var M,B,O,E;const L=(E=(O=(B=(M=n.getViewDataStatistics)===null||M===void 0?void 0:M.call(n))===null||B===void 0?void 0:B.latestData[T])===null||O===void 0?void 0:O.values)!==null&&E!==void 0?E:[],P=[];k.forEach(F=>{L.forEach(j=>{var D;const N=(D=F==null?void 0:F.slice())!==null&&D!==void 0?D:[];N[C]=j,P.push(N)})}),k=P}),k.forEach(T=>{var C,M;if(b){const B=(C=S.getViewData())===null||C===void 0?void 0:C.latestData.filter(Yn(d,T));m.forEach(O=>{const E=B.find(P=>P[g]===O);if(y=da(p,E),!al(y))return;const L=S.dataToPosition(E);I(L)||isNaN(L.x)||isNaN(L.y)||i.push({pos:L,data:{dimensionFields:d,dimensionData:T,measureFields:p,measureData:y,hasMeasureData:_,groupField:g,groupData:O},series:n,dimType:A})})}else{const B=(M=S.getViewData())===null||M===void 0?void 0:M.latestData.find(Yn(d,T));if(!_&&(y=da(p,B),!al(y)))return;const O=S.dataToPosition(B);if(I(O)||isNaN(O.x)||isNaN(O.y))return;i.push({pos:O,data:{dimensionFields:d,dimensionData:T,measureFields:p,measureData:y,hasMeasureData:_,groupField:g,groupData:f},dimType:A,series:n})}})}else if(n.coordinate==="polar")if(n.type===te.pie)x();else{const S=n;if(b){const A=((u=S.getViewData())===null||u===void 0?void 0:u.latestData.filter(Yn(d,v))).find(w=>w[g]===f);m.forEach(w=>{if(y=da(p,A),!al(y))return;const k=S.dataToPosition(A);I(k)||isNaN(k.x)||isNaN(k.y)||i.push({pos:k,data:{dimensionFields:d,dimensionData:v,measureFields:p,measureData:y,hasMeasureData:_,groupField:g,groupData:w},series:n})})}else x()}else n.coordinate==="geo"&&x()}),i},uP=["updateTitle","updateContent","updatePosition","maxLineCount","othersLine"],dP=(s,t,e,i,n)=>{var r,a,o;const l={activeType:s};switch(s){case"mark":case"group":if(e){const h=(r=e.getSpec())===null||r===void 0?void 0:r.tooltip;return l.visible=!0,h!=null&&h.handler&&(l.handler=h.handler),!((a=l.handler)===null||a===void 0)&&a.showTooltip?l:(h!=null&&h[s]&&uP.forEach(c=>{R(h[s][c])&&(l[c]=h[s][c])}),Object.assign(Object.assign({},l),e.tooltipHelper.getTooltipData(s,t,i,i[0].datum,n)))}break;case"dimension":if(i!=null&&i.length){if(pP(i).every(c=>{var u;return!Gg("dimension",(u=c.tooltipHelper)===null||u===void 0?void 0:u.spec)})?l.visible=!1:l.visible=!0,l.handler=t.handler,(o=l.handler)===null||o===void 0?void 0:o.showTooltip)return l;const h=[];return i.forEach(c=>c.data.forEach(u=>{const{series:d}=u,p=d.tooltipHelper.getTooltipData(s,t,i,u.datum,n);p&&h.push(p)})),function(c){if(!c||!c.length)return null;const u=[];return c.forEach(({content:d})=>{d&&d.forEach(p=>{u.push(p)})}),u.length?Object.assign(Object.assign({},c[0]),{content:u}):c[0]}(h)}}return null},pP=s=>{const t=[];return s.forEach(e=>{e.data.forEach(i=>{R(i.series)&&t.push(i.series)})}),t},pa={dom:\`\${xt}_TOOLTIP_HANDLER_DOM\`,canvas:\`\${xt}_TOOLTIP_HANDLER_CANVAS\`},k1={key:"其他",value:"..."},w1=["group","mark","dimension"];class pf{constructor(t){this._showTooltipByHandler=(e,i)=>{var n,r,a;if(I(e))return 1;i.changePositionOnly||this.clearCache(),this._updateViewSpec(e,i);const o=this._cacheActiveSpec;if(I(o)||o.visible===!1)return 1;i.tooltipSpec=this.component.getSpec(),i.activeTooltipSpec=o;const{title:l,content:h}=o,c=I(l==null?void 0:l.key)&&I(l==null?void 0:l.value)&&!(h!=null&&h.length);if(this.component.event.emit(pt.tooltipShow,Object.assign(Object.assign({},i),{isEmptyTooltip:c,tooltipData:e,activeType:this.activeType,tooltip:this.component})),c)return 1;let u;return!((n=o.handler)===null||n===void 0)&&n.showTooltip?u=o.handler.showTooltip.bind(o.handler):!((r=this.component.tooltipHandler)===null||r===void 0)&&r.showTooltip&&(u=this.component.tooltipHandler.showTooltip.bind(this.component.tooltipHandler)),u?(a=u(this.activeType,e,i))!==null&&a!==void 0?a:0:1},this.component=t}_preprocessDimensionInfo(t){const e=[];if(t==null||t.forEach(i=>{const n=Object.assign(Object.assign({},i),{data:i.data.filter(({series:r})=>{var a,o;return((o=(a=r.getSpec())===null||a===void 0?void 0:a.tooltip)===null||o===void 0?void 0:o.visible)!==!1})});n.data.length>0&&e.push(n)}),e.length>0)return e}_updateViewSpec(t,e){var i,n,r,a,o,l,h,c,u;const{changePositionOnly:d,model:p}=e;if(!d||!this._cacheActiveSpec){const g=this.component.getSpec();if(this._cacheActiveSpec=dP(this.activeType,this.component.getSpec(),p,t,e),this._cacheActiveSpec){I(this._cacheActiveSpec.handler)&&R(g.handler)&&(this._cacheActiveSpec.handler=g.handler);const f=(i=g[this.activeType])!==null&&i!==void 0?i:{},m=(n=this._cacheActiveSpec.updateTitle)!==null&&n!==void 0?n:f.updateTitle,v=(r=this._cacheActiveSpec.updateContent)!==null&&r!==void 0?r:f.updateContent,y=(o=(a=this._cacheActiveSpec.maxLineCount)!==null&&a!==void 0?a:f.maxLineCount)!==null&&o!==void 0?o:20;if(m&&(this._cacheActiveSpec.title=(l=m(this._cacheActiveSpec.title,t,e))!==null&&l!==void 0?l:this._cacheActiveSpec.title),v)this._cacheActiveSpec.content=(h=v(this._cacheActiveSpec.content,t,e))!==null&&h!==void 0?h:this._cacheActiveSpec.content;else if(y>=1&&((c=this._cacheActiveSpec.content)===null||c===void 0?void 0:c.length)>y){const _=(u=this._cacheActiveSpec.othersLine)!==null&&u!==void 0?u:f.othersLine,b=_?Object.assign(Object.assign({},k1),_):k1;this._cacheActiveSpec.content=[...this._cacheActiveSpec.content.slice(0,y-1),Object.assign(Object.assign({},this._cacheActiveSpec.content[y-1]),b)]}}}}shouldHandleTooltip(t,e){var i,n;return!I(e)&&Gg(this.activeType,(n=(i=t.model)===null||i===void 0?void 0:i.tooltipHelper)===null||n===void 0?void 0:n.spec)}clearCache(){this._cacheActiveSpec=void 0}}class gP extends pf{constructor(){super(...arguments),this.activeType="dimension"}showTooltip(t,e,i){const n=Object.assign(Object.assign({},e),{dimensionInfo:this._preprocessDimensionInfo(t),changePositionOnly:i,tooltip:this.component});return this._showTooltipByHandler(t,n)}_getDimensionInfo(t){var e,i;let n;const r=this.component.getChart(),a=r.getCompiler().getStage().getLayer(void 0),o={x:t.event.viewX,y:t.event.viewY};if(a.globalTransMatrix.transformPoint({x:t.event.viewX,y:t.event.viewY},o),n=[...(e=Wx(r,o,!0))!==null&&e!==void 0?e:[],...(i=jx(r,o))!==null&&i!==void 0?i:[]],n.length===0)n=void 0;else if(n.length>1){const l=n.filter(h=>{var c;const u=h.axis;if(u.getSpec().hasDimensionTooltip)return!0;if(!fi(u.getScale().type))return!1;let d;for(const p of(c=u==null?void 0:u.getRegions())!==null&&c!==void 0?c:[]){for(const g of p.getSeries())if(g.coordinate==="cartesian"){d=g;break}if(R(d))break}return R(d)&&d.getDimensionField()[0]===d.fieldY[0]?u.getOrient()==="left"||u.getOrient()==="right":u.getOrient()==="bottom"||u.getOrient()==="top"});if(n=l.length?l:n.slice(0,1),n.length>1){const h=new Set;n.forEach(c=>{c.data=c.data.filter(({key:u})=>!h.has(u)&&(h.add(u),!0))})}}return n}getMouseEventData(t){return{tooltipInfo:this._getDimensionInfo(t),ignore:!1}}}class fP extends pf{constructor(){super(...arguments),this.activeType="mark"}showTooltip(t,e,i){var n,r,a;const{datum:o,series:l}=t,h=this.component.getSpec(),c=[{datum:[o],series:l}],u=l.tooltipHelper,d=(n=l.getSpec())===null||n===void 0?void 0:n.tooltip,p=(r=d==null?void 0:d.mark)===null||r===void 0?void 0:r.checkOverlap;let g=!1;if(p===!0||((a=h.mark)===null||a===void 0?void 0:a.checkOverlap)===!0&&p!==!1){const m=u==null?void 0:u.activeTriggerSet.mark;if(m){g=!0;const v=this.component.getChart().getCompiler().getStage().getLayer(void 0),y={x:e.event.viewX,y:e.event.viewY};v.globalTransMatrix.transformPoint({x:e.event.viewX,y:e.event.viewY},y),m.forEach(_=>{_.getProductElements().forEach(b=>{const x=b.getGraphicItem();b!==e.item&&x&&x.containsPoint(y.x,y.y,rr.GLOBAL,x.stage.getPickerService())&&c[0].datum.push(b.getDatum())})})}}const f=Object.assign(Object.assign({},e),{model:l,changePositionOnly:i,tooltip:this.component});if(i&&g){const m=this._cacheActiveSpec&&this._cacheActiveSpec.data;m&&m[0].series===c[0].series&&m[0].datum.length===c[0].datum.length&&!m[0].datum.some((v,y)=>v!==c[0].datum[y])||(f.changePositionOnly=!1)}return this._showTooltipByHandler(c,f)}getMouseEventData(t){var e;let i,n;const r=(e=t.model)===null||e===void 0?void 0:e.modelType;if(r==="series"){const a=t.model,o=a.tooltipHelper,l=o==null?void 0:o.activeTriggerSet.mark,h=o==null?void 0:o.ignoreTriggerSet.mark;l!=null&&l.has(t.mark)?i={mark:t.mark,datum:t.datum,series:a}:h!=null&&h.has(t.mark)&&(n=!0)}else if(r==="component"){const a=t.model,o=t.node;if(a.name==="label"&&o){const l=a.getLabelInfoByTextGraphic(o),{baseMark:h,series:c,labelMark:u}=l??{},d=c.tooltipHelper,p=d==null?void 0:d.activeTriggerSet.mark,g=d==null?void 0:d.ignoreTriggerSet.mark;p!=null&&p.has(u)?i={mark:h,datum:o.attribute.data,series:c}:g!=null&&g.has(u)&&(n=!0)}}return{tooltipInfo:i,ignore:n}}}class mP extends pf{constructor(){super(...arguments),this.activeType="group"}showTooltip(t,e,i){const{datum:n,series:r}=t,a=[{datum:Y(n),series:r}],o=Object.assign(Object.assign({},e),{groupDatum:this._getGroupDatum(e),changePositionOnly:i,tooltip:this.component});return this._showTooltipByHandler(a,o)}getMouseEventData(t){var e,i;let n;if(((e=t.model)===null||e===void 0?void 0:e.modelType)==="series"){const r=t.model,a=r.tooltipHelper,o=a==null?void 0:a.activeTriggerSet.group;if(o!=null&&o.has(t.mark)){const l=this.component.getSpec()[this.activeType];(l!=null&&l.triggerMark?Y(l.triggerMark):[]).includes((i=t.mark)===null||i===void 0?void 0:i.name)&&(n={mark:t.mark,datum:t.datum,series:r})}}return{tooltipInfo:n,ignore:!1}}_getGroupDatum(t){const{model:e,mark:i,datum:n}=t,r=e;if(["line","area"].includes(i.type))return Y(n);const a=r.getViewData().latestData,o=r.getSeriesField();if(!o)return a;const l=Y(n)[0][o];return a.filter(h=>h[o]===l)}}const T1=s=>R(s)&&!W(s),C1=s=>R(s)&&W(s);class M1 extends Su{_shouldMergeThemeToSpec(){return!1}_initTheme(t,e){var i;const{spec:n,theme:r}=super._initTheme(t,e);return n.style=mt({},this._theme,n.style),n.offset=mt({},r.offset,t.offset),n.transitionDuration=(i=t.transitionDuration)!==null&&i!==void 0?i:r.transitionDuration,{spec:n,theme:r}}_transformSpecAfterMergingTheme(t,e,i){var n,r,a,o,l,h,c;super._transformSpecAfterMergingTheme(t,e,i),t.visible=(n=t.visible)===null||n===void 0||n,t.activeType=(u=>{var d,p,g;if((u==null?void 0:u.visible)===!1)return[];const f={mark:((d=u==null?void 0:u.mark)===null||d===void 0?void 0:d.visible)!==!1,dimension:((p=u==null?void 0:u.dimension)===null||p===void 0?void 0:p.visible)!==!1,group:((g=u==null?void 0:u.group)===null||g===void 0?void 0:g.visible)!==!1};return R(u==null?void 0:u.activeType)&&Object.keys(f).forEach(m=>{var v;f[m]=(v=u==null?void 0:u.activeType)===null||v===void 0?void 0:v.includes(m)}),Object.keys(f).filter(m=>f[m])})(t),t.renderMode=(r=t.renderMode)!==null&&r!==void 0?r:kr(this._option.mode)||!ks(this._option.mode)?"canvas":"html",t.trigger=(a=t.trigger)!==null&&a!==void 0?a:"hover",t.className=(o=t.className)!==null&&o!==void 0?o:"vchart-tooltip-element",t.enterable=(l=t.enterable)!==null&&l!==void 0&&l,t.transitionDuration=(h=t.transitionDuration)!==null&&h!==void 0?h:150,t.confine=(c=t.confine)!==null&&c!==void 0?c:t.renderMode==="canvas",R(t.parentElement)?Q(t.parentElement)&&(t.parentElement=Me.getElementById(t.parentElement)):ks(this._option.mode)&&(t.parentElement=Sr==null?void 0:Sr.body)}}class ol extends aa{constructor(){super(...arguments),this.layoutZIndex=1,this.type=st.tooltip,this.name=st.tooltip,this.transformerConstructor=M1,this.specKey="tooltip",this.layoutType="none",this._isReleased=!1,this._alwaysShow=!1,this._eventList=[],this._isTooltipShown=!1,this._clickLock=!1,this._mountEvent=(t,e,i)=>{this.event.on(t,e,i),this._eventList.push({eventType:t,handler:i})},this._handleClickToLock=t=>{this._clickLock?(this._handleChartMouseOut(t),this._clickLock=!1):this._clickLock=!0},this._getMouseOutHandler=t=>e=>{var i,n,r,a,o;if(this._isReleased||this._alwaysShow||this._clickLock||!this._isTooltipShown&&!(!((n=(i=this.tooltipHandler)===null||i===void 0?void 0:i.isTooltipShown)===null||n===void 0)&&n.call(i)))return;const l=ks((r=this._option)===null||r===void 0?void 0:r.mode),{clientX:h,clientY:c}=e.event;l&&t&&this._isPointerInChart({x:h,y:c})||(this._enterable?this._outTimer=setTimeout(()=>{this._handleChartMouseOut(e)},(o=(a=this._spec)===null||a===void 0?void 0:a.showDelay)!==null&&o!==void 0?o:50):this._handleChartMouseOut(e))},this._handleChartMouseOut=t=>{this._alwaysShow||this._isReleased||this._isEnterTooltip||this._spec.triggerOff!=="none"&&(this._hideTooltipByHandler(Object.assign(Object.assign({},t),{tooltip:this})),this._handleMouseMove&&this._handleMouseMove.cancel&&this._handleMouseMove.cancel(),this._cacheEnterableRect=null,this._cacheInfo=void 0,this._cacheParams=void 0,this._cacheActiveType=void 0)},this._getMouseMoveHandler=t=>e=>{var i,n,r,a;this._isReleased||this._isEnterTooltip||(this._outTimer&&(clearTimeout(this._outTimer),this._outTimer=null),this.tooltipHandler||this._initHandler(),this.processor||this._initProcessor(),this._alwaysShow||(this._clickLock?t&&(this._handleChartMouseOut(e),this._clickLock=!1):!t&&this._enterable&&(!((n=(i=this.tooltipHandler)===null||i===void 0?void 0:i.isTooltipShown)===null||n===void 0)&&n.call(i))?(this._showTimer&&clearTimeout(this._showTimer),this._showTimer=setTimeout(()=>{this._handleChartMouseMove(e,t)},(a=(r=this._spec)===null||r===void 0?void 0:r.showDelay)!==null&&a!==void 0?a:50)):this._handleChartMouseMove(e,t)))},this._handleChartMouseMove=(t,e)=>{if(this._isReleased)return;const i=this._getMouseEventData(t),{tooltipInfo:{dimension:n},ignore:{mark:r}}=i,a={mark:!1,dimension:!1,group:!1};for(let o=0,l=w1.length;o<l;o++){const h=w1[o];if(this.processor[h]&&this._showTooltipByMouseEvent(h,i,t,e)){a[h]=!0;break}}Object.values(a).every(o=>!o)&&!function(o){return I(o.mark)&&I(o.model)&&I(o.datum)}(t)&&(r&&T1(this._cacheInfo)?a.mark=this._showTooltipByMouseEvent("mark",i,t,e,!0):R(n)&&(a.dimension=this._showTooltipByMouseEvent("dimension",i,t,e))),a.mark||a.group||a.dimension&&!I(n)?this._initEventOfTooltipContent():this._handleChartMouseOut(t)},this._showTooltipByMouseEvent=(t,e,i,n,r)=>{var a;const o=this.processor[t];if(!o.shouldHandleTooltip(i,e.tooltipInfo[t]))return!1;let l;if(this._hideTimer&&clearTimeout(this._hideTimer),r)l=!o.showTooltip(this._cacheInfo,i,!0);else{const c=e.tooltipInfo[t],u=this._isSameAsCache(c,i,t);l=!o.showTooltip(c,i,u),l&&(this._cacheInfo=c,this._cacheParams=i,this._cacheActiveType=t)}l&&(this._isTooltipShown=!0,n&&this._spec.lockAfterClick&&!this._clickLock?this._clickLock=!0:Number.isFinite(this._spec.hideTimer)&&(this._hideTimer=setTimeout(()=>{this._handleChartMouseOut()},this._spec.hideTimer)));const h=(a=this._option)===null||a===void 0?void 0:a.globalInstance;return l&&Be.globalConfig.uniqueTooltip&&h&&Be.hideTooltip(h.id),l},this._getMouseEventData=t=>{const e={tooltipInfo:{},ignore:{}};return Object.keys(this.processor).forEach(i=>{const{tooltipInfo:n,ignore:r}=this.processor[i].getMouseEventData(t);e.tooltipInfo[i]=n,e.ignore[i]=r}),e},this._hideTooltipByHandler=t=>{var e,i,n;if(!this._isTooltipShown&&!(!((i=(e=this.tooltipHandler)===null||e===void 0?void 0:e.isTooltipShown)===null||i===void 0)&&i.call(e)))return 0;this.event.emit(pt.tooltipHide,Object.assign(Object.assign({},t),{source:It.chart,tooltip:this})),Object.values(this.processor).forEach(a=>{a.clearCache()});const r=(n=this._spec.handler)!==null&&n!==void 0?n:this.tooltipHandler;if(r.hideTooltip){const a=r.hideTooltip.call(r,t);return a||(this._isTooltipShown=!1),a}return 1},this.hideTooltip=()=>{if(this._isReleased)return!1;const t={changePositionOnly:!1,tooltip:this,item:void 0,datum:void 0,source:It.chart};return this._alwaysShow=!1,!this._hideTooltipByHandler(t)}}isTooltipShown(){return this._isTooltipShown}changeRegions(t){}_getNeedClearVRenderComponents(){return[]}_registerEvent(){}_releaseEvent(){}onLayout(t){}onLayoutEnd(t){}onRender(t){}created(){super.created(),this._regions=this._option.getAllRegions(),this._initEvent()}release(){var t,e;super.release(),this._isReleased=!0,this._hideTimer&&clearTimeout(this._hideTimer),this._eventList.forEach(({eventType:i,handler:n})=>{this.event.off(i,n)}),this._eventList=[],(e=(t=this.tooltipHandler)===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t),this._isTooltipShown=!1}beforeRelease(){this.event.emit(pt.tooltipHide,{tooltip:this,chart:this.getChart()}),this.event.emit(pt.tooltipRelease,{tooltip:this,chart:this.getChart()})}_initHandler(){var t,e,i;const n=(t=this._spec.renderMode)!==null&&t!==void 0?t:"html",r=this._option.globalInstance.getTooltipHandlerByUser();if(r)this.tooltipHandler=r,this._enterable=!1;else{const a=n==="canvas"?pa.canvas:pa.dom,o=et.getComponentPluginInType(a);o||co("Can not find tooltip handler: "+a);const l=new o;l.name=\`\${this._spec.className}-\${(e=this._option.globalInstance.id)!==null&&e!==void 0?e:0}-\${this.getSpecIndex()}\`,(i=this.pluginService)===null||i===void 0||i.load([l]),this.tooltipHandler=l,this._spec.enterable&&n==="html"&&this.tooltipHandler?(this._enterable=!0,this._needInitEventOfTooltip=!0):this._enterable=!1}}_initEventOfTooltipContent(){var t,e;if(!this._needInitEventOfTooltip)return;const i=(e=(t=this.tooltipHandler).getTooltipContainer)===null||e===void 0?void 0:e.call(t),n=i==null?void 0:i.firstChild;n&&(n.addEventListener("pointerenter",()=>{var r;if(!this._enterable)return;this._isEnterTooltip=!0;const a=(r=n.getBoundingClientRect)===null||r===void 0?void 0:r.call(n);a&&(this._cacheEnterableRect={x:a.x,y:a.y,width:a.width,height:a.height}),this._outTimer&&(clearTimeout(this._outTimer),this._outTimer=null),this._showTimer&&(clearTimeout(this._showTimer),this._showTimer=null)}),n.addEventListener("pointerleave",()=>{var r,a,o;if(this._enterable&&(this._isEnterTooltip=!1,this._cacheEnterableRect)){const l=(r=n.getBoundingClientRect)===null||r===void 0?void 0:r.call(n);l&&Object.keys(this._cacheEnterableRect).every(h=>this._cacheEnterableRect[h]===l[h])&&(this._cacheEnterableRect=null,this._outTimer=setTimeout(this.hideTooltip,(o=(a=this._spec)===null||a===void 0?void 0:a.showDelay)!==null&&o!==void 0?o:50))}}),this._needInitEventOfTooltip=!1)}_initProcessor(){const t=this._spec.activeType;this.processor={},t.includes("dimension")&&(this.processor.dimension=new gP(this)),t.includes("group")&&(this.processor.group=new mP(this)),t.includes("mark")&&(this.processor.mark=new fP(this))}_initEvent(){var t;if(this._option.disableTriggerEvent)return;const e=Y((t=this._spec.trigger)!==null&&t!==void 0?t:"hover"),i=Y(this._spec.triggerOff),n=this._option.mode;e.forEach(r=>{var a;r==="hover"?(this._handleMouseMove=this._throttle(this._getMouseMoveHandler(!1)),this._mountEvent("pointermove",{source:"chart"},this._handleMouseMove),(Ar(n)||kr(n))&&(this._mountEvent("pointerdown",{source:"chart"},this._getMouseMoveHandler(!1)),this._mountEvent("pointerup",{source:"window"},this._getMouseOutHandler(!0))),this._mountEvent("pointerleave",{source:"chart"},this._getMouseOutHandler(!1))):r==="click"?(this._mountEvent("pointertap",{source:"chart"},this._getMouseMoveHandler(!0)),this._mountEvent("pointerup",{source:"window"},this._getMouseOutHandler(!0))):_t(r)&&this._mountEvent(r.eventType,{source:(a=r.source)!==null&&a!==void 0?a:"chart",consume:r.consume},this._getMouseMoveHandler(!0))}),i.filter(r=>_t(r)).forEach(r=>{var a,o;this._mountEvent(r.eventType,{source:(a=r.source)!==null&&a!==void 0?a:"chart",consume:r.consume},this._getMouseOutHandler((o=r.checkOutside)!==null&&o!==void 0&&o))}),!e.includes("click")&&this._spec.lockAfterClick&&this._mountEvent("pointertap",{source:"chart"},this._handleClickToLock)}_throttle(t){let e;return e=it(this._spec.throttleInterval)?this._spec.throttleInterval:this._spec.renderMode==="html"&&this._spec.transitionDuration?50:10,tr(t,e)}reInit(t){var e,i,n;if(super.reInit(t),this.tooltipHandler){const r=(e=this._spec.renderMode)!==null&&e!==void 0?e:"html",a=this._spec.enterable&&r==="html";a&&!this._enterable&&(this._needInitEventOfTooltip=!0),this._enterable=a,(n=(i=this.tooltipHandler).reInit)===null||n===void 0||n.call(i)}else this._initHandler()}showTooltip(t,e){var i;if(this.tooltipHandler||this._initHandler(),this.processor||this._initProcessor(),!(!((i=this.tooltipHandler)===null||i===void 0)&&i.showTooltip))return!1;const n=hP(t,e,this);return n!=="none"&&(this._alwaysShow=!!(e!=null&&e.alwaysShow)),n}_isSameAsCache(t,e,i){if(i!==this._cacheActiveType)return!1;if(t===this._cacheInfo)return!0;if(I(this._cacheInfo)||I(t))return!1;if(C1(t)){if(T1(this._cacheInfo))return!1;const a=this._cacheInfo;return a.length===t.length&&t.every((o,l)=>Fx(o,a[l]))}if(C1(this._cacheInfo))return!1;const n=this._cacheInfo;if(!((t==null?void 0:t.datum)===n.datum&&(t==null?void 0:t.mark)===n.mark&&(t==null?void 0:t.series)===n.series))return!1;const r=this._cacheParams;return!I(r)&&!I(e)&&r.mark===e.mark&&r.model===e.model&&r.datum===e.datum}_isPointerInChart(t){var e;const i=(e=this._option)===null||e===void 0?void 0:e.globalInstance;if(!i||!i.getChart())return!1;const{x:n,y:r}=t,a=i.getCanvas(),{x:o,y:l,width:h,height:c}=a.getBoundingClientRect();return n>=o&&n<=o+h&&r>=l&&r<=l+c}getVisible(){return this._spec.visible!==!1}}ol.type=st.tooltip,ol.transformerConstructor=M1,ol.specKey="tooltip";function vP(s,t){const{title:e={},item:i={},pager:n={},background:r={},type:a,id:o,visible:l,orient:h,position:c,data:u,filter:d,regionId:p,regionIndex:g,seriesIndex:f,seriesId:m,padding:v}=s,y=ne(s,["title","item","pager","background","type","id","visible","orient","position","data","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return e.visible?y.title=function(_){var b,x;const S=Object.assign({},_);return ht(_.style)||(S.textStyle=Ht(_.style)),ht(_.textStyle)||mt(S.textStyle,Ht(_.textStyle)),!((b=_.shape)===null||b===void 0)&&b.style&&Ht(S.shape.style),!((x=_.background)===null||x===void 0)&&x.style&&Ht(S.background.style),S}(e):y.title={visible:!1},ht(i.focusIconStyle)||Ht(i.focusIconStyle),i.shape&&(i.shape=qs(i.shape)),i.label&&(i.label=qs(i.label)),i.value&&(i.value=qs(i.value)),i.background&&(i.background=qs(i.background)),Yr(i.maxWidth)&&(i.maxWidth=Number(i.maxWidth.substring(0,i.maxWidth.length-1))*t.width/100),Yr(i.width)&&(i.width=Number(i.width.substring(0,i.width.length-1))*t.width/100),Yr(i.height)&&(i.height=Number(i.height.substring(0,i.height.length-1))*t.width/100),y.item=i,n.type==="scrollbar"?(ht(n.railStyle)||Ht(n.railStyle),ht(n.sliderStyle)||Ht(n.sliderStyle)):(ht(n.textStyle)||Ht(n.textStyle),n.handler&&qs(n.handler)),y.pager=n,r.visible&&!ht(r.style)&&(mt(y,r.style),R(r.padding)&&(y.padding=r.padding)),y}const yP=(s,t)=>{const e=[],i={},{series:n,seriesField:r}=t;return n().forEach(a=>{const o=r(a);let l;l=o===a.getSeriesField()?a.getSeriesInfoList():a.getSeriesInfoInField(o),l.forEach(h=>{i[h.key]||(i[h.key]=!0,e.push(h))})}),e},_P=(s,t)=>{var e,i,n;const{series:r,selected:a,field:o,data:l,customFilter:h}=t,c=a(),u=l();if(c.length===0&&u.length)return[];if(c.length===u.length)return s;const d={};c.forEach(g=>{d[g]=!0});const p=(e=o())!==null&&e!==void 0?e:$s;return h?h(s,c,p):(W(s)&&(!((i=s[0])===null||i===void 0)&&i.nodes)?(s[0].nodes=s[0].nodes.filter(g=>d[g.key]===!0),!((n=s[0])===null||n===void 0)&&n.links&&(s[0].links=s[0].links.filter(g=>d[g.source]===!0&&d[g.target]===!0))):R(p)&&(s=s.filter(g=>d[r.getSeriesFieldValue(g,p)]===!0)),s)};class E1 extends aa{constructor(){super(...arguments),this.layoutType="normal",this.layoutZIndex=Qe.Legend,this.layoutLevel=Wo.Legend,this.specKey="legends",this._orient="left",this._visible=!0,this._position="middle",this._preSelectedData=[],this._selectedData=[],this.effect={onSelectedDataChange:()=>{qe(this._regions,t=>{var e;(e=t.getViewData())===null||e===void 0||e.markRunning()},{userId:this._seriesUserId,specIndex:this._seriesIndex}),qe(this._regions,t=>{t.reFilterViewData()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}get orient(){return this._orient}get visible(){return this._visible}get position(){return this._position}getLegendData(){return this._legendData.getLatestData()}getSelectedData(){return this._selectedData}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._orient=bb(this._spec.orient)?this._spec.orient:"left",this._position=(t=this._spec.position)!==null&&t!==void 0?t:"middle",this._visible=this._spec.visible!==!1;const{regionId:e,regionIndex:i,seriesId:n,seriesIndex:r}=this._spec;R(n)&&(this._seriesUserId=Y(n)),R(e)&&(this._regionUserId=Y(e)),R(r)&&(this._seriesIndex=Y(r)),R(i)&&(this._regionUserIndex=Y(i)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionUserIndex)}created(){super.created(),this.initData()}onRender(t){}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reRender=!0,(t==null?void 0:t.orient)!==(e==null?void 0:e.orient)?(i.reMake=!0,i):(Xt(e,t)||(i.reCompile=!0),i)}changeRegions(t){}_bindLegendDataChange(){this._preSelectedData=this._selectedData.slice(),this._initSelectedData()}initData(){const t=this._initLegendData();t.target.addListener("change",this._bindLegendDataChange.bind(this)),this._legendData=new Vn(this._option,t),this._initSelectedData(),qe(this._regions,e=>{e.event.on(pt.rawDataUpdate,{filter:({model:i})=>(i==null?void 0:i.id)===e.id},()=>{this._legendData.getDataView().reRunAllTransform()})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}setSelectedData(t){var e,i,n;const r=this._selectedData;I(t)||JSON.stringify(r)===JSON.stringify(t)||(qe(this._regions,a=>{a.legendSelectedFilter&&(t=a.legendSelectedFilter(this,t))},{userId:this._seriesUserId,specIndex:this._seriesIndex}),this._selectedData=[...t],(i=(e=this.effect).onSelectedDataChange)===null||i===void 0||i.call(e),this.event.emit(pt.legendSelectedDataChange,{model:this}),(n=this._legendComponent)===null||n===void 0||n.setSelected(this._selectedData))}afterSetLayoutStartPoint(t){if(super.afterSetLayoutStartPoint(t),this._legendComponent){const{x:e,y:i}=t;q(e*i)&&this._legendComponent.setAttributes({x:e,y:i})}}getBoundsInRect(t,e){if(!this._visible)return this._legendComponent&&this._legendComponent.parent&&(this._legendComponent.parent.removeChild(this._legendComponent),this._legendComponent=null),{x1:0,y1:0,x2:0,y2:0};const i={x1:this.getLayoutStartPoint().x,y1:this.getLayoutStartPoint().y,x2:0,y2:0},n=this._getLegendAttributes(t);if(n.disableTriggerEvent=this._option.disableTriggerEvent,this._legendComponent)Xt(n,this._cacheAttrs)||this._legendComponent.setAttributes(mt({},n,{defaultSelected:this._selectedData}));else{const o=new(this._getLegendConstructor())(mt({},n,{defaultSelected:this._selectedData}));o.name="legend",this._legendComponent=o,this.getContainer().add(o),this._option.disableTriggerEvent||this._initEvent(),o.on("*",(l,h)=>this._delegateEvent(this._legendComponent,l,h))}this._cacheAttrs=n;const r=isFinite(this._legendComponent.AABBBounds.width())?this._legendComponent.AABBBounds.width():0,a=isFinite(this._legendComponent.AABBBounds.height())?this._legendComponent.AABBBounds.height():0;if(this.layoutType!=="normal-inline"){const o=this.layoutOrient==="bottom"||this.layoutOrient==="top"?"horizontal":"vertical",l=this._position,{width:h,height:c}=e;let u=0,d=0;o==="horizontal"?l==="middle"?u=(h-r)/2:l==="end"&&(u=h-r):l==="middle"?d=(c-a)/2:l==="end"&&(d=c-a),this._legendComponent.setAttributes({dx:u,dy:d})}return i.x2=i.x1+r,i.y2=i.y1+a,i}onDataUpdate(){var t,e,i;if(JSON.stringify(this._preSelectedData)!==JSON.stringify(this._selectedData)){if(this._legendComponent){const n=this._getLegendAttributes(this.getLayoutRect());Xt(n,this._cacheAttrs)||this._legendComponent.setAttributes(mt({},n,{defaultSelected:this._selectedData}))}(e=(t=this.effect).onSelectedDataChange)===null||e===void 0||e.call(t),(i=this.getChart())===null||i===void 0||i.setLayoutTag(!0,null,!1),this.event.emit(pt.legendSelectedDataChange,{model:this})}}_getNeedClearVRenderComponents(){return[this._legendComponent]}clear(){super.clear(),this._cacheAttrs=null,this._preSelectedData=null}}E1.specKey="legends";class Pu extends E1{constructor(){super(...arguments),this.type=st.discreteLegend,this.name=st.discreteLegend}static getSpecInfo(t){return bu(t,this.specKey,this.type,e=>!e.type||e.type==="discrete")}init(t){super.init(t),qe(this._regions,e=>{e.addViewDataFilter({type:"discreteLegendFilter",options:{series:e,selected:()=>this._selectedData,field:()=>this._getSeriesLegendField(e),data:()=>this.getLegendDefaultData(),customFilter:this._spec.customFilter},level:du.legendFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}_initLegendData(){Se(this._option.dataSet,"discreteLegendFilter",_P),Se(this._option.dataSet,"discreteLegendDataMake",yP);const t=new _e(this._option.dataSet,{name:\`\${this.type}_\${this.id}_data\`});return t.transform({type:"discreteLegendDataMake",options:{series:()=>{const e=[];return qe(this._regions,i=>{e.push(i)},{specIndex:this._spec.seriesIndex,userId:this._spec.seriesId}),e},seriesField:e=>this._getSeriesLegendField(e)}}),t}_getSeriesLegendField(t){var e,i,n;const r=t.getSeriesField(),a=(e=this._spec.scaleName)!==null&&e!==void 0?e:this._spec.scale;if(I(a)||!t.getRawData())return r;const o=this._option.globalScale.getScaleSpec(a);if(!o)return r;if(this._spec.field)return this._spec.field;if(!uo(o.domain))return r;const l=o.domain.find(h=>h.dataId===t.getRawData().name);return l&&(n=(i=l.fields)===null||i===void 0?void 0:i[0])!==null&&n!==void 0?n:r}_initSelectedData(){const t=this.getLegendDefaultData();if(this._unselectedData){const e=[],i=[];t.forEach(n=>{this._unselectedData.includes(n)?i.push(n):e.push(n)}),this._selectedData=e,this._unselectedData=i}else this._spec.defaultSelected?this._selectedData=[...this._spec.defaultSelected]:this._selectedData=t}getLegendDefaultData(t){return U(this._spec.data)?this._getLegendItems().map(e=>e.label):this._legendData.getLatestData().map(t?e=>e.originalKey:e=>e.key)}_addDefaultTitleText(t){var e,i,n,r;if(!((e=t.title)===null||e===void 0)&&e.visible&&I(t.title.text)&&I((i=t.title.style)===null||i===void 0?void 0:i.text)){const a=(r=(n=this._regions)===null||n===void 0?void 0:n[0])===null||r===void 0?void 0:r.getSeries()[0];if(!a)return;t.title.text=Gb(a.getRawData(),a.getSeriesField())}}_getLegendAttributes(t){const e=this.layoutOrient==="bottom"||this.layoutOrient==="top"?"horizontal":"vertical",i=Object.assign(Object.assign({layout:e,items:this._getLegendItems(),zIndex:this.layoutZIndex},vP(this._spec,t)),{maxWidth:t.width,maxHeight:t.height});return this._addDefaultTitleText(i),this._addLegendItemFormatMethods(i),i}_getLegendConstructor(){return hb}setSelectedData(t){t&&(this._unselectedData=this.getLegendDefaultData().filter(e=>!t.includes(e))),super.setSelectedData(t)}_initEvent(){if(this._legendComponent){const t=this._spec.filter!==!1;this._legendComponent.addEventListener(Oi.legendItemClick,e=>{const i=vt(e,"detail.currentSelected");t&&this.setSelectedData(i),this.event.emit(pt.legendItemClick,{model:this,value:i,event:e})}),this._legendComponent.addEventListener(Oi.legendItemHover,e=>{const i=vt(e,"detail");this.event.emit(pt.legendItemHover,{model:this,value:i,event:e})}),this._legendComponent.addEventListener(Oi.legendItemUnHover,e=>{const i=vt(e,"detail");this.event.emit(pt.legendItemUnHover,{model:this,value:i,event:e})})}}_getLegendItems(){const t=(this._legendData.getLatestData()||[]).map(e=>{var i,n;const r=e.style("fillOpacity"),a=e.style("strokeOpacity"),o=e.style("opacity"),l=e.style("texture");return{label:e.key,shape:{symbolType:(n=(i=e.style("symbolType"))!==null&&i!==void 0?i:e.shapeType)!==null&&n!==void 0?n:"circle",fillOpacity:q(r)?r:1,strokeOpacity:q(a)?a:1,opacity:q(o)?o:1,texturePadding:l?1:null,textureSize:l?4:null,texture:l,fill:e.style("fill"),stroke:e.style("stroke"),textureColor:e.style("textureColor"),innerBorder:e.style("innerBorder"),outerBorder:e.style("outerBorder"),lineDash:e.style("lineDash"),lineDashOffset:e.style("lineDashOffset"),lineWidth:e.style("lineWidth")}}});return U(this._spec.data)?this._spec.data(t,this._option.globalScale.getScale("color"),this._option.globalScale):t}_addLegendItemFormatMethods(t){var e,i,n,r;const{formatMethod:a,formatter:o}=(i=(e=this._spec.item)===null||e===void 0?void 0:e.label)!==null&&i!==void 0?i:{},{formatMethod:l,formatter:h}=(r=(n=this._spec.item)===null||n===void 0?void 0:n.value)!==null&&r!==void 0?r:{},{formatFunc:c}=ra(a,o);o&&!a&&c&&(t.item.label.formatMethod=(d,p)=>c(d,p,o));const{formatFunc:u}=ra(l,h);h&&!l&&u&&(t.item.value.formatMethod=(d,p)=>u(h,d,p,o))}}Pu.specKey="legends",Pu.type=st.discreteLegend;const ga="vchart-tooltip",B1=\`\${ga}-container\`,gf=\`\${ga}-title\`,ff=\`\${ga}-content-box\`,mf={offsetX:10,offsetY:10},R1="99999999999999";function fa(s){return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\(/g,"&#40;").replace(/  /g," &nbsp;")}const I1=(s,t)=>s?(t||(t=s.getBoundingClientRect()),s.offsetWidth>0?t.width/s.offsetWidth:s.offsetHeight>0?t.height/s.offsetHeight:1):1,O1=s=>Q(s)&&(s==null?void 0:s.trim())!==""||it(s)?fa(s):"",ll=(s,t)=>{let e;if(R(s)){if(it(s))e=s;else if(U(s)){const i=s(t);it(i)&&(e=i)}}return e},bP={left:[-2,0],right:[2,0],top:[0,-2],lt:[-2,-2],tl:[-2,-2],rt:[2,-2],tr:[2,-2],bottom:[0,2],bl:[-2,2],lb:[-2,2],br:[2,2],rb:[2,2],inside:[0,0],center:[0,0],centerBottom:[0,1],centerTop:[0,-1],centerLeft:[-1,0],centerRight:[1,0]},P1=(s,t,e=2)=>{var i,n;return(n=(i=bP[s])===null||i===void 0?void 0:i[t==="x"?0:1])!==null&&n!==void 0?n:e};class vf extends sf{constructor(){super(...arguments),this._visible=!0,this._isReleased=!1,this.showTooltip=(t,e,i)=>{const{changePositionOnly:n}=i;return n?this.changeTooltipPosition(i,e):this.changeTooltip(!0,i,e)},this.changeTooltip=(t,e,i)=>this._isReleased?1:t?this.changeTooltipPosition(e,i):(this._updateTooltip(!1,e),0),this.changeTooltipPosition=(t,e)=>{var i,n,r,a,o;if(this._isReleased)return 1;const l=t.event,{tooltipSpec:h,activeTooltipSpec:c,changePositionOnly:u}=t;if(!c)return 1;const d=c.activeType;if(c.handler)return(r=(n=(i=c.handler).showTooltip)===null||n===void 0?void 0:n.call(i,d,e,t))!==null&&r!==void 0?r:0;const p=c,g=this._getActualTooltipPosition(c,t,this._getTooltipBoxSize(c,u));c.position=g;const f=(a=c.updatePosition)!==null&&a!==void 0?a:(o=h[d])===null||o===void 0?void 0:o.updatePosition;f&&(c.position=f(c.position,e,t));let m=(p==null?void 0:p.visible)!==!1;return e&&l.type!=="pointerout"&&c.visible&&(c.title||c.content)||(m=!1),this._updateTooltip(m,Object.assign(Object.assign({},t),{changePositionOnly:u})),0},this._getActualTooltipPosition=(t,e,i)=>{var n,r,a,o,l,h,c,u,d;const{tooltipSpec:p}=e,g={x:1/0,y:1/0};if(!p)return g;const f=e.event,{activeType:m,data:v}=t,y=m==="dimension"?(r=(n=v[0])===null||n===void 0?void 0:n.data)===null||r===void 0?void 0:r[0]:v==null?void 0:v[0],{offsetX:_,offsetY:b}=this._option,x=p[m],S=uS(x==null?void 0:x.position,v,e),A=(a=uS(x==null?void 0:x.positionMode,v,e))!==null&&a!==void 0?a:m==="mark"?"mark":"pointer",{width:w=0,height:k=0}=i??{},T=p.renderMode==="canvas",C=(o=e==null?void 0:e.chart)===null||o===void 0?void 0:o.getCanvasRect(),M=(l=C==null?void 0:C.width)!==null&&l!==void 0?l:On,B=(h=C==null?void 0:C.height)!==null&&h!==void 0?h:Pn;let O=!1;const E={width:0,height:0};let L,P={x:0,y:0},F={x:0,y:0},j=1,D=1;const N=ks(this._env);if(N&&!p.confine?(E.width=window.innerWidth,E.height=window.innerHeight):(E.width=M,E.height=B),N&&!T){const tt=this._getParentElement(p);F=(u=(c=tt==null?void 0:tt.getBoundingClientRect)===null||c===void 0?void 0:c.call(tt))!==null&&u!==void 0?u:g;const lt=(d=this._compiler.getCanvas())!==null&&d!==void 0?d:this._chartContainer;L=lt==null?void 0:lt.getBoundingClientRect(),P={x:L.x-F.x,y:L.y-F.y},j=I1(lt,L),D=I1(tt,F)}const J=D/j,X={},$={x:S,y:S},G={x:["left","right"],y:["top","bottom"]},z=({orient:tt,mode:lt,offset:Mt},Pt)=>{var Dt;let ue,Re;const de=e.model,zt=de==null?void 0:de.getLayoutStartPoint(),vi=Mt??(Pt==="x"?_:b);if(lt==="mark"){O=!0;const ti=e.item,yi=ti==null?void 0:ti.getBounds();yi&&zt&&(ue=(Pt==="x"?yi.x1:yi.y1)+zt[Pt],Re=(Pt==="x"?yi.x2:yi.y2)+zt[Pt])}else if(lt==="crosshair"&&((Dt=y==null?void 0:y.series)===null||Dt===void 0?void 0:Dt.coordinate)==="cartesian"&&y.datum&&y.datum.length){O=!0;const ti=((yi,bf)=>{var Di;const cl=new Map,va=new Map,{series:Is,datum:ul}=yi,dl=Is.direction==="horizontal",xf=(dl?Is.getYAxisHelper():Is.getXAxisHelper()).getAxisId(),ya=Is.getChart().getComponentsByKey("axes").find(Sf=>Sf.id===xf);if(!ya)return;(dl?va:cl).set(ya.getSpecIndex(),{datum:(Di=Is.getDatumPositionValues(ul[0],Is.getDimensionField()))===null||Di===void 0?void 0:Di[0],axis:ya});const un={xField:{coordKey:"x",anotherAxisKey:"y",currentValue:cl,attributes:{visible:!!cl.size,type:"rect"}},yField:{coordKey:"y",anotherAxisKey:"x",currentValue:va,attributes:{visible:!!va.size,type:"rect"}}};return A1(un,Is,bf),un.xField.cacheInfo?df(un.xField):un.yField.cacheInfo?df(un.yField):void 0})(y,zt);ti&&(ue=ti.start[Pt],Re=ti.end[Pt])}else $[Pt]=tt;if(O){const ti=G[Pt][0],yi=Pt==="x"?w:k;switch(P1(tt,Pt)){case-2:X[ti]=ue-yi*J-vi;break;case 0:X[ti]=(ue+Re)/2-yi*J/2;break;case-1:X[ti]=(ue+Re)/2-yi*J-vi;break;case 1:X[ti]=(ue+Re)/2+vi;break;case 2:X[ti]=Re+vi}}},ot=["x","y"];if(_t(S))if(_t(ft=S)&&(R(ft.left)||R(ft.right)||R(ft.top)||R(ft.bottom))){const{left:tt,right:lt,top:Mt,bottom:Pt}=S;X.left=ll(tt,f),X.top=ll(Mt,f),X.right=ll(lt,f),X.bottom=ll(Pt,f)}else(tt=>_t(tt)&&(R(tt.x)||R(tt.y)))(S)&&ot.forEach(tt=>{const lt=S[tt];it(lt)||U(lt)?X[G[tt][0]]=ll(lt,f):z(lt,tt)});else R(S)&&(z({orient:S,mode:A},"x"),z({orient:S,mode:A},"y"));var ft;const ut={x:null,y:null};return ot.forEach(tt=>{var lt;const Mt=tt==="x"?w:k,Pt=tt==="x"?M:B,Dt=tt==="x"?_:b,ue=P1($[tt],tt);if(q(X[G[tt][0]]))ut[tt]=X[G[tt][0]];else if(q(X[G[tt][1]]))ut[tt]=Pt-Mt*J-X[G[tt][1]];else{const vi=tt==="x"?f.canvasX:f.canvasY;ut[tt]=ue>0?vi+Dt:ue===0?vi-Mt*J/2:vi-Mt*J-Dt}ut[tt]*=j,N&&(ut[tt]+=P[tt]),ut[tt]/=D;const Re=tt==="x"?E.width:E.height,de=p.confine?-(F[tt]-((lt=L==null?void 0:L[tt])!==null&&lt!==void 0?lt:0)/j)/D:-F[tt]/D,zt=Re/D+de-Mt;ue!==2&&ut[tt]<de?O?ut[tt]=de:(ut[tt]+=ue===0?Dt+Mt/2:2*Dt+Mt,ut[tt]>zt&&(ut[tt]=zt)):ue!==-2&&ut[tt]>zt&&(O?ut[tt]=zt:(ut[tt]-=ue===0?Dt+Mt/2:2*Dt+Mt,ut[tt]<de&&(ut[tt]=de)))}),ut}}get env(){return this._env}onAdd(t){super.onAdd(t);const e=t.component;this._component=e,this._chartOption=e.getOption(),this._env=this._chartOption.mode,this._chartContainer=this._chartOption.globalInstance.getContainer(),this._compiler=e.getCompiler(),this._initFromSpec()}hideTooltip(t){return this.changeTooltip(!1,t)}release(){var t,e,i;const n=(t=this._component.getSpec())!==null&&t!==void 0?t:{};n.handler?(i=(e=n.handler).release)===null||i===void 0||i.call(e):(this._removeTooltip(),this._isReleased=!0)}_getDefaultOption(){var t,e;const{offset:i}=this._component.getSpec();return i?{offsetX:(t=i.x)!==null&&t!==void 0?t:mf.offsetX,offsetY:(e=i.y)!==null&&e!==void 0?e:mf.offsetY}:mf}_getParentElement(t){return t.parentElement}getTooltipContainer(){return this._container}_initFromSpec(){this._option=this._getDefaultOption()}reInit(){this._initFromSpec()}}vf.specKey="tooltip";const $n=(s,t)=>R(s)?W(s)?s.map(e=>\`\${e}px\`).join(" "):\`\${s}px\`:t??"initial",hl=(s={},t={})=>{var e,i;R(s.fontFamily)&&(t.fontFamily=s.fontFamily);const n=(e=s.fill)!==null&&e!==void 0?e:s.fontColor;return R(n)&&(t.color=n),R(s.fontWeight)&&(t.fontWeight=s.fontWeight),R(s.textAlign)&&(t.textAlign=s.textAlign),R(s.fontSize)&&(t.fontSize=$n(s.fontSize)),R(s.maxWidth)&&(t.maxWidth=$n(s.maxWidth)),s.multiLine||R(s.maxWidth)&&s.multiLine!==!1?(t.whiteSpace="initial",t.wordBreak=(i=s.wordBreak)!==null&&i!==void 0?i:"break-word"):(t.wordBreak="normal",t.whiteSpace="nowrap"),t},L1=(s={})=>{const{lineHeight:t}=s;return s.fontSize?Je(t,s.fontSize):0},xP=s=>{var t;const{backgroundColor:e,border:i,shadow:n,padding:r}=s,a={borderWidth:\`\${(t=i==null?void 0:i.width)!==null&&t!==void 0?t:0}px\`};let o=null;i!=null&&i.color&&(a.borderColor=i.color),e&&(a.backgroundColor=e),a.boxShadow=n?\`\${n.x}px \${n.y}px \${n.blur}px \${n.spread}px \${n.color}\`:"initial";const{radius:l}=i??{};return R(l)&&(a.borderRadius=q(l)?\`\${l}px\`:\`\${l}\`),r&&(o=Si(r),a.padding=$n(o)),{panelStyle:a,panelPadding:o}};function Xn(s,t){s&&s.style&&t&&Object.keys(t).forEach(e=>{s.style[e]=t[e]})}class yf extends vf{getVisibility(){return!!this._rootDom&&this._rootDom.style.visibility==="visible"}setVisibility(t){t!==this.getVisibility()&&this._rootDom&&(this._rootDom.style.visibility=t?"visible":"hidden")}constructor(){super(yf.type),this.type=pa.dom,this._tooltipContainer=Sr==null?void 0:Sr.body}onAdd(t){super.onAdd(t),this._initStyle(),this.initEl()}initEl(){const t=this._component.getSpec().parentElement;if(Sr&&t&&t.children&&t.children.length){for(let e=0;e<t.children.length;e++)if(t.children[e].classList.contains(B1)){this._container=t.children[e];break}this._container||(this._container=Sr.createElement("div"),this._container.style.position="relative",this._container.style.zIndex=R1,this._container.classList.add(B1),t.appendChild(this._container))}}initRootDom(){var t,e,i;const n=this._component.getSpec(),r=document.createElement("div"),a=(e=(t=this._chartOption)===null||t===void 0?void 0:t.getTheme())!==null&&e!==void 0?e:{};Xn(r,Object.assign({left:"0",top:"0",pointerEvents:"none",padding:"12px",position:"absolute",zIndex:R1,fontFamily:(i=a==null?void 0:a.fontFamily)!==null&&i!==void 0?i:$r.fontFamily,fontSize:"11px",borderRadius:"3px",borderStyle:"solid",lineHeight:"initial",background:"#fff",boxShadow:"2px 2px 4px rgba(0, 0, 0, 0.1)",maxWidth:"100wh",maxHeight:"100vh",visibility:"hidden"},this._domStyle.panel)),r.classList.add(n.className),r.setAttribute("vchart-tooltip-id",\`\${this.id}\`),this._container.appendChild(r),this._rootDom=r}_getTooltipBoxSize(t,e){var i;this._rootDom||this.initRootDom(),e||this._updateDomStringByCol(t),this._updateDomStyle("height");const n=(i=this._rootDom)===null||i===void 0?void 0:i.getBoundingClientRect();return{width:n==null?void 0:n.width,height:n==null?void 0:n.height}}_removeTooltip(){this._rootDom&&this._rootDom.parentNode&&(this._rootDom.parentNode.removeChild(this._rootDom),this._rootDom=null),this._container=null}_updateTooltip(t,e){var i,n,r;if(t&&this._rootDom){const{tooltipSpec:a,activeTooltipSpec:o}=e;e.changePositionOnly||(this._tooltipActual=o);const l=this.getVisibility(),h=this._rootDom;if(h){const{x:c=0,y:u=0}=(i=o.position)!==null&&i!==void 0?i:{};if(a.updateElement){this._updatePosition((n=this._cacheCustomTooltipPosition)!==null&&n!==void 0?n:{x:c,y:u}),a.updateElement(h,o,e);const d=this._getActualTooltipPosition(o,e,{width:h.offsetWidth,height:h.offsetHeight});this._updatePosition(d),this._cacheCustomTooltipPosition=d}else this._rootDom.style.transitionDuration=l?(r=this._domStyle.panel.transitionDuration)!==null&&r!==void 0?r:"initial":"0ms",this._updatePosition({x:c,y:u})}this.setVisibility(t)}else this.setVisibility(t),this._cacheCustomTooltipPosition=void 0}_initStyle(){const t=this._component.getSpec();this._domStyle=((e={})=>{var i,n,r,a;const{style:o={},enterable:l,transitionDuration:h}=e,{panel:c={},titleLabel:u,shape:d,keyLabel:p,valueLabel:g,spaceRow:f,align:m}=o,{panelStyle:v,panelPadding:y}=xP(c),_={marginTop:"0px",marginBottom:"0px"};v.pointerEvents=l?"auto":"none",h&&(v.transitionDuration=h?\`\${h}ms\`:"initial",v.transitionProperty=h?"transform":"initial",v.transitionTimingFunction=h?"ease-out":"initial"),q(f)&&(_.marginBottom=\`\${f}px\`);const b={width:$n((i=d==null?void 0:d.size)!==null&&i!==void 0?i:8)},x=hl(u),S=hl(p),A=hl(g),w=m==="right"?"marginLeft":"marginRight";m==="right"?(v.direction="rtl",x.textAlign="right",S.textAlign="right",A.textAlign="left"):(x.textAlign="left",S.textAlign="left",A.textAlign="right"),b[w]=$n((n=d.spacing)!==null&&n!==void 0?n:8),S[w]=$n((r=p.spacing)!==null&&r!==void 0?r:26),A[w]=$n((a=g.spacing)!==null&&a!==void 0?a:0);const k=Math.max(L1(g),L1(p));return _.lineHeight=k>0?\`\${k}px\`:"20px",{panelPadding:y,row:_,panel:v,title:x,shape:b,key:S,value:A}})(t)}_updateDomStringByCol(t){var e;const{title:i={},content:n}=t,r=n&&n.length,a=this._domStyle.row,o=[...this._rootDom.children];let l=o.find(u=>u.className.includes(gf));if(!l&&i.visible!==!1){l=document.createElement("h2");const u=document.createElement("span");l.appendChild(u),l.classList.add(gf),this._rootDom.appendChild(l)}l&&i.visible!==!1?(Xn(l,Object.assign(Object.assign(Object.assign({},this._domStyle.title),r?a:{marginBottom:"0px"}),{marginTop:"0px"})),l.firstChild.innerHTML=\`\${(e=i.value)!==null&&e!==void 0?e:""}\`):l&&i.visible===!1&&l.parentNode.removeChild(l);let h=o.find(u=>u.className.includes(ff));const c=["shape","key","value"];if(!h&&r&&(h=document.createElement("div"),c.forEach(u=>{const d=document.createElement("div");d.classList.add(\`\${ga}-column\`),d.classList.add(\`\${ga}-\${u}-column\`),d.setAttribute("data-col",u),h.appendChild(d)}),h.classList.add(ff),this._rootDom.appendChild(h)),h&&r){const u=[...h.children];Xn(h,{whiteSpace:"nowrap"}),u.forEach((d,p)=>{const g=d.getAttribute("data-col");if(g&&c.includes(g)){const f=g==="shape"&&n.every(v=>!v.hasShape||!v.shapeType);Xn(d,Object.assign(Object.assign({},this._domStyle[g]),{display:f?"none":"inline-block",verticalAlign:"top"}));const m=[...d.children];m.slice(n.length).forEach(v=>{v.parentNode.removeChild(v)}),n.forEach((v,y)=>{let _=m[y];_||(_=document.createElement("div"),_.classList.add(\`\${ga}-\${g}\`),d.appendChild(_));const b=Object.assign({},a);y===n.length-1&&(b.marginBottom="0px"),b.display=v.visible===!1?"none":"block",b.height="initial",g==="key"?(_.innerHTML=O1(v.key),v.keyStyle&&hl(v.keyStyle,b)):g==="value"?(_.innerHTML=O1(v.value),v.valueStyle&&hl(v.valueStyle,b)):g==="shape"&&(_.innerHTML=function(x,S){var A,w,k,T,C,M;if(!x||!x.hasShape||!x.shapeType)return"";const B='style="display:inline-block;vertical-align:middle;"',{shapeType:O,shapeFill:E,shapeStroke:L,shapeHollow:P=!1}=x,F=(A=x.shapeSize)!==null&&A!==void 0?A:8,j=x.shapeLineWidth?fa(x.shapeLineWidth)+"px":"0px";let D="currentColor";const N=()=>L?fa(L):D,J=F,X=ut=>new Ud({symbolType:ut,size:J,fill:!0});let $=X(O);const G=$.getParsedPath();let z,ot;if(!G.path&&G.pathStr&&($=X(G.pathStr)),$.getParsedPath().path){const ut=$.getParsedPath().path;ot=ut.toString(),z=ut.bounds}else G.isSvg&&G.svgCache&&(ot=G.svgCache.map(ut=>ut.path.toString()).join(),z=G.svgCache.reduce((ut,tt)=>ut.union(tt.path.bounds),new es));let ft=\`\${z.x1} \${z.y1} \${z.width()} \${z.height()}\`;if(j!=="0px"){const[ut,tt,lt,Mt]=ft.split(" ").map(Dt=>Number(Dt)),Pt=Number(j.slice(0,-2));ft=\`\${ut-Pt/2} \${tt-Pt/2} \${lt+Pt} \${Mt+Pt}\`}if(!E||Q(E)||P)return D=P?"none":E?fa(E):"currentColor",\`
    <svg \${B} width="\${F}" height="\${F}" viewBox="\${ft}">
      <path
        d="\${ot}"
        style="fill: \${D}; stroke: \${N()}; stroke-width: \${j}"
      >
      </path>
    </svg>\`;if(_t(E)){D="gradientColor"+(S??"");let ut="";const tt=((w=E.stops)!==null&&w!==void 0?w:[]).map(lt=>\`<stop offset="\${fa(lt.offset.toString())}" stop-color="\${fa(lt.color)}"/>\`).join("");return E.gradient==="radial"?ut=\`<radialGradient id="\${D}" cx="50%" cy="50%" r="50%" fx="0%" fy="0%">
      \${tt}
      </radialGradient>\`:E.gradient==="linear"&&(ut=\`<linearGradient id="\${D}" x1="\${100*((k=E.x0)!==null&&k!==void 0?k:0)}%" y1="\${100*((T=E.y0)!==null&&T!==void 0?T:0)}%" x2="\${100*((C=E.x1)!==null&&C!==void 0?C:0)}%" y2="\${100*((M=E.y1)!==null&&M!==void 0?M:0)}%">
      \${tt}
      </linearGradient>\`),\`
    <svg \${B} width="\${F}" height="\${F}" viewBox="-0.5 -0.5 1 1">
      \${ut}
      <path
        d="\${ot}"
        style="fill: url(#\${D}); stroke: \${N()}; stroke-width: \${j}"
      >
      </path>
    </svg>\`}return""}(v,\`\${this.id}_\${y}\`)),Xn(_,b)})}})}else h&&!r&&h.parentNode.removeChild(h)}_updateDomStyle(t="width"){var e,i,n,r;const a=this._rootDom,o=[...a.children].find(l=>l.className.includes(ff));if(o){const l=this._component.getSpec(),h={};if(R((e=l==null?void 0:l.style)===null||e===void 0?void 0:e.maxContentHeight)){const d=a.children[0],p=d&&d.className.includes(gf)?d.getBoundingClientRect().height+((i=l.style.spaceRow)!==null&&i!==void 0?i:0):0,g=this._chartOption.getChartViewRect(),f=Je(l.style.maxContentHeight,Math.min(g.height,document.body.clientHeight)-p-(this._domStyle.panelPadding?this._domStyle.panelPadding[0]+this._domStyle.panelPadding[1]:0));f>0&&(h.maxHeight=\`\${f}px\`,h.overflowY="auto",h.width=\`calc(100% + \${this._domStyle.panelPadding?this._domStyle.panelPadding[1]+"px":"10px"})\`,Xn(o,h))}const c=o.children,u=[];if(c){for(let d=0;d<c.length;d++){const p=(n=c[d].children)!==null&&n!==void 0?n:[];for(let g=0;g<p.length;g++){const f=p[g].getBoundingClientRect()[t];(u[g]===void 0||u[g]<f)&&(u[g]=f)}}for(let d=0;d<c.length;d++){const p=(r=c[d].children)!==null&&r!==void 0?r:[];for(let g=0;g<p.length;g++)p[g].style[t]=\`\${u[g]}px\`}}}}_getParentElement(t){var e;return(e=this._container)!==null&&e!==void 0?e:super._getParentElement(t)}isTooltipShown(){return this.getVisibility()}reInit(){super.reInit(),this._initStyle(),this._rootDom&&Xn(this._rootDom,this._domStyle.panel),this.getVisibility()&&(this._updateDomStringByCol(this._tooltipActual),this._updateDomStyle("height"))}_updatePosition({x:t,y:e}){this._rootDom&&(this._rootDom.style.transform=\`translate3d(\${t}px, \${e}px, 0)\`)}}yf.type=pa.dom;const SP={fontFamily:$r.fontFamily,spacing:10,wordBreak:"break-word"},_f=(s,t)=>{var e;let i,n;(s==null?void 0:s.type)!=="rich"&&(s==null?void 0:s.type)!=="html"?(s=(s??"").toString(),t.multiLine?(i=s.split(\`
\`),i=i.map((o,l)=>l<i.length-1?o+\`
\`:o)):i=[s],n=i.map(o=>Object.assign(Object.assign({},t),{text:o}))):(n=s.text,i=s);const r=(a={wordBreak:(e=t.wordBreak)!==null&&e!==void 0?e:"break-word",maxWidth:t.maxWidth?t.maxWidth:void 0,width:0,height:0,textConfig:n},vh||(vh=gt.CreateGraphic("richtext",{})),vh.setAttributes(a),vh.AABBBounds);var a;return{width:r.width(),height:r.height(),text:i}};function ma(s={},t,e){var i,n;return Object.assign(Object.assign({},e??SP),{fill:(i=s.fill)!==null&&i!==void 0?i:s.fontColor,textAlign:s.textAlign,textBaseline:s.textBaseline,fontFamily:(n=s.fontFamily)!==null&&n!==void 0?n:t==null?void 0:t.fontFamily,fontSize:s.fontSize,fontWeight:s.fontWeight,lineHeight:s.lineHeight,spacing:s.spacing,multiLine:R(s.maxWidth)?s.multiLine!==!1:s.multiLine,maxWidth:s.maxWidth,wordBreak:s.wordBreak,autoWidth:s.autoWidth})}const AP=s=>{var t;const{backgroundColor:e,border:i,shadow:n}=s,r={lineWidth:(t=i==null?void 0:i.width)!==null&&t!==void 0?t:0,shadow:!!n};i!=null&&i.color&&(r.stroke=i.color),e&&(r.fill=e),n&&(r.shadowColor=n.color,r.shadowBlur=n.blur,r.shadowOffsetX=n.x,r.shadowOffsetY=n.y,r.shadowSpread=n.spread);const{radius:a}=i??{};return R(a)&&(r.cornerRadius=[a,a,a,a]),r};class Lu extends vf{constructor(){super(Lu.type),this.type=pa.canvas,this._attributes=null}onAdd(t){var e;super.onAdd(t),this._tooltipCanvasId=(e=this._chartOption.modeParams)===null||e===void 0?void 0:e.tooltipCanvasId}_initTooltipComponent(t){const e=this._getLayer(t);this._tooltipComponent=new ub({autoCalculatePosition:!1,autoMeasure:!1}),e.add(this._tooltipComponent)}_getLayer(t){if(this._layer)return this._layer;this._layer=t.createLayer(this._tooltipCanvasId);const e=this._layer.layerHandler.canvas.nativeCanvas;return e&&e.style&&(e.style.touchAction="none",e.style.pointerEvents="none"),this._layer}_getTooltipBoxSize(t,e){var i,n,r;if(!e||I(this._attributes)){const o=(n=(i=this._chartOption)===null||i===void 0?void 0:i.getTheme())!==null&&n!==void 0?n:{};this._attributes=((l,h,c)=>{var u,d,p,g,f;const{style:m={},enterable:v,transitionDuration:y}=h,{panel:_={},titleLabel:b,shape:x,keyLabel:S,valueLabel:A,spaceRow:w,align:k}=m,T=Si(_.padding),C=Ro(_.padding),M=ma(Object.assign({textAlign:k==="right"?"right":"left"},b),c),B=ma(Object.assign({textAlign:k==="right"?"right":"left"},S),c),O=ma(A,c),E={fill:!0,size:(u=x==null?void 0:x.size)!==null&&u!==void 0?u:8,spacing:(d=x==null?void 0:x.spacing)!==null&&d!==void 0?d:6},L={panel:AP(_),padding:T,title:{},content:[],titleStyle:{value:M,spaceRow:w},contentStyle:{shape:E,key:B,value:O,spaceRow:w},hasContentShape:!1,keyWidth:0,valueWidth:0,enterable:v,transitionDuration:y,align:k},{title:P={},content:F=[]}=l;let j=C.left+C.right,D=C.top+C.bottom,N=0;const J=!!F.length;let X=0,$=0,G=0,z=0;if(J){const Re=[],de=[],zt=[],vi=[];let ti=0;L.content=F.map((yi,bf)=>{let Di=0;const{hasShape:cl,key:va,shapeType:Is="",shapeFill:ul,shapeStroke:dl,shapeLineWidth:xf,shapeSize:ya,value:un,isKeyAdaptive:Sf,spaceRow:D1,keyStyle:CP,valueStyle:MP,shapeHollow:EP}=yi,qn={height:0,spaceRow:D1??w};if(R(va)){const qi=mt({},B,ma(CP,void 0,{})),{width:Os,height:pl,text:Af}=_f(va,qi);qn.key=Object.assign(Object.assign({width:Os,height:pl},qi),{text:Af}),Sf?de.push(Os):Re.push(Os),Di=Math.max(Di,pl)}if(R(un)){const qi=mt({},O,ma(MP,void 0,{})),{width:Os,height:pl,text:Af}=_f(un,qi);qn.value=Object.assign(Object.assign({width:Os,height:pl},qi),{text:Af}),zt.push(Os),Di=Math.max(Di,pl)}if(cl){const qi={visible:!0,symbolType:Is};EP?qi.stroke=ul:qi.fill=ul,qi.stroke=dl??ul,qi.lineWidth=xf,qn.shape=qi;const Os=ya??E.size;Di=Math.max(Os,Di),vi.push(Os)}else qn.shape={visible:!1};return qn.height=Di,ti+=Di,bf<F.length-1&&(ti+=qn.spaceRow),qn}),D+=ti,X=Re.length?Ge(Re):0,$=de.length?Ge(de):0,G=zt.length?Ge(zt):0,z=vi.length?Ge(vi)+E.spacing:0,N=Math.max(z+X+B.spacing+G+O.spacing,z+$,N),L.hasContentShape=!!vi.length,L.keyWidth=X,L.valueWidth=G}let ot=0,ft=0,ut=0;const{visible:tt=!0,value:lt="",valueStyle:Mt,spaceRow:Pt}=P;L.title.visible=tt,L.title.spaceRow=Pt??w;let Dt={};const ue=()=>Dt.autoWidth&&Dt.multiLine!==!1;if(tt){Dt=mt({},M,ma(Mt,void 0,{})),ue()&&(Dt.multiLine=(p=Dt.multiLine)===null||p===void 0||p,Dt.maxWidth=(g=Dt.maxWidth)!==null&&g!==void 0?g:J?Math.ceil(N):void 0);const{text:Re,width:de,height:zt}=_f(lt,Dt);L.title.value=Object.assign(Object.assign({width:ue()?Math.min(de,(f=Dt.maxWidth)!==null&&f!==void 0?f:Number.MAX_VALUE):de,height:zt},Dt),{text:Re}),ot=L.title.value.width,ft=L.title.value.height,ut=ft+(J?L.title.spaceRow:0)}return D+=ut,L.title.width=ot,L.title.height=ft,ue()?j+=N||ot:j+=Math.max(ot,N),J&&L.content.forEach(Re=>{var de;const zt=Re.value;zt&&((de=zt.autoWidth)===null||de===void 0||de)&&(zt.width=j-C.left-C.right-z-X-B.spacing-O.spacing,zt.maxWidth||(zt.maxWidth=Math.ceil(zt.width)),L.valueWidth=Math.max(L.valueWidth,zt.width))}),L.panel.width=j,L.panel.height=D,L})(t,this._component.getSpec(),o)}const{panel:a}=(r=this._attributes)!==null&&r!==void 0?r:{};return{width:a.width+a.lineWidth,height:a.height+a.lineWidth}}_removeTooltip(){this._layer&&this._layer.removeAllChild(),this._attributes=null}_updateTooltip(t,e){this._visible=t;const i=this._compiler.getStage();if(!i)return;if(!t)return void(this._tooltipComponent&&this._tooltipComponent.attribute.visible&&(this._tooltipComponent.hideAll(),this._tooltipComponent.setAttributes({visibleAll:!1})));this._tooltipComponent||this._initTooltipComponent(i);const{activeTooltipSpec:n}=e,r=n.position;e.changePositionOnly?R(r)&&this._tooltipComponent.setAttributes(r):this._tooltipComponent.setAttributes(Object.assign(Object.assign({},this._attributes),r)),this._tooltipComponent.attribute.visible||(this._tooltipComponent.showAll(),this._tooltipComponent.setAttributes({visibleAll:!0}))}isTooltipShown(){var t;return(t=this._tooltipComponent)===null||t===void 0?void 0:t.attribute.visibleAll}release(){var t;super.release(),(t=this._layer)===null||t===void 0||t.release()}}Lu.type=pa.canvas;const kP=/\\{([^}]+)\\}/,wP=/\\{([^}]+)\\}/g,TP=/:/;class Kn extends sf{constructor(){super(Kn.type),this.type="formatterPlugin",this._timeModeFormat={utc:ps.getInstance().timeUTCFormat,local:ps.getInstance().timeFormat},this._formatter=this._format,this._timeFormatter=this._timeModeFormat.local,this._numericFormatter=gn.getInstance().format,this._numericSpecifier=gn.getInstance().formatter,this._numericFormatterCache=new Map,this._isNumericFormatterCache=new Map}onInit(t,e){var i;const{globalInstance:n}=t;if(!n)return;this._spec=(i=e==null?void 0:e[Kn.specKey])!==null&&i!==void 0?i:{};const{timeMode:r,customFormatter:a,numericFormatter:o,timeFormatter:l}=this._spec;U(a)?this._formatter=a:(this._formatter=this._format.bind(this),U(l)?this._timeFormatter=l:r&&this._timeModeFormat[r]&&(this._timeFormatter=this._timeModeFormat[r]),o&&(this._numericFormatter=o,this._numericSpecifier=null,this._numericFormatterCache=null)),et.registerFormatter(this._formatter)}_format(t,e,i){return W(t)?t.map((n,r)=>{const a=W(i)?i[r]:i;return a?this._formatSingleLine(n,e,a):n}):W(i)?i.map(n=>this._formatSingleLine(t,e,n)):this._formatSingleLine(t,e,i)}_formatSingleLine(t,e,i){let n;return this._isNumericFormatterCache&&(this._isNumericFormatterCache.get(i)?n=this._isNumericFormatterCache.get(i):(n=kP.test(i),this._isNumericFormatterCache.set(i,n))),n?i.replace(wP,(a,o)=>{if(!TP.test(o)){const u=e[o.trim()];return u!==void 0?u:a}const l=o.split(":"),h=e[l.shift()],c=l.join(":");return this._formatSingleText(h,c)}):this._formatSingleText(t,i)}_formatSingleText(t,e){if($f.test(e)&&this._numericFormatter){let i;return this._numericFormatterCache&&this._numericSpecifier?(this._numericFormatterCache.get(e)?i=this._numericFormatterCache.get(e):(i=this._numericSpecifier(e),this._numericFormatterCache.set(e,i)),i(Number(t))):this._numericFormatter(e,Number(t))}return e.includes("%")&&this._timeFormatter?this._timeFormatter(e,t):t}release(){super.release(),this._format=null,this._timeFormatter=null,this._numericFormatter=null,this._numericSpecifier=null,this._numericFormatterCache=null,this._isNumericFormatterCache=null}}Kn.pluginType="chart",Kn.specKey="formatter",Kn.type="formatterPlugin",Be.useRegisters([()=>{Lg(),Ox(),PS(),LS(),AS(),xS(),wu(),ku(),et.registerSeries(oa.type,oa),et.registerChart(la.type,la)},()=>{Lg(),Ox(),PS(),jO(),LS(),HO(),wu(),ku(),et.registerSeries(cn.type,cn),et.registerChart(ca.type,ca)},()=>{FO(),et.registerChart(ha.type,ha)},()=>{JO(),et.registerChart(sl.type,sl)},()=>{et.registerChart(nl.type,nl)},ku,wu,()=>{et.registerComponent(Pu.type,Pu)},()=>{et.registerComponent(ol.type,ol)},()=>{et.registerComponent(Ou.type,Ou)},()=>{V.registerGraphicComponent(ee.label,s=>new zc(s)),V.registerComponent(ee.label,Ex),nP(),GS(),et.registerComponent(rl.type,rl,!0)},()=>{var s;s=Lu,et.registerComponentPlugin(s.type,s)},()=>{var s;s=Kn,et.registerChartPlugin(s.type,s)},dx,ux]),Be.useRegisters([()=>{pc(kt)}]),K.DEFAULT_CHART_HEIGHT=Pn,K.DEFAULT_CHART_WIDTH=On,K.DEFAULT_DATA_INDEX=Dn,K.DEFAULT_DATA_KEY=Oo,K.DEFAULT_DATA_SERIES_FIELD=$s,K.DEFAULT_MEASURE_CANVAS_ID=aR,K.DEFAULT_SERIES_STYLE_NAME=bg,K.Factory=et,K.MOSAIC_CAT_END_PERCENT=cR,K.MOSAIC_CAT_START_PERCENT=hR,K.MOSAIC_VALUE_END_PERCENT=lR,K.MOSAIC_VALUE_START_PERCENT=oR,K.PREFIX=xt,K.SEGMENT_FIELD_END=dR,K.SEGMENT_FIELD_START=uR,K.STACK_FIELD_END=Xi,K.STACK_FIELD_END_OffsetSilhouette=Qc,K.STACK_FIELD_END_PERCENT=Ks,K.STACK_FIELD_KEY=Vb,K.STACK_FIELD_START=Xs,K.STACK_FIELD_START_OffsetSilhouette=Jc,K.STACK_FIELD_START_PERCENT=Fn,K.STACK_FIELD_TOTAL=Wb,K.STACK_FIELD_TOTAL_BOTTOM=Sg,K.STACK_FIELD_TOTAL_PERCENT=Ub,K.STACK_FIELD_TOTAL_TOP=xg,K.ThemeManager=Gs,K.VChart=Be,K.builtinThemes=Xr,K.computeActualDataScheme=Uc,K.createArc=Xd,K.createArea=$d,K.createGroup=Rd,K.createLine=Gd,K.createRect=fh,K.createRichText=l0,K.createSymbol=gh,K.createText=Ka,K.darkTheme=gg,K.dataScheme=ug,K.default=Be,K.defaultThemeName=Kr,K.getActualColor=mb,K.getColorSchemeBySeries=hg,K.getDataScheme=Gr,K.getMergedTheme=Hb,K.getTheme=vg,K.hasThemeMerged=Io,K.isColorKey=Bo,K.isProgressiveDataColorScheme=Yc,K.isTokenKey=Fb,K.lightTheme=Xc,K.queryColorFromColorScheme=Gc,K.queryToken=Db,K.registerTheme=Zc,K.removeTheme=Nb,K.themeExist=zb,K.themes=Ln,K.token=$r,K.transformColorSchemeToStandardStruct=vb,K.version="1.13.8",K.vglobal=Me,Object.defineProperty(K,"__esModule",{value:!0})})}(gl,gl.exports)),gl.exports}var z1=IP();const OP=BP(z1);Component({properties:{styles:{type:String},canvasId:{type:String},spec:{type:Object,observer(Ae,us){this.chart&&JSON.stringify(Ae)!==JSON.stringify(us)&&this.chart.updateSpec(Ae)}},options:{type:Object,value:{}},events:{type:Object,value:[]}},data:{offscreenCanvasWidth:0,offscreenCanvasHeight:0,chart:void 0},lifetimes:{attached(){this._onload()},detached(){this.chart&&this.chart.release()}},pageLifetimes:{show(){}},methods:{init(){wx.createSelectorQuery().in(this).select(\`#\${this.data.canvasId}_draw_canvas\`).fields({node:!0,size:!0}).exec(async Ae=>{Ae[0].node;const us=[\`\${this.data.canvasId}_draw_canvas\`,\`\${this.data.canvasId}_tooltip_canvas\`,\`\${this.data.canvasId}_hit_canvas\`],K={width:Ae[0].width,height:Ae[0].height};this.setData({offscreenCanvasWidth:K.width,offscreenCanvasHeight:K.height}),this.chart&&this.chart.release(),await z1.vglobal.setEnv("wx",{domref:K,force:!0,canvasIdLists:us,freeCanvasIdx:2,component:this});const ne=new OP({...this.data.spec,width:K.width,height:K.height},{mode:"wx",modeParams:{domref:K,force:!0,canvasIdLists:us,tooltipCanvasId:\`\${this.data.canvasId}_tooltip_canvas\`,freeCanvasIdx:2},dpr:wx.getSystemInfoSync().pixelRatio,renderCanvas:\`\${this.data.canvasId}_draw_canvas\`,...this.data.options});this.chart=ne,this.triggerEvent("chartinit"),this.data.events&&this.data.events.forEach(Ie=>{Ie&&ne.on(Ie.type,{...Ie.query,source:"chart"},Ie.handler)}),ne.renderAsync().then(Ie=>{this.triggerEvent("chartready")})})},_onload(){if(!this.data.spec||!this.data.canvasId){console.warn("组件需绑定 spec 变量并且设置唯一 canvas-id");return}wx.onWindowResize(Ae=>{this.init()}),this.init()},bindEvent(Ae){const{brand:us}=wx.getSystemInfoSync();if(us==="PC"&&Ae.type.startsWith("touch")||us!=="PC"&&Ae.type.startsWith("mouse"))return;const K=this.chart;K&&(Ae.target=K.getCanvas(),K.getStage().window.dispatchEvent(Ae))}}});
"
`;

exports[`build import-umd > dist > components/chart/index.json 1`] = `
"{
  "component": true
}"
`;

exports[`build import-umd > dist > components/chart/index.wxml 1`] = `
"<view class="vchart" id="{{ canvasId }}" style="{{ styles }}">
  <canvas
    class="cs-canvas"
    bindtouchstart="bindEvent"
    bindtouchmove="bindEvent"
    bindtouchend="bindEvent"
    bindmousemove="bindEvent"
    bindmouseover="bindEvent"
    bindmouseout="bindEvent"
    bindmousedown="bindEvent"
    bindmouseup="bindEvent"
    id="{{ canvasId }}_draw_canvas"
    canvas-id="{{ canvasId }}_draw_canvas"
    type="2d"
  ></canvas>
  <canvas width="{{ offscreenCanvasWidth }}" height="{{ offscreenCanvasHeight }}" id="{{ canvasId }}_hit_canvas"
    canvas-id="{{ canvasId }}_hit_canvas" class="cs-tooltip-canvas" type="2d"></canvas>
  <canvas width="{{ offscreenCanvasWidth }}" height="{{ offscreenCanvasHeight }}" id="{{ canvasId }}_tooltip_canvas"
    canvas-id="{{ canvasId }}_tooltip_canvas" class="cs-tooltip-canvas" type="2d"></canvas>
</view>
"
`;

exports[`build import-umd > dist > components/chart/index.wxss 1`] = `
".vchart{width:100%;height:100%;position:relative;padding:0!important}.cs-canvas{width:100%;height:100%;display:block;margin:0}.cs-canvas-hidden{opacity:0;visibility:hidden;display:none}.cs-tooltip-canvas{width:100%;height:100%;position:absolute;top:0;left:0;z-index:1;pointer-events:none}
/*$vite$:1*/"
`;

exports[`build import-umd > dist > pages/index/index.js 1`] = `
"Page({data:{spec:{},events:[],options:{}},chartType:"",stage:void 0,onLoad(e){this.chartType=e.name||"";const a={type:"bar",data:[{id:"barData",values:[{type:"Autocracies",year:"1930",value:129},{type:"Autocracies",year:"1940",value:133},{type:"Autocracies",year:"1950",value:130},{type:"Autocracies",year:"1960",value:126},{type:"Autocracies",year:"1970",value:117},{type:"Autocracies",year:"1980",value:114},{type:"Autocracies",year:"1990",value:111},{type:"Autocracies",year:"2000",value:89},{type:"Autocracies",year:"2010",value:80},{type:"Autocracies",year:"2018",value:80},{type:"Democracies",year:"1930",value:22},{type:"Democracies",year:"1940",value:13},{type:"Democracies",year:"1950",value:25},{type:"Democracies",year:"1960",value:29},{type:"Democracies",year:"1970",value:38},{type:"Democracies",year:"1980",value:41},{type:"Democracies",year:"1990",value:57},{type:"Democracies",year:"2000",value:87},{type:"Democracies",year:"2010",value:98},{type:"Democracies",year:"2018",value:99}]}],xField:["year","type"],yField:"value",seriesField:"type",legends:{visible:!0,orient:"top",position:"start"},axes:[{orient:"left",label:{formatMethod:t=>\`$\${t}\`}}]};this.setData({spec:a})},onChartInit(e){console.log("chart 实例初始化完成",e)},onChartReady(e){console.log("chart 实例渲染完成",e)}});
"
`;

exports[`build import-umd > dist > pages/index/index.json 1`] = `
"{
  "usingComponents": {
    "Navbar": "/components/Navbar/Navbar",
    "chart": "/components/chart/index"
  },
  "navigationBarTitleText": "初始模板"
}"
`;

exports[`build import-umd > dist > pages/index/index.wxml 1`] = `
"<view>
  <Navbar />
  <chart canvas-id="chart" spec="{{ spec }}" styles="{{ styles }}" events="{{ events }}" bind:chartinit="onChartInit" bind:chartready="onChartReady" />
</view>"
`;

exports[`build import-umd > dist > pages/index/index.wxss 1`] = `
".page{color:red}
/*$vite$:1*/"
`;

exports[`build import-umd > dist > sitemap.json 1`] = `
"{
  "desc": "关于本文件的更多信息，请参考文档 https://developers.weixin.qq.com/miniprogram/dev/framework/sitemap.html",
  "rules": [
    {
      "action": "allow",
      "page": "*"
    }
  ]
}"
`;

exports[`build import-umd > dist > theme.json 1`] = `
"{
  "light": {},
  "dark": {}
}"
`;

exports[`build import-umd > dist 1`] = `
[
  "app.js",
  "app.json",
  "app.wxss",
  "components/Navbar/Navbar.js",
  "components/Navbar/Navbar.json",
  "components/Navbar/Navbar.wxml",
  "components/Navbar/Navbar.wxss",
  "components/chart/index.js",
  "components/chart/index.json",
  "components/chart/index.wxml",
  "components/chart/index.wxss",
  "pages/index/index.js",
  "pages/index/index.json",
  "pages/index/index.wxml",
  "pages/index/index.wxss",
  "sitemap.json",
  "theme.json",
]
`;
